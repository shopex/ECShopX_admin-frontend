"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[99],{70099:function(t,e,a){a.r(e),a.d(e,{default:function(){return m}});a(44114),a(18111),a(7588);var s=a(72505),o=a.n(s),i=a(71710),n=a.n(i),l=a(91936),r=a.n(l),c=a(27192),d=a(77825),p=a(82997);var h={components:{timeChoose:c.default},mixins:[d.Ay,d.at,d.v8],data(){return{monitor_id:"",detail:{monitor_id:"",monitor_path:"",monitor_path_params:"",nick_name:""},dialogVisible:!1,loading:!1,statstotal:{total_pv:0,total_uv:0,total_member_visitor:0,total_visitor:0,total_pay_num:0,total_pay_amount:0,total_fans_num:0,total_register_num:0,total_entries_num:0,total_conversion_rate:"0%"},dataList:[],wxaCodeInfo:{source_name:"",code_src:"",source_id:"",monitor_id:""},pickerOptions:{disabledDate(t){return t.getTime()>Date.now()-864e5}},pickerOptions2:{disabledDate(t){return t.getTime()>Date.now()-864e5}},timeTypeOptions:[{value:"1",label:$t("dkrhb74","最近7天","lang")},{value:"2",label:$t("5bf5dx5","最近30天","lang")},{value:"3",label:$t("jks2l3","自然天","lang")},{value:"4",label:$t("ad4gxf4","今日实时","lang")},{value:"5",label:$t("jh1ll3","自定义","lang")}],chooseDate:"",customDate:"",timeType:"4",typeText:"",isNeardate:!0,ischooseDay:!1,isRealTime:!1,iscustom:!1,checkedSource:[],codeDialogVisible:!1,dataSpan:[],codeInterval:10,codeLeft:!1,codespanIndex:-1,codeSpanMax:-1,codeSpanMin:-1,isdownloadOk:!1,linkPathStr:""}},mounted(){this.timeTypeChange(this.timeType),this.monitor_id=this.$route.query.monitorId,this.getPageInfo(),this.getStats()},methods:{remove(t){this.$confirm($t("9ocmsgc","确定是否删除该监控来源?","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(()=>{(0,p.deleteRelSources)(t.monitor_id,t.source_id).then(t=>{this.$message({message:$t("7dvduc8","删除监控来源成功","lang"),type:"success",duration:2e3}),this.getPageInfo(),this.getStats()}).catch(()=>{this.$message({type:"error",message:$t("7du72x8","删除监控来源失败","lang")})})}).catch(()=>{this.$message({type:"info",message:$t("e68dg3","已取消","lang")})})},viewOrder(t){window.open(`/order/entitytrade/tradenormalorders?sourceId=${t.source_id}&monitorId=${t.monitor_id}`,"_blank")},showlink(t){var e=this;e.wxaCodeInfo.source_name=t.source_name,e.wxaCodeInfo.source_id=t.source_id,e.wxaCodeInfo.monitor_id=t.monitor_id;let a={monitor_id:t.monitor_id,source_id:t.source_id};(0,p.getMonitorsWxaCode64)(a).then(t=>{e.wxaCodeInfo.code_src=t.data.data.base64Image}),e.linkPathStr=this.detail?.monitor_path_params?this.detail?.monitor_path+"?"+this.detail?.monitor_path_params+"&m="+t?.monitor_id+"&s="+t?.source_id:this.detail?.monitor_path+"?m="+t?.monitor_id+"&s="+t?.source_id,e.dialogVisible=!0},getLinkPath(t){return this.detail?.monitor_path_params?this.detail?.monitor_path+"?"+this.detail?.monitor_path_params+"&m="+t?.monitor_id+"&s="+t?.source_id:this.detail?.monitor_path+"?m="+t?.monitor_id+"&s="+t?.source_id},cancelDialog(){this.dialogVisible=!1},downloadCode(t,e){var a=document.createElement("a");a.href=e,a.download=t+".png",a.click()},getPageInfo(){(0,p.getMonitorsDetail)(this.monitor_id).then(t=>{this.detail=t.data.data})},getStats(){let t={};switch(t.monitor_id=this.monitor_id,this.timeType){case"1":t.date_type="before7days";break;case"2":t.date_type="before30days";break;case"3":if(t.date_type="custom",!this.chooseDate)return this.$message.error($t("2ekjhr5","请选择日期","lang")),!1;t.begin_date=this.getTaskTime(this.chooseDate,!0),t.end_date=this.getTaskTime(this.chooseDate,!0);break;case"4":t.date_type="today";break;case"5":if(t.date_type="custom",!this.customDate)return this.$message.error($t("x307s27","请选择日期范围","lang")),!1;t.begin_date=this.getTaskTime(this.customDate[0],!0),t.end_date=this.getTaskTime(this.customDate[1],!0)}this.dataSpan=[],(0,p.getMonitorsStats)(t).then(t=>{this.dataList=t.data.data.stats_list,this.statstotal=t.data.data.stats_total;var e=0;(this.dataList.length/this.codeInterval+"").indexOf(".")>=0?(e=parseInt(this.dataList.length/this.codeInterval),this.codeLeft=!0):e=this.dataList.length/this.codeInterval;var a=0;0==e&&this.dataSpan.push("0~"+this.dataList.length);for(var s=0;s<e;s++)0===s?this.dataSpan.push(s+1+"~"+10*(s+1)):this.dataSpan.push(a+1+"~"+10*(s+1)),a=10*(s+1);e>0&&this.codeLeft&&this.dataSpan.push(e*this.codeInterval+1+"~"+this.dataList.length)})},searchStats(){this.getStats()},timeTypeChange(t){var e=864e5,a=new Date((new Date).getTime()-e);a=this.getTaskTime(a,!0);var s="";switch(this.isNeardate=this.ischooseDay=this.isRealTime=this.iscustom=!1,t){case"1":s=this.getTaskTime(new Date((new Date).getTime()-7*e),!0),this.typeText=s+$t("mrhp3"," 至 ","lang")+a,this.isNeardate=!0;break;case"2":s=this.getTaskTime(new Date((new Date).getTime()-30*e),!0),this.typeText=s+$t("mrhp3"," 至 ","lang")+a,this.isNeardate=!0;break;case"3":this.ischooseDay=!0;break;case"4":this.isRealTime=this.isNeardate=!0,this.typeText=this.getTaskTime("",!1);break;case"5":this.iscustom=!0}},getTaskTime(t,e){let a=t||new Date,s=a.getFullYear(),o=a.getMonth()+1;o=o<10?"0"+o:o;let i=a.getDate();i=i<10?"0"+i:i;let n=a.getHours();n=n<10?"0"+n:n;let l=a.getMinutes();l=l<10?"0"+l:l;let r=a.getSeconds();return r=r<10?"0"+r:r,e?s+"-"+o+"-"+i:s+"-"+o+"-"+i+" "+n+":"+l+":"+r},getRealTime(){this.typeText=this.getTaskTime("",!1)},handleRowKey:function(t){return t.source_id},handleBatchDownload:function(){if(this.checkedSource.length<=0)return void this.$message({type:"error",message:$t("hq6t1pa","请至少选择一条数据!","lang")});if(this.checkedSource.length>20)return void this.$message({type:"error",message:$t("gznh04p","每次最多可选择20条数据!否则可能导致浏览器崩溃！","lang")});const t=new(n()),e={},a=[];var s=this;this.checkedSource.forEach(s=>{const i=(t=>new Promise((e,a)=>{o()({method:"get",url:t,responseType:"arraybuffer"}).then(t=>{e(t.data)}).catch(t=>{a(t.toString())})}))(this.BASE_API+"/datacube/monitorsWxaCodeStream?monitor_id="+s.monitor_id+"&source_id="+s.source_id).then(a=>{const o=s.source_name+"("+s.source_id+").png";t.file(o,a,{binary:!0,date:new Date(Date.now()+288e5)}),e[o]=a});a.push(i)}),this.checkedSource=[],Promise.all(a).then(()=>{t.generateAsync({type:"blob"}).then(t=>{r().saveAs(t,"小程序码(批量).zip"),s.isdownloadOk=!0})})},codePack(){this.codeDialogVisible=!0,this.codespanIndex=-1,this.codeSpanMin=-1,this.codeSpanMax=-1,this.isdownloadOk=!1},codeSpanChoose(t){this.isdownloadOk=!1,this.codespanIndex=t;var e=this.dataSpan[t].split("~");if(this.codeSpanMin=Number(e[0]),this.codeSpanMax=Number(e[1]),this.checkedSource=[],!(this.codeSpanMin<0||this.codeSpanMax<0)){for(var a=0===this.codeSpanMin?0:this.codeSpanMin-1;a<this.dataList.length;a++)a<this.codeSpanMax&&this.checkedSource.push(this.dataList[a]);this.handleBatchDownload()}},handleBack(){this.$router.back()}}},m=(0,a(81656).A)(h,function(){var t=this,e=t._self._c;return e("div",{staticClass:"section-white content-padded"},[e("div",[e("el-button",{attrs:{size:"small",type:"text"},on:{click:t.handleBack}},[t._v($t("goh68i6"," < 返回 ","lang"))]),t._v($t("8c6yyw6"," 页面路径：","lang")),e("a",{staticClass:"page-name",attrs:{href:"#"}},[t._v(t._s(t.detail.monitor_path)),e("span",{directives:[{name:"show",rawName:"v-show",value:""!=t.detail.monitor_path_params,expression:"detail.monitor_path_params != ''"}]},[t._v("?"+t._s(t.detail.monitor_path_params))])]),e("span",[t._v($t("c4d4cn4","小程序：","lang")+t._s(t.detail.nick_name))])],1),e("div",{staticClass:"time-box"},[e("div",[e("span",[t._v($t("e92amm5","日期筛选：","lang"))]),e("el-select",{on:{change:t.timeTypeChange},model:{value:t.timeType,callback:function(e){t.timeType=e},expression:"timeType"}},t._l(t.timeTypeOptions,function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1),t.isNeardate?e("span",[t._v(t._s(t.typeText)),t.isRealTime?e("span",{staticClass:"refresh",on:{click:t.getRealTime}},[t._v($t("hu613"," 刷新","lang"))]):t._e()]):t._e(),t.ischooseDay?e("el-date-picker",{attrs:{type:"date",placeholder:$t("ikzrh64","选择日期","lang"),"picker-options":t.pickerOptions},model:{value:t.chooseDate,callback:function(e){t.chooseDate=e},expression:"chooseDate"}}):t._e(),t.iscustom?e("el-date-picker",{attrs:{type:"daterange",placeholder:$t("to1gvf6","选择日期范围","lang"),"picker-options":t.pickerOptions2},model:{value:t.customDate,callback:function(e){t.customDate=e},expression:"customDate"}}):t._e(),e("el-button",{staticStyle:{margin:"0 10px"},attrs:{type:"primary",size:"small"},on:{click:t.searchStats}},[t._v($t("gg26b4"," 查询 ","lang"))])],1)]),e("div",{staticClass:"time-box basic"},[e("el-row",[e("el-col",{attrs:{span:2}},[t._v(" PV: "),e("span",[t._v(t._s(t.statstotal.total_pv))])]),e("el-col",{attrs:{span:2}},[t._v(" UV: "),e("span",[t._v(t._s(t.statstotal.total_uv))])]),e("el-col",{attrs:{span:3}},[t._v($t("dwpmb88"," 会员访客量: ","lang")),e("span",[t._v(t._s(t.statstotal.total_member_visitor))])]),e("el-col",{attrs:{span:3}},[t._v($t("d1n6dg8"," 游客访问量: ","lang")),e("span",[t._v(t._s(t.statstotal.total_visitor))])]),e("el-col",{attrs:{span:2}},[t._v($t("pny9v56"," 注册量: ","lang")),e("span",[t._v(t._s(t.statstotal.total_register_num))])]),e("el-col",{attrs:{span:3}},[t._v($t("gzlltn7"," 支付人数: ","lang")),e("span",[t._v(t._s(t.statstotal.total_pay_num))])]),e("el-col",{attrs:{span:3}},[t._v($t("geosae7"," 支付单数: ","lang")),e("span",[t._v(t._s(t.statstotal.total_entries_num))])]),e("el-col",{attrs:{span:3}},[t._v($t("evevit7"," 支付总价: ","lang")),e("span",[t._v(t._s(t.statstotal.total_pay_amount/100))])]),e("el-col",{attrs:{span:2}},[t._v($t("imo5ib6"," 转化率: ","lang")),e("span",[t._v(t._s(t.statstotal.total_conversion_rate))])])],1)],1),e("div",[e("div",{staticClass:"content-bottom-padded"},[e("el-button",{attrs:{type:"primary"},on:{click:t.codePack}},[t._v($t("acgfgr7"," 二维码打包 ","lang"))])],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.dataList,"row-key":t.handleRowKey}},[e("el-table-column",{attrs:{prop:"source_id",label:$t("dho5d24","来源ID","lang")}}),e("el-table-column",{attrs:{prop:"monitor_id",label:$t("fe3ij54","监控ID","lang")}}),e("el-table-column",{attrs:{prop:"source_name",label:$t("di32by4","来源名称","lang")}}),e("el-table-column",{attrs:{prop:"total_pv",label:"PV"}}),e("el-table-column",{attrs:{prop:"total_uv",label:"UV"}}),e("el-table-column",{attrs:{prop:"total_member_visitor",label:$t("ynegq95","会员访客数","lang")}}),e("el-table-column",{attrs:{prop:"total_visitor",label:$t("gww7au5","游客访问量","lang")}}),e("el-table-column",{attrs:{prop:"register_num",label:$t("gcxij3","注册量","lang")}}),e("el-table-column",{attrs:{prop:"total_pay_num",label:$t("d3de0v4","支付人数","lang")}}),e("el-table-column",{attrs:{prop:"entries_num",label:$t("d3e6844","支付单数","lang")}}),e("el-table-column",{attrs:{prop:"total_pay_amount",label:$t("d3g8rp4","支付总价","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.total_pay_amount/100)+" ")]}}])}),e("el-table-column",{attrs:{prop:"conversion_rate",label:$t("lf0yl3","转化率","lang")}}),e("el-table-column",{attrs:{label:$t("hkxb2","操作","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return[e("a",{attrs:{href:"#"},on:{click:function(e){return t.showlink(a.row)}}},[t._v($t("pw132","链接","lang"))]),t._v("   "),e("a",{attrs:{href:"#"},on:{click:function(e){return t.remove(a.row)}}},[t._v($t("eslg2","删除","lang"))]),t._v("   "),e("a",{attrs:{href:"#"},on:{click:function(e){return t.viewOrder(a.row)}}},[t._v($t("dlur7d4","查看订单","lang"))]),e("a",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.getLinkPath(a.row),expression:"getLinkPath(scope.row)",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:t.onCopySuccess,expression:"onCopySuccess",arg:"success"}],attrs:{href:"#"}},[t._v($t("j66ck06"," 复制链接 ","lang"))])]}}])})],1)],1),e("el-dialog",{attrs:{title:$t("viycmx5","二维码信息","lang"),visible:t.dialogVisible,"close-on-click-modal":!1,"before-close":t.cancelDialog}},[[e("el-alert",{attrs:{title:$t("tsjkstl","将此链接或二维码进行投放，获取对应跟踪数据","lang"),type:"warning",closeable:!1}}),e("el-row",{staticClass:"row-bg"},[e("el-col",{attrs:{span:4}},[e("div",{staticClass:"grid-content"},[t._v($t("di32by4","来源名称","lang"))])]),e("el-col",{attrs:{span:15}},[t._v(" "+t._s(t.wxaCodeInfo.source_name)+" ")])],1),e("el-row",{staticClass:"row-bg"},[e("el-col",{attrs:{span:4}},[e("div",{staticClass:"grid-content"},[t._v($t("4qe6mm5","跟踪二维码","lang"))])]),e("el-col",{attrs:{span:15}},[e("img",{staticStyle:{width:"100%",height:"100%"},attrs:{src:t.wxaCodeInfo.code_src}})])],1),e("el-row",{staticClass:"row-bg-btn"},[e("el-col",{attrs:{span:12}},[e("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){return t.downloadCode(t.wxaCodeInfo.source_name,t.wxaCodeInfo.code_src)}}},[t._v($t("bvnzdz7"," 下载二维码 ","lang"))])],1),e("el-col",{attrs:{span:12}},[e("el-button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.linkPathStr,expression:"linkPathStr",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:t.onCopySuccess,expression:"onCopySuccess",arg:"success"}],attrs:{type:"primary",plain:""}},[t._v($t("j66ck06"," 复制链接 ","lang"))])],1)],1)]],2),e("el-dialog",{attrs:{title:$t("ziajnh7","二维码打包下载","lang"),visible:t.codeDialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(e){t.codeDialogVisible=e}}},[t.dataList.length>0?t._l(t.dataSpan,function(a,s){return e("div",{staticClass:"code-span",class:{cur:s===t.codespanIndex},on:{click:function(e){return t.codeSpanChoose(s)}}},[e("span",[t._v(t._s(a))]),s!==t.codespanIndex||t.isdownloadOk?t._e():e("span",{staticClass:"bg-waiting"},[e("i",{staticClass:"el-icon-loading"})]),s===t.codespanIndex&&t.isdownloadOk?e("span",{staticClass:"download-ok"},[e("i",{staticClass:"el-icon-circle-check"})]):t._e()])}):t._e()],2)],1)},[],!1,null,"4a62db03",null).exports}}]);