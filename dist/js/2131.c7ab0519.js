"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[2131],{2131:function(e,t,a){a.r(t),a.d(t,{default:function(){return r}});a(44114),a(18111),a(7588);var i=a(9108),s={components:{imgPicker:a(87378).default},data(){return{loading:!1,spaceInput:!1,categoryList:[],total_count:0,params:{category_type:"general"},imgDialog:!1,isGetImage:!1,current:""}},mounted(){this.getArticleCategory()},methods:{onCopy(){this.$notify.success({message:$t("bkv2mw4","复制成功","lang"),showClose:!0})},getArticleCategory(){this.loading=!0,(0,i.getArticleCategoryList)(this.params).then(e=>{let t=e.data.data;t.forEach((e,a)=>{let i=`/pages/recommend/list?id=${e.category_id}&name=${e.category_name}`;t[a]={...e,link:i}}),this.categoryList=t,this.loading=!1})},updateCategory(){for(var e=0;e<this.categoryList.length;e++){for(var t=0;t<this.categoryList.length-1-e;t++)if(this.categoryList[t].category_name==this.categoryList[t+1].category_name)return this.$message({type:"error",message:$t("7dz2o1a","同级栏目名称不能相同","lang")}),!1;if(!this.catNameCheck(this.categoryList[e].category_name))return!1;for(var a=0;a<this.categoryList[e].children.length;a++){for(var s=0;s<this.categoryList[e].children.length-1-a;s++)if(this.categoryList[e].children[s].category_name==this.categoryList[e].children[s+1].category_name)return this.$message({type:"error",message:$t("7dz2o1a","同级栏目名称不能相同","lang")}),!1;if(!this.catNameCheck(this.categoryList[e].children[a].category_name))return!1}}let r=JSON.stringify(this.categoryList);(0,i.saveArticleCategory)({form:r}).then(e=>{this.$message({type:"success",message:$t("zfxtjr6","保存栏目成功","lang")}),this.getArticleCategory()})},deleteCategory(e,t){this.$confirm($t("svdg9tg","此操作将删除该栏目, 是否继续?","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(()=>{if(void 0!==t.category_id)(0,i.deleteArticleCategoryInfo)(t.category_id).then(e=>{this.$message({type:"success",message:$t("rn8zse6","删除栏目成功","lang")}),this.getArticleCategory()});else{const a=e.parent,i=a.data.children||a.data,s=i.findIndex(e=>e.id===t.id);i.splice(s,1)}}).catch(()=>{this.$message({type:"info",message:$t("e68dg3","已取消","lang")})})},append(e,t=0){const a={category_name:"",sort:0,level:t,children:[],created:0,image_url:"",category_type:"general"};e.push(a)},catNameCheck(e){let t=0;if(e){for(var a=0;a<e.length;a++)e.charCodeAt(a)>255?t+=2:t++;return!(t>12)||(this.$message({type:"error",message:$t("832f5li","栏目名称长度最多6个汉字或12个字符","lang")}),!1)}return this.$message({type:"error",message:$t("ikol736","栏目不能为空","lang")}),!1},handleImgChange(e){this.imgDialog=!0,this.isGetImage=!0,this.current=e},pickImg(e){if(this.current.parent_id&&0!=this.current.parent_id){const t=this.categoryList.findIndex(e=>e.id===this.current.parent_id),a=this.categoryList[t].children.findIndex(e=>e.id===this.current.id);this.categoryList[t].children[a].image_url=e.url}else{const t=this.categoryList.findIndex(e=>e.id===this.current.id);this.categoryList[t].image_url=e.url}this.imgDialog=!1},closeImgDialog(){this.imgDialog=!1}}},r=(0,a(81656).A)(s,function(){var e=this,t=e._self._c;return t("SpPage",[t("div",{staticClass:"custom-tree-container"},[t("div",{staticClass:"action-container"},[t("el-button",{attrs:{type:"primary",icon:"plus"},on:{click:e.updateCategory}},[e._v($t("fs2j8a6"," 保存栏目 ","lang"))])],1),t("div",{staticClass:"block"},[t("ul",{staticClass:"custom-tree-node-title"},[t("li",[e._v($t("dmbqf64","栏目名称","lang"))]),t("li",[e._v($t("dme81o4","栏目排序","lang"))]),t("li",[e._v($t("bl3tv44","复制链接","lang"))]),t("li",[e._v($t("ar84e54","创建时间","lang"))]),t("li",[e._v($t("hkxb2","操作","lang"))])])]),t("div",{staticClass:"tree-background block"},[t("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.categoryList,"default-expand-all":"","expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function({node:a,data:i}){return t("ul",{staticClass:"custom-tree-node"},[t("li",[0==i.level?t("i"):t("i",[e._v("　├─")]),t("input",{directives:[{name:"model",rawName:"v-model",value:i.category_name,expression:"data.category_name"}],attrs:{placeholder:$t("dmbqf64","栏目名称","lang")},domProps:{value:i.category_name},on:{input:function(t){t.target.composing||e.$set(i,"category_name",t.target.value)}}})]),t("li",[t("input",{directives:[{name:"model",rawName:"v-model",value:i.sort,expression:"data.sort"}],attrs:{placeholder:$t("dme81o4","栏目排序","lang")},domProps:{value:i.sort},on:{input:function(t){t.target.composing||e.$set(i,"sort",t.target.value)}}})]),t("li",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:i.link,expression:"data.link",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.onCopy,expression:"onCopy",arg:"success"}]},[t("input",{directives:[{name:"model",rawName:"v-model",value:i.link,expression:"data.link"}],staticClass:"copy-link",attrs:{type:"text"},domProps:{value:i.link},on:{input:function(t){t.target.composing||e.$set(i,"link",t.target.value)}}}),t("i",{staticClass:"iconfont icon-copy"}),e._v($t("3pfzrj8"," 复制栏目链接 ","lang"))]),i.created?t("li",[e._v(" "+e._s(e._f("datetime")(i.created))+" ")]):t("li"),t("li",[t("span",{staticClass:"remove-category",on:{click:function(t){return e.deleteCategory(a,i)}}},[t("i",{staticClass:"iconfont icon-trash-alt"})])])])}}])}),t("div",{staticClass:"add-category"},[t("span",{on:{click:function(t){return e.append(e.categoryList)}}},[t("i",{staticClass:"el-icon-plus"}),e._v($t("bizlkx4","增加栏目","lang"))])])],1),t("imgPicker",{attrs:{"dialog-visible":e.imgDialog,"sc-status":e.isGetImage},on:{chooseImg:e.pickImg,closeImgDialog:e.closeImgDialog}})],1)])},[],!1,null,"d665211a",null).exports}}]);