"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[6632],{26632:function(t,e,a){a.r(e),a.d(e,{default:function(){return r}});var n=a(94644),i=(a(57270),{components:{loadingBtn:a(79836).default},data(){return{search_options:[],exportLoading:!1}},computed:{setting(){return(t=>{const e=t=>{if(!t)return"-";var e=new Date(1e3*t);return e.getFullYear()+"-"+(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())};return(0,n.createSetting)({columns:[{name:$t("fd5ujm4","申请时间","lang"),key:"created",width:200,formatter:e},{name:$t("kz6ms95","申请人账号","lang"),key:"operator",width:120},{name:$t("fd4l7r4","申请店铺","lang"),key:"distributor_name",width:120},{name:$t("cjbhr24","店铺id","lang"),key:"distributor_id",width:100},{name:$t("fd2q514","申请商户","lang"),key:"merchant_name",width:120},{name:$t("b5ky304","商户id","lang"),key:"merchant_id",width:100},{name:$t("d2r9004","提现类型","lang"),key:"withdraw_type",width:100,formatter:t=>({D0:"D0",D1:"D1",T1:"T1"}[t]||t)},{name:$t("d2v8i44","提现金额","lang"),key:"amount",width:120,formatter:t=>t?(t/100).toFixed(2).toLocaleString():"0.00"},{name:$t("dllgxp4","查看发票","lang"),key:"invoice_file",width:100,render:(t,{row:e})=>e.invoice_file?t("el-image",{props:{src:e.invoice_file,"preview-src-list":[e.invoice_file],fit:"cover"},style:{width:"50px",height:"50px"}}):t("span","-")},{name:$t("byza2e4","审批时间","lang"),key:"audit_time",width:200,formatter:e},{name:$t("bzr5iw4","审核备注","lang"),key:"audit_remark",width:150},{name:$t("glh41g5","审核人账号","lang"),key:"auditor",width:120},{name:$t("d2pmuj4","提现状态","lang"),key:"status",width:100,formatter:t=>({0:$t("dxb9y3","审核中","lang"),1:$t("c00pno4","审核通过","lang"),2:$t("e8vjx3","已拒绝","lang"),3:$t("dljhn3","处理中","lang"),4:$t("bpnma94","处理成功","lang"),5:$t("bpmfiu4","处理失败","lang")}[t]||t)},{name:$t("d2ul1n4","提现进度","lang"),key:"failure_reason",width:150},{name:$t("hkxb2","操作","lang"),key:"action",width:150,fixed:"right",render:(e,{row:a})=>"0"===a.status?e("div",[e("el-button",{props:{type:"primary",size:"mini"},on:{click:()=>t.handleAudit(a,"approve")}},$t("past2","通过","lang")),e("el-button",{props:{type:"danger",size:"mini"},style:{marginLeft:"8px"},on:{click:()=>t.handleAudit(a,"reject")}},$t("hi6j2","拒绝","lang"))]):e("span","-")}]})})(this)}},methods:{beforeSearch(t){return{...t,type:"audit"}},afterSearch({data:t}){const{search_options:e={}}=t.data;this.search_options=e.status},async handleAudit(t,e){try{const a="approve"===e?$t("usgt7ea","确认通过此提现申请？","lang"):$t("7ln96wa","确认拒绝此提现申请？","lang"),n="approve"===e?$t("past2","通过","lang"):$t("hi6j2","拒绝","lang");await this.$confirm(a,$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"approve"===e?"success":"warning"});const{value:i}=await this.$prompt($t("ljbvbz7","请输入审核备注","lang"),$t("bzr5iw4","审核备注","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),inputPattern:/.+/,inputErrorMessage:$t("49c8r56","备注不能为空","lang")}),r={apply_id:t.id,action:e,remark:i};(await this.$api.bspay.withdrawAudit(r)).status?(this.$message.success(`${n}${$t("h4sv2","成功","lang")}`),this.$refs.finder.refresh(!0)):this.$message.error(`${n}${$t("fy1g2","失败","lang")}`)}catch(t){"cancel"!==t&&this.$message.error($t("bzrcwb4","审核失败","lang"))}},async handleExport(){try{this.exportLoading=!0;const t={type:"audit",export_type:"bspay_withdraw"},e=await this.$api.bspay.exportWithdrawData(t);e.status?e.data&&e.data.file_url?(this.downloadFile(e.data.file_url,e.data.file_name||"提现数据.xlsx"),this.$message.success($t("by5dal4","导出成功","lang"))):(this.$message.success($t("xdh90kk","已加入执行队列，请在设置-导出列表中下载","lang")),this.$export_open("bspay_withdraw")):this.$message.error(e.message||$t("by46j64","导出失败","lang"))}catch(t){this.$message.error($t("by46j64","导出失败","lang"))}finally{this.exportLoading=!1}},downloadFile(t,e){const a=document.createElement("a");a.href=t,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a)}}}),r=(0,a(81656).A)(i,function(){var t=this,e=t._self._c;return e("SpPage",[e("div",{staticClass:"zyk_withdraw_audit"},[e("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v($t("d2lr4n4","提现审核","lang"))])]),e("div",{staticClass:"content"},[e("div",{staticClass:"toolbar"},[e("el-button",{attrs:{type:"primary",icon:"el-icon-download",loading:t.exportLoading},on:{click:t.handleExport}},[t._v($t("uf2qh06"," 导出数据 ","lang"))])],1),e("div",{staticClass:"list"},[e("SpFinder",{ref:"finder",attrs:{"no-selection":!0,setting:t.setting,url:"/bspay/withdraw/lists",hooks:{beforeSearch:t.beforeSearch,afterSearch:t.afterSearch}}})],1)])])],1)])},[],!1,null,"b1c98028",null).exports}}]);