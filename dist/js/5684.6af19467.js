"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[5684],{95684:function(t,e,i){i.r(e),i.d(e,{default:function(){return g}});i(18111),i(20116),i(7588),i(61701);var a=i(95353),l=i(2038),r=i(8690),s=i(59025),o=i(87378),n=i(43224),d={components:{imgPicker:o.default,imgBox:n.A},data(){return{isDisable:!1,loading:!1,spaceInput:!1,categoryList:[],total_count:0,imgDialog:!1,isGetImage:!1,current:"",dialog:{visible:!1,label:"",is_hassuperior:!1,superior_cat_name:"",superior_cat_id:"",sort:0,current_id:"",cat_img:"",loading:!1,type:"add",distributor_id:[],address:""},distributorList:[],addList:[],params:{label:""}}},computed:{...(0,a.L8)(["login_type"])},mounted(){this.getCategory(),this.getDistributor(),this.getAddress()},methods:{onSearch(){this.getCategory()},getAddress(){this.loading=!0,(0,s.getAddress)().then(t=>{this.loading=!1;const e=t.data.data;if(e&&e.length>0){const t=e.map(t=>({label:t.label,value:t.value}));let i=[];e.forEach(t=>{i=i.concat(t.children.map(t=>({label:t.label,value:t.value})))});let a=[];e.forEach(t=>{t.children.forEach(t=>{a=a.concat(...t.children.map(t=>({label:t.label,value:t.value})))})}),this.addList=e,this.province=t,this.city=i,this.area=a}})},append(t){this.dialog={...this.dialog,visible:!0,is_hassuperior:!0,superior_cat_name:t.label,superior_cat_id:t.category_id,current_id:t.id,type:"add",label:"",title:$t("g6r32","居委","lang")}},editCategory(t){this.dialog={...this.dialog,visible:!0,is_hassuperior:!1,type:"edit",current_id:t.id,distributor_id:t.distributor_id,label:t.label,parent_id:t.parent_id,title:0==t.parent_id?$t("nzdo2","街道","lang"):$t("g6r32","居委","lang"),address:t.regions_id}},handleDeleteImg(){this.dialog.cat_img=null},handleSubmit(){const t=this,{label:e,type:i,current_id:a,parent_id:l,distributor_id:s,address:o,is_hassuperior:n,title:d}=this.dialog;if(n||d!=$t("nzdo2","街道","lang")||o)if(e){this.dialog.loading=!0;let g={};if(!n&&d==$t("nzdo2","街道","lang")){const t=this.province.find(t=>t.value===o[0]),e=this.city.find(t=>t.value===o[1]),i=this.area.find(t=>t.value===o[2]);t&&e&&i||this.$message.error($t("paxor69","选择的地区不存在！","lang")),g.regions_id=o,g.province=t.label,g.city=e.label,g.area=i.label}"add"===i?(g={...g,label:e,parent_id:a||0,distributor_id:s},(0,r.addSubDistrictInfo)(g).then(e=>{t.dialog={...t.dialog,loading:!1,visible:!1,label:"",cat_img:"",sort:0,is_hassuperior:!1,superior_cat_id:"",superior_cat_name:""},t.getCategory()}).catch(e=>{e&&(t.dialog.loading=!1)})):(g={...g,id:a,label:e,parent_id:l,distributor_id:s},(0,r.updateSubDistrictInfo)(g).then(e=>{t.dialog={...t.dialog,loading:!1,visible:!1,label:"",cat_img:"",sort:0,is_hassuperior:!1,superior_cat_id:"",superior_cat_name:""},t.getCategory()}).catch(e=>{e&&(t.dialog.loading=!1)}))}else this.$message.error($t("aqhkh45","名称必填！","lang"));else this.$message.error($t("3ch3fx5","地区必选！","lang"))},getDistributor(){(0,l.getDistributorList)({page:1,pageSize:500}).then(t=>{t.data.data.list&&(this.distributorList=t.data.data.list.map(t=>({...t,distributor_id:t.distributor_id+""})))})},getCategory(){this.loading=!0,(0,r.getSubDistrictList)(this.params).then(t=>{this.categoryList=t.data.data,this.categoryList.forEach(t=>{t.distributor_list=t.distributor_id.map((e,i)=>({id:e+"",name:t.distributor[i]})),t.distributor_id=t.distributor_id.map(t=>t+"")}),this.loading=!1,this.spaceInput=!1})},deleteCategory(t){this.$confirm($t("59pcidg","此操作将删除该分类, 是否继续?","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(()=>{if(void 0!==t.id)(0,r.deleteSubDistrictInfo)(t.id).then(t=>{this.$message({type:"success",message:$t("uehn3s6","删除分类成功","lang")}),this.getCategory()});else{const{level:e,id:i,parent_id:a}=t;let l=0===e?i:a;const r=this.categoryList,s=r.findIndex(t=>t.id===l),o=function(t,e){if(t)for(let i=0;i<t.length;i++){if(t[i].id===e)return void t.splice(i,1);o(t[i].children,e)}};l===i?r.splice(s,1):o(r[s].children,i),this.categoryList=r}}).catch(t=>{this.$message({type:"info",message:$t("e68dg3","已取消","lang")})})},appendTop(t){this.dialog={visible:!0,is_hassuperior:!1,type:"add",label:"",distributor_id:[],parent_id:0,title:$t("nzdo2","街道","lang")}},catNameCheck(t){let e=0;if(t){for(var i=0;i<t.length;i++)t.charCodeAt(i)>255?e+=2:e++;return!(e>50)||(this.$message({type:"error",message:$t("ac84ccj","分类名称长度最多25个汉字或50个字符","lang")}),!1)}return this.$message({type:"error",message:$t("2fzsqj6","分类不能为空","lang")}),!1},handleImgChange(t){this.imgDialog=!0,this.isGetImage=!0,this.current=t},handleImgChangeCat(t){this.imgDialog=!0,this.isGetImage=!0},pickImg(t){if(this.dialog.visible)return this.dialog.cat_img=t.url,void(this.imgDialog=!1);if(this.current.parent_id&&0!=this.current.parent_id)if(this.current.parent_id&&1==this.current.level){const e=this.categoryList.findIndex(t=>t.id===this.current.parent_id),i=this.categoryList[e].children.findIndex(t=>t.id===this.current.id);this.categoryList[e].children[i].image_url=t.url}else{let i,a;for(var e in this.categoryList)if(a=this.categoryList[e].children.findIndex(t=>t.id===this.current.parent_id),i=e,a>-1)break;const l=this.categoryList[i].children[a].children.findIndex(t=>t.id===this.current.id);this.categoryList[i].children[a].children[l].image_url=t.url}else{const e=this.categoryList.findIndex(t=>t.id===this.current.id);this.categoryList[e].image_url=t.url}this.imgDialog=!1},closeImgDialog(){this.imgDialog=!1}}},g=(0,i(81656).A)(d,function(){var t=this,e=t._self._c;return e("SpPage",[e("SpFilterForm",{attrs:{model:t.params},on:{onSearch:t.onSearch,onReset:t.onSearch}},[e("SpFilterFormItem",{attrs:{prop:"label",label:$t("gkjzw15","街道居委:","lang")}},[e("el-input",{attrs:{placeholder:$t("94eflj9","请输入街道居委名称","lang")},model:{value:t.params.label,callback:function(e){t.$set(t.params,"label",e)},expression:"params.label"}})],1)],1),e("div",{staticClass:"action-container"},[e("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){return t.appendTop(t.categoryList)}}},[t._v($t("1or7ka6"," 新增街道 ","lang"))])],1),e("el-card",[e("el-dialog",{attrs:{title:"add"===t.dialog.type?`${$t("hs6m2","新增","lang")}${t.dialog.title}`:`${$t("mekb2","编辑","lang")}${t.dialog.title}`,visible:t.dialog.visible,"destroy-on-close":""},on:{"update:visible":function(e){return t.$set(t.dialog,"visible",e)}}},[e("el-form",{attrs:{"label-width":"180px"}},[e("el-form-item",{attrs:{label:`${$t("hs6m2","新增","lang")}${t.dialog.title}${$t("eyrn2","名称","lang")}`}},[e("el-input",{model:{value:t.dialog.label,callback:function(e){t.$set(t.dialog,"label",e)},expression:"dialog.label"}})],1),t.dialog.is_hassuperior||t.dialog.title!=$t("nzdo2","街道","lang")?t._e():e("el-form-item",{attrs:{label:$t("ikx5hm4","选择地区","lang")}},[e("el-cascader",{attrs:{options:t.addList,props:{expandTrigger:"hover"}},model:{value:t.dialog.address,callback:function(e){t.$set(t.dialog,"address",e)},expression:"dialog.address"}})],1),t.dialog.is_hassuperior?e("el-form-item",{attrs:{label:$t("csb7964","所属街道","lang")}},[e("el-input",{attrs:{label:$t("av5kqa4","分类排序","lang"),disabled:!0},model:{value:t.dialog.superior_cat_name,callback:function(e){t.$set(t.dialog,"superior_cat_name",e)},expression:"dialog.superior_cat_name"}})],1):t._e(),t.dialog.is_hassuperior||t.dialog.title!=$t("nzdo2","街道","lang")?t._e():e("el-form-item",{attrs:{label:$t("at3gas4","关联店铺","lang")}},[e("el-select",{attrs:{multiple:"",clearable:"",placeholder:$t("2elj5y5","请选择店铺","lang")},model:{value:t.dialog.distributor_id,callback:function(e){t.$set(t.dialog,"distributor_id",e)},expression:"dialog.distributor_id"}},t._l(t.distributorList,function(t,i){return e("el-option",{key:i,attrs:{label:t.name,value:t.distributor_id}})}),1)],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialog.visible=!1}}},[t._v($t("caoqm3","取 消","lang"))]),e("el-button",{attrs:{loading:t.dialog.loading,type:"primary"},on:{click:t.handleSubmit}},[t._v($t("hnjoo3","确 定","lang"))])],1)],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"tableTree",staticStyle:{width:"100%"},attrs:{data:t.categoryList,"row-key":"id","default-expand-all":"",height:-180,"tree-props":{children:"children"},size:"small"}},[e("el-table-column",{attrs:{label:$t("p3ayuq6","居委街道名称","lang"),width:"220"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v(t._s(i.row.label))])]}}])}),e("el-table-column",{attrs:{prop:"distributor",label:$t("at3gas4","关联店铺","lang"),width:"480"},scopedSlots:t._u([{key:"default",fn:function(i){return t._l(i.row.distributor,function(i,a){return e("span",{key:a,staticClass:"storeL",staticStyle:{padding:"4px 10px",color:"#fff","background-color":"#1480e3","border-radius":"5px",margin:"5px"}},[t._v(" "+t._s(i)+" ")])})}}])}),e("el-table-column",{attrs:{label:$t("fabu2","地区","lang")},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v(t._s((i.row.province||"")+" "+(i.row.city||"")+" "+(i.row.area||"")))])]}}])}),e("el-table-column",{attrs:{label:$t("hkxb2","操作","lang")},scopedSlots:t._u([{key:"default",fn:function(i){return["0"===i.row.parent_id?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.append(i.row)}}},[t._v($t("1vgv0d6"," 新增居委 ","lang"))]):t._e(),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.editCategory(i.row)}}},[t._v($t("juz394"," 编辑 ","lang"))]),e("el-button",{attrs:{type:"text"},nativeOn:{click:function(e){return e.preventDefault(),t.deleteCategory(i.row)}}},[t._v($t("db22k4"," 删除 ","lang"))])]}}])})],1)],1),e("imgPicker",{attrs:{"dialog-visible":t.imgDialog,"sc-status":t.isGetImage},on:{chooseImg:t.pickImg,closeImgDialog:t.closeImgDialog}})],1)},[],!1,null,null,null).exports}}]);