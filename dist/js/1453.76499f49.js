"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[1453],{71453:function(t,a,e){e.r(a),e.d(a,{default:function(){return c}});e(44114);var i=e(95353),n=e(5134),s=e(25159),l=e(77825),o={components:{shopSelect:s.default},mixins:[l.Ay,l.v8],provide(){return{refresh:this.fetchList}},data(){const t={create_time:[],marketing_type:"full_discount",item_type:"",status:"all"};return{initialParams:t,params:{...t},activeName:"all",cursymbol:"￥",loading:!1,activityItemParams:{page:1,pageSize:20},activityItemTotalCount:0,activityItemListsData:[],total_count:0,activityItemDialog:!1,ItemLoading:!1,tabList:[{name:$t("en402","全部","lang"),activeName:"all"},{name:$t("egbo03","待开始","lang"),activeName:"waiting"},{name:$t("lq5q43","进行中","lang"),activeName:"ongoing"},{name:$t("edie63","已结束","lang"),activeName:"end"}]}},computed:{...(0,i.L8)(["wheight"])},mounted(){this.fetchList()},methods:{onSearch(){this.page.pageIndex=1,this.$nextTick(()=>{this.fetchList()})},onReset(){this.params={...this.initialParams},this.onSearch()},getParams(){const t={},a=this.params.create_time;return a&&a.length>0&&(t.start_time=this.dateStrToTimeStamp(a[0]+" 00:00:00"),t.end_time=this.dateStrToTimeStamp(a[1]+" 23:59:59")),{...this.params,status:"all"===this.params.status?void 0:this.params.status,create_time:[],...t}},async fetchList(){this.loading=!0;const{pageIndex:t,pageSize:a}=this.page;let e={page:t,pageSize:a,...this.getParams()};const{list:i,total_count:n}=await this.$api.promotions.getMarketingActivityList(e);this.tableList=i,this.page.total=n,this.loading=!1},handleTabClick(t,a){this.onSearch()},addActivityData(){this.$router.push({path:this.matchRoutePath("editor")})},editActivityAction(t,a){this.$router.push({path:this.matchRoutePath("editor/")+a.marketing_id})},deleteActivityAction(t){var a=$t("47ymzlb","你确定要删除该活动吗?","lang");this.$confirm(a,$t("hn562","提示","lang"),{cancelButtonText:$t("ev022","取消","lang"),confirmButtonText:$t("kzjg2","确定","lang"),type:"warning",beforeClose:(a,e,i)=>{"confirm"===a&&(0,n.removeMarketingActivity)({marketing_id:t.marketing_id}).then(t=>{this.fetchList(),this.$message({message:$t("r52uu86","删除活动成功","lang"),type:"success",duration:5e3})}),i()}})},viewDetail(t){this.$router.push({path:this.matchRoutePath("editor/")+t.marketing_id,query:{isnodata:!0}})},viewItemList(t,a){"all"==t?"normal"==a?this.$router.push({path:this.matchInternalRoute("goodsphysical")}):this.$router.push({path:this.matchInternalRoute("servicegoods")}):(this.ItemLoading=!0,this.activityItemDialog=!0,this.activityItemParams.marketing_id=t,(0,n.getMarketingActivityItemList)(this.activityItemParams).then(t=>{null!=t&&t.data.data&&t.data.data.total_count>0&&(this.activityItemListsData=t.data.data.list,this.activityItemTotalCount=t.data.data.total_count),this.ItemLoading=!1}))},handleGoodsCurrentChange(t){this.ItemLoading=!0,this.activityItemDialog=!0,this.activityItemParams.page=t,(0,n.getMarketingActivityItemList)(this.activityItemParams).then(t=>{null!=t&&t.data.data&&t.data.data.total_count>0&&(this.activityItemListsData=t.data.data.list,this.activityItemTotalCount=t.data.data.total_count),this.ItemLoading=!1})},handleGoodsSizeChange(t){this.ItemLoading=!0,this.activityItemDialog=!0,this.activityItemParams.page=1,this.activityItemParams.pageSize=t,(0,n.getMarketingActivityItemList)(this.activityItemParams).then(t=>{null!=t&&t.data.data&&t.data.data.total_count>0&&(this.activityItemListsData=t.data.data.list,this.activityItemTotalCount=t.data.data.total_count),this.ItemLoading=!1})},handleCancel(){this.activityItemDialog=!1},dateStrToTimeStamp(t){return Date.parse(new Date(t))/1e3},updateStatusCommunityAction(t){var a=$t("3pkh9yi","此操作将永久终止该活动, 是否继续?","lang");this.$confirm(a,$t("hn562","提示","lang"),{cancelButtonText:$t("ev022","取消","lang"),confirmButtonText:$t("kzjg2","确定","lang"),type:"warning",beforeClose:(a,e,i)=>{"confirm"===a&&(0,n.removeMarketingActivity)({marketing_id:t.marketing_id,isEnd:!0}).then(t=>{this.fetchList(),this.$message({message:$t("c6bhfy8","修改活动状态成功","lang"),type:"success",duration:5e3})}),i()}})}}},r=o,c=(0,e(81656).A)(r,function(){var t=this,a=t._self._c;return a("SpPage",[a("SpRouterView",[t.VERSION_SHUYUN()?t._e():a("SpPlatformTip",{attrs:{h5:"",app:"",pc:"",alipay:""}}),a("SpFilterForm",{attrs:{model:t.params},on:{onSearch:t.onSearch,onReset:t.onReset}},[a("SpFilterFormItem",{attrs:{prop:"create_time",label:$t("fn58c3","时间:","lang")}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","value-format":"yyyy/MM/dd",placeholder:$t("fcdtwa8","根据添加时间筛选","lang")},model:{value:t.params.create_time,callback:function(a){t.$set(t.params,"create_time",a)},expression:"params.create_time"}})],1)],1),a("div",{staticClass:"action-container"},[a("el-button",{attrs:{type:"primary",icon:"iconfont icon-xinzengcaozuo-01"},on:{click:t.addActivityData}},[t._v($t("b48mw78"," 添加满折促销 ","lang"))])],1),a("el-tabs",{attrs:{type:"card"},on:{"tab-click":t.handleTabClick},model:{value:t.params.status,callback:function(a){t.$set(t.params,"status",a)},expression:"params.status"}},t._l(t.tabList,function(e,i){return a("el-tab-pane",{key:i,attrs:{label:e.name,name:e.activeName}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableList,height:t.wheight-190,"element-loading-text":$t("go5gpa5","数据加载中","lang"),border:""}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:$t("infiw44","适用会员","lang")}},t._l(e.row.member_grade,function(e,i){return a("el-tag",{key:i},[t._v(" "+t._s(e)+" ")])}),1),a("el-form-item",{attrs:{label:$t("ar84e54","创建时间","lang")}},[a("span",[t._v(t._s(e.row.created_date))])]),a("el-form-item",{attrs:{label:$t("ingkrl4","适用商品","lang")}},t._l(e.row.items,function(e,i){return a("div",{key:i},[t._v(" "+t._s(e.item_name)+" ")])}),0),a("el-form-item",{attrs:{label:$t("iniii14","适用店铺","lang")}},[e.row.use_shop?a("span",t._l(e.row.shops,function(e,i){return a("div",{key:i},[t._v(" "+t._s(e.shop_name)+" ")])}),0):a("span",[a("div",[t._v($t("avbuf74","全部店铺","lang"))])])])],1)]}}],null,!0)}),a("el-table-column",{attrs:{prop:"marketing_id",width:"60",label:$t("m2sh2","编号","lang")}}),a("el-table-column",{attrs:{prop:"marketing_name","min-width":"150",label:$t("fammkp6","满折促销名称","lang")}}),a("el-table-column",{attrs:{label:$t("nvth2","规则","lang"),"min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.condition_value,function(i,n){return a("div",{key:n},["quantity"==e.row.condition_type?a("span",[t._v($t("ham9c4"," 消费满","lang")+t._s(i.full)+$t("dq2c115","件，给予 ","lang")+t._s(i.discount)+$t("fk8s04","%折扣 ","lang"))]):t._e(),"totalfee"==e.row.condition_type?a("span",[t._v($t("ham9c4"," 消费满","lang")+t._s(i.full)+$t("4q7ijc5","元，给予 ","lang")+t._s(i.discount)+$t("fk8s04","%折扣 ","lang"))]):t._e()])})}}],null,!0)}),a("el-table-column",{attrs:{prop:"used_platform","min-width":"100",label:$t("ini4sj4","适用平台","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.used_platform?a("span",[t._v($t("amtppn4","全场可用","lang"))]):t._e(),1==e.row.used_platform?a("span",[t._v($t("fhdu2c6","只用于pc端","lang"))]):t._e(),2==e.row.used_platform?a("span",[t._v($t("c4ce8s4","小程序端","lang"))]):t._e(),3==e.row.used_platform?a("span",[t._v($t("2uo23","h5端","lang"))]):t._e()]}}],null,!0)}),a("el-table-column",{attrs:{prop:"total_fee","min-width":"150",label:$t("fl3fk3","有效期","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.start_date))]),a("div",[t._v("~")]),a("div",[t._v(t._s(e.row.end_date))])]}}],null,!0)}),a("el-table-column",{attrs:{"min-width":"70",label:$t("k1e32","状态","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return["ongoing"==e.row.status?a("span",[t._v($t("lq5q43","进行中","lang"))]):t._e(),"waiting"==e.row.status?a("span",[t._v($t("fkmt13","未开始","lang"))]):t._e(),"end"==e.row.status?a("span",[t._v($t("edie63","已结束","lang"))]):t._e()]}}],null,!0)}),a("el-table-column",{attrs:{"min-width":"70",prop:"source_name",label:$t("gwn72","店铺","lang")}}),a("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),"min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"operating-icons"},[0!=e.row.use_bound?a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.viewItemList(e.row.marketing_id)}}},[t._v($t("akaly76"," 查看商品 ","lang"))]):a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.viewItemList("all",e.row.item_type)}}},[t._v($t("32l7x76"," 全部商品 ","lang"))]),"end"!==e.row.status?a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.updateStatusCommunityAction(e.row)}}},[t._v($t("jn7om4"," 终止 ","lang"))]):t._e(),"waiting"!=e.row.status&&"ongoing"!=e.row.status?a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.viewDetail(e.row)}}},[t._v($t("ascou36"," 查看详情 ","lang"))]):t._e(),"Y"==e.row.edit_btn?["waiting"==e.row.status||"ongoing"==e.row.status?a("i",{staticClass:"iconfont icon-edit1",on:{click:function(a){return t.editActivityAction(e.$index,e.row)}}}):t._e()]:t._e(),"waiting"==e.row.status?a("i",{staticClass:"iconfont icon-trash-alt",on:{click:function(a){return t.deleteActivityAction(e.row)}}}):t._e()],2)]}}],null,!0)})],1),t.page.total>t.page.pageSize?a("div",{staticClass:"mt-4 text-right"},[a("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":t.page.pageIndex,"page-sizes":[10,20,50],total:t.page.total,"page-size":t.page.pageSize},on:{"update:currentPage":function(a){return t.$set(t.page,"pageIndex",a)},"update:current-page":function(a){return t.$set(t.page,"pageIndex",a)},"current-change":t.onCurrentChange,"size-change":t.onSizeChange}})],1):t._e()],1)}),1),a("el-dialog",{attrs:{title:$t("752fp56","活动商品列表","lang"),visible:t.activityItemDialog,"before-close":t.handleCancel,width:"70%"},on:{"update:visible":function(a){t.activityItemDialog=a}}},[[a("el-pagination",{attrs:{background:"",layout:"total","current-page":t.activityItemParams.page,"page-sizes":[10,20,50],total:t.activityItemTotalCount,"page-size":t.activityItemParams.pageSize},on:{"update:currentPage":function(a){return t.$set(t.activityItemParams,"page",a)},"update:current-page":function(a){return t.$set(t.activityItemParams,"page",a)},"current-change":t.handleGoodsCurrentChange,"size-change":t.handleGoodsSizeChange}}),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.ItemLoading,expression:"ItemLoading"}],attrs:{data:t.activityItemListsData,height:t.wheight-190}},[a("el-table-column",{attrs:{prop:"item_id",label:"id",width:"60"}}),a("el-table-column",{attrs:{prop:"pics[0]",label:$t("ff9l2","图片","lang"),width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("img",{attrs:{src:t.wximageurl+e.row.pics[0],width:"50",height:"50"}})]}}])}),a("el-table-column",{attrs:{prop:"item_name",label:$t("eyrn2","名称","lang")}}),a("el-table-column",{attrs:{prop:"price",label:$t("e04l2","价格","lang"),width:"100"},scopedSlots:t._u([{key:"default",fn:function(a){return[t._v(" "+t._s(t.cursymbol)+t._s(a.row.price/100)+" ")]}}])}),a("el-table-column",{attrs:{prop:"item_spec_desc",label:$t("o06w2","规格","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-col",[t._v(t._s(e.row.item_spec_desc))])]}}])}),a("el-table-column",{attrs:{prop:"store",label:$t("gl5x2","库存","lang"),width:"70"}})],1),a("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next","current-page":t.activityItemParams.page,"page-sizes":[10,20,50],total:t.activityItemTotalCount,"page-size":t.activityItemParams.pageSize},on:{"update:currentPage":function(a){return t.$set(t.activityItemParams,"page",a)},"update:current-page":function(a){return t.$set(t.activityItemParams,"page",a)},"current-change":t.handleGoodsCurrentChange,"size-change":t.handleGoodsSizeChange}})]],2)],1)],1)},[],!1,null,"e914d9dc",null).exports}}]);