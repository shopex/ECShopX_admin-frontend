"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[6792],{56792:function(t,a,e){e.r(a),e.d(a,{default:function(){return r}});e(44114);var i=e(95353),s=e(5134),n={components:{shopSelect:e(25159).default},provide(){return{refresh:this.getActivityLists}},data(){return{activeName:"all",cursymbol:"￥",loading:!1,create_time:"",params:{page:1,pageSize:20,marketing_type:"member_preference",item_type:"",status:"",start_time:"",end_time:""},activityItemParams:{page:1,pageSize:20},activityItemTotalCount:0,activityItemListsData:[],total_count:0,list:[],activityItemDialog:!1,ItemLoading:!1}},computed:{...(0,i.L8)(["wheight"])},mounted(){this.getActivityLists()},methods:{handleClick(t,a){this.activeName=t.name,this.params.status="all"==t.name?"":t.name,this.params.page=1,this.getActivityLists()},storeSearch(t){t&&t.shop_id,this.params.store_id=t.shop_id,this.params.page=1,this.getActivityLists()},itemTypeChange(){this.params.page=1,this.getActivityLists()},addActivityData(){this.$router.push({path:this.matchRoutePath("editor")})},editActivityAction(t,a){this.$router.push({path:this.matchRoutePath("editor/")+a.marketing_id})},deleteActivityAction(t){var a=$t("47ymzlb","你确定要删除该活动吗?","lang");this.$confirm(a,$t("hn562","提示","lang"),{cancelButtonText:$t("ev022","取消","lang"),confirmButtonText:$t("kzjg2","确定","lang"),type:"warning",beforeClose:(a,e,i)=>{"confirm"===a&&(0,s.removeMarketingActivity)({marketing_id:t.marketing_id}).then(t=>{this.getActivityLists(),this.$message({message:$t("r52uu86","删除活动成功","lang"),type:"success",duration:5e3})}),i()}})},copyActivity(t){this.$router.push({path:this.matchRoutePath("editor/")+t.marketing_id,query:{is_copy:1}})},updateDetail(t){this.$router.push({path:this.matchRoutePath("editor/")+t.marketing_id})},viewDetail(t){this.$router.push({path:this.matchRoutePath("editor/")+t.marketing_id,query:{isnodata:!0}})},viewItemList(t,a){"all"==t?"normal"==a?this.$router.push({path:this.matchInternalRoute("goodsphysical")}):this.$router.push({path:this.matchInternalRoute("servicegoods")}):(this.ItemLoading=!0,this.activityItemDialog=!0,this.activityItemParams.marketing_id=t,(0,s.getMarketingActivityItemList)(this.activityItemParams).then(t=>{null!=t&&t.data.data&&t.data.data.total_count>0&&(this.activityItemListsData=t.data.data.list,this.activityItemTotalCount=t.data.data.total_count),this.ItemLoading=!1}))},handleGoodsCurrentChange(t){this.ItemLoading=!0,this.activityItemDialog=!0,this.activityItemParams.page=t,(0,s.getMarketingActivityItemList)(this.activityItemParams).then(t=>{null!=t&&t.data.data&&t.data.data.total_count>0&&(this.activityItemListsData=t.data.data.list,this.activityItemTotalCount=t.data.data.total_count),this.ItemLoading=!1})},handleGoodsSizeChange(t){this.ItemLoading=!0,this.activityItemDialog=!0,this.activityItemParams.page=1,this.activityItemParams.pageSize=t,(0,s.getMarketingActivityItemList)(this.activityItemParams).then(t=>{null!=t&&t.data.data&&t.data.data.total_count>0&&(this.activityItemListsData=t.data.data.list,this.activityItemTotalCount=t.data.data.total_count),this.ItemLoading=!1})},handleCancel(){this.activityItemDialog=!1},dateChange(t){t.length>0&&(this.params.start_time=this.dateStrToTimeStamp(t[0]+" 00:00:00"),this.params.end_time=this.dateStrToTimeStamp(t[1]+" 23:59:59")),this.params.page=1,this.getActivityLists()},handleCurrentChange(t){this.params.page=t,this.loading=!1,this.getActivityLists()},handleSizeChange(t){this.params.page=1,this.params.pageSize=t,this.getActivityLists()},dateStrToTimeStamp(t){return Date.parse(new Date(t))/1e3},getActivityLists(){this.loading=!0;var t=this.params;(0,s.getMarketingActivityList)(t).then(t=>{this.list=t.data.data.list,this.total_count=Number(t.data.data.total_count),this.loading=!1})},updateStatusCommunityAction(t){var a=$t("3pkh9yi","此操作将永久终止该活动, 是否继续?","lang");this.$confirm(a,$t("hn562","提示","lang"),{cancelButtonText:$t("ev022","取消","lang"),confirmButtonText:$t("kzjg2","确定","lang"),type:"warning",beforeClose:(a,e,i)=>{"confirm"===a&&(0,s.removeMarketingActivity)({marketing_id:t.marketing_id,isEnd:!0}).then(t=>{this.getActivityLists(),this.$message({message:$t("c6bhfy8","修改活动状态成功","lang"),type:"success",duration:5e3})}),i()}})}}},r=(0,e(81656).A)(n,function(){var t=this,a=t._self._c;return a("SpPage",[a("SpRouterView",[t.VERSION_SHUYUN()?t._e():a("SpPlatformTip",{attrs:{h5:"",app:"",alipay:""}}),a("div",{staticClass:"action-container"},[a("el-button",{attrs:{type:"primary"},on:{click:t.addActivityData}},[t._v($t("w0r6rdb"," 添加会员优先购活动 ","lang"))])],1),a("el-tabs",{attrs:{type:"card"},on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(a){t.activeName=a},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:$t("en402","全部","lang"),name:"all"}}),a("el-tab-pane",{attrs:{label:$t("egbo03","待开始","lang"),name:"waiting"}}),a("el-tab-pane",{attrs:{label:$t("lq5q43","进行中","lang"),name:"ongoing"}}),a("el-tab-pane",{attrs:{label:$t("edie63","已结束","lang"),name:"end"}}),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.list,"element-loading-text":$t("go5gpa5","数据加载中","lang")}},[a("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"operating-icons"},["ongoing"==e.row.status?a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.updateStatusCommunityAction(e.row)}}},[t._v($t("dd4ni4"," 取消 ","lang"))]):t._e(),a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.viewDetail(e.row)}}},[t._v($t("gcika4"," 查看 ","lang"))]),a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.copyActivity(e.row)}}},[t._v($t("j09soa6"," 复制活动 ","lang"))]),"waiting"==e.row.status?a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.updateDetail(e.row)}}},[t._v($t("juz394"," 编辑 ","lang"))]):t._e()],1)]}}])}),a("el-table-column",{attrs:{prop:"marketing_id",width:"60",label:$t("m2sh2","编号","lang")}}),a("el-table-column",{attrs:{prop:"marketing_name",label:$t("e4hvdc4","活动名称","lang")}}),a("el-table-column",{attrs:{label:$t("cd0k3t4","开始时间","lang"),width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("datetime")(e.row.start_time,"YYYY-MM-DD HH:mm:ss")))])]}}])}),a("el-table-column",{attrs:{label:$t("gfi7qi4","结束时间","lang"),width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("datetime")(e.row.end_time,"YYYY-MM-DD HH:mm:ss")))])]}}])}),a("el-table-column",{attrs:{label:$t("lnjk2","类型","lang"),width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return["waiting"==e.row.status?a("span",[t._v($t("egbo03","待开始","lang"))]):t._e(),"ongoing"==e.row.status?a("span",[t._v($t("lq5q43","进行中","lang"))]):t._e(),"end"==e.row.status?a("span",[t._v($t("edie63","已结束","lang"))]):t._e()]}}])})],1),t.total_count>t.params.pageSize?a("div",{staticClass:"mt-4 text-right"},[a("el-pagination",{attrs:{layout:"prev, pager, next","current-page":t.params.page,total:t.total_count,"page-size":t.params.pageSize},on:{"update:currentPage":function(a){return t.$set(t.params,"page",a)},"update:current-page":function(a){return t.$set(t.params,"page",a)},"current-change":t.handleCurrentChange}})],1):t._e()],1)],1)],1)},[],!1,null,null,null).exports}}]);