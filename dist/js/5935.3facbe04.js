"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[5935],{45935:function(t,e,a){a.r(e),a.d(e,{default:function(){return m}});var s=a(95353),i=a(77944),o=a(2212),l=a(91142),r=a(41776),n=(a(47003),a(95093)),d=a.n(n),h={components:{shopSelect:a(25159).default},props:["isLoad","resourceName"],data(){return{loading:!1,shopListData:"",shopId:"",dataList:[],daterange:"",dateType:"1",params:{page:1,pageSize:20},dateDay:"",tableTitle:[],total_count:"",pickerOptions:{disabledDate(t){return t.getTime()<Date.now()-864e5}},chooseTypeDialogVisible:!1,formData:{dateDay:"",beginTime:"",shopId:"",shopName:"",resourceLevelId:"",resourceLevelName:"",labelId:"",labelName:"",rightsId:"",rightsName:"",mobile:"",userName:"",sex:"",instead:"system",userId:""},labelList:[]}},computed:{...(0,s.L8)(["wheight"])},watch:{selectedParams:{handler(t,e){},deep:!0}},watch:{isLoad(t,e){t&&(this.dataList=[],this.getStoreList(),this.shopId&&this.getLevelList())}},mounted(){this.dateDay=d()().format("YYYY-MM-DD"),this.dataList=[],this.getStoreList()},methods:{chooseCancel(){this.i=-1,this.chooseTypeDialogVisible=!1},handleCurrentChange(t){this.params.page=t,this.getLevelList()},storeChange(t){t&&t.shop_id&&(this.shopId=t.shop_id),this.params.page=1,this.getLevelList(),this.getTimePeriod()},initChange(){this.shopId=""},getLevelList(){this.loading=!0,this.params.dateDay=this.dateDay,this.params.shopId=this.shopId,(0,o.getReservationRecord)(this.params).then(t=>{t.data.data&&(this.dataList=t.data.data.list,this.total_count=t.data.data.total_count),this.$nextTick(()=>{this.$refs.table.doLayout()}),this.loading=!1})},getStoreList(){this.loading=!0;(0,i.getWxShopsList)({page:1,pageSize:500}).then(t=>{this.shopListData=t.data.data.list,""==this.shopId&&this.shopListData[0].wxShopId&&(this.shopId=this.shopListData[0].wxShopId),this.storeChange(),this.loading=!1})},getTimePeriod(){if(this.shopId){this.loading=!0;var t={shopId:this.shopId,dateDay:this.dateDay};(0,o.getTimePeriodTitle)(t).then(t=>{this.tableTitle=t.data.data.tableTitle,this.loading=!1})}},reservationAdd(t,e,a){this.formData={dateDay:this.dateDay,beginTime:e,shopId:this.shopId,shopName:"",resourceLevelId:t.resourceLevelId,resourceLevelName:t.name,labelId:"",labelName:"",rightsId:"",rightsName:"",mobile:"",userName:"",sex:"",instead:"system",userId:"",endTime:a},this.labelList=[],this.chooseTypeDialogVisible=!0},reservationSave(){if("system"==this.formData.instead)this.formData.rightsId="",this.formData.userName="",this.formData.userId="",this.formData.mobile="",this.formData.sex="",this.formData.shopName="",this.formData.labelId="",this.formData.labelName="",this.formData.rightsName="",this.formData.labelId="";else{if(!this.formData.mobile)return void this.$message({type:"error",message:$t("8sc3278","请输入会员手机号","lang")});if(!/^1[3|4|5|7|8][0-9]\d{8}$/.test(this.formData.mobile))return void this.$message({message:$t("w8axw89","请输入正确的手机号","lang"),type:"error"});if(!this.formData.rightsId)return void this.$message({type:"error",message:$t("nvkuqa","请选择会员拥有的权益","lang")})}if(this.formData.rightsId)for(var t in this.labelList)this.labelList[t].rights_id==this.formData.rightsId&&(this.formData.labelName=this.labelList[t].label_name,this.formData.rightsName=this.labelList[t].rights_name,this.formData.labelId=this.labelList[t].label_id);if(this.formData.shopId)for(var e in this.shopListData)this.formData.shopId==this.shopListData[e].wxShopId&&(this.formData.shopName=this.shopListData[e].storeName);(0,o.addReservationRecord)(this.formData).then(t=>{t.data.status&&this.$message({type:"success",message:$t("4h4ur46","代客预约成功","lang")}),this.chooseTypeDialogVisible=!1,this.storeChange()})},dateChange(t){"4"!=t&&(this.dateDay=d()().add("days",Number(t)-1).format("YYYY-MM-DD"),this.storeChange())},customChange(t){this.dateDay=d()(new Date(t)).format("YYYY-MM-DD"),this.dateDay&&this.storeChange()},getMemberData(){if(this.labelList=[],this.formData.mobile){let t={mobile:this.formData.mobile};(0,l.getMembers)(t).then(t=>{if(t.data.data.list){let e=t.data.data.list;this.formData.userName=e[0].username,this.formData.sex=e[0].sex,this.formData.userId=e[0].user_id,this.getResource(e[0].user_id)}})}},getResource(t){let e={user_id:t,end_time:this.dateDay,page:1,pageSize:100,resource_level_id:this.formData.resourceLevelId};(0,r.getRightsList)(e).then(t=>{0!=t.data.data.length?t.data.data.list&&(this.labelList=t.data.data.list):this.$message({message:$t("c7xwlo9","该用户无可预约权益","lang"),type:"error"})})}}},m=(0,a(81656).A)(h,function(){var t=this,e=t._self._c;return e("div",{staticClass:"reservation-box"},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:10}},[t._v($t("jtblg55"," 门店： ","lang")),e("el-select",{on:{change:t.storeChange},model:{value:t.shopId,callback:function(e){t.shopId=e},expression:"shopId"}},t._l(t.shopListData,function(a){return e("el-option",{key:a.wxShopId,attrs:{label:a.storeName,value:a.wxShopId}},[t._v(" "+t._s(a.storeName)+" ")])}),1)],1),e("el-col",{staticClass:"content-right",attrs:{span:14}},[e("el-radio-group",{attrs:{size:"mini"},on:{change:t.dateChange},model:{value:t.dateType,callback:function(e){t.dateType=e},expression:"dateType"}},[e("el-radio-button",{attrs:{label:"1"}},[t._v($t("cj1vl4"," 今天 ","lang"))]),e("el-radio-button",{attrs:{label:"2"}},[t._v($t("fxqbp4"," 明天 ","lang"))]),e("el-radio-button",{attrs:{label:"3"}},[t._v($t("datfp4"," 后天 ","lang"))]),e("el-radio-button",{attrs:{label:"4"}},[t._v($t("h99slj5"," 自定义 ","lang"))])],1),"4"==t.dateType?e("el-date-picker",{attrs:{type:"date",placeholder:$t("2ekjhr5","请选择日期","lang"),"picker-options":t.pickerOptions},on:{change:t.customChange},model:{value:t.dateDay,callback:function(e){t.dateDay=e},expression:"dateDay"}}):t._e()],1)],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"table",staticClass:"table",attrs:{"max-height":t.wheight-100,border:"",data:t.dataList}},[t._l(t.tableTitle,function(a,s){return[0==s?[e("el-table-column",{key:s,attrs:{fixed:"",label:a.begin,width:"150",prop:"name"}})]:[e("el-table-column",{key:s,attrs:{label:a.begin},scopedSlots:t._u([{key:"default",fn:function(s){return[s.row.record?t._l(s.row.record,function(s,i){return[a.begin==s.beginTime?[e("el-tooltip",{attrs:{effect:"light",placement:"top"}},["system"==s.status?e("div",{attrs:{slot:"content"},slot:"content"},[t._v($t("mygmwf6"," 系统占位 ","lang")),e("br"),e("br"),t._v($t("17bho46"," 占用时间：","lang")+t._s(s.beginTime)+"~"+t._s(s.endTime)+" ")]):e("div",{attrs:{slot:"content"},slot:"content"},[t._v($t("k92kma5"," 预约人：","lang")+t._s(s.userName)+" "),e("br"),e("br"),t._v($t("belzyv6"," 预约手机：","lang")+t._s(s.mobile)+" "),e("br"),e("br"),t._v($t("b6ln196"," 预约项目：","lang")+t._s(s.labelName)+" "),e("br"),e("br"),t._v($t("6aapxn6"," 到店时间：","lang")+t._s(s.beginTime)+" ")]),s.userName?e("span",[t._v(t._s(s.userName))]):s.mobile?e("span",[t._v(t._s(s.mobile))]):e("span",[t._v($t("gah73l4","系统占位","lang"))])])]:t._e()]}):[e("span",{staticClass:"type-add",on:{click:function(e){return t.reservationAdd(s.row,a.begin,a.end)}}},[e("i",{staticClass:"el-icon-plus"})])],s.row.timedata&&s.row.timedata.indexOf(a.begin)<0?e("span",{staticClass:"type-add",on:{click:function(e){return t.reservationAdd(s.row,a.begin,a.end)}}},[e("i",{staticClass:"el-icon-plus"})]):t._e()]}}],null,!0)})]]})],2),t.total_count>t.params.pageSize?e("div",{staticClass:"mt-4 text-right"},[e("el-pagination",{attrs:{layout:"prev, pager, next","current-page":t.params.page,total:t.total_count,"page-size":t.params.pageSize},on:{"update:currentPage":function(e){return t.$set(t.params,"page",e)},"update:current-page":function(e){return t.$set(t.params,"page",e)},"current-change":t.handleCurrentChange}})],1):t._e(),e("el-dialog",{attrs:{title:$t("acctfl4","代客预约","lang"),width:"20%",visible:t.chooseTypeDialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(e){t.chooseTypeDialogVisible=e}}},[e("div",{staticClass:"type-list type-choose-box"},[e("el-form",{attrs:{"label-width":"120px"},model:{value:t.formData,callback:function(e){t.formData=e},expression:"formData"}},[e("el-form-item",{attrs:{label:$t("jrk6u04","预约方式","lang"),prop:""}},[e("el-radio-group",{model:{value:t.formData.instead,callback:function(e){t.$set(t.formData,"instead",e)},expression:"formData.instead"}},[e("el-radio",{attrs:{label:"system"}},[t._v($t("mygmwf6"," 系统占位 ","lang"))]),e("el-radio",{attrs:{label:"user"}},[t._v($t("jd30td6"," 代客预约 ","lang"))])],1)],1),"user"==t.formData.instead?[e("el-form-item",{attrs:{label:$t("3etng96","客户手机号:","lang"),prop:""}},[e("el-input",{staticStyle:{width:"120px"},attrs:{size:"40",placeholder:$t("fxg7tf5","客户手机号","lang"),maxlength:11,minlength:11},on:{blur:t.getMemberData},model:{value:t.formData.mobile,callback:function(e){t.$set(t.formData,"mobile",e)},expression:"formData.mobile"}})],1),t.labelList?e("el-form-item",{attrs:{label:$t("qc2xzx5","预约项目:","lang"),prop:""}},[e("el-select",{attrs:{size:"40"},model:{value:t.formData.rightsId,callback:function(e){t.$set(t.formData,"rightsId",e)},expression:"formData.rightsId"}},t._l(t.labelList,function(a){return e("el-option",{key:a.rights_id,attrs:{label:a.label_name,value:a.rights_id}},[e("span",{staticStyle:{float:"left"}},[t._v(t._s(a.label_name))]),e("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[t._v(t._s(t._f("datetime")(a.start_time))+" ~ "+t._s(t._f("datetime")(a.end_time))+" ")])])}),1)],1):t._e()]:t._e()],2)],1),e("div",{staticClass:"footer-dialog content-center",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.chooseCancel}},[t._v($t("dd4ni4"," 取消 ","lang"))]),e("el-button",{attrs:{type:"primary"},on:{click:t.reservationSave}},[t._v($t("in1ck4"," 确定 ","lang"))])],1)])],1)},[],!1,null,"b2f04854",null).exports}}]);