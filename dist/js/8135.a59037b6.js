"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[8135],{58135:function(t,e,i){i.r(e),i.d(e,{default:function(){return p}});i(44114),i(18111),i(22489),i(20116),i(7588),i(61701);var a=i(71710),r=i.n(a),s=i(91936),n=i.n(s),o=i(94644),l=i(59025),d={name:"",props:{itemId:String,distributorId:String,isTotalStore:Boolean,isSuplier:Boolean},data(){return{setting:(0,o.createSetting)({columns:[{name:$t("b4865i4","商品编码","lang"),key:"item_bn",width:160},{name:$t("o06w2","规格","lang"),key:"item_spec_desc"},{name:$t("gl5x2","库存","lang"),key:"store",width:100,showType:this.isTotalStore?"":"editable",componentProps:{change:async(t,e)=>{await this.$api.marketing.updateDistributorItem({distributor_id:this.distributorId,item_id:e.item_id,store:t}),this.$refs.skuFinder.refresh()}}},{name:$t("5t2yy47","商品价格（¥）","lang"),key:"price",width:160,showType:this.isTotalStore?"":"editable",componentProps:{change:async(t,e)=>{await this.$api.marketing.updateDistributorItem({distributor_id:this.distributorId,item_id:e.item_id,price:100*t}),this.$refs.skuFinder.refresh()}}},{name:$t("8fohvo6","店铺销售状态","lang"),key:"is_can_sale",render:(t,{row:e})=>t("span",{},e.is_can_sale?$t("d0e3h3","可销售","lang"):$t("a7er004","不可销售","lang"))},{name:$t("vab1c45","上下架操作","lang"),render:(t,{row:e})=>t("el-switch",{props:{value:e.is_can_sale,"active-value":!0,"inactive-value":!1,disabled:this.IS_ADMIN()&&this.VERSION_STANDARD()&&this.isSuplier},on:{change:async t=>{await this.$api.marketing.updateDistributorItem({distributor_id:this.distributorId,item_id:e.item_id,is_can_sale:t}),e.is_can_sale=t}}})}]})}},created(){},methods:{beforeSearch(t){return t={...t,is_sku:!0,item_id:this.itemId,distributor_id:this.distributorId}},afterSearch(t){const{list:e}=t.data.data;return e.forEach(t=>{t.price=t.price/100}),e},getApproveStatus(t){return{1:$t("eqsf2","可售","lang"),0:$t("buay43","不可售","lang")}[t]||$t("buay43","不可售","lang")}}},m=i(81656),c=(0,m.A)(d,function(){var t=this;return(0,t._self._c)("SpFinder",{ref:"skuFinder",attrs:{"no-selection":"","fixed-row-action":"",url:"/distributor/items",hooks:{beforeSearch:t.beforeSearch,afterSearch:t.afterSearch},setting:t.setting}})},[],!1,null,null,null).exports,u=i(95353),h={components:{skuFinder:c},data(){const t=this.$createElement,e=this.$store.getters.login_type;let i,a=[{title:$t("en402","全部","lang"),value:""},{title:$t("meu01y5","前台可销售","lang"),value:"onsale"},{title:$t("mfygnl5","前台不展示","lang"),value:"offline_sale"},{title:$t("mfuo7t5","前台仅展示","lang"),value:"only_show"},{title:$t("a7er004","不可销售","lang"),value:"instock"}];return i="distributor"==e?[{title:$t("en402","全部","lang"),value:""},{title:$t("c025s24","审核驳回","lang"),value:"rejected"},{title:$t("fy8avn4","等待审核","lang"),value:"processing"},{title:$t("meu01y5","前台可销售","lang"),value:"onsale"},{title:$t("mfygnl5","前台不展示","lang"),value:"offline_sale"},{title:$t("mfuo7t5","前台仅展示","lang"),value:"only_show"},{title:$t("a7er004","不可销售","lang"),value:"instock"}]:a,{formData:{distributor_id:"",keywords:"",item_bn:"",barcode:"",supplier_name:"",approve_status:""},statusOption:i,finderData:[],finderUrl:"",tabList:[{name:$t("av9wor4","全部商品","lang"),value:"first"},{name:$t("e57q63","已上架","lang"),value:"second"},{name:$t("fhtp23","未上架","lang"),value:"third"}],activeTab:"first",selectItems:[],itemSkuDialog:!1,editPrice:null,editRow:{},itemSkuForm:{itemName:"",itemId:"",is_total_store:!1},loading:!1,itemSkuFormList:[{key:"invitation_code",component:()=>t(c,{attrs:{itemId:this.itemSkuForm.itemId,isSuplier:"0"!=this.editRow.supplier_id,isTotalStore:this.itemSkuForm.is_total_store,distributorId:this.formData.distributor_id}})}]}},computed:{...(0,u.L8)(["login_type"]),setting(){this.$createElement;return(0,o.createSetting)({actions:[{name:$t("5s8var5","设置SKU","lang"),key:"detail",type:"button",buttonType:"text",action:{handler:async([t])=>{this.itemSkuForm.itemName=t.itemName,this.itemSkuForm.itemId=t.itemId,this.itemSkuForm.is_total_store=t.is_total_store,this.editRow=t,this.itemSkuDialog=!0}}}],columns:[{name:$t("vab1c45","上下架操作","lang"),width:120,render:(t,{row:e})=>t("el-switch",{props:{value:e.goods_can_sale,"active-value":!0,"inactive-value":!1},on:{change:async t=>{await this.$api.marketing.updateDistributorItem({distributor_id:this.formData.distributor_id,goods_id:e.goods_id,is_can_sale:t}),e.goods_can_sale=t,this.$message.success($t("d1spvi4","操作成功","lang")),this.$refs.finder.refresh()}}})},{name:$t("b40v0e4","商品名称","lang"),key:"item_name",width:160},{name:$t("1ttci05","sku编码","lang"),key:"item_bn",width:150,align:"right",headerAlign:"center"},{name:$t("b42heo4","商品库存","lang"),key:"store",width:90},{name:$t("cjs0bs4","店铺库存","lang"),render:(t,{row:e})=>t("el-switch",{props:{value:!e.is_total_store,"active-value":!0,"inactive-value":!1,disabled:this.IS_ADMIN()&&this.VERSION_STANDARD()&&"0"!=e.supplier_id},on:{change:async t=>{await this.$api.marketing.updateDistributorItem({distributor_id:this.formData.distributor_id,goods_id:e.goods_id,is_total_store:!t}),this.$refs.finder.refresh()}}})},{name:$t("8fohvo6","店铺销售状态","lang"),key:"is_can_sale",width:120,render:(t,{row:e})=>t("span",{},e.is_can_sale?$t("d0e3h3","可销售","lang"):$t("a7er004","不可销售","lang"))},{name:$t("wg31hi6","总部销售状态","lang"),width:120,key:"approve_status",formatter:(t,e,i)=>this.statusOption.find(e=>e.value===t)?.title},{name:$t("qknewd6","市场价（¥）","lang"),key:"market_price",width:120,render:(t,{row:e})=>t("span",{},e.market_price/100)},{name:$t("789h436","销售价（¥）","lang"),key:"price",width:120,render:(t,{row:e})=>t("div",[e.price,this.IS_ADMIN()&&this.VERSION_STANDARD()&&"0"==e.supplier_id&&t("el-popover",{attrs:{placement:"top",trigger:"hover"},on:{show:()=>this.editPrice=e.price}},[t("div",{class:"popover-edit flex"},[t("el-input",{class:"edit-input",attrs:{placeholder:$t("2jc52q5","请输入价格","lang")},model:{value:this.editPrice,callback:t=>{this.editPrice=t}}}),t("el-button",{attrs:{type:"primary",size:"mini"},class:"ml-1",on:{click:this.onModifyItemPrice.bind(this,e)}},[$t("kzjg2","确定","lang")])]),t("el-button",{slot:"reference",attrs:{type:"text"}},[t("i",{class:"el-icon-edit"})])])])},{name:$t("c4yuhd6","成本价（¥）","lang"),key:"cost_price",width:120,render:(t,{row:e})=>t("span",{},e.cost_price/100)},{name:$t("ewhqj16","毛利率（%)","lang"),key:"gross_profit_rate",width:100,align:"right",headerAlign:"center"},{name:$t("7msy3i5","来源供应商","lang"),key:"supplier_name",width:100},{name:$t("j5fnxf4","销售分类","lang"),key:"itemCatName",minWidth:120},{name:$t("idef2","标签","lang"),width:120,key:"tagList",render:(t,e)=>t("div",{style:"white-space: normal;"},[e.row.tagList?.map(e=>t("span",{style:{color:e.font_color,"background-color":e.tag_color,"font-size":"12px",padding:"2px 5px","border-radius":"2px",margin:"0 8px 8px 0"}},[e.tag_name]))])},{name:$t("di507i4","来源店铺","lang"),key:"distributor_name",width:160}]})}},created(){this.getDefaultDistributor()},methods:{onSearch(){this.$refs.finder.refresh(!0)},async getDefaultDistributor(){if(!this.formData.distributor_id){const{distributor_id:t,name:e}=await this.$api.marketing.getDistributorInfo({distributor_id:0});this.formData.distributor_id=t,this.$refs.selectShop&&(this.$refs.selectShop.selectValue=e)}this.finderUrl="/distributor/items",this.finderData=void 0},beforeSearch(t){const e=this.formData;return t={...t,...e,is_can_sale:"second"==this.activeTab||"third"!=this.activeTab&&"_all"}},afterSearch({data:t}){return t.data.list.forEach(t=>{t.price=t.price/100}),t},onSelectionChange(t){this.selectItems=t},getApproveStatus(t){return{1:$t("eqsf2","可售","lang"),0:$t("buay43","不可售","lang")}[t]||$t("buay43","不可售","lang")},async removeItemFromShop(){if(0==this.selectItems.length)return this.$message.error($t("6enbc69","请至少选择一个商品","lang"));await this.$confirm($t("w368ub9","请确认是否删除商品","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang")});const{distributor_id:t}=this.formData;await this.$api.marketing.deleteDistributorItems({distributor_id:t,item_ids:this.selectItems.map(t=>t.goods_id)}),this.$message.success($t("nnzyj26","商品删除成功","lang")),this.$refs.finder.refresh(!0)},handleBatchDownload(t){if(0==this.selectItems.length)return this.$message.error($t("6enbc69","请至少选择一个商品","lang"));const e=new(r()),i=[],{distributor_id:a}=this.formData;this.selectItems.forEach(t=>{const e=`${this.BASE_API}/goods/distributionGoodsWxaCodeStream?item_id=${t.itemId}&distributor_id=${a}`;i.push((0,l.getFileBlob)(e))}),Promise.all(i).then(t=>{t.forEach((t,i)=>{e.file(`${this.selectItems[i].itemName}.png`,t,{binary:!0})}),e.generateAsync({type:"blob"}).then(t=>{n().saveAs(t,"店铺的商品小程序码(批量).zip")})})},async handleExport(){const t={...this.formData,goods_ids:this.selectItems.map(t=>t.goods_id)},{status:e}=await this.$api.marketing.exportDistributorItems(t);e&&(this.$message.success($t("xdh90kk","已加入执行队列，请在设置-导出列表中下载","lang")),this.$export_open("distributor_items"))},async onModifyItemPrice(t){await this.$api.marketing.updateDistributorItem({distributor_id:t.distributor_id,item_id:t.item_id,price:100*this.editPrice}),this.$refs.finder.refresh()},onItemSkuFormSubmit(){this.itemSkuDialog=!1,this.$refs.finder.refresh()},async onPatchAction(t){if(0==this.selectItems.length)return this.$message.error($t("6enbc69","请至少选择一个商品","lang"));if("1"==t||"2"==t){this.loading=!0;try{await this.$api.marketing.updateDistributorItem({distributor_id:this.formData.distributor_id,goods_id:JSON.stringify(this.selectItems.map(t=>t.goods_id)),is_can_sale:"1"==t}),this.$message.success($t("d1spvi4","操作成功","lang")),this.$refs.finder.refresh()}catch(t){this.$message.error($t("d1rj434","操作失败","lang"))}finally{this.loading=!1}}else if("3"==t||"4"==t){this.loading=!0;let e=[];if(this.IS_ADMIN()&&this.VERSION_STANDARD()&&(e=this.selectItems.filter(t=>"0"==t.supplier_id)),!e.length)return void this.$refs.finder.refresh(!0);try{await this.$api.marketing.updateDistributorItem({distributor_id:this.formData.distributor_id,goods_id:JSON.stringify(e.map(t=>t.goods_id)),is_total_store:"3"==t}),this.$message.success($t("d1spvi4","操作成功","lang")),this.$refs.finder.refresh(!0)}catch(t){this.$message.error($t("d1rj434","操作失败","lang"))}finally{this.loading=!1}}},handleTabClick(){this.$refs.finder.refresh()}}},p=(0,m.A)(h,function(){var t=this,e=t._self._c;return e("SpPage",{},[t.VERSION_SHUYUN()?t._e():e("SpPlatformTip",{attrs:{h5:"",app:"",alipay:""}}),e("SpFilterForm",{attrs:{model:t.formData},on:{onSearch:t.onSearch,onReset:t.onSearch}},[e("SpFilterFormItem",{attrs:{prop:"distributor_id",label:$t("ek40n3","店铺:","lang")}},[e("SpSelectShop",{ref:"selectShop",attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:t.formData.distributor_id,callback:function(e){t.$set(t.formData,"distributor_id",e)},expression:"formData.distributor_id"}})],1),e("SpFilterFormItem",{attrs:{prop:"keywords",label:$t("aotkhw5","商品名称:","lang")}},[e("el-input",{attrs:{placeholder:$t("mf25uh7","请输入商品名称","lang")},model:{value:t.formData.keywords,callback:function(e){t.$set(t.formData,"keywords",e)},expression:"formData.keywords"}})],1),e("SpFilterFormItem",{attrs:{prop:"item_bn",label:$t("agmxld5","商品货号:","lang")}},[e("el-input",{attrs:{placeholder:$t("mesnos7","请输入商品货号","lang")},model:{value:t.formData.item_bn,callback:function(e){t.$set(t.formData,"item_bn",e)},expression:"formData.item_bn"}})],1),e("SpFilterFormItem",{attrs:{prop:"barcode",label:$t("alzzc15","商品条码:","lang")}},[e("el-input",{attrs:{placeholder:$t("meyvvg7","请输入商品条码","lang")},model:{value:t.formData.barcode,callback:function(e){t.$set(t.formData,"barcode",e)},expression:"formData.barcode"}})],1),e("SpFilterFormItem",{attrs:{prop:"supplier_name",label:$t("7xykgl6","所属供应商:","lang")}},[e("el-input",{attrs:{placeholder:$t("40h5ei8","请输入所属供应商","lang")},model:{value:t.formData.supplier_name,callback:function(e){t.$set(t.formData,"supplier_name",e)},expression:"formData.supplier_name"}})],1),e("SpFilterFormItem",{attrs:{prop:"approve_status",label:$t("bf1igk7","总部销售状态:","lang")}},[e("el-select",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:t.formData.approve_status,callback:function(e){t.$set(t.formData,"approve_status",e)},expression:"formData.approve_status"}},t._l(t.statusOption,function(t){return e("el-option",{key:t.value,attrs:{label:t.title,size:"mini",value:t.value}})}),1)],1)],1),e("div",{staticClass:"action-container"},[e("el-button",{attrs:{type:"primary"},on:{click:t.removeItemFromShop}},[t._v($t("uugmmy7"," 从店铺移除 ","lang"))]),e("el-button",{attrs:{type:"primary"},on:{click:t.handleBatchDownload}},[t._v($t("mi7yg7"," 商品码下载 ","lang"))]),e("el-button",{attrs:{type:"primary"},on:{click:t.handleExport}},[t._v($t("efepu4"," 导出 ","lang"))]),e("el-dropdown",{on:{command:t.onPatchAction}},[e("el-button",{attrs:{type:"primary"}},[t._v($t("dikeo55"," 批量操作","lang")),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:"1"}},[e("span",[t._v($t("d0v9424","批量上架","lang"))])]),e("el-dropdown-item",{attrs:{command:"2"}},[e("span",[t._v($t("d0v94x4","批量下架","lang"))])]),e("el-dropdown-item",{attrs:{command:"3"}},[e("span",[t._v($t("cqmq5u4","总部库存","lang"))])]),e("el-dropdown-item",{attrs:{command:"4"}},[e("span",[t._v($t("cjs0bs4","店铺库存","lang"))])])],1)],1)],1),e("el-tabs",{attrs:{type:"card"},on:{"tab-click":t.handleTabClick},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},t._l(t.tabList,function(t,i){return e("el-tab-pane",{key:`tab-pane__${i}`,attrs:{label:t.name,name:t.value}})}),1),e("SpFinder",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"finder",attrs:{"fixed-row-action":"",setting:t.setting,hooks:{beforeSearch:t.beforeSearch,afterSearch:t.afterSearch},data:t.finderData,url:t.finderUrl,"row-actions-fixed-align":"left"},on:{"selection-change":t.onSelectionChange}}),t.itemSkuDialog?e("SpDialog",{ref:"itemSkuRef",staticClass:"sku-dialog",attrs:{width:"1100px","destroy-on-close":"",title:`${$t("i5i3a25","编辑商品【","lang")}${t.itemSkuForm.itemName}】`,form:t.itemSkuForm,"form-list":t.itemSkuFormList},on:{onSubmit:t.onItemSkuFormSubmit},model:{value:t.itemSkuDialog,callback:function(e){t.itemSkuDialog=e},expression:"itemSkuDialog"}}):t._e()],1)},[],!1,null,"34557820",null).exports}}]);