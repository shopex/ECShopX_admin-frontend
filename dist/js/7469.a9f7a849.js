"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[7469],{77469:function(e,t,a){a.r(t),a.d(t,{default:function(){return u}});a(44114);var n=a(33318),i=a(94644),r=a(95093),s=a.n(r),l=a(36251),o=a(76677),m=a(86729),d=a(26456),c={name:"",components:{SpSelectSupplier:m.default},data(){const e=this.$createElement;return{daijiesuan:l,yijiesuan:o,formQuery:{merchant_type:"supplier",supplier_id:"",merchant_id:"",statement_status:"",cycleTime:[],distributor_id:""},statusOption:[{title:$t("edmdy3","已结算","lang"),value:"done"},{title:$t("ulgi4m5","待平台结算","lang"),value:"confirmed"},{title:$t("vsetgi6","待供应商确认","lang"),value:"ready"}],feeDone:0,feeReady:0,defaultTime:["00:00:00","23:59:59"],pickerOptions:n.Dv,merchantLoading:!1,merchantList:[],setting:(0,i.createSetting)({actions:[{name:$t("dloloe4","查看明细","lang"),key:"detail",type:"button",buttonType:"text",action:{handler:async([e])=>{this.$router.push({path:`${this.$route.path}/detail?id=${e.id}`})}}},{name:this.IS_ADMIN()?$t("m90k2","结算","lang"):$t("l9122","确认","lang"),key:"settlement",type:"button",buttonType:"text",visible:e=>!(!this.IS_ADMIN()||"confirmed"!=e.statement_status)||!(!this.IS_SUPPLIER()||"ready"!=e.statement_status),action:{handler:async([e])=>{await this.$confirm(`${$t("elo38q5","结算单号【","lang")}${e.statement_no}${$t("v3ms8d9","】，确认是否结算？","lang")}`,$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang")}),await this.$api.financial.confirmStatement(e.id),this.$message.success($t("d1spvi4","操作成功","lang")),this.onSearch()}}}],columns:[{name:$t("gidap24","结算单号","lang"),key:"statement_no",width:160},{name:$t("c4b9p3","供应商","lang"),key:"supplier_name",width:160},{name:$t("hyq5qq4","订单数量","lang"),key:"order_num",width:160},{name:$t("wriojj8","实付总金额（¥）","lang"),key:"total_fee",width:160,render:(e,{row:t})=>e("span",{},t.point_fee/100+t.total_fee/100),visible:!(0,d.WZ)()},{name:$t("91qscc7","结算金额（¥）","lang"),key:"statement_fee",width:120,render:(e,{row:t})=>e("span",{},t.statement_fee/100)},{name:$t("d2orsf7","现金实付（¥）","lang"),key:"total_fee",width:160,render:(e,{row:t})=>e("span",{},t.total_fee/100),visible:!(0,d.WZ)()},{name:$t("fq5dol4","积分抵扣","lang"),key:"point_fee",width:160,render:(e,{row:t})=>e("span",{},t.point_fee/100),visible:!(0,d.WZ)()},{name:$t("cx45rh5","运费（总）","lang"),key:"freight_fee",width:160,render:(e,{row:t})=>e("span",{},t.freight_fee/100)},{name:$t("im23vh4","退款数量","lang"),key:"refund_num",width:160},{name:$t("cvf9i67","退款金额（¥）","lang"),key:"refund_fee",width:160,render:(e,{row:t})=>e("span",{},t.refund_fee/100),visible:!(0,d.WZ)()},{name:$t("im58s54","退款积分","lang"),key:"refund_point",width:160,render:(e,{row:t})=>e("span",{},t.refund_point/100)},{name:$t("6z0sw08","退货结算价（¥）","lang"),key:"refund_cost_fee",width:160,render:(e,{row:t})=>e("span",{},t.refund_cost_fee/100)},{name:$t("x32267","结算实付（¥）","lang"),key:"statement_fee",width:120,render:(e,{row:t})=>e("span",{},t.statement_fee/100),visible:(0,d.WZ)()},{name:$t("gidl234","结算周期","lang"),key:"alert_required_message",width:160,formatter:(t,a)=>e("div",[e("div",[s()(1e3*a.start_time).format("YYYY-MM-DD HH:mm:ss")]),e("div",["~",s()(1e3*a.end_time).format("YYYY-MM-DD HH:mm:ss")])])},{name:$t("frs75g4","确认时间","lang"),key:"confirm_time",width:160,formatter:(t,a)=>{if(a.confirm_time)return e("div",[s()(1e3*a.confirm_time).format("YYYY-MM-DD HH:mm:ss")])}},{name:$t("gigtsy4","结算时间","lang"),key:"end_time",width:160,formatter:(t,a)=>{if(a.end_time)return e("div",[s()(1e3*a.end_time).format("YYYY-MM-DD HH:mm:ss")])}},{name:$t("giip7z4","结算状态","lang"),key:"statement_status",width:120,render:(e,{row:t})=>e("span",{},this.getStateMentStatus(t.statement_status))}]})}},created(){},methods:{onSearch(){this.$refs.finder.refresh(!0)},beforeSearch(e){const t=JSON.parse(JSON.stringify(this.formQuery));return t.cycleTime.length>0&&(t.start_time=s()(t.cycleTime[0]).unix(),t.end_time=s()(t.cycleTime[1]).unix(),delete t.cycleTime),{...e,...t}},afterSearch(e){const{total_statement_fee_done:t,total_statement_fee_ready:a}=e.data.data;this.feeDone=(t/100).toFixed(2),this.feeReady=(a/100).toFixed(2)},getStateMentStatus(e){return"ready"==e?$t("vsetgi6","待供应商确认","lang"):"confirmed"==e?$t("ulgi4m5","待平台结算","lang"):"done"==e?$t("edmdy3","已结算","lang"):void 0},async exportData(){const e=JSON.parse(JSON.stringify(this.formQuery));e.cycleTime.length>0&&(e.start_time=s()(e.cycleTime[0]).unix(),e.end_time=s()(e.cycleTime[1]).unix(),delete e.cycleTime);const{status:t,url:a,filename:n}=await this.$api.financial.exportData(e);if(t)return this.$message({type:"success",message:$t("xdh90kk","已加入执行队列，请在设置-导出列表中下载","lang")}),void this.$export_open("statements");this.$message({type:"error",message:$t("yndnt89","没有相关数据可导出","lang")})},remoteMerchantList:async function(e){this.merchantLoading=!0;const t=await this.$api.marketing.getMerchantsList({pageSize:10,page:1});return this.merchantLoading=!1,t}}},u=(0,a(81656).A)(c,function(){var e=this,t=e._self._c;return t("SpPage",[-1===e.$route.path.indexOf("detail")?t("div",[t("SpFilterForm",{attrs:{model:e.formQuery},on:{onSearch:e.onSearch,onReset:e.onSearch}},[t("SpFilterFormItem",{attrs:{prop:"distributor_id",label:$t("ek40n3","店铺:","lang")}},[t("SpSelectShop",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:e.formQuery.distributor_id,callback:function(t){e.$set(e.formQuery,"distributor_id",t)},expression:"formQuery.distributor_id"}})],1),e.IS_SUPPLIER()?e._e():t("SpFilterFormItem",{attrs:{prop:"supplier_id",label:$t("afppe54","供应商:","lang")}},[t("SpSelectSupplier",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:e.formQuery.supplier_id,callback:function(t){e.$set(e.formQuery,"supplier_id",t)},expression:"formQuery.supplier_id"}})],1),t("SpFilterFormItem",{attrs:{prop:"statement_status",label:$t("eqbc2z5","结算状态:","lang")}},[t("el-select",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:e.formQuery.statement_status,callback:function(t){e.$set(e.formQuery,"statement_status",t)},expression:"formQuery.statement_status"}},e._l(e.statusOption,function(e){return t("el-option",{key:e.value,attrs:{label:e.title,size:"mini",value:e.value}})}),1)],1),t("SpFilterFormItem",{attrs:{prop:"cycleTime",label:$t("elwr0f5","结算周期:","lang"),size:"max"}},[t("el-date-picker",{attrs:{clearable:"",type:"datetimerange",align:"right",format:"yyyy-MM-dd HH:mm:ss","range-separator":$t("po31","至","lang"),"start-placeholder":$t("cd0ag54","开始日期","lang"),"end-placeholder":$t("gfhy2u4","结束日期","lang"),"prefix-icon":"null","default-time":e.defaultTime,"picker-options":e.pickerOptions},model:{value:e.formQuery.cycleTime,callback:function(t){e.$set(e.formQuery,"cycleTime",t)},expression:"formQuery.cycleTime"}})],1)],1),t("div",{staticClass:"action-container"},[t("el-button",{attrs:{type:"primary",plain:""},on:{click:e.exportData}},[e._v($t("efepu4"," 导出 ","lang"))])],1),t("div",{staticClass:"summary-info"},[t("div",{staticClass:"summary-item"},[t("SpImage",{attrs:{src:e.daijiesuan,width:40,height:40}}),t("div",[t("div",[e._v($t("oc5bev8","待结算金额（元）","lang"))]),t("div",{staticClass:"daijiesuan"},[e._v(" "+e._s(e.feeReady)+" ")])])],1),t("div",{staticClass:"summary-item"},[t("SpImage",{attrs:{src:e.yijiesuan,width:40,height:40}}),t("div",[t("div",[e._v($t("93qoz08","已结算金额（元）","lang"))]),t("div",{staticClass:"yijiesuan"},[e._v(" "+e._s(e.feeDone)+" ")])])],1)]),t("SpFinder",{ref:"finder",attrs:{"no-selection":"","fixed-row-action":"",setting:e.setting,hooks:{beforeSearch:e.beforeSearch,afterSearch:e.afterSearch},url:"/statement/summarized"}})],1):e._e(),t("router-view")],1)},[],!1,null,"cc4a5956",null).exports}}]);