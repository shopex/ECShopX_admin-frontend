"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[2350],{52350:function(t,e,a){a.r(e),a.d(e,{default:function(){return d}});a(44114),a(18111),a(7588);var i=a(95353),s=a(77825),n=a(26456),l=a(5134),r=a(95093),o=a.n(r),c=a(33318),p={mixins:[s.Ay,s.v8],data(){return{loading:!1,defaultTime:["00:00:00","23:59:59"],params:{activity_name:"",activity_status:"",time_start_begin:"",time_start_end:""},activity_id:[],activity_status:[{title:$t("en402","全部","lang"),value:""},{title:$t("fkmt13","未开始","lang"),value:"waiting"},{title:$t("lq5q43","进行中","lang"),value:"ongoing"},{title:$t("edie63","已结束","lang"),value:"end"}],processArr:[{title:$t("k6n1","是","lang"),value:1},{title:$t("gme1","否","lang"),value:0}],pickerOptions:c.Dv,exportData:{},activity_id:[]}},computed:{...(0,i.L8)(["wheight"])},mounted(){this.fetchList()},methods:{onSearch(){this.page.pageIndex=1,this.$nextTick(()=>{this.fetchList()})},getParams(){const t={};return(0,n.cy)(this.params.create_time)&&this.params.create_time.length>=2&&(t.time_start_begin=o()(this.params.create_time[0]).unix(),t.time_start_end=o()(this.params.create_time[1]).unix()),{...this.params,activity_status:0==this.params.activity_status?void 0:this.params.activity_status,activity_name:this.params.activity_name,create_time:[],...t}},onReset(){this.params={...this.initialParams},this.onSearch()},handleTabClick(t,e){this.onSearch()},dateStrToTimeStamp(t){return Date.parse(new Date(t))/1e3},exportCommunityOrder(){if(this.activity_id.length){let t={activity_id:this.activity_id};(0,l.communityOrderExport)(t).then(t=>{if(t.data.data.status)return this.$message({type:"success",message:$t("xdh90kk","已加入执行队列，请在设置-导出列表中下载","lang")}),void this.$export_open("normal_community_order");t.data.data.url?(this.downloadUrl=t.data.data.url,this.downloadName=t.data.filename,this.downloadView=!0):this.$message({type:"error",message:$t("d17rj2j","无内容可导出 或 执行失败，请检查重试","lang")})})}else(0,l.communityOrderExport)(this.params).then(t=>{if(t.data.data.status)return this.$message({type:"success",message:$t("xdh90kk","已加入执行队列，请在设置-导出列表中下载","lang")}),void this.$export_open("normal_community_order");t.data.data.url?(this.downloadUrl=t.data.data.url,this.downloadName=t.data.filename,this.downloadView=!0):this.$message({type:"error",message:$t("d17rj2j","无内容可导出 或 执行失败，请检查重试","lang")})})},handleSelectionChange(t){this.activity_id=[],t&&t.forEach(t=>{t&&this.activity_id.push(t.activity_id)})},async fetchList(){this.loading=!0;const{pageIndex:t,pageSize:e}=this.page;let a={page:t,pageSize:e,...this.getParams()};const{list:i,total_count:s}=await this.$api.promotions.getCommunityActivity(a);this.tableList=i,this.page.total=s,this.loading=!1},send(t){var e=$t("vma16tc","此操作发货, 是否继续?","lang");this.$confirm(e,$t("hn562","提示","lang"),{cancelButtonText:$t("ev022","取消","lang"),confirmButtonText:$t("kzjg2","确定","lang"),type:"warning",beforeClose:(e,a,i)=>{"confirm"===e&&(0,l.communityDeliver)({activity_id:t.activity_id}).then(t=>{this.fetchList(),this.$message({message:$t("b5q8w54","发货成功","lang"),type:"success",duration:5e3})}),i()}})}}},d=(0,a(81656).A)(p,function(){var t=this,e=t._self._c;return e("SpPage",[e("div",{staticClass:"page-body"},[-1===t.$route.path.indexOf("detail")&&-1===t.$route.path.indexOf("process")?e("div",[e("SpFilterForm",{attrs:{model:t.params},on:{onSearch:t.onSearch,onReset:t.onSearch}},[e("SpFilterFormItem",{attrs:{prop:"activity_name",label:$t("bopooa5","活动名称:","lang")}},[e("el-input",{attrs:{placeholder:$t("jel5hj7","请输入活动名称","lang")},model:{value:t.params.activity_name,callback:function(e){t.$set(t.params,"activity_name",e)},expression:"params.activity_name"}})],1),e("SpFilterFormItem",{attrs:{prop:"create_time",label:$t("fn58c3","时间:","lang"),size:"max"}},[e("el-date-picker",{attrs:{clearable:"",type:"datetimerange",align:"right",format:"yyyy-MM-dd HH:mm:ss","range-separator":$t("po31","至","lang"),"start-placeholder":$t("cd0ag54","开始日期","lang"),"end-placeholder":$t("gfhy2u4","结束日期","lang"),"prefix-icon":"null","default-time":t.defaultTime,"picker-options":t.pickerOptions},model:{value:t.params.create_time,callback:function(e){t.$set(t.params,"create_time",e)},expression:"params.create_time"}})],1),e("SpFilterFormItem",{attrs:{prop:"is_success",label:$t("1rn5746","仅成团订单:","lang")}},[e("el-select",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:t.params.is_success,callback:function(e){t.$set(t.params,"is_success",e)},expression:"params.is_success"}},t._l(t.processArr,function(t){return e("el-option",{key:t.value,attrs:{size:"mini",label:t.title,value:t.value}})}),1)],1)],1),e("div",{staticClass:"action-container"},[e("el-button",{attrs:{type:"primary",plain:"",icon:"el-plus-circle"},on:{click:t.exportCommunityOrder}},[t._v($t("99iynda"," 导出活动销售数据 ","lang"))])],1),e("el-tabs",{attrs:{type:"card"},on:{"tab-click":t.onSearch},model:{value:t.params.activity_status,callback:function(e){t.$set(t.params,"activity_status",e)},expression:"params.activity_status"}},[t._l(t.activity_status,function(t){return e("el-tab-pane",{key:t.value,attrs:{label:t.title,name:t.value}})}),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{border:"",data:t.tableList},on:{"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{type:"selection",align:"center",label:$t("emxt2","全选","lang")}}),e("el-table-column",{attrs:{width:"100",prop:"activity_id",label:"ID"}}),e("el-table-column",{attrs:{width:"220",prop:"activity_name",label:$t("e4hvdc4","活动名称","lang")}}),e("el-table-column",{attrs:{prop:"total_fee",width:"120",label:$t("pasdvu7","实际收入（¥）","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s((e.row.total_fee/100).toFixed(2))+" ")]}}],null,!1,518453929)}),e("el-table-column",{attrs:{prop:"total_fee","min-width":"150",label:$t("fl3fk3","有效期","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",[t._v(t._s(a.row.start_time))]),e("div",[t._v("~")]),e("div",[t._v(t._s(a.row.end_time))])]}}],null,!1,812850061)}),e("el-table-column",{attrs:{width:"220",prop:"activity_process_msg",label:$t("k1e32","状态","lang")}}),e("el-table-column",{attrs:{width:"200",prop:"activity_delivery_status_msg",label:$t("b5t5hd4","发货状态","lang")}}),e("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),"min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"operating-icons"},["success"==a.row.activity_status&&"PENDING"==a.row.delivery_status?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.send(a.row)}}},[t._v($t("diekq4"," 发货 ","lang"))]):t._e()],1)]}}],null,!1,948033852)})],1),e("div",{staticClass:"mt-4 text-right"},[e("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":t.page.pageIndex,"page-sizes":[10,20,50],total:t.page.total,"page-size":t.page.pageSize},on:{"update:currentPage":function(e){return t.$set(t.page,"pageIndex",e)},"update:current-page":function(e){return t.$set(t.page,"pageIndex",e)},"current-change":t.onCurrentChange,"size-change":t.onSizeChange}})],1)],2)],1):t._e(),e("router-view")],1)])},[],!1,null,null,null).exports}}]);