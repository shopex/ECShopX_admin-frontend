"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[6313],{26313:function(t,e,i){i.r(e),i.d(e,{default:function(){return o}});i(44114);var s=i(87378),a=i(98818),l=i(50002),n={components:{imgPicker:s.default},inject:["refresh"],data(){return{imgDialog:!1,thumbDialog:!1,couponDialog:!1,isGetImage:!1,isGetThumb:!1,isGetCard:!1,id:0,isEditting:!1,articals:[{title:"",author:"",content:"",viewcontent:"",content_source_url:"",digest:"",thumb_media_id:"",thumb_url:"",show_cover_pic:0,hasLink:!1,popVisible:!1}]}},mounted(){this.$route.params.id&&(this.isEditting=!0,(0,l.getArtical)(this.$route.params.id).then(t=>{this.articals=t.data.data.news_item,this.articals[this.id].viewcontent=this.articals[this.id].content.replace(/<img data-src="(.*?)/g,'<img src="'+{VUE_APP_IS_SAAS:"false",VUE_APP_SYSTEM_NAME:"Shopex Admin",VUE_APP_PUBLIC_PATH:"/",VUE_APP_WXIMG_URL:"",VUE_APP_WXAUTHCALL_Url:"https://demo-ecshopx.ishopex.cn",VUE_APP_PREFIXES:"",VUE_APP_QIANKUN_ENTRY:"/newpc",VUE_APP_OSS_CDN:"false",VUE_APP_FREE:"false",VUE_APP_ALIOSS_REGION:"",VUE_APP_ALIOSS_ACCESS_KEY_ID:"",VUE_APP_ALIOSS_ACCESS_KEY_SECRET:"",VUE_APP_ALIOSS_BUCKET:"",VUE_APP_LOCAL_DELIVERY_DIRVER:"dada",VUE_APP_CHUZHI:"true",NODE_ENV:"production",VUE_APP_BASE_API:"https://ecshopx82.shopex123.com/api",VUE_APP_MAP_KEY:"PSPBZ-KQ5CW-CSGRF-ON2S4-K2HQJ-XEBQG",VUE_APP_DEFAULT_LANG:"zhcn",BASE_URL:"/",VUE_APP_PLATFORM:"yd"}.WXIMG_URL+'"'),setTimeout(()=>{var t=this.$refs.editor[0].$refs.content.querySelectorAll(".coupon-card");if(0!=t.length){for(var e=0;e<t.length;e++)t[e].style.display="block",t[e].parentNode.setAttribute("contenteditable",!1);this.$refs.editor[0].focus(),this.$refs.editor[0].restoreSelection()}},200)}).catch(t=>{this.$router.go(-1)}))},methods:{addImgPreview(){this.imgDialog=!0,this.isGetImage=!0},pickImg(t){if(t&&""!==t.url){this.imgDialog=!1;var e=this.$refs.editor[0].$el.id,i=this.$refs.editor[0],s=new Image;s.src=this.wximageurl+t.url,i.range?i.range.insertNode(s):(i.$refs.content.appendChild(s),i.focus(),i.restoreSelection()),this.articals[e].viewcontent=i.$refs.content.innerHTML}},closeImgDialog(){this.imgDialog=!1},addThumbPreview(){this.thumbDialog=!0,this.isGetThumb=!0},pickThumb(t){t&&""!==t.url&&(this.thumbDialog=!1,this.articals[this.id].thumb_url=t.url,this.articals[this.id].thumb_media_id=t.media_id)},closeThumbDialog(){this.thumbDialog=!1},addCouponPreview(){this.couponDialog=!0,this.isGetCard=!0},closeCouponDialog(){this.couponDialog=!1},pickCoupon(t){if(this.couponDialog=!1,t){var e={card_id:t.card_id};(0,a.getCouponHtml)(e).then(e=>{var i=this.$refs.editor[0].$el.id,s=this.$refs.editor[0],a=e.data.data.html,l=document.createElement("div"),n=document.createElement("div");n.innerHTML="&nbsp;",l.className="coupon-wrap",l.setAttribute("contenteditable",!1);var o=a+'<div class="coupon-card"><div class="card_content" style="background-color: rgb(213, 64, 54);"><img class="logo" src="https://mmbiz.qlogo.cn/mmbiz_png/MUQsdY0GdK6oqaZpqxLBE6ReLkiaRv6ia3YTIzQHzr96iaiaWAXibGjRCicBdjoenWPzOcaERniajD1ZzhK6yetlXP1Ig/0?wx_fmt=png"><div class="card_info"><h4 class="card_title">'+t.title+'</h4></div><div class="deco"></div></div><div class="store group">&nbsp;</div></div>';l.innerHTML=o,s.range?(s.range.insertNode(l),s.range.endContainer==s.$refs.content&&(s.$refs.content.appendChild(n),s.focus())):(s.$refs.content.appendChild(l),s.$refs.content.appendChild(n),s.focus(),s.restoreSelection()),this.articals[i].viewcontent=s.$refs.content.innerHTML})}},handleClick(t){if(this.id=+t,this.isEditting){this.articals[this.id].viewcontent=this.articals[this.id].content.replace(/<img data-src="(.*?)/g,'<img src="'+{VUE_APP_IS_SAAS:"false",VUE_APP_SYSTEM_NAME:"Shopex Admin",VUE_APP_PUBLIC_PATH:"/",VUE_APP_WXIMG_URL:"",VUE_APP_WXAUTHCALL_Url:"https://demo-ecshopx.ishopex.cn",VUE_APP_PREFIXES:"",VUE_APP_QIANKUN_ENTRY:"/newpc",VUE_APP_OSS_CDN:"false",VUE_APP_FREE:"false",VUE_APP_ALIOSS_REGION:"",VUE_APP_ALIOSS_ACCESS_KEY_ID:"",VUE_APP_ALIOSS_ACCESS_KEY_SECRET:"",VUE_APP_ALIOSS_BUCKET:"",VUE_APP_LOCAL_DELIVERY_DIRVER:"dada",VUE_APP_CHUZHI:"true",NODE_ENV:"production",VUE_APP_BASE_API:"https://ecshopx82.shopex123.com/api",VUE_APP_MAP_KEY:"PSPBZ-KQ5CW-CSGRF-ON2S4-K2HQJ-XEBQG",VUE_APP_DEFAULT_LANG:"zhcn",BASE_URL:"/",VUE_APP_PLATFORM:"yd"}.WXIMG_URL+'"');var e=this.$refs.editor[0].$refs.content;setTimeout(()=>{for(var t=e.querySelectorAll(".coupon-card"),i=0;i<t.length;i++)t[i].style.display="block",t[i].parentNode.setAttribute("contenteditable",!1);this.$refs.editor[0].focus(),this.$refs.editor[0].restoreSelection()},200)}},addmsg(){this.articals.push({title:"",author:"",content:"",viewcontent:"",content_source_url:"",digest:"",thumb_media_id:"",thumb_url:"",show_cover_pic:0,hasLink:!1,popVisible:!1})},sortup(t){this.articals[t-1]=this.articals.splice(t,1,this.articals[t-1])[0]},sortdown(t){this.articals[t+1]=this.articals.splice(t,1,this.articals[t+1])[0]},remove(t){this.id=+(t-1),this.articals.splice(t,1),this.popVisible=!1},updateContent(t){let e=this.$refs.editor[0].$el.id;this.articals[e].viewcontent=t},onSubmit(){for(var t=new RegExp(this.wximageurl,"g"),e=0;e<this.articals.length;e++){this.articals[e].content=this.articals[e].viewcontent?this.articals[e].viewcontent.replace(t,""):this.articals[e].content;var i=document.getElementById("submitContent");i.innerHTML=this.articals[e].content;for(var s=i.querySelectorAll(".coupon-card"),a=0;a<s.length;a++)s[a].style.display="none";this.articals[e].content=i.innerHTML}const n=this;let o={};this.$route.params.id?(o={body:n.articals,media_id:this.$route.params.id},(0,l.updateArtical)(o).then(t=>{this.$message({message:$t("90byn76","修改图文成功","lang"),type:"success",duration:2e3,onClose(){n.refresh(),n.$router.go(-1)}})})):(o={body:n.articals},(0,l.createArtical)(o).then(t=>{this.$message({message:$t("r6ja596","添加图文成功","lang"),type:"success",duration:2e3,onClose(){n.refresh(),n.$router.go(-1)}})}))}}},o=(0,i(81656).A)(n,function(){var t=this,e=t._self._c;return e("SpPage",{attrs:{title:$t("v6582q6","新增图文消息","lang")}},[e("template",{slot:"page-footer"},[e("div",{staticClass:"text-right"},[e("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v($t("cp35x4"," 保存 ","lang"))]),e("el-button",{on:{click:t.onSubmit}},[t._v($t("nk2ws4"," 预览 ","lang"))])],1)]),e("section",{staticClass:"section-white"},[e("div",{staticClass:"appmsg_preview_area"},[e("div",{staticClass:"appmsg_preview_container"},[e("div",{attrs:{id:"submitContent"}}),e("div",{staticClass:"appmsg_container_hd"},[e("h4",{staticClass:"appmsg_container_title"},[t._v($t("bea0564","图文列表","lang"))])]),e("div",{staticClass:"appmsg_container_bd"},[e("div",{staticClass:"appmsg multi has_first_cover editing"},[e("div",{staticClass:"appmsg_content",attrs:{id:"js_appmsg_preview"}},[t._l(t.articals,function(i,s){return[e("div",{key:s,staticClass:"js_appmsg_item appmsg_item_wrp",class:t.id===s?"current":"",on:{click:function(e){return t.handleClick(s)}}},0===s?[e("div",{staticClass:"first_appmsg_item",attrs:{title:$t("59hoqs5","第一篇图文","lang")}},[e("div",{staticClass:"cover_appmsg_item"},[e("h4",{staticClass:"appmsg_title"},[e("a",{staticClass:"js_appmsg_title",attrs:{href:"javascript:void(0);",onclick:"return false;"}},[""!=t.articals[0].title?[t._v(" "+t._s(t.articals[0].title)+" ")]:[t._v($t("gix7z4"," 标题 ","lang"))]],2)]),e("div",{staticClass:"appmsg_thumb_wrp",style:{backgroundImage:"url("+(i.thumb_url?t.wximageurl+i.thumb_url:"")+")"}},[i.thumb_url?t._e():e("div",{staticClass:"appmsg_thumb default"},[e("i",{staticClass:"icon_appmsg_thumb el-icon-picture"})])])]),e("div",{staticClass:"appmsg_edit_mask"},[e("a",{staticClass:"icon20_common iconfont icon-arrow-down sort_down_white",attrs:{onclick:"return false;",title:$t("dxzk2","下移","lang")},on:{click:function(e){return e.preventDefault(),t.sortdown(s)}}})])])]:[e("div",{staticClass:"appmsg_item has_cover"},[e("div",{staticClass:"appmsg_thumb_wrp",style:{backgroundImage:"url("+(i.thumb_url?t.wximageurl+i.thumb_url:"")+")"}},[i.thumb_url?t._e():e("div",{staticClass:"appmsg_thumb default"},[e("i",{staticClass:"icon_appmsg_thumb_small el-icon-picture"})])]),e("h4",{staticClass:"appmsg_title js_appmsg_title"},[""!=i.title?[t._v(" "+t._s(i.title)+" ")]:[t._v($t("gix7z4"," 标题 ","lang"))]],2),e("div",{staticClass:"appmsg_edit_mask"},[e("a",{staticClass:"icon20_common sort_up_white iconfont icon-arrow-up",attrs:{title:$t("dxyp2","上移","lang")},on:{click:function(e){return e.preventDefault(),t.sortup(s)}}}),s!==t.articals.length-1?e("a",{staticClass:"icon20_common sort_down_white icon icon-arrow-down",attrs:{title:$t("dxzk2","下移","lang")},on:{click:function(e){return e.preventDefault(),t.sortdown(s)}}}):t._e(),e("el-popover",{attrs:{placement:"bottom",width:"220",trigger:"click"},model:{value:i.popVisible,callback:function(e){t.$set(i,"popVisible",e)},expression:"item.popVisible"}},[e("p",{staticClass:"content-padded content-center",staticStyle:{"font-size":"14px"}},[t._v($t("pma37cb"," 确定删除这篇图文？ ","lang"))]),e("div",{staticClass:"content-center"},[e("el-button",{on:{click:function(t){i.popVisible=!1}}},[t._v($t("dd4ni4"," 取消 ","lang"))]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.remove(s)}}},[t._v($t("in1ck4"," 确定 ","lang"))])],1),t.isEditting?t._e():e("a",{staticClass:"icon20_common del_media_white el-icon-delete2",attrs:{slot:"reference",title:$t("eslg2","删除","lang")},slot:"reference"})])],1)])])]})],2)]),t.isEditting?t._e():e("div",{staticClass:"create_access_primary appmsg_add",attrs:{title:$t("q4wxxx6","添加一篇图文","lang")},on:{click:t.addmsg}},[e("i",{staticClass:"icon35_common el-icon-plus"})])])])]),e("div",{staticClass:"appmsg_input_area"},[t._l(t.articals,function(i,s){return t.id===s?[e("el-form",{key:s,ref:"item",refInFor:!0,attrs:{model:i,"label-position":"top","label-width":"80px"}},[e("div",{staticClass:"content-padded"},[e("el-form-item",{attrs:{label:$t("ij5d2","标题","lang")}},[e("el-input",{attrs:{placeholder:$t("2j7m1y5","请输入标题","lang")},model:{value:i.title,callback:function(e){t.$set(i,"title",e)},expression:"item.title"}})],1),e("el-form-item",{attrs:{label:$t("e78p2","作者","lang")}},[e("el-input",{model:{value:i.author,callback:function(e){t.$set(i,"author",e)},expression:"item.author"}})],1),e("el-form-item",[e("SpRichText",{model:{value:i.viewcontent,callback:function(e){t.$set(i,"viewcontent",e)},expression:"item.viewcontent"}})],1),e("el-form-item",[e("el-checkbox",{model:{value:i.hasLink,callback:function(e){t.$set(i,"hasLink",e)},expression:"item.hasLink"}},[t._v($t("dltwx6"," 原文链接 ","lang"))]),i.hasLink?e("el-input",{attrs:{placeholder:""},model:{value:i.content_source_url,callback:function(e){t.$set(i,"content_source_url",e)},expression:"item.content_source_url"}},[e("template",{slot:"prepend"},[t._v(" Http:// ")])],2):t._e()],1)],1),e("div",{staticClass:"content-padded appmsg_edit_highlight_area"},[e("h3",{staticClass:"header-title"},[t._v($t("rvvsqt6","发布样式编辑","lang"))]),e("div",{staticClass:"header_tips"},[t._v($t("7zd4h57"," 封面小图片 ","lang")),e("span",{staticClass:"form-text-tip"},[t._v($t("jvk7goi","建议尺寸：200像素 * 200像素","lang"))])]),e("el-form-item",[e("div",[e("el-button",{on:{click:t.addThumbPreview}},[t._v($t("rexvoc8"," 从图片库选择 ","lang"))])],1),i.thumb_url?e("div",{staticClass:"cover_preview",style:{backgroundImage:"url("+(i.thumb_url?t.wximageurl+i.thumb_url:"")+")"}}):t._e()]),e("div",{staticClass:"header_tips"},[t._v($t("fwxkn4"," 摘要 ","lang")),e("span",{staticClass:"form-text-tip"},[t._v($t("9to0rhk","选填，如果不填写会默认抓取正文前54个字","lang"))])]),e("el-form-item",[e("el-input",{attrs:{type:"textarea",autosize:{minRows:5,maxRows:8},resize:"none",maxlength:120},model:{value:i.digest,callback:function(e){t.$set(i,"digest",e)},expression:"item.digest"}}),e("div",{staticClass:"content-num"},[t._v(t._s(i.digest.length)+"/120")])],1)],1)])]:t._e()})],2),e("div",{staticClass:"appmsg_tpl_area"},[e("div",{staticClass:"appmsg_tpl_container"},[e("div",{staticClass:"appmsg_container_hd"},[e("h4",{staticClass:"appmsg_container_title"},[t._v($t("dho633","多媒体","lang"))])]),e("div",{staticClass:"appmsg_container_bd"},[e("ul",{staticClass:"tpl_list",attrs:{id:"js_media_list"}},[e("li",{staticClass:"tpl_item img",on:{click:t.addImgPreview}},[e("i",{staticClass:"iconfont icon-image"}),t._v($t("da59z3","图片 ","lang"))])]),e("imgPicker",{attrs:{"dialog-visible":t.thumbDialog,"sc-status":t.isGetThumb},on:{chooseImg:t.pickThumb,closeImgDialog:t.closeThumbDialog}}),e("imgPicker",{attrs:{"dialog-visible":t.imgDialog,"sc-status":t.isGetImage},on:{chooseImg:t.pickImg,closeImgDialog:t.closeImgDialog}})],1)])])])],2)},[],!1,null,"1cd693ab",null).exports}}]);