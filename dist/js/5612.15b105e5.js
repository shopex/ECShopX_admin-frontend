"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[5612],{45612:function(t,e,l){l.r(e),l.d(e,{default:function(){return c}});l(44114),l(18111),l(7588);var a=l(73306),s=l(62473),o={props:["seletedCoupon","type"],methods:{deleteRow(t,e){this.$emit("deleteRowHandle",t)}}},n=l(81656),i=(0,n.A)(o,function(){var t=this,e=t._self._c;return e("el-table",{ref:"Table",staticStyle:{width:"100%"},attrs:{data:t.seletedCoupon,"tooltip-effect":"dark",border:""}},[e("el-table-column",{attrs:{label:$t("avb2lg4","卡劵类型","lang"),width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return["new_gift"==e.row.card_type?[t._v($t("b5rlyx5"," 兑换券 ","lang"))]:t._e(),"discount"==e.row.card_type?[t._v($t("dc2rhw5"," 折扣卷 ","lang"))]:t._e(),"cash"==e.row.card_type?[t._v($t("etfamu5"," 满减券 ","lang"))]:t._e()]}}])}),e("el-table-column",{attrs:{prop:"title",label:$t("av4dtj4","卡劵名称","lang"),width:"120"}}),e("el-table-column",{attrs:{prop:"description",label:$t("avds7i4","卡劵说明","lang"),"show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"fixed_term",label:$t("ia37tg5","卡劵有效期","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return["DATE_TYPE_FIX_TIME_RANGE"==e.row.date_type||"DATE_TYPE_SHORT"==e.row.date_type?[t._v(" "+t._s(t._f("formatTimestamp")(e.row.begin_time))+" - "+t._s(t._f("formatTimestamp")(e.row.end_time))+" ")]:"DATE_TYPE_FIX_TERM"==e.row.date_type||"DATE_TYPE_LONG"==e.row.date_type?[t._v(" "+t._s(e.row.takeEffect)+" ")]:t._e()]}}])}),e("el-table-column",{attrs:{label:$t("7duixo5","可领取库存","lang"),"show-overflow-tooltip":"",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.quantity-e.row.get_num)+" ")]}}])}),e("el-table-column",{attrs:{prop:"give_num",label:$t("b667cf4","发送数量","lang"),width:"100","show-overflow-tooltip":""}}),"edit"!=t.type?e("el-table-column",{attrs:{fixed:"right",label:$t("hkxb2","操作","lang"),width:"100"},scopedSlots:t._u([{key:"default",fn:function(l){return[e("el-button",{staticStyle:{color:"#409eff"},attrs:{type:"text",size:"small"},nativeOn:{click:function(e){return e.preventDefault(),t.deleteRow(l.$index,t.seletedCoupon)}}},[t._v($t("j57pz4"," 移除 ","lang"))])]}}],null,!1,3849913300)}):t._e()],1)},[],!1,null,null,null).exports,r={components:{couponSelect:s.default,cpnTable:i},data(){return{visible:!1,disabled:!1,type:"create",ruleForm:{title:"",package_describe:"",limit_count:""},seletedCoupon:[],rules:{title:[(0,a.XU)($t("as7rs14","劵包标题","lang")),(0,a.SO)(10)]}}},mounted(){this.Config()},methods:{async Config(){const{type:t,package_id:e}=this.$route.query;if(this.type=t,"create"==t)return;"edit"==t&&(this.disabled=!0);const{title:l,package_describe:a,limit_count:s,discount_cards:o}=await this.$api.coupons_package.couponDetail({package_id:e});this.ruleForm.title=l,this.ruleForm.package_describe=a,this.ruleForm.limit_count=s,this.seletedCoupon=o},pickHanle(){this.visible=!this.visible},back(){this.$router.push({path:this.$route.matched[1].path})},seletedDataHandle(t){this.seletedCoupon=t},deleteRowHandle(t){this.seletedCoupon.splice(t,1)},confirmHandle(t){const{type:e,package_id:l}=this.$route.query;"edit"==e?this.$refs[t].validate(async t=>{if(!t)return!1;{const{status:t}=await this.$api.coupons_package.editCouponPackage({...this.ruleForm,package_id:l});t?(this.$message.success($t("h4sv2","成功","lang")),this.$router.push({path:this.$route.matched[1].path})):this.$message.success($t("fy1g2","失败","lang"))}}):this.$refs[t].validate(async t=>{if(!t)return!1;{let t=[];this.seletedCoupon.forEach(e=>{t.push({card_id:e.card_id,give_num:e.give_num})});const{status:e}=await this.$api.coupons_package.createdCoupons({...this.ruleForm,package_content:t});e?(this.$message.success($t("h4sv2","成功","lang")),this.$router.push({path:this.$route.matched[1].path})):this.$message.success($t("fy1g2","失败","lang"))}})}}},c=(0,n.A)(r,function(){var t=this,e=t._self._c;return e("div",{staticClass:"zykCouponEditor"},[e("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"100px"}},[e("el-card",{attrs:{shadow:"never"}},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v($t("blh1h04","基础信息","lang"))])]),e("div",{staticClass:"content"},[e("el-form-item",{attrs:{label:$t("as7rs14","劵包标题","lang"),prop:"title"}},[e("el-input",{staticClass:"maxW",attrs:{maxlength:"10","show-word-limit":""},model:{value:t.ruleForm.title,callback:function(e){t.$set(t.ruleForm,"title",e)},expression:"ruleForm.title"}})],1),e("el-form-item",{attrs:{label:$t("hrlt2","描述","lang")}},[e("el-input",{staticClass:"maxW",attrs:{maxlength:"20","show-word-limit":"",placeholder:$t("pbdijre","仅商家端显示，可以区分相似劵","lang")},model:{value:t.ruleForm.package_describe,callback:function(e){t.$set(t.ruleForm,"package_describe",e)},expression:"ruleForm.package_describe"}})],1)],1)]),e("el-card",{attrs:{shadow:"never"}},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v($t("as3cta4","劵包信息","lang"))]),e("div",{staticClass:"tips"},[t._v($t("5r6qbng","劵包一旦保存,劵包信息不可再修改","lang"))])]),e("div",{staticClass:"content"},[e("el-form-item",{attrs:{"label-width":"0px"}},[e("el-tooltip",{attrs:{placement:"top",width:"350"}},[e("div",{staticClass:"tips",attrs:{slot:"content"},slot:"content"},[e("p",[t._v($t("8nswz3z","1. 券包不区分优惠券发送渠道，所有种类优惠券都可以配置到同一券包内。","lang"))]),e("p",[t._v($t("wt8x06z","2. 券包可以设置限领，但限领规则优先由券包内优惠券设置及库存等决定。","lang"))]),e("p",[t._v($t("xu1l3fn","3. 券包内优惠券规则根据优惠券本身规则所定。","lang"))]),e("p",[t._v($t("pcbcv6v","4. 若有优惠券限领1张，券包限领2次，按优惠券规则领取数量。","lang"))])]),e("el-button",{staticClass:"btn",staticStyle:{border:"none","font-size":"14px",width:"100px"},attrs:{type:"text",icon:"el-icon-warning-outline"}},[t._v($t("i6kjp46"," 优惠劵包 ","lang"))])],1),e("el-button",{attrs:{disabled:t.disabled},on:{click:t.pickHanle}},[t._v($t("rqlv47"," 选择优惠券 ","lang"))])],1),t.seletedCoupon.length>0?e("el-form-item",{attrs:{"label-width":"20px"}},[e("cpn-table",{attrs:{"seleted-coupon":t.seletedCoupon,type:t.type},on:{deleteRowHandle:t.deleteRowHandle}})],1):t._e(),e("el-form-item",{attrs:{label:$t("b6c17p4","发送规则","lang")}},[e("span",[t._v($t("7l74crq","券包内任一优惠券库存大于等于1时，券包都可继续发放 ","lang"))]),e("span",[e("el-tooltip",{attrs:{placement:"top",width:"250"}},[e("div",{staticClass:"tips",attrs:{slot:"content"},slot:"content"},[e("p",[t._v($t("xh1c9s18"," 例：选择券包内有5张优惠券，其中1张优惠券库存为零，用户可继续领取有库存的4张优惠券 ","lang"))])]),e("el-button",{staticClass:"btn",staticStyle:{border:"none","font-size":"14px",color:"none"},attrs:{type:"text",icon:"el-icon-warning-outline"}})],1)],1)]),e("el-form-item",{attrs:{label:$t("jldgdh4","限领次数","lang")}},[e("el-input",{staticStyle:{width:"130px"},attrs:{placeholder:$t("l6wdl3","请输入","lang"),disabled:t.disabled},model:{value:t.ruleForm.limit_count,callback:function(e){t.$set(t.ruleForm,"limit_count",e)},expression:"ruleForm.limit_count"}},[e("el-button",{attrs:{slot:"append"},slot:"append"},[t._v($t("ivr33"," 次 ","lang"))])],1),e("p",{staticClass:"tips"},[t._v($t("jv6besj","每个用户领券上限，如不填，则默认为1。","lang"))])],1)],1)]),e("div",[e("el-button",{on:{click:t.back}},[t._v($t("m1m0m4"," 返回 ","lang"))]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.confirmHandle("ruleForm")}}},[t._v($t("fk4a44"," 提交 ","lang"))])],1)],1),t.visible?[e("coupon-select",{attrs:{"seleted-coupon":t.seletedCoupon,visible:t.visible},on:{closeHandle:t.pickHanle,seletedDataHandle:t.seletedDataHandle}})]:t._e()],2)},[],!1,null,"04d65246",null).exports}}]);