"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[9546],{59546:function(t,e,a){a.r(e),a.d(e,{default:function(){return c}});a(44114),a(18111),a(22489),a(61701);var i=a(95353),n=a(5134),s=a(25159),o=a(77825),l={components:{shopSelect:s.default},mixins:[o.Ay,o.v8],provide(){return{refresh:this.fetchList}},data(){const t={create_time:[],status:"all",marketing_type:"full_gift",item_type:void 0};return{initialParams:t,params:{...t},cursymbol:"￥",loading:!1,activityItemParams:{page:1,pageSize:20},activityItemTotalCount:0,activityItemListsData:[],activityItemDialog:!1,ItemLoading:!1,tabList:[{name:$t("en402","全部","lang"),activeName:"all"},{name:$t("egbo03","待开始","lang"),activeName:"waiting"},{name:$t("lq5q43","进行中","lang"),activeName:"ongoing"},{name:$t("edie63","已结束","lang"),activeName:"end"}]}},computed:{...(0,i.L8)(["wheight"])},mounted(){this.fetchList()},methods:{onSearch(){this.page.pageIndex=1,this.$nextTick(()=>{this.fetchList()})},getParams(){const t={},e=this.params.create_time;return e&&e.length>0&&(t.start_time=this.dateStrToTimeStamp(e[0]+" 00:00:00"),t.end_time=this.dateStrToTimeStamp(e[1]+" 23:59:59")),{...this.params,status:"all"===this.params.status?void 0:this.params.status,create_time:[],...t}},onReset(){this.params={...this.initialParams},this.onSearch()},handleTabClick(t,e){this.onSearch()},addActivityData(){this.$router.push({path:this.matchRoutePath("editor")})},editActivityAction(t,e){this.$router.push({path:this.matchRoutePath("editor/")+e.marketing_id})},deleteActivityAction(t){var e=$t("47ymzlb","你确定要删除该活动吗?","lang");this.$confirm(e,$t("hn562","提示","lang"),{cancelButtonText:$t("ev022","取消","lang"),confirmButtonText:$t("kzjg2","确定","lang"),type:"warning",beforeClose:(e,a,i)=>{"confirm"===e&&(0,n.removeMarketingActivity)({marketing_id:t.marketing_id}).then(t=>{this.fetchList(),this.$message({message:$t("r52uu86","删除活动成功","lang"),type:"success",duration:5e3})}),i()}})},viewDetail(t){this.$router.push({path:this.matchRoutePath("editor/")+t.marketing_id,query:{isnodata:!0}})},viewItemList(t,e){"all"==t?"normal"==e?this.$router.push({path:"distributor"!=this.$store.getters.login_type?"/entity/goods/goodsphysical":"/shopadmin/entity/goodsphysical"}):this.$router.push({path:this.matchInternalRoute("servicegoods")}):(this.ItemLoading=!0,this.activityItemDialog=!0,this.activityItemParams.marketing_id=t,(0,n.getMarketingActivityItemList)(this.activityItemParams).then(t=>{null!=t&&t.data.data&&t.data.data.total_count>0&&(this.activityItemListsData=t.data.data.list,this.activityItemTotalCount=t.data.data.total_count),this.ItemLoading=!1}))},handleGoodsCurrentChange(t){this.ItemLoading=!0,this.activityItemDialog=!0,this.activityItemParams.page=t,(0,n.getMarketingActivityItemList)(this.activityItemParams).then(t=>{null!=t&&t.data.data&&t.data.data.total_count>0&&(this.activityItemListsData=t.data.data.list,this.activityItemTotalCount=t.data.data.total_count),this.ItemLoading=!1})},handleGoodsSizeChange(t){this.ItemLoading=!0,this.activityItemDialog=!0,this.activityItemParams.page=1,this.activityItemParams.pageSize=t,(0,n.getMarketingActivityItemList)(this.activityItemParams).then(t=>{null!=t&&t.data.data&&t.data.data.total_count>0&&(this.activityItemListsData=t.data.data.list,this.activityItemTotalCount=t.data.data.total_count),this.ItemLoading=!1})},handleCancel(){this.activityItemDialog=!1},dateStrToTimeStamp(t){return Date.parse(new Date(t))/1e3},viewGiftItemList(t,e,a){if(this.activityItemDialog=!0,1==a)this.activityItemListsData=t.gifts,this.activityItemTotalCount=t.gifts.length;else{let a=t.gifts.map(t=>t.filter_full.split(".")[0]==e?t:{}).filter(function(t){return Object.keys(t).length>0});this.activityItemListsData=a,this.activityItemTotalCount=a.length}},async fetchList(){this.loading=!0;const{pageIndex:t,pageSize:e}=this.page;let a={page:t,pageSize:e,...this.getParams()};const{list:i,total_count:n}=await this.$api.promotions.getMarketingActivityList(a);this.tableList=i,this.page.total=n,this.loading=!1},updateStatusCommunityAction(t){var e=$t("3pkh9yi","此操作将永久终止该活动, 是否继续?","lang");this.$confirm(e,$t("hn562","提示","lang"),{cancelButtonText:$t("ev022","取消","lang"),confirmButtonText:$t("kzjg2","确定","lang"),type:"warning",beforeClose:(e,a,i)=>{"confirm"===e&&(0,n.removeMarketingActivity)({marketing_id:t.marketing_id,isEnd:!0}).then(t=>{this.fetchList(),this.$message({message:$t("c6bhfy8","修改活动状态成功","lang"),type:"success",duration:5e3})}),i()}})}}},r=l,c=(0,a(81656).A)(r,function(){var t=this,e=t._self._c;return e("SpPage",[e("SpRouterView",[t.VERSION_SHUYUN()?t._e():e("SpPlatformTip",{attrs:{h5:"",app:"",pc:"",alipay:""}}),e("SpFilterForm",{attrs:{model:t.params},on:{onSearch:t.onSearch,onReset:t.onReset}},[e("SpFilterFormItem",{attrs:{prop:"create_time",label:$t("fn58c3","时间:","lang")}},[e("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","value-format":"yyyy/MM/dd",placeholder:$t("fcdtwa8","根据添加时间筛选","lang")},model:{value:t.params.create_time,callback:function(e){t.$set(t.params,"create_time",e)},expression:"params.create_time"}})],1)],1),e("div",{staticClass:"action-container"},[e("el-button",{attrs:{type:"primary",icon:"iconfont icon-xinzengcaozuo-01"},on:{click:t.addActivityData}},[t._v($t("gihr8f8"," 添加满赠促销 ","lang"))])],1),e("el-tabs",{attrs:{type:"card"},on:{"tab-click":t.handleTabClick},model:{value:t.params.status,callback:function(e){t.$set(t.params,"status",e)},expression:"params.status"}},t._l(t.tabList,function(a,i){return e("el-tab-pane",{key:i,attrs:{label:a.name,name:a.activeName}},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableList,border:"",height:t.wheight-190,"element-loading-text":$t("go5gpa5","数据加载中","lang")}},[e("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[e("el-form-item",{attrs:{label:$t("infiw44","适用会员","lang")}},t._l(a.row.member_grade,function(a,i){return e("el-tag",{key:i},[t._v(" "+t._s(a)+" ")])}),1),e("el-form-item",{attrs:{label:$t("ar84e54","创建时间","lang")}},[e("span",[t._v(t._s(a.row.created_date))])]),e("el-form-item",{attrs:{label:$t("ingkrl4","适用商品","lang")}},t._l(a.row.items,function(a,i){return e("div",{key:i},[t._v(" "+t._s(a.item_name)+" ")])}),0),e("el-form-item",{attrs:{label:$t("iniii14","适用店铺","lang")}},[a.row.use_shop?e("span",t._l(a.row.shops,function(a,i){return e("div",{key:i},[t._v(" "+t._s(a.shop_name)+" ")])}),0):e("span",[e("div",[t._v($t("avbuf74","全部店铺","lang"))])])])],1)]}}],null,!0)}),e("el-table-column",{attrs:{prop:"marketing_id",width:"60",label:$t("m2sh2","编号","lang")}}),e("el-table-column",{attrs:{prop:"marketing_name","min-width":"150",label:$t("aoeo684","促销名称","lang")}}),e("el-table-column",{attrs:{label:$t("nvth2","规则","lang"),"min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(a){return t._l(a.row.condition_value,function(i,n){return e("div",{key:n},["quantity"==a.row.condition_type?e("span",[t._v($t("ham9c4"," 消费满","lang")+t._s(i.full)+$t("p870fl5","件,赠送(","lang")),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.viewGiftItemList(a.row,i.full,a.row.condition_value.length)}}},[t._v($t("oig12","赠品","lang"))]),t._v(") ")],1):t._e(),"totalfee"==a.row.condition_type?e("span",[t._v($t("ham9c4"," 消费满","lang")+t._s(i.full)+$t("y81txa5","元,赠送(","lang")),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.viewGiftItemList(a.row,i.full,a.row.condition_value.length)}}},[t._v($t("oig12","赠品","lang"))]),t._v(") ")],1):t._e()])})}}],null,!0)}),e("el-table-column",{attrs:{prop:"used_platform","min-width":"100",label:$t("ini4sj4","适用平台","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return[0==a.row.used_platform?e("span",[t._v($t("amtppn4","全场可用","lang"))]):t._e(),1==a.row.used_platform?e("span",[t._v($t("fhdu2c6","只用于pc端","lang"))]):t._e(),2==a.row.used_platform?e("span",[t._v($t("c4ce8s4","小程序端","lang"))]):t._e(),3==a.row.used_platform?e("span",[t._v($t("2uo23","h5端","lang"))]):t._e()]}}],null,!0)}),e("el-table-column",{attrs:{prop:"total_fee","min-width":"150",label:$t("fl3fk3","有效期","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",[t._v(t._s(a.row.start_date))]),e("div",[t._v("~")]),e("div",[t._v(t._s(a.row.end_date))])]}}],null,!0)}),e("el-table-column",{attrs:{"min-width":"70",prop:"source_name",label:$t("gwn72","店铺","lang")}}),e("el-table-column",{attrs:{"min-width":"70",label:$t("k1e32","状态","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return["ongoing"==a.row.status?e("span",[t._v($t("lq5q43","进行中","lang"))]):t._e(),"waiting"==a.row.status?e("span",[t._v($t("fkmt13","未开始","lang"))]):t._e(),"end"==a.row.status?e("span",[t._v($t("edie63","已结束","lang"))]):t._e()]}}],null,!0)}),e("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),"min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"operating-icons"},[0!=a.row.use_bound?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.viewItemList(a.row.marketing_id)}}},[t._v($t("akaly76"," 查看商品 ","lang"))]):e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.viewItemList("all",a.row.item_type)}}},[t._v($t("32l7x76"," 全部商品 ","lang"))]),"end"!==a.row.status?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.updateStatusCommunityAction(a.row)}}},[t._v($t("jn7om4"," 终止 ","lang"))]):t._e(),"waiting"!=a.row.status&&"ongoing"!=a.row.status?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.viewDetail(a.row)}}},[t._v($t("ascou36"," 查看详情 ","lang"))]):t._e(),"Y"==a.row.edit_btn?["waiting"==a.row.status||"ongoing"==a.row.status?e("i",{staticClass:"iconfont icon-edit1",on:{click:function(e){return t.editActivityAction(a.$index,a.row)}}}):t._e()]:t._e(),"waiting"==a.row.status?e("i",{staticClass:"iconfont icon-trash-alt",on:{click:function(e){return t.deleteActivityAction(a.row)}}}):t._e()],2)]}}],null,!0)})],1),t.page.total>t.page.pageSize?e("div",{staticClass:"mt-4 text-right"},[e("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":t.page.pageIndex,"page-sizes":[10,20,50],total:t.page.total,"page-size":t.page.pageSize},on:{"update:currentPage":function(e){return t.$set(t.page,"pageIndex",e)},"update:current-page":function(e){return t.$set(t.page,"pageIndex",e)},"current-change":t.onCurrentChange,"size-change":t.onSizeChange}})],1):t._e()],1)}),1),e("el-dialog",{attrs:{title:$t("kaiuhjc","活动商品列表 OR 赠品","lang"),visible:t.activityItemDialog,"before-close":t.handleCancel,width:"70%"},on:{"update:visible":function(e){t.activityItemDialog=e}}},[[e("el-pagination",{attrs:{background:"",layout:"total","current-page":t.activityItemParams.page,"page-sizes":[10,20,50],total:t.activityItemTotalCount,"page-size":t.activityItemParams.pageSize},on:{"update:currentPage":function(e){return t.$set(t.activityItemParams,"page",e)},"update:current-page":function(e){return t.$set(t.activityItemParams,"page",e)},"current-change":t.handleGoodsCurrentChange,"size-change":t.handleGoodsSizeChange}}),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.ItemLoading,expression:"ItemLoading"}],attrs:{data:t.activityItemListsData,height:t.wheight-190}},[e("el-table-column",{attrs:{prop:"item_id",label:"id",width:"60"}}),e("el-table-column",{attrs:{prop:"pics[0]",label:$t("ff9l2","图片","lang"),width:"80"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("img",{attrs:{src:t.wximageurl+a.row.pics[0],width:"50",height:"50"}})]}}])}),e("el-table-column",{attrs:{prop:"item_name",label:$t("eyrn2","名称","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-col",[t._v(t._s(a.row.item_name))]),a.row.gift_num?e("el-col",[t._v(" x "+t._s(a.row.gift_num)+" ")]):t._e()]}}])}),e("el-table-column",{attrs:{prop:"item_spec_desc",label:$t("o06w2","规格","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-col",[t._v(t._s(a.row.item_spec_desc))])]}}])})],1),e("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next","current-page":t.activityItemParams.page,"page-sizes":[10,20,50],total:t.activityItemTotalCount,"page-size":t.activityItemParams.pageSize},on:{"update:currentPage":function(e){return t.$set(t.activityItemParams,"page",e)},"update:current-page":function(e){return t.$set(t.activityItemParams,"page",e)},"current-change":t.handleGoodsCurrentChange,"size-change":t.handleGoodsSizeChange}})]],2)],1)],1)},[],!1,null,"37936f79",null).exports}}]);