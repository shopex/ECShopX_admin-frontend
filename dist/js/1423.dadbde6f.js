"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[1423],{1423:function(t,a,e){e.r(a),e.d(a,{default:function(){return n}});e(44114),e(18111),e(7588);var s=e(95353),l=e(41776),i=e(5748),r={components:{shopSelect:e(25159).default},data(){var t=Date.now();return{loading:!1,activeName:"first",addRightsDialog:!1,delayDialog:!1,transferDialog:!1,mobile:"",searchMobile:"",goodsList:[],addRightsItems:[],goodsListSelect:[],rightsList:[],total_count:0,goods_total_count:0,goods_page:1,currentPage:1,goodsParams:{page:1,pageSize:20},params:{page:1,pageSize:20},form:{delay_date:[],remark:""},transferForm:{rights_id:null,mobile:"",transfer_mobile:"",remark:""},rightsInfo:{},delayData:[],transferData:[],pickerOptions:{disabledDate(a){return a.getTime()<t}},create_time:"",rights_from:"",rightsFrom:[{type:$t("yvi16l5","会员升级送","lang"),name:$t("yvi16l5","会员升级送","lang")},{type:$t("yvhk215","会员周年送","lang"),name:$t("yvhk215","会员周年送","lang")},{type:$t("ac0zi24","会员日送","lang"),name:$t("ac0zi24","会员日送","lang")},{type:$t("yqnsbn5","会员生日送","lang"),name:$t("yqnsbn5","会员生日送","lang")},{type:$t("e34w914","注册赠送","lang"),name:$t("e34w914","注册赠送","lang")},{type:$t("lli5qj7","管理员手动添加","lang"),name:$t("lli5qj7","管理员手动添加","lang")},{type:$t("i55dlu4","购买获取","lang"),name:$t("i55dlu4","购买获取","lang")}],valid:0,downloadView:!1,downloadUrl:"",downloadName:"",currentShop:""}},computed:{...(0,s.L8)(["wheight"])},mounted(){this.getRightsList()},methods:{onSubmit(){let t={mobile:this.mobile,itemids:this.addRightsItems};(0,l.createRights)(t).then(t=>{this.mobile="",this.addRightsItems=[],this.$message({type:"success",message:$t("taxr976","添加权益成功","lang")}),this.getRightsList(),this.addRightsDialog=!1})},addResource(){this.getGoodsList(),this.mobile="",this.addRightsDialog=!0},handleCancelLabelsDialog(){this.addRightsDialog=!1},handleCurrentChange(t){this.loading=!1,this.params.page=t,this.getRightsList()},numberSearch(){this.searchMobile?this.params.mobile=this.searchMobile:this.params.mobile="",this.params.page=1,this.getRightsList()},dateChange(t){t&&t.length>0?(this.params.date_begin=this.dateStrToTimeStamp(t[0]+" 00:00:00"),this.params.date_end=this.dateStrToTimeStamp(t[1]+" 23:59:59")):(this.params.date_begin="",this.params.date_end=""),this.params.page=1,this.getRightsList()},dateStrToTimeStamp(t){return Date.parse(new Date(t))/1e3},rightsFromHandle(t){this.params.rights_from=t,this.params.page=1,this.getRightsList()},handleGoodsChange(t){this.goodsParams.page=t,this.goodsListSelect=[],this.goodsList.forEach(t=>{-1!=this.addRightsItems.indexOf(t.key)&&this.goodsListSelect.push(t)}),this.getGoodsList()},getGoodsList(){(0,i.getItemsList)(this.goodsParams).then(t=>{let a=[];t.data.data.list.forEach(t=>{-1===this.addRightsItems.indexOf(t.itemId)&&a.push({key:t.itemId,label:t.itemName})}),this.goodsList=a.concat(this.goodsListSelect),this.goods_total_count=t.data.data.total_count})},getRightsList(){this.loading=!0,(0,l.findRightsList)(this.params).then(t=>{this.rightsList=t.data.data.list,this.total_count=Number(t.data.data.total_count),this.loading=!1})},delayAction(t){this.form.delay_date="",this.form.remark="",this.rightsInfo=t,this.form.rights_id=t.rights_id;var a={rights_id:t.rights_id};(0,l.getRightsInfo)(a).then(t=>{t.data.data.logs.list&&(this.delayData=t.data.data.logs.list)}),this.delayDialog=!0},delaySave(){(0,l.delayRights)(this.form).then(t=>{t.data.data&&(this.delayDialog=!1,this.getRightsList())})},transferAction(t){this.transferForm.rights_id=t.rights_id,this.transferForm.mobile=t.mobile,this.transferForm.transfer_mobile="",this.transferForm.remark="";var a={rights_id:t.rights_id};(0,l.transferRightsList)(a).then(t=>{t.data.data.list&&(this.transferData=t.data.data.list)}),this.transferDialog=!0},transferSave(){return this.transferForm.transfer_mobile?this.transferForm.remark?((0,l.transferRights)(this.transferForm).then(t=>{t.data.data&&(this.delayDialog=!1,this.getRightsList())}).catch(t=>{this.$message({type:"error",message:t.error.message})}),void(this.transferDialog=!1)):(this.$message({type:"error",message:$t("2jaeja5","请输入备注","lang")}),!1):(this.$message({type:"error",message:$t("yfxvdq8","请输入转让手机号","lang")}),!1)},changeOpen(t){this.params.valid=this.valid?1:0,this.params.page=1,this.getRightsList()},exportData(){this.params.page=1,(0,l.rightsExport)(this.params).then(t=>{t.data.data.status?this.$message({type:"success",message:$t("xdh90kk","已加入执行队列，请在设置-导出列表中下载","lang")}):t.data.data.url?(this.downloadUrl=t.data.data.url,this.downloadName=t.data.data.filename,this.downloadView=!0):this.$message({type:"error",message:$t("d17rj2j","无内容可导出 或 执行失败，请检查重试","lang")})})},shopHandle(t){t&&t.shop_id,this.currentShop=t.shop_id,this.params.page=1,this.params.shop_id=t.shop_id,this.getRightsList()}}},n=(0,e(81656).A)(r,function(){var t=this,a=t._self._c;return a("div",[a("el-row",{staticClass:"filter-header",attrs:{gutter:20}},[a("el-col",[a("shop-select",{attrs:{wxshops:""},on:{update:t.shopHandle}}),a("el-input",{staticClass:"input-m",attrs:{placeholder:$t("ewbd43","手机号","lang"),clearable:""},model:{value:t.searchMobile,callback:function(a){t.searchMobile=a},expression:"searchMobile"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.numberSearch},slot:"append"})],1),a("el-date-picker",{attrs:{type:"daterange","value-format":"yyyy/MM/dd",placeholder:$t("to1gvf6","选择日期范围","lang")},on:{change:t.dateChange},model:{value:t.create_time,callback:function(a){t.create_time=a},expression:"create_time"}}),a("el-select",{attrs:{placeholder:$t("2ek8u65","请选择来源","lang")},on:{change:t.rightsFromHandle},model:{value:t.rights_from,callback:function(a){t.rights_from=a},expression:"rights_from"}},t._l(t.rightsFrom,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.type}})}),1),a("el-switch",{attrs:{"active-color":"#13ce66","inactive-text":$t("d8sygm4","是否有效","lang"),"inactive-color":"#efefef"},on:{change:function(a){return t.changeOpen()}},model:{value:t.valid,callback:function(a){t.valid=a},expression:"valid"}}),a("el-button",{attrs:{type:"primary"},on:{click:t.exportData}},[t._v($t("efepu4"," 导出 ","lang"))]),a("el-popover",{attrs:{placement:"top-start",width:"200",trigger:"hover",content:$t("lntxa712","导出任务会以队列执行，点击导出后，请至‘设置-导出列表’页面中查看及下载数据","lang")}},[a("i",{staticClass:"el-icon-question",attrs:{slot:"reference"},slot:"reference"})])],1)],1),a("el-dialog",{attrs:{title:$t("dintvd4","权益下载","lang"),visible:t.downloadView,"close-on-click-modal":!1},on:{"update:visible":function(a){t.downloadView=a}}},[t.downloadUrl?[a("a",{attrs:{href:t.downloadUrl,download:""}},[t._v(t._s(t.downloadName))])]:t._e()],2),a("el-card",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.rightsList,height:t.wheight-150}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.label_infos,function(e){return a("div",[a("span",[t._v($t("jgcm2k5","包含物料：","lang"))]),a("el-tag",{attrs:{type:"success"}},[t._v(" "+t._s(e.label_name)+" ")])],1)})}}])}),a("el-table-column",{attrs:{prop:"rights_name",label:$t("eyrn2","名称","lang"),"min-width":"140"}}),a("el-table-column",{attrs:{prop:"rights_from",label:$t("i6yz2","来源","lang"),"min-width":"100"}}),a("el-table-column",{attrs:{prop:"mobile",label:$t("ewbd43","手机号","lang"),"min-width":"90"}}),a("el-table-column",{attrs:{prop:"total_num",label:$t("elh3u3","总数量","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[2==e.row.is_not_limit_num?a("span",[t._v(t._s(e.row.total_num))]):t._e(),1==e.row.is_not_limit_num?a("span",[t._v($t("fnc8h3","无限次","lang"))]):t._e()]}}])}),a("el-table-column",{attrs:{prop:"total_consum_num",label:$t("pxn8rd5","已核销数量","lang")}}),a("el-table-column",{attrs:{label:$t("ikg3cm4","过期时间","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("datetime")(e.row.end_time)))])]}}])}),a("el-table-column",{attrs:{label:$t("k1e32","状态","lang"),"min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[2==e.row.is_not_limit_num?[e.row.total_num==e.row.total_consum_num?a("el-tag",{attrs:{size:"mini"}},[t._v($t("ctr9ka5"," 已用完 ","lang"))]):t._e()]:t._e(),1==e.row.is_not_limit_num?[a("el-tag",{attrs:{size:"mini"}},[t._v($t("dyoyb35"," 无限次 ","lang"))])]:"1"==e.row.is_valid?a("el-tag",{attrs:{size:"mini",type:"success"}},[t._v($t("g4yo14"," 有效 ","lang"))]):a("el-tag",{attrs:{size:"mini"}},[t._v($t("cxplue5"," 已过期 ","lang"))])]}}])}),a("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),"min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return t.delayAction(e.row)}}},[t._v($t("eyp874"," 延期 ","lang"))]),a("el-button",{attrs:{size:"mini"},on:{click:function(a){return t.transferAction(e.row)}}},[t._v($t("m8g6b4"," 转让 ","lang"))])]}}])})],1),a("div",{staticClass:"mt-4 text-right"},[a("el-pagination",{attrs:{"current-page":t.params.page,total:t.total_count,"page-size":t.params.pageSize},on:{"update:currentPage":function(a){return t.$set(t.params,"page",a)},"update:current-page":function(a){return t.$set(t.params,"page",a)},"current-change":t.handleCurrentChange}})],1)],1),a("el-dialog",{staticClass:"right-dialog",attrs:{title:$t("e7zjxo4","添加权益","lang"),visible:t.addRightsDialog,"before-close":t.handleCancelLabelsDialog},on:{"update:visible":function(a){t.addRightsDialog=a}}},[[a("el-form",[a("el-form-item",{attrs:{"label-width":"100px",label:$t("ewbd43","手机号","lang")}},[a("el-col",{attrs:{span:9}},[a("el-input",{attrs:{placeholder:$t("tcg0ewd","请输入添加权益用户的手机号","lang")},model:{value:t.mobile,callback:function(a){t.mobile=a},expression:"mobile"}})],1)],1),a("el-form-item",{attrs:{"label-width":"100px",label:$t("twbrz66","选择权益商品","lang")}},[a("el-transfer",{attrs:{titles:[$t("b40lv04","商品列表","lang"),$t("egat23","已选中","lang")],data:t.goodsList},model:{value:t.addRightsItems,callback:function(a){t.addRightsItems=a},expression:"addRightsItems"}},[a("div",{staticClass:"transfer-footer",attrs:{slot:"left-footer"},slot:"left-footer"},[t.goods_total_count>t.goodsParams.pageSize?a("el-pagination",{attrs:{small:"",layout:"prev, pager, next",total:t.goods_total_count,"page-size":t.goodsParams.pageSize},on:{"current-change":t.handleGoodsChange}}):t._e()],1)])],1),a("el-form-item",{staticClass:"content-center"},[a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v($t("tnxv36"," 确定添加 ","lang"))])],1)],1)]],2),a("el-dialog",{staticClass:"delay-dialog",attrs:{title:$t("ceyr6h4","延期设置","lang"),visible:t.delayDialog},on:{"update:visible":function(a){t.delayDialog=a}}},[a("div",{staticClass:"alert-txt"},[a("el-alert",{attrs:{title:"",type:"warning",description:$t("sr0w6s7","消息提示的文案","lang"),closable:!1}},[t._v($t("gaj8z4"," 权益：","lang")+t._s(t.rightsInfo.rights_name)+$t("gt04th7"," ,有效期至：","lang")+t._s(t._f("datetime")(t.rightsInfo.end_time))+" ")])],1),a("el-row",{staticClass:"option-box"},[a("el-col",{attrs:{span:8}},[t._v($t("cwj7f45"," 延期至：","lang")),a("el-date-picker",{attrs:{type:"date","picker-options":t.pickerOptions},model:{value:t.form.delay_date,callback:function(a){t.$set(t.form,"delay_date",a)},expression:"form.delay_date"}})],1),a("el-col",{attrs:{span:12}},[t._v($t("e5snt4"," 备注：","lang")),a("el-input",{attrs:{type:"textarea",placeholder:$t("2jaeja5","请输入备注","lang"),rows:2},model:{value:t.form.remark,callback:function(a){t.$set(t.form,"remark",a)},expression:"form.remark"}})],1),a("el-col",{attrs:{span:4}},[a("el-button",{attrs:{type:"primary"},on:{click:t.delaySave}},[t._v($t("fk4a44"," 提交 ","lang"))])],1)],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.delayData,height:"380"}},[a("el-table-column",{attrs:{label:$t("az9zmp4","原有效期","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("datetime")(e.row.original_date)))])]}}])}),a("el-table-column",{attrs:{label:$t("8t3b9h6","延期后有效期","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("datetime")(e.row.delay_date)))])]}}])}),a("el-table-column",{attrs:{prop:"remark",label:$t("fqo12","备注","lang")}})],1)],1),a("el-dialog",{staticClass:"delay-dialog",attrs:{title:$t("r5rrxo6","转让权益设置","lang"),visible:t.transferDialog},on:{"update:visible":function(a){t.transferDialog=a}}},[a("el-row",{staticClass:"option-box"},[a("el-col",{attrs:{span:8}},[t._v($t("fn5xin7"," 转让手机号：","lang")),a("el-input",{staticStyle:{width:"200px"},model:{value:t.transferForm.transfer_mobile,callback:function(a){t.$set(t.transferForm,"transfer_mobile",a)},expression:"transferForm.transfer_mobile"}})],1),a("el-col",{attrs:{span:12}},[t._v($t("e5snt4"," 备注：","lang")),a("el-input",{attrs:{type:"textarea",placeholder:$t("2jaeja5","请输入备注","lang"),rows:2},model:{value:t.transferForm.remark,callback:function(a){t.$set(t.transferForm,"remark",a)},expression:"transferForm.remark"}})],1),a("el-col",{attrs:{span:4}},[a("el-button",{attrs:{type:"primary"},on:{click:t.transferSave}},[t._v($t("fk4a44"," 提交 ","lang"))])],1)],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.transferData,height:"380"}},[a("el-table-column",{attrs:{label:$t("io6nnf4","转让时间","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("datetime")(e.row.created)))])]}}])}),a("el-table-column",{attrs:{prop:"mobile",label:$t("ayp61q4","原持有者","lang")}}),a("el-table-column",{attrs:{prop:"transfer_mobile",label:$t("f0atd94","现持有者","lang")}}),a("el-table-column",{attrs:{prop:"remark",label:$t("fqo12","备注","lang")}})],1)],1)],1)},[],!1,null,null,null).exports}}]);