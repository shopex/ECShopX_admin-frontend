"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[4842],{92461:function(t,e,a){a.r(e),a.d(e,{default:function(){return c}});var i={name:"SettlementCycle",props:["value"],data(){const{cycle:t="",unit:e=""}=this.value;return{units:[{label:$t("hm11","天","lang"),value:"day"},{label:$t("go81","周","lang"),value:"week"},{label:$t("kco1","月","lang"),value:"month"}],cycle:t,unit:e}},computed:{cycleClass(){const{cycle:t}=this;return["cycle-input",{"is-error":!t}]}},watch:{value(t,e){const{cycle:a="",unit:i=""}=t;this.cycle=a,this.unit=i}},created(){},methods:{onChange(t){this.$emit("input",{cycle:this.cycle,unit:this.unit})}}},l=a(81656),r=(0,l.A)(i,function(){var t=this,e=t._self._c;return e("div",{staticClass:"comp-cycle"},[e("span",{staticClass:"label"},[t._v($t("lan1","每","lang"))]),e("el-input",{class:t.cycleClass,attrs:{type:"text",clearable:"",placeholder:$t("ue3nx08","请输入结算周期数","lang")},on:{change:t.onChange},model:{value:t.cycle,callback:function(e){t.cycle=e},expression:"cycle"}}),e("el-select",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},on:{change:t.onChange},model:{value:t.unit,callback:function(e){t.unit=e},expression:"unit"}},t._l(t.units,function(t){return e("el-option",{key:t.value,attrs:{size:"mini",label:t.label,value:t.value}})}),1)],1)},[],!1,null,"5e7c2370",null).exports,n=a(22541),o={name:"",data(){const t=this.$createElement;return{form:{cycleData:{cycle:"",unit:""}},formList:[{label:$t("gidl234","结算周期","lang"),key:"cycleData",component:()=>t(r,{model:{value:this.form.cycleData,callback:t=>{this.$set(this.form,"cycleData",t)}}}),validator:(t,e,a)=>{const{cycle:i,unit:l}=this.form.cycleData;i&&l?a():a(new Error($t("8wc3fv8","结算周期不能为空","lang")))},tip:$t("757dukj","结算说明：结算周期的T+1天生成结算单","lang")}],formQuery:{distributor_id:"",merchant_id:""},setting:(0,n.createSetting)({actions:[{name:$t("sc7ow96","添加店铺配置","lang"),key:"add",type:"button",slot:"header",buttonType:"primary is-plain",action:{handler:async t=>{this.addForm.id="",this.addForm.distributor_id="",this.addForm.cycleData={cycle:"",unit:""},this.addFormList[0].isShow=!0,this.addFormList[1].isShow=!1,this.addDialog=!0}}},{name:$t("ogvk2","设置","lang"),key:"config",type:"button",buttonType:"text",action:{handler:async([t])=>{this.addForm.id=t.id,this.addForm.distributor_id=t.distributor_id,this.addForm.cycleData={cycle:t.period[0],unit:t.period[1]},this.addForm.distributor_name=t.distributor_name,this.addFormList[0].isShow=!1,this.addFormList[1].isShow=!0,this.addDialog=!0}}}],columns:[{name:$t("f0a82","商家","lang"),key:"merchant_name"},{name:$t("gwn72","店铺","lang"),key:"distributor_name"},{name:$t("gidl234","结算周期","lang"),key:"period",render:(t,{row:e})=>t("span",{},this.getCycle(e.period))}]}),addDialog:!1,addForm:{id:"",distributor_id:"",distributor_name:"",cycleData:{cycle:"",unit:""}},addFormList:[{label:$t("gwn72","店铺","lang"),key:"distributor_id",component:()=>t("SpSelectShop",{attrs:{clearable:!0,placeholder:$t("l72nr3","请选择","lang")},model:{value:this.addForm.distributor_id,callback:t=>{this.$set(this.addForm,"distributor_id",t)}}}),validator:(t,e,a)=>{const{id:i,distributor_id:l}=this.addForm;i||l?a():a(new Error($t("adohlc4","不能为空","lang")))},isShow:!0},{label:$t("gwn72","店铺","lang"),key:"distributor_name",type:"text",isShow:!1},{label:$t("elwr0f5","结算周期:","lang"),key:"cycleData",component:()=>t(r,{model:{value:this.addForm.cycleData,callback:t=>{this.$set(this.addForm,"cycleData",t)}}}),validator:(t,e,a)=>{const{cycle:i,unit:l}=this.addForm.cycleData;i&&l?a():a(new Error($t("8wc3fv8","结算周期不能为空","lang")))}}]}},created(){this.fetch()},methods:{async fetch(){const{period:t}=await this.$api.financial.getDefaultSetting();2==t.length&&(this.form.cycleData={cycle:t[0],unit:t[1]})},onSearch(){this.$refs.finder.refresh(!0)},beforeSearch(t){return{...t,...this.formQuery}},async onSaveConfig(){const{cycle:t,unit:e}=this.form.cycleData;await this.$api.financial.savePeriodSetting({period:[t,e]}),this.$message.success($t("aghf564","保存成功","lang"))},async onAddSubmit(){const{id:t,distributor_id:e,cycleData:a}=this.addForm,{cycle:i,unit:l}=a;await this.$api.financial.savePeriodSetting({id:t,distributor_id:e,period:[i,l]}),this.$message.success(t?$t("aghf564","保存成功","lang"):$t("e7ygyc4","添加成功","lang")),this.addDialog=!1,this.$refs.finder.refresh(!0)},getCycle(t){const[e,a]=t;return`${e}${{day:$t("hm11","天","lang"),week:$t("go81","周","lang"),month:$t("kco1","月","lang")}[a]}`}}},c=(0,l.A)(o,function(){var t=this,e=t._self._c;return e("SpPage",[e("el-tabs",{attrs:{type:"card"}},[e("el-tab-pane",{attrs:{label:$t("qp8b186","结算周期配置","lang")}},[e("SpForm",{attrs:{"form-list":t.formList},on:{onSubmit:t.onSaveConfig},model:{value:t.form,callback:function(e){t.form=e},expression:"form"}})],1),e("el-tab-pane",{attrs:{label:$t("b2vzaa6","店铺结算周期","lang")}},[e("SpFilterForm",{attrs:{model:t.formQuery},on:{onSearch:t.onSearch,onReset:t.onSearch}},[e("SpFilterFormItem",{attrs:{prop:"distributor_id",label:$t("ek40n3","店铺:","lang")}},[e("SpSelectShop",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:t.formQuery.distributor_id,callback:function(e){t.$set(t.formQuery,"distributor_id",e)},expression:"formQuery.distributor_id"}})],1),e("SpFilterFormItem",{attrs:{prop:"merchant_id",label:$t("u0ravo5","所属商家:","lang")}},[e("SpSelectMerchant",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:t.formQuery.merchant_id,callback:function(e){t.$set(t.formQuery,"merchant_id",e)},expression:"formQuery.merchant_id"}})],1)],1),e("SpFinder",{ref:"finder",attrs:{"no-selection":"",setting:t.setting,hooks:{beforeSearch:t.beforeSearch},url:"/statement/period/distributor/setting"}})],1)],1),e("SpDialog",{ref:"addDialogRef",attrs:{title:`${this.addForm.id?$t("cjxtq64","店铺编辑","lang"):$t("sc7ow96","添加店铺配置","lang")}`,form:t.addForm,"form-list":t.addFormList},on:{onSubmit:t.onAddSubmit},model:{value:t.addDialog,callback:function(e){t.addDialog=e},expression:"addDialog"}})],1)},[],!1,null,"39c76a13",null).exports}}]);