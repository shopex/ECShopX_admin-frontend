"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[5875],{45875:function(e,a,t){t.r(a),t.d(a,{default:function(){return g}});t(44114),t(18111),t(7588);var i=t(95353),l=t(79296),s=t(2038),o=t(27810),n=t(87378),r={components:{shopDecoration:o.A,imgPicker:n.default},data(){return{imgDialog:!1,isGetImage:!1,template_dialog:!1,page_dialog:!1,total_count:0,dialogTitle:$t("d7g3y34","新增页面","lang"),loading:!1,appID:"",appCodeUrl:"",curPageUrl:"",params:{page:1,pageSize:10,page_type:"category"},pageForm:{id:"",page_name:"",page_description:"",page_share_title:"",page_share_desc:"",page_share_imageUrl:"",is_open:!0},list:[],store:null}},computed:{...(0,i.L8)(["template_name"])},mounted(){this.fetchPageList(),this.fetchWechatList(),this.store={id:"0"}},methods:{async fetchWechatList(){const{list:e}=await this.$api.minimanage.gettemplateweapplist();e.forEach((e,a)=>{"yykweishop"==e.key_name&&(this.appID=e.authorizer.authorizer_appid)})},handleClick(e){const a="pages/custom/custom-page";this.curPageUrl=`${a}?id=${e}`;let t={wxaAppId:this.appID,page:a,id:e};(0,s.getPageCode)(t).then(e=>{this.appCodeUrl=e.data.data.base64Image})},handleDownload(e){var a=document.createElement("a"),t=e;this.appCodeUrl&&(a.href=this.appCodeUrl,a.download=t+".png",a.click())},temDialog(e,a){this.$router.push(`/decoration/mobile/home-template/edit?id=${e}&scene=1006`)},closeDialog(){this.template_dialog=!1},handleCurrentChange(e){this.params.page=e,this.fetchPageList()},delPage(e){this.$confirm($t("mevewna","确认删除当前页面吗？","lang")).then(a=>{(0,l.delCustomPage)(e).then(e=>{this.$message({type:"success",message:$t("lmwnct5","操作成功！","lang")}),this.fetchPageList()})})},openDialog(e=null){this.page_dialog=!0,e?(this.pageForm=e,1==e.is_open&&(this.pageForm.is_open=!0),this.dialogTitle=$t("gmtjig4","编辑页面","lang")):(this.dialogTitle=$t("d7g3y34","新增页面","lang"),this.pageForm={id:"",page_name:"",page_description:"",page_share_title:"",page_share_desc:"",page_share_imageUrl:"",is_open:!0})},savePage(){let{page_name:e,page_description:a,page_share_title:t,page_share_desc:i,page_share_imageUrl:s,is_open:o,id:n}=this.pageForm;const r={page_type:"category",page_name:e,page_description:a,is_open:o,page_share_title:t,page_share_desc:i,page_share_imageUrl:s,template_name:this.template_name};this.dialogTitle==$t("gmtjig4","编辑页面","lang")&&(0,l.editCustomPage)(n,r).then(e=>{this.page_dialog=!1,this.fetchPageList(),this.$message({type:"success",message:$t("t7fdl56","保存页面成功","lang")})}),this.dialogTitle==$t("d7g3y34","新增页面","lang")&&(0,l.createCustomPage)(r).then(e=>{this.page_dialog=!1,this.fetchPageList(),this.$message({type:"success",message:$t("t7fdl56","保存页面成功","lang")})})},fetchPageList(){this.loading=!0,Object.assign(this.params,{template_name:this.template_name}),(0,l.getCustomPageList)(this.params).then(e=>{e.data.data.list&&(this.list=e.data.data.list,this.total_count=e.data.data.total_count),this.loading=!1})},handleCancel(){this.page_dialog=!1},handleImgChange(){this.imgDialog=!0,this.isGetImage=!0},pickImg(e){this.pageForm.page_share_imageUrl=e.url,this.imgDialog=!1},closeImgDialog(){this.imgDialog=!1}}},g=(0,t(81656).A)(r,function(){var e=this,a=e._self._c;return a("SpPage",[-1===e.$route.path.indexOf("detail")?a("div",[e.VERSION_SHUYUN()?e._e():a("SpPlatformTip",{attrs:{h5:"",app:"",alipay:""}}),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:4}},[a("el-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(a){return e.openDialog()}}},[e._v($t("vq945qa"," 添加分类模版页面 ","lang"))])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.list}},[a("el-table-column",{attrs:{prop:"id",label:$t("jufa7c4","页面id","lang")}}),a("el-table-column",{attrs:{prop:"page_name",label:$t("juu6ds4","页面名称","lang")}}),a("el-table-column",{attrs:{label:$t("d8pu5s4","是否启用","lang")},scopedSlots:e._u([{key:"default",fn:function(t){return["0"==t.row.is_open?a("el-tag",{attrs:{type:"info"}},[e._v($t("ix1qx4"," 禁用 ","lang"))]):a("el-tag",{attrs:{type:"warning"}},[e._v($t("dg9c74"," 启用 ","lang"))])]}}],null,!1,2167625431)}),a("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),"min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",plain:"",round:"",size:"mini"},on:{click:function(a){return e.temDialog(t.row.id)}}},[e._v($t("8d291y6"," 页面装修 ","lang"))]),a("el-button",{attrs:{type:"text"}},[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(a){return e.openDialog(t.row)}}},[e._v($t("juz394"," 编辑 ","lang"))])]),e.appID?a("el-popover",{attrs:{placement:"top",width:"200",trigger:"click"}},[a("div",[a("img",{staticClass:"page-code",attrs:{src:e.appCodeUrl}}),a("div",{staticClass:"page-btns"},[a("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(a){return e.handleDownload(t.row.page_name)}}},[e._v($t("axjir55"," 下载码 ","lang"))]),a("el-button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:e.curPageUrl,expression:"curPageUrl",arg:"copy"}],attrs:{type:"primary",plain:"",size:"mini"}},[e._v($t("j66ck06"," 复制链接 ","lang"))])],1)]),a("el-button",{staticStyle:{width:"45px"},attrs:{slot:"reference",type:"text"},on:{click:function(a){return e.handleClick(t.row.id)}},slot:"reference"},[e._v($t("fhh3r4"," 投放 ","lang"))])],1):e._e(),a("el-button",{attrs:{type:"text"}},[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(a){return e.delPage(t.row.id)}}},[e._v($t("db22k4"," 删除 ","lang"))])])]}}],null,!1,2665230836)})],1),a("div",{staticClass:"mt-4 text-right"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","current-page":e.params.page,total:e.total_count,"page-size":e.params.pageSize},on:{"update:currentPage":function(a){return e.$set(e.params,"page",a)},"update:current-page":function(a){return e.$set(e.params,"page",a)},"current-change":e.handleCurrentChange}})],1),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.page_dialog,"close-on-click-modal":!1,"before-close":e.handleCancel},on:{"update:visible":function(a){e.page_dialog=a}}},[a("el-form",{attrs:{"label-width":"200px"},model:{value:e.pageForm,callback:function(a){e.pageForm=a},expression:"pageForm"}},[a("el-form-item",{attrs:{label:$t("juu6ds4","页面名称","lang")}},[a("el-input",{staticStyle:{width:"55%"},attrs:{placeholder:$t("juu6ds4","页面名称","lang")},model:{value:e.pageForm.page_name,callback:function(a){e.$set(e.pageForm,"page_name",a)},expression:"pageForm.page_name"}})],1),a("el-form-item",{attrs:{label:$t("juwz7y4","页面描述","lang")}},[a("el-input",{staticStyle:{width:"55%"},attrs:{placeholder:$t("juwz7y4","页面描述","lang")},model:{value:e.pageForm.page_description,callback:function(a){e.$set(e.pageForm,"page_description",a)},expression:"pageForm.page_description"}})],1),a("el-form-item",{attrs:{label:$t("aoh3124","分享标题","lang")}},[a("el-input",{staticStyle:{width:"55%"},attrs:{placeholder:$t("aoh3124","分享标题","lang")},model:{value:e.pageForm.page_share_title,callback:function(a){e.$set(e.pageForm,"page_share_title",a)},expression:"pageForm.page_share_title"}})],1),a("el-form-item",{attrs:{label:$t("aodz5a4","分享图片","lang")}},[a("div",{staticClass:"upload-box",on:{click:function(a){return e.handleImgChange()}}},[e.pageForm.page_share_imageUrl?a("img",{staticClass:"avatar",attrs:{src:e.wximageurl+e.pageForm.page_share_imageUrl}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),a("imgPicker",{attrs:{"dialog-visible":e.imgDialog,"sc-status":e.isGetImage},on:{chooseImg:e.pickImg,closeImgDialog:e.closeImgDialog}})],1),a("el-form-item",{attrs:{label:$t("d8pu5s4","是否启用","lang")}},[a("el-switch",{model:{value:e.pageForm.is_open,callback:function(a){e.$set(e.pageForm,"is_open",a)},expression:"pageForm.is_open"}})],1)],1),a("div",{staticClass:"dialog-footer content-center",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.savePage}},[e._v($t("6rf6vj6"," 确认保存 ","lang"))])],1)],1),a("el-dialog",{attrs:{visible:e.template_dialog,"destroy-on-close":"",title:$t("gmtjig4","编辑页面","lang"),fullscreen:"","lock-scroll":""},on:{"update:visible":function(a){e.template_dialog=a}}},[a("shopDecoration",{attrs:{id:e.pageForm.id,usage:"page",pagetype:"cuspage","rel-store":e.store,template_name:e.template_name},on:{saved:e.closeDialog}})],1)],1):e._e(),a("router-view")],1)},[],!1,null,"476cd410",null).exports}}]);