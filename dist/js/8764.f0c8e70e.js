"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[8764],{68764:function(t,e,a){a.r(e),a.d(e,{default:function(){return d}});a(44114),a(18111),a(7588);var s=a(95353),i=a(27671),o=a(71196),n=a(5748),l=a(77825),r=a(33318),m=a(26456),c=(a(41776),{components:{SideBar:o.A},mixins:[l.v8],provide(){return{refresh:this.fetchList}},props:["getStatus"],data(){return{dialogVisible:!1,regions:i,tabList:[{label:$t("av9wor4","全部商品","lang"),name:""},{label:$t("eftvg3","待审核","lang"),name:"processing"}],form:{audit_status:"approved",audit_reason:""},activeName:"first",ItemsList:[],goods_id:[],loading:!1,itemCategoryList:[],params:{keywords:"",item_bn:"",goods_bn:"",regions_id:[],approve_status:"",distributor_id:"all_distributor",audit_status:"",main_cat_id:""},salesStatus:r.W1,submitLoading:!1,show_commission_sideBar:!1,skuLoading:!1,commissionSpecItems:[],current:""}},computed:{...(0,s.L8)(["wheight"])},created(){this.getMainCategory()},mounted(){const{main_cat_id:t}=this.$route.query;t&&(this.params.main_cat_id=t),this.fetchList()},methods:{async getMainCategory(){const t=await this.$api.goods.getCategory({is_main_category:!0});this.itemCategoryList=t},async exportItemsWxappCode(t){let e;e=this.goods_id.length?{item_id:this.goods_id}:{...this.params};const{status:a}=await this.$api.goods.exportGoodsCode({...e,source:"distributor",export_type:t});a?(this.$message.success($t("xdh90kk","已加入执行队列，请在设置-导出列表中下载","lang")),this.$export_open("itemcode")):this.$message.error($t("by46j64","导出失败","lang"))},Examine(){if(0===this.goods_id.length)return this.$message.error($t("gi0dra9","请选择至少一个商品","lang")),!1;this.dialogVisible=!0},onSubmit(){this.form.goods_id=this.goods_id,(0,n.auditItems)(this.form).then(t=>{this.$message.success($t("aghf564","保存成功","lang")),this.dialogVisible=!1,this.fetchList()})},batchItemsAudit(t,e){this.goods_id=[t.goods_id],this.dialogVisible=!0},handleSelectionChange(t){let e=[];for(let a in t)e.push(t[a].goods_id);this.goods_id=e},editItemsAction(t,e){this.$router.push({path:this.matchRoutePath("editor/")+e.itemId})},async fetchList(){this.loading=!0;const{pageIndex:t,pageSize:e}=this.page;let a={page:t,pageSize:e,item_type:"normal",...this.params};this.params.main_cat_id&&((0,m.cy)(this.params.main_cat_id)?a.main_cat_id=this.params.main_cat_id[this.params.main_cat_id.length-1]:a.main_cat_id=this.params.main_cat_id);const{list:s,total_count:i}=await this.$api.goods.getItemsList(a);s.forEach(t=>{t.price=t.price/100,t.link=`pages/item/espier-detail?gid=${t.goods_id}&id=${t.item_id}`}),this.tableList=s,this.page.total=i,this.loading=!1},batchItemsStatus(t){if(0===this.goods_id.length)return this.$message.error($t("gi0dra9","请选择至少一个商品","lang")),!1;this.skuLoading=!0;let e={};if(this.goods_id.length>0){let a=[];this.goods_id.forEach(t=>{a.push({goods_id:t})}),e={items:JSON.stringify(a),status:t}}this.submitLoading=!0,(0,n.updateItemsStatus)(e).then(t=>{t.data.data.status&&(this.$message({message:$t("ai8d7e4","修改成功","lang"),type:"success",duration:2e3}),this.fetchList()),this.submitLoading=!1,this.skuLoading=!1})},handleCommissionConf(t){this.show_commission_sideBar=!0,this.skuLoading=!0,this.current=t,(0,n.getGoodsCommission)(t.item_id).then(t=>{var e=t.data.data;this.commissionSpecItems=e,this.skuLoading=!1})},saveCommissionConf(){if(""==this.commissionSpecItems.commission)return this.$message({type:"error",message:$t("hjgt46b","SPU结算佣金不能为空","lang")}),!1;var t=[];let e={item_id:this.current.item_id,goods_id:this.current.goods_id,commission_type:this.commissionSpecItems.commission_type};"1"==e.commission_type?e.commission=this.commissionSpecItems.commission:e.commission=100*this.commissionSpecItems.commission,this.commissionSpecItems.sku_commission.forEach(e=>{var a={item_id:e.item_id};"2"==this.commissionSpecItems.commission_type?a.commission=100*e.commission:a.commission=e.commission,t.push(a)}),e.sku_commission=JSON.stringify(t),(0,n.saveGoodsCommission)(e).then(t=>{this.$message({message:$t("aghf564","保存成功","lang"),type:"success",duration:2e3})})}}}),p=c,d=(0,a(81656).A)(p,function(){var t=this,e=t._self._c;return e("div",[e("SpPage",[-1===t.$route.path.indexOf("editor")?e("div",[e("SpFilterForm",{attrs:{model:t.params},on:{onSearch:t.onSearch,onReset:t.onSearch}},[e("SpFilterFormItem",{attrs:{prop:"keywords",label:$t("aotkhw5","商品名称:","lang")}},[e("el-input",{attrs:{placeholder:$t("mf25uh7","请输入商品名称","lang")},model:{value:t.params.keywords,callback:function(e){t.$set(t.params,"keywords",e)},expression:"params.keywords"}})],1),e("SpFilterFormItem",{attrs:{prop:"goods_bn",label:$t("txp2nd6","SPU编码:","lang")}},[e("el-input",{attrs:{placeholder:$t("rct46y8","请输入SPU编码","lang")},model:{value:t.params.goods_bn,callback:function(e){t.$set(t.params,"goods_bn",e)},expression:"params.goods_bn"}})],1),e("SpFilterFormItem",{attrs:{prop:"item_bn",label:$t("u0g1m66","SKU编码:","lang")}},[e("el-input",{attrs:{placeholder:$t("rcpx9b8","请输入SKU编码","lang")},model:{value:t.params.item_bn,callback:function(e){t.$set(t.params,"item_bn",e)},expression:"params.item_bn"}})],1),e("SpFilterFormItem",{attrs:{prop:"regions_id",label:$t("apry225","商品产地:","lang")}},[e("el-cascader",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang"),options:t.regions},model:{value:t.params.regions_id,callback:function(e){t.$set(t.params,"regions_id",e)},expression:"params.regions_id"}})],1),e("SpFilterFormItem",{attrs:{prop:"approve_status",label:$t("akgb645","商品状态:","lang")}},[e("el-select",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:t.params.approve_status,callback:function(e){t.$set(t.params,"approve_status",e)},expression:"params.approve_status"}},t._l(t.salesStatus,function(t){return e("el-option",{key:t.value,attrs:{label:t.title,size:"mini",value:t.value}})}),1)],1),e("SpFilterFormItem",{attrs:{prop:"distributor_id",label:$t("ek40n3","店铺:","lang")}},[e("SpSelectShop",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:t.params.distributor_id,callback:function(e){t.$set(t.params,"distributor_id",e)},expression:"params.distributor_id"}})],1),e("SpFilterFormItem",{attrs:{prop:"main_cat_id",label:$t("15jaio5","管理分类:","lang")}},[e("el-cascader",{attrs:{placeholder:$t("l72nr3","请选择","lang"),clearable:"",options:t.itemCategoryList,props:{value:"category_id",label:"category_name",checkStrictly:!0}},model:{value:t.params.main_cat_id,callback:function(e){t.$set(t.params,"main_cat_id",e)},expression:"params.main_cat_id"}})],1)],1),e("div",{staticClass:"action-container"},[e("el-button",{attrs:{type:"primary",plain:""},on:{click:t.Examine}},[t._v($t("78btvx6"," 批量审核 ","lang"))]),e("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){return t.batchItemsStatus("onsale")}}},[t._v($t("7abkpu6"," 批量上架 ","lang"))]),e("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){return t.batchItemsStatus("instock")}}},[t._v($t("s00ehz6"," 强制下架 ","lang"))]),e("el-dropdown",{on:{command:t.exportItemsWxappCode}},[e("el-button",{attrs:{type:"primary",plain:"",icon:"iconfont icon-daorucaozuo-01"}},[t._v($t("gr6m3"," 导出","lang")),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:"wxa"}},[t._v($t("zaknla6"," 小程序码 ","lang"))]),e("el-dropdown-item",{attrs:{command:"h5"}},[t._v($t("powvvw6","H5二维码 ","lang"))])],1)],1)],1),e("el-tabs",{attrs:{type:"card"},on:{"tab-click":t.onSearch},model:{value:t.params.audit_status,callback:function(e){t.$set(t.params,"audit_status",e)},expression:"params.audit_status"}},t._l(t.tabList,function(a,s){return e("el-tab-pane",{key:s,attrs:{label:a.label,name:a.name}},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{border:"",data:t.tableList},on:{"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{type:"selection",align:"center",label:$t("emxt2","全选","lang")}}),e("el-table-column",{attrs:{prop:"goods_id",label:$t("b3ly1i4","商品ID","lang")}}),e("el-table-column",{attrs:{prop:"itemName",label:$t("b40v0e4","商品名称","lang"),width:"200"},scopedSlots:t._u([{key:"default",fn:function(a){return[t._v(" "+t._s(a.row.item_name)+" "),"drug"==a.row.special_type?e("el-tag",{attrs:{type:"danger"}},[t._v($t("c5auna5"," 处方药 ","lang"))]):t._e(),e("div",{staticStyle:{color:"#888","font-size":"12px"}},[t._v($t("txnoax6","SPU编码：","lang")+t._s(a.row.goods_bn))])]}}],null,!0)}),e("el-table-column",{attrs:{label:$t("cyko7y4","排序编号","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-input",{staticStyle:{width:"60px"},attrs:{size:"mini"},on:{change:function(e){return t.editItemsSort(a.$index,a.row)}},model:{value:a.row.sort,callback:function(e){t.$set(a.row,"sort",e)},expression:"scope.row.sort"}})]}}],null,!0)}),e("el-table-column",{attrs:{prop:"distributor_name",label:$t("di507i4","来源店铺","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.distributor_name.name)+" ")]}}],null,!0)}),e("el-table-column",{attrs:{label:$t("o06w2","规格","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.nospec?e("el-tag",{attrs:{effect:"plain",size:"mini"}},[t._v($t("bkn8435"," 单规格 ","lang"))]):e("el-tag",{attrs:{effect:"plain",size:"mini",type:"success"}},[t._v($t("caubqm5"," 多规格 ","lang"))])]}}],null,!0)}),e("el-table-column",{attrs:{prop:"market_price",label:$t("qknewd6","市场价（¥）","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v(t._s(a.row.market_price/100))])]}}],null,!0)}),e("el-table-column",{attrs:{prop:"price",label:$t("789h436","销售价（¥）","lang")}}),e("el-table-column",{attrs:{prop:"store",label:$t("gl5x2","库存","lang")}}),e("el-table-column",{attrs:{label:$t("k1e32","状态","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return["processing"==a.row.audit_status?e("span",[t._v($t("fy8avn4","等待审核","lang"))]):"rejected"==a.row.audit_status?e("el-popover",{attrs:{placement:"top-start",width:"200",trigger:"hover",content:a.row.audit_reason}},[e("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[t._v($t("w1qlxa6"," 审核驳回 ","lang"))])],1):"onsale"==a.row.approve_status?e("span",[t._v($t("aqern84","前台可销","lang"))]):"offline_sale"==a.row.approve_status?e("span",[t._v($t("ekg7gx6","前台不展示 ","lang"))]):"only_show"==a.row.approve_status?e("span",[t._v($t("mfuo7t5","前台仅展示","lang"))]):e("span",[t._v($t("a7er004","不可销售","lang"))])]}}],null,!0)}),e("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),width:"200",fixed:"left"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{staticClass:"btn-gap",attrs:{type:"text"},on:{click:function(e){return t.editItemsAction(a.$index,a.row)}}},[t._v($t("gcika4"," 查看 ","lang"))]),"processing"==a.row.audit_status?e("el-button",{staticClass:"btn-gap",attrs:{type:"text"},on:{click:function(e){return t.batchItemsAudit(a.row,a.$index)}}},[t._v($t("ehbft4"," 审核 ","lang"))]):t._e()]}}],null,!0)})],1),e("div",{staticClass:"content-center content-top-padded"},[e("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":t.page.pageIndex,"page-sizes":[10,20,50],total:t.page.total,"page-size":t.page.pageSize},on:{"update:currentPage":function(e){return t.$set(t.page,"pageIndex",e)},"update:current-page":function(e){return t.$set(t.page,"pageIndex",e)},"current-change":t.onCurrentChange,"size-change":t.onSizeChange}})],1)],1)}),1),e("el-dialog",{attrs:{title:$t("hs0npx8","批量审核店铺商品","lang"),visible:t.dialogVisible,width:"30%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px"}},[e("el-form-item",{attrs:{label:$t("bzvg8y4","审核状态","lang")}},[e("el-radio-group",{model:{value:t.form.audit_status,callback:function(e){t.$set(t.form,"audit_status",e)},expression:"form.audit_status"}},[e("el-radio",{attrs:{label:"approved"}},[t._v($t("mcqer4"," 通过 ","lang"))]),e("el-radio",{attrs:{label:"rejected"}},[t._v($t("fn3854"," 拒绝 ","lang"))])],1)],1),"rejected"==t.form.audit_status?e("el-form-item",{attrs:{label:$t("czp1gs4","拒绝原因","lang")}},[e("el-input",{attrs:{type:"textarea"},model:{value:t.form.audit_reason,callback:function(e){t.$set(t.form,"audit_reason",e)},expression:"form.audit_reason"}})],1):t._e(),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v($t("in1ck4"," 确定 ","lang"))]),e("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v($t("dd4ni4"," 取消 ","lang"))])],1)],1)],1),e("SideBar",{attrs:{visible:t.show_commission_sideBar,title:$t("dy6ykg8","总部结算佣金配置","lang"),width:"60"},on:{"update:visible":function(e){t.show_commission_sideBar=e}}},[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[e("el-alert",{staticClass:"alert-text",attrs:{title:$t("s2acxfd","佣金结算类型: 【百分比】","lang"),description:$t("njtczs16","计算方式：商品最终金额 ×  百分比，其中计算方式：商品最终金额为【支付金额-运费】","lang"),type:"info","close-text":" ","show-icon":""}})],1),e("span",[e("el-alert",{staticClass:"alert-text",attrs:{title:$t("2m3kcde","佣金结算类型: 【固定金额】","lang"),description:$t("49pn2oe","计算方式： 固定金额结算佣金","lang"),type:"info","close-text":" ","show-icon":""}})],1)]),e("el-form",{ref:"form",attrs:{"label-width":"120px"}},[e("el-form-item",{attrs:{label:$t("b40v0e4","商品名称","lang")}},[t._v(" "+t._s(t.current.item_name)+" ")]),e("el-form-item",{attrs:{label:$t("jdyg7y6","佣金结算类型","lang")}},[e("el-radio-group",{model:{value:t.commissionSpecItems.commission_type,callback:function(e){t.$set(t.commissionSpecItems,"commission_type",e)},expression:"commissionSpecItems.commission_type"}},[e("el-radio",{attrs:{label:"1"}},[t._v($t("fs59o45"," 百分比 ","lang"))]),e("el-radio",{attrs:{label:"2"}},[t._v($t("c8mvg46"," 固定金额 ","lang"))])],1)],1),e("el-form-item",{attrs:{label:$t("4me6ba7","SPU结算佣金","lang"),rules:[{required:!0}]}},[e("el-input",{staticStyle:{width:"200px"},attrs:{size:"mini",type:"number"},model:{value:t.commissionSpecItems.commission,callback:function(e){t.$set(t.commissionSpecItems,"commission",e)},expression:"commissionSpecItems.commission"}},[1==t.commissionSpecItems.commission_type?e("template",{slot:"append"},[t._v(" % ")]):t._e()],2),e("div",{staticClass:"form-item-tip"},[t._v($t("of83nal","SKU未设置佣金时，按SPU设置的佣金结算","lang"))])],1)],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.skuLoading,expression:"skuLoading"}],attrs:{data:t.commissionSpecItems.sku_commission}},[e("el-table-column",{attrs:{label:$t("o06w2","规格","lang"),prop:"item_spec_desc","min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.item_spec_desc?e("span",[t._v(t._s(a.row.item_spec_desc))]):e("span",[t._v($t("cvevh3","单规格","lang"))])]}}],null,!1,215542460)}),e("el-table-column",{attrs:{label:$t("m8lft3","销售价","lang"),"min-width":"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" ¥"+t._s(e.row.price/100)+" ")]}}],null,!1,133717387)}),e("el-table-column",{attrs:{label:$t("ev2aj3","成本价","lang"),"min-width":"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" ¥"+t._s(e.row.cost_price/100)+" ")]}}],null,!1,1804956287)}),e("el-table-column",{attrs:{label:$t("6zmaa97","SKU结算佣金","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return[0==t.commissionSpecItems.commission_type?e("div",[e("el-input",{attrs:{disabled:!0,size:"mini",type:"number",value:"0"}})],1):e("div",[e("el-input",{attrs:{size:"mini",type:"number"},model:{value:a.row.commission,callback:function(e){t.$set(a.row,"commission",e)},expression:"scope.row.commission"}},[1==t.commissionSpecItems.commission_type?e("template",{slot:"append"},[t._v(" % ")]):t._e()],2)],1)]}}],null,!1,4192937198)})],1)],1),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary",loading:t.submitLoading},on:{click:t.saveCommissionConf}},[t._v($t("cp35x4"," 保存 ","lang"))])],1)],1)],1):t._e(),e("router-view")],1)],1)},[],!1,null,"5b8a1406",null).exports}}]);