"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[2621],{42621:function(t,e,a){a.r(e),a.d(e,{default:function(){return n}});var l=a(95353),o=a(5134),s={mixins:[a(77825).v8],data(){return{params:{mobile:"",store_status:""},paramsModal:{page:1,pageSize:14,mobile:""},list:[],modalList:[],loading:!1,modalLoading:!1,addVisible:!1,editSuperiorVisible:!1,editGradeVisible:!1,updateShopVisible:!1,row:{},newGradeName:"",gradeList:{},identifierModal:"",promoter_mobile:"",shop_status:"",currentRow:null,total_count:0,modal_total_count:0,message:"",datapass_block:1}},mounted(){this.loginType=this.$store.getters.login_type,this.fetchList(this.params),this.getPopularizeListModalFun(this.modalList),(0,o.getPromoterGradeConfig)().then(t=>{this.gradeList=t.data.data})},methods:{onSearch(){this.fetchList()},onReset(){this.params={mobile:"",store_status:""},this.fetchList()},onCopy(){this.$notify.success({message:$t("bkv2mw4","复制成功","lang"),showClose:!0})},detail(t){let e=this.$router.resolve({path:this.matchRoutePath("detail"),query:{user_id:t.user_id}});window.open(e.href,"_blank")},addPromoter(){(0,o.addPromoter)({mobile:this.promoter_mobile}).then(t=>{this.promoter_mobile="",this.addVisible=!1,this.$message({message:$t("w74l6d7","添加推广员成功","lang"),type:"success",duration:2e3}),this.fetchList()})},count(t,e){if(e.children_count>0){let t=this.$router.resolve({path:this.matchRoutePath("child"),query:{promoter_id:e.promoter_id}});window.open(t.href,"_blank")}},editPopularizeRemoveFun(){(0,o.editPopularizeRemove)({user_id:this.row.user_id,new_user_id:this.currentRow}).then(t=>{this.message=$t("btgue3","上下级","lang"),this.loading=!1,this.$message({message:$t("ode92","调整","lang")+this.message+$t("h4sv2","成功","lang"),type:"success",duration:5e3}),this.fetchList()})},handleShopStatus(t,e){this.currentRow=e;var a="";if(0==e.shop_status||4==e.shop_status||3==e.shop_status)a=$t("cr9uxqd","确定当前推广员开通虚拟店？","lang"),this.shop_status=1;else if(1==e.shop_status)a=$t("u9qdvaf","确定将当前推广员的虚拟店关闭？","lang"),this.shop_status=3;else if(2==e.shop_status)return void(this.updateShopVisible=!0);this.$confirm(a,$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning",center:!0}).then(()=>{this.actionShopStatus(),this.updateShopVisible=!1,this.list[t].status=this.shop_status}).catch(()=>{this.$message({type:"info",message:$t("e68dg3","已取消","lang")})})},actionShopStatus(){var t={user_id:this.currentRow.user_id,status:this.shop_status};return this.currentRow.reason&&4==this.shop_status&&(t.reason=this.currentRow.reason),(0,o.updatePromoterShop)(t).then(t=>{this.$message({type:"success",message:$t("d1spvi4","操作成功","lang")}),this.fetchList(),this.updateShopVisible=!1}),!0},editTop(t){this.$confirm($t("y5s6orc","调整至顶级, 是否继续?","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(()=>{this.currentRow=0,this.row=t,this.message=$t("qmlt2","顶级","lang"),this.editPopularizeRemoveFun()}).catch(()=>{this.$message({type:"info",message:$t("e68dg3","已取消","lang")})})},editSuperior(t){this.editSuperiorVisible=!0,this.row=t,this.identifierModal="",this.numberSearchModal()},editGrade(t,e){this.editGradeVisible=!0,this.row=e},handleCancel(){this.editGradeVisible=!1},submitGradeAction(){(0,o.editPopularizeGrade)({user_id:this.row.user_id,grade_level:this.newGradeName}).then(t=>{""!=this.newGradeName?(this.editGradeVisible=!1,this.$message({message:$t("j3buoy6","调整等级成功","lang"),type:"success",duration:5e3}),this.fetchList()):this.$message({message:$t("x9zwqk9","请选择调整后的等级","lang"),type:"error"})})},freeze(t){let e=!!t.disabled;(0,o.editPopularizeDisabled)({user_id:t.user_id,active:e}).then(a=>{t.disabled=e?0:1,this.$message({type:"success",message:$t("cp6e056","状态修改成功","lang")})})},handleCancelSuperior(){this.editSuperiorVisible=!1},numberSearchModal(t){this.paramsModal.page=1,this.paramsModal.mobile=this.identifierModal,this.getPopularizeListModalFun(this.paramsModal)},getPopularizeListModalFun(t){this.modalLoading=!0,(0,o.getPopularizeList)(t).then(t=>{this.modalList=t.data.data.list,this.modal_total_count=Number(t.data.data.total_count),this.modalLoading=!1})},fetchList(){this.loading=!0;const{pageIndex:t,pageSize:e}=this.page;let a={page:t,pageSize:e,...this.params};(0,o.getPopularizeList)(a).then(t=>{this.list=t.data.data.list,this.total_count=Number(t.data.data.total_count),this.datapass_block=t.data.data.datapass_block,this.loading=!1})},handleCurrentChange(t){t&&t.user_id&&(this.currentRow=t.user_id)},submitSuperiorAction(){this.editPopularizeRemoveFun(),this.editSuperiorVisible=!1},handleModalPage(t){this.paramsModal.page=t,this.getPopularizeListModalFun(this.paramsModal)}},computed:{...(0,l.L8)(["wheight"])}},i=(0,a(81656).A)(s,function(){var t=this,e=t._self._c;return e("SpPage",[-1===t.$route.path.indexOf("child")&&-1===t.$route.path.indexOf("detail")?e("div",[e("SpFilterForm",{attrs:{model:t.params},on:{onSearch:t.onSearch,onReset:t.onReset}},[e("SpFilterFormItem",{attrs:{prop:"mobile",label:$t("cttsc24","手机号:","lang")}},[e("el-input",{attrs:{placeholder:$t("7ji3y96","请输入手机号","lang")},model:{value:t.params.mobile,callback:function(e){t.$set(t.params,"mobile",e)},expression:"params.mobile"}})],1),e("SpFilterFormItem",{attrs:{prop:"store_status",label:$t("spb7a05","开店状态:","lang")}},[e("el-select",{attrs:{placeholder:$t("l5bar97","请输入开店状态","lang"),clearable:""},model:{value:t.params.store_status,callback:function(e){t.$set(t.params,"store_status",e)},expression:"params.store_status"}},[e("el-option",{attrs:{label:$t("fknr53","未开店","lang"),value:"0"}}),e("el-option",{attrs:{label:$t("e81s93","已开店","lang"),value:"1"}}),e("el-option",{attrs:{label:$t("e61qk3","已关闭","lang"),value:"3"}}),e("el-option",{attrs:{label:$t("fy8avn4","等待审核","lang"),value:"2"}}),e("el-option",{attrs:{label:$t("bzsx1e4","审核拒绝","lang"),value:"4"}})],1)],1)],1),"distributor"!==t.loginType?e("div",{staticClass:"action-container"},[e("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus"},nativeOn:{click:function(e){t.addVisible=!0}}},[t._v($t("17u7wk7"," 添加推广员 ","lang"))])],1):t._e(),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{border:"",data:t.list,height:t.wheight-170,"element-loading-text":$t("go5gpa5","数据加载中","lang"),"default-sort":{prop:"bind_date",order:"descending"}}},[e("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{staticClass:"btn-gap",attrs:{type:"text"},on:{click:function(e){return t.detail(a.row)}}},[t._v($t("8p5m9o6"," 分佣详情 ","lang"))]),e("el-popover",{attrs:{placement:"right",width:"440",trigger:"hover"}},[e("div",{staticClass:"operating-icons"},[e("el-button",{staticClass:"btn-gap",attrs:{icon:"edit",type:"text"},on:{click:function(e){return t.detail(a.row)}}},[t._v($t("8p5m9o6"," 分佣详情 ","lang"))]),e("el-button",{attrs:{icon:"edit",type:"text"},on:{click:function(e){return t.editTop(a.row)}}},[t._v($t("pcuq5p7"," 调整至顶级 ","lang"))]),e("el-button",{attrs:{icon:"edit",type:"text"},on:{click:function(e){return t.editSuperior(a.row)}}},[t._v($t("7h5xle6"," 调整上级 ","lang"))]),0===a.row.shop_status||4===a.row.shop_status||3===a.row.shop_status?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.handleShopStatus(a.$index,a.row)}}},[t._v($t("73uxnc7"," 开通虚拟店 ","lang"))]):t._e(),2===a.row.shop_status?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.handleShopStatus(a.$index,a.row)}}},[t._v($t("vwj8056"," 审核申请 ","lang"))]):t._e(),1===a.row.shop_status?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.handleShopStatus(a.$index,a.row)}}},[t._v($t("6w8mp47"," 关闭虚拟店 ","lang"))]):t._e(),e("el-button",{directives:[{name:"show",rawName:"v-show",value:"true"==t.gradeList.isOpenPromoterGrade,expression:"gradeList.isOpenPromoterGrade == 'true'"}],attrs:{icon:"edit",type:"text"},on:{click:function(e){return t.editGrade(a.$index,a.row)}}},[t._v($t("qq9hv89"," 修改推广员等级 ","lang"))])],1),e("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e("i",{staticClass:"iconfont icon-angle-double-right"})])],1)]}}],null,!1,1969411996)}),e("el-table-column",{attrs:{prop:"username",label:$t("fqmy2","姓名","lang")}}),e("el-table-column",{attrs:{prop:"mobile",label:$t("ewbd43","手机号","lang"),width:"150"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.mobile?e("i",{staticClass:"el-icon-mobile"}):t._e(),t._v(" "+t._s(a.row.mobile)+" "),a.row.mobile&&0==t.datapass_block?e("el-tooltip",{attrs:{effect:"dark",content:$t("fljd2","复制","lang"),placement:"top-start"}},[e("i",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:a.row.mobile,expression:"scope.row.mobile",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:t.onCopy,expression:"onCopy",arg:"success"}],staticClass:"el-icon-document-copy"})]):t._e()]}}],null,!1,2046652697)}),e("el-table-column",{attrs:{prop:"promoter_grade_name",label:$t("o947kx5","推广员等级","lang")}}),e("el-table-column",{attrs:{prop:"pmobile",label:$t("qncunu6","上级联系方式","lang"),width:"150"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.pmobile&&""!=a.row.pmobile?e("i",{staticClass:"el-icon-mobile"}):t._e(),t._v(" "+t._s(a.row.pmobile&&""!=a.row.pmobile?a.row.pmobile:"-")+" "),a.row.pmobile&&""!=a.row.pmobile?e("el-tooltip",{attrs:{effect:"dark",content:$t("fljd2","复制","lang"),placement:"top-start"}},[e("i",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:a.row.pmobile,expression:"scope.row.pmobile",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:t.onCopy,expression:"onCopy",arg:"success"}],staticClass:"el-icon-document-copy"})]):t._e()]}}],null,!1,705542618)}),e("el-table-column",{attrs:{prop:"children_count",width:"100",label:$t("fe1d9i4","直属下级","lang"),sortable:""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{size:"mini",icon:"edit",type:"text"},on:{click:function(e){return t.count(a.$index,a.row)}}},[t._v(" "+t._s(a.row.children_count)+" ")])]}}],null,!1,3824559507)}),e("el-table-column",{attrs:{label:$t("k1e32","状态","lang"),width:"60"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#efefef"},on:{change:function(e){return t.freeze(a.row)}},model:{value:0==a.row.disabled,callback:function(e){t.$set(a.row,"disabled == 0",e)},expression:"scope.row.disabled == 0"}})]}}],null,!1,4123711519)}),e("el-table-column",{attrs:{label:$t("cdrq3m4","开店状态","lang"),width:"80"},scopedSlots:t._u([{key:"default",fn:function(a){return[0===a.row.shop_status?e("el-tag",{attrs:{size:"mini",effect:"plain"}},[t._v($t("dwdvdr5"," 未开店 ","lang"))]):t._e(),1===a.row.shop_status?e("el-tag",{attrs:{size:"mini",effect:"plain",type:"success"}},[t._v($t("cqiyc75"," 已开店 ","lang"))]):t._e(),2===a.row.shop_status?e("el-tag",{attrs:{size:"mini",effect:"plain"}},[t._v($t("cesw256"," 等待审核 ","lang"))]):t._e(),3===a.row.shop_status?e("el-tag",{attrs:{size:"mini",effect:"plain",type:"warning"}},[t._v($t("m1rdtp6"," 店铺关闭 ","lang"))]):t._e(),4===a.row.shop_status?e("el-popover",{attrs:{placement:"top-start",width:"300",trigger:"hover",content:a.row.reason}},[e("el-tag",{attrs:{slot:"reference",size:"mini",effect:"plain"},slot:"reference"},[t._v($t("vts2ym6"," 审核拒绝 ","lang"))])],1):t._e()]}}],null,!1,3166305636)}),e("el-table-column",{attrs:{prop:"bind_date",label:$t("arlfer4","加入时间","lang"),width:"100"}}),e("el-table-column",{attrs:{label:$t("edmdy3","已结算","lang"),width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" ￥"+t._s((e.row.rebateTotal-e.row.noCloseRebate)/100)+" ")]}}],null,!1,479293567)}),e("el-table-column",{attrs:{label:$t("fq8cu3","未结算","lang"),width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" ￥"+t._s(e.row.noCloseRebate/100)+" ")]}}],null,!1,2670536084)})],1),e("div",{staticClass:"mt-4 text-right"},[e("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":t.page.pageIndex,total:t.total_count,"page-size":t.page.pageSize},on:{"update:currentPage":function(e){return t.$set(t.page,"pageIndex",e)},"update:current-page":function(e){return t.$set(t.page,"pageIndex",e)},"size-change":t.onSizeChange,"current-change":t.onCurrentChange}})],1),e("el-dialog",{attrs:{title:$t("i2zka64","调整上级","lang"),visible:t.editSuperiorVisible,"before-close":t.handleCancelSuperior},on:{"update:visible":function(e){t.editSuperiorVisible=e}}},[e("el-row",{attrs:{gutter:10}},[e("el-col",{attrs:{md:8,lg:10}},[e("el-input",{attrs:{placeholder:$t("7ji3y96","请输入手机号","lang")},model:{value:t.identifierModal,callback:function(e){t.identifierModal=e},expression:"identifierModal"}},[e("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.numberSearchModal},slot:"append"})],1)],1)],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.modalLoading,expression:"modalLoading"}],staticStyle:{width:"100%"},attrs:{data:t.modalList,height:400,"element-loading-text":$t("go5gpa5","数据加载中","lang"),"highlight-current-row":""},on:{"current-change":t.handleCurrentChange}},[e("el-table-column",{attrs:{type:"index",width:"50"}}),e("el-table-column",{attrs:{prop:"username",label:$t("fqmy2","姓名","lang")}}),e("el-table-column",{attrs:{prop:"mobile",label:$t("ewbd43","手机号","lang")}}),e("el-table-column",{attrs:{prop:"promoter_grade_name",label:$t("o947kx5","推广员等级","lang")}}),e("el-table-column",{attrs:{prop:"disabled",label:$t("k1e32","状态","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return["0"==a.row.disabled?e("el-tag",{attrs:{type:"success",size:"mini"}},[t._v($t("g4yo14"," 有效 ","lang"))]):e("el-tag",{attrs:{type:"info",size:"mini"}},[t._v($t("fyufs4"," 无效 ","lang"))])]}}],null,!1,531259896)})],1),t.modal_total_count>t.paramsModal.pageSize?e("div",{staticClass:"mt-4 text-right"},[e("el-pagination",{attrs:{layout:"prev, pager, next","current-page":t.paramsModal.page,total:t.modal_total_count,"page-size":t.paramsModal.pageSize},on:{"update:currentPage":function(e){return t.$set(t.paramsModal,"page",e)},"update:current-page":function(e){return t.$set(t.paramsModal,"page",e)},"current-change":t.handleModalPage}})],1):t._e(),e("div",{staticClass:"dialog-footer content-center",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{nativeOn:{click:function(e){return t.handleCancelSuperior.apply(null,arguments)}}},[t._v($t("dd4ni4"," 取消 ","lang"))]),e("el-button",{attrs:{type:"primary"},on:{click:t.submitSuperiorAction}},[t._v($t("in1ck4"," 确定 ","lang"))])],1)],1),e("el-dialog",{attrs:{title:$t("eob5mk5","添加推广员","lang"),visible:t.addVisible,"distinguish-cancel-and-close":!1},on:{"update:visible":function(e){t.addVisible=e}}},[e("el-row",{attrs:{gutter:10}},[e("el-col",[e("el-alert",{attrs:{title:$t("6cku7gj","添加的推广员必须为已经授权手机号的会员","lang"),type:"info","show-icon":""}})],1)],1),e("el-row",{attrs:{gutter:10}},[e("el-col",{attrs:{md:8,lg:10}},[e("el-input",{attrs:{placeholder:$t("ytf6465","会员手机号","lang")},model:{value:t.promoter_mobile,callback:function(e){t.promoter_mobile=e},expression:"promoter_mobile"}})],1)],1),e("div",{staticClass:"dialog-footer content-center",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{nativeOn:{click:function(e){t.addVisible=!1}}},[t._v($t("dd4ni4"," 取消 ","lang"))]),e("el-button",{attrs:{type:"primary"},on:{click:t.addPromoter}},[t._v($t("cp35x4"," 保存 ","lang"))])],1)],1),e("el-dialog",{attrs:{title:$t("vjd51d7","审核开通虚拟店","lang"),visible:t.updateShopVisible,"close-on-click-modal":!1},on:{"update:visible":function(e){t.updateShopVisible=e}}},[[e("el-form",[e("el-form-item",{attrs:{label:$t("bzvg8y4","审核状态","lang"),"label-width":"100px"}},[e("el-radio-group",{model:{value:t.shop_status,callback:function(e){t.shop_status=e},expression:"shop_status"}},[e("el-radio",{attrs:{label:1}},[t._v($t("w0hq586"," 审核通过 ","lang"))]),e("el-radio",{attrs:{label:4}},[t._v($t("vts2ym6"," 审核拒绝 ","lang"))])],1)],1),4==t.shop_status?e("el-form-item",{attrs:{label:$t("czp1gs4","拒绝原因","lang"),"label-width":"100px"}},[e("el-input",{attrs:{type:"textarea",rows:4},model:{value:t.currentRow.reason,callback:function(e){t.$set(t.currentRow,"reason",e)},expression:"currentRow.reason"}})],1):t._e()],1)],e("div",{staticClass:"dialog-footer content-center",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{nativeOn:{click:function(e){t.updateShopVisible=!1}}},[t._v($t("dd4ni4"," 取消 ","lang"))]),e("el-button",{attrs:{type:"primary"},on:{click:t.actionShopStatus}},[t._v($t("in1ck4"," 确定 ","lang"))])],1)],2),e("el-dialog",{attrs:{title:$t("raeirw7","修改推广员等级","lang"),visible:t.editGradeVisible,"before-close":t.handleCancel},on:{"update:visible":function(e){t.editGradeVisible=e}}},[[e("el-row",{staticClass:"grade-setting-row",attrs:{gutter:20}},[e("el-col",{staticClass:"grade-setting-col",attrs:{span:8}},[t._v(" "+t._s(t.row.promoter_grade_name)+" ")]),e("el-col",{staticClass:"grade-setting-col",attrs:{span:8}},[t._v($t("ikkbfb5"," 调整为 ","lang"))]),e("el-col",{staticClass:"grade-setting-col",attrs:{span:8}},[e("el-select",{attrs:{placeholder:$t("l72nr3","请选择","lang")},model:{value:t.newGradeName,callback:function(e){t.newGradeName=e},expression:"newGradeName"}},t._l(t.gradeList.grade,function(t){return e("el-option",{key:t.grade_level,attrs:{label:t.custom_name,value:t.grade_level}})}),1)],1)],1)],e("div",{staticClass:"dialog-footer content-center",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{nativeOn:{click:function(e){return t.handleCancel.apply(null,arguments)}}},[t._v($t("dd4ni4"," 取消 ","lang"))]),e("el-button",{attrs:{type:"primary"},on:{click:t.submitGradeAction}},[t._v($t("y5hwj6"," 确定调整 ","lang"))])],1)],2)],1):t._e(),e("router-view")],1)},[],!1,null,"4d63134b",null),n=i.exports}}]);