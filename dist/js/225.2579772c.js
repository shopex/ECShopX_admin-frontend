"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[225],{80225:function(t,e,a){a.r(e),a.d(e,{default:function(){return g}});a(44114),a(18111),a(7588),a(61701),a(57270);var l=a(432),o=a.n(l),s=a(87378),i=a(9146),r=a(21837),n=(a(97570),a(12104),a(21255),a(73910)),c=a(9130),d={provide(){return{refresh:this.getDataList}},components:{imgPicker:s.default,videoPicker:i.default,draggable:o(),SkuSelector:r.A,flagModal:n.A,topicModal:c.A},data(){return{ruleForm:{p_order:0,badges:null,topics:[],title:null,content:null,goods:[],cover:"",images:[],image_path:[],image_tag:[],video:""},rules:{title:[{required:!0,message:$t("9hmia25","请填写标题","lang"),trigger:"blur"},{validator:(t,e,a)=>{if(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g.test(e))return a(new Error(t.message));a()},message:$t("glt1w2m","标题仅支持汉字、英文、数字，不支持emoji","lang"),trigger:"blur"}],content:[{required:!0,message:$t("p6b4wu7","请填写笔记描述","lang"),trigger:"blur"}],images:[{required:!0,validator:(t,e,a)=>{const{ruleForm:l}=this.$data;if(e.length<1)return this.$data.picdanger=!0,a(new Error($t("2en0jk5","请选择图片","lang")));a()},trigger:"blur"}]},post_info:{},is_top:!1,formLoad:!1,picsDialog:!1,isGetPics:!1,multiple:!1,itemVideo:{},relItems:[],relImages:[],relTopics:[],relFlag:{},goodslimit:9,topiclist:[],flagModalShow:!1,topicModalShow:!1,picdanger:!1}},mounted(){this.$route.query.id&&this.getDetail()},methods:{handleBack(){this.$router.go(-1)},async getDetail(){const{id:t}=this.$route.query,{post_info:e}=await this.$api.ugc.getNotesDetail({post_id:t});e?(this.serializeFrom(e),this.post_info=e):(await this.$confirm(`${$t("8z16sdb","笔记不存在,可能已删除","lang")}`,$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang")}),this.$router.go(-1))},serializeFrom(t){var e=[],a={post_id:t.post_id,is_top:t.is_top,p_order:t.p_order,title:t.title,content:t.content.replace(/<br\/>/g,"\n"),video:t.video,video_ratio:t.video_ratio,images:JSON.parse(t.images).map(t=>t.url)};t.goods&&t.goods.length&&t.goods.forEach(t=>{t.spec_items=[],e.push(t)}),t.topics&&(this.$data.relTopics=t.topics),t.badges&&(this.$data.relFlag=t.badges[0],a.badges=[t.badges[0].badge_id]),this.$data.is_top=t.is_top>0,this.$data.relItems=e,this.$data.itemVideo={},this.$data.ruleForm=a},pageTo(t){this.$router.push({path:t})},serialChanges(){const{ruleForm:t,is_top:e}=this.$data;t.p_order=0},handleAddItems(){this.$refs.itemsSku.handleGoodsDialogShow()},getItems(t){let e=[];t.forEach((t,a)=>{e.push(t.goods_id)}),this.ruleForm.goods=e,this.$forceUpdate()},flagModalHide(t){this.$data.flagModalShow=t},flagModalHandle(t){this.ruleForm.badges=[t.badge_id],this.relFlag=t,this.flagModalHide(!1)},removeFlag(){this.ruleForm.badges=null,this.relFlag={}},topicModalHide(t){this.$data.topicModalShow=t},topicModalHandle(t){this.relTopics=t,this.topicModalHide(!1)},removeTopic(t){const{relTopics:e}=this.$data;e.splice(t,1)},confirmHandle(){this.$refs.dataForm.validate(async t=>{if(!t)return!1;{let t=JSON.parse(JSON.stringify(this.ruleForm));t.is_top=this.is_top?1:0,t.cover=t.images[0],t.image_path=t.images,t.content=t.content.replace(/\n/g,"<br/>"),t.topics=this.relTopics.map(t=>t.topic_id),t.images=JSON.stringify(t.images.map(t=>({url:t,topics:[]})));const{message:e}=await this.$api.ugc.notesCreate(t);this.$message.success(e),setTimeout(()=>{this.$router.go(-1)},500)}})}}},g=(0,a(81656).A)(d,function(){var t=this,e=t._self._c;return e("SpPage",{attrs:{title:$t("5fz8e66","编辑品牌笔记","lang")}},[e("template",{slot:"page-footer"},[e("div",{staticClass:"text-center"},[t.ruleForm.post_id?t._e():e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.confirmHandle("ruleForm")}}},[t._v($t("8k3anr7"," 创建并发布 ","lang"))]),t.ruleForm.post_id?e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.confirmHandle("ruleForm")}}},[t._v($t("in1ck4"," 确定 ","lang"))]):t._e(),e("el-button",{on:{click:t.handleBack}},[t._v($t("m1m0m4"," 返回 ","lang"))])],1)]),e("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.formLoad,expression:"formLoad"}],ref:"dataForm",staticClass:"ugc-form",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"120px"}},[e("el-form-item",{staticClass:"notMBot",attrs:{label:$t("g3snkp4","笔记排序","lang"),prop:"p_order"}},[e("el-row",[e("el-col",{attrs:{span:4}},[e("el-checkbox",{on:{change:t.serialChanges},model:{value:t.is_top,callback:function(e){t.is_top=e},expression:"is_top"}},[t._v($t("jyavp4"," 置项 ","lang"))])],1),e("el-col",{attrs:{span:20}},[e("span",{staticClass:"text text-ml"},[t._v($t("ejnu8sm"," 最多置顶两篇笔记，置顶后将自动排序最优。 ","lang"))])])],1),e("el-row",[e("el-col",{attrs:{span:4}},[e("el-input",{staticClass:"mipt",attrs:{disabled:t.is_top,type:"number",min:"0",max:"50"},model:{value:t.ruleForm.p_order,callback:function(e){t.$set(t.ruleForm,"p_order",e)},expression:"ruleForm.p_order"}})],1),e("el-col",{attrs:{span:20}},[e("span",{staticClass:"text text-ml"},[t._v($t("q807ipp"," 默认为0，排序数字越小优先级越高；相同优先级下 ","lang"))])])],1)],1),e("el-form-item",{staticClass:"bottom-bor",attrs:{label:$t("g3z7o14","笔记角标","lang"),prop:"badges"}},[e("el-row",[e("el-col",{attrs:{span:16}},[t.ruleForm.badges?e("div",{staticClass:"badgebar"},[e("span",{staticClass:"text"},[t._v($t("f1pc34"," 已选：","lang")+t._s(t.relFlag.badge_name)+" ")]),e("span",{staticClass:"el-icon el-icon-close",on:{click:t.removeFlag}})]):e("span",{staticClass:"text"},[t._v($t("l72nr3","请选择","lang"))])]),e("el-col",{staticClass:"row-fright",attrs:{span:8}},[e("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:function(e){return t.flagModalHide(!0)}}},[t._v($t("dgq4vs5"," 打角标 ","lang"))])],1)],1)],1),e("el-form-item",{attrs:{label:$t("g3tqbx4","笔记标题","lang"),prop:"title"}},[e("el-input",{attrs:{maxlength:"50","show-word-limit":!0},model:{value:t.ruleForm.title,callback:function(e){t.$set(t.ruleForm,"title",e)},expression:"ruleForm.title"}})],1),e("el-form-item",{attrs:{label:$t("g3sysd4","笔记描述","lang"),prop:"content"}},[e("el-input",{attrs:{type:"textarea",rows:5,maxlength:"900","show-word-limit":!0},model:{value:t.ruleForm.content,callback:function(e){t.$set(t.ruleForm,"content",e)},expression:"ruleForm.content"}})],1),e("el-form-item",{attrs:{label:$t("atb68s4","关联话题","lang"),prop:"topics"}},[e("el-row",[e("el-col",{attrs:{span:16}},[e("span",{staticClass:"text"},[t._v($t("ydi2w28","可多选，话题可在","lang")),e("b",{on:{click:function(e){return t.pageTo("/marketing/ugc/ugctopic")}}},[t._v($t("22gtxk6","笔记话题配置","lang"))]),t._v($t("8uovz88","菜单中新建/修改","lang"))])]),e("el-col",{staticClass:"row-fright",attrs:{span:8}},[e("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:function(e){return t.topicModalHide(!0)}}},[t._v($t("n54r2d6"," 选择话题 ","lang"))])],1)],1),t.relTopics&&t.relTopics.length?e("el-row",{staticClass:"bgbar"},t._l(t.relTopics,function(a,l){return e("el-col",{key:l,staticClass:"baritem"},[e("div",{class:{gray:"4"==a.status},on:{click:function(e){return t.removeTopic(l)}}},[e("span",[t._v(t._s(a.topic_name))]),e("span",{staticClass:"el-icon el-icon-close"})])])}),1):t._e()],1),e("el-form-item",{attrs:{label:$t("g3zgyv4","笔记视频","lang"),prop:"video"}},[e("el-row",[e("el-col",{attrs:{span:16}},[e("SpVideoPicker",{model:{value:t.ruleForm.video,callback:function(e){t.$set(t.ruleForm,"video",e)},expression:"ruleForm.video"}})],1)],1)],1),e("el-form-item",{attrs:{label:$t("g3qmg54","笔记图片","lang"),prop:"images"}},[e("SpImagePicker",{attrs:{drag:"",max:9},model:{value:t.ruleForm.images,callback:function(e){t.$set(t.ruleForm,"images",e)},expression:"ruleForm.images"}})],1),e("el-form-item",{attrs:{label:$t("d45exv4","推荐商品","lang"),prop:"goods"}},[e("el-row",[e("el-col",{attrs:{span:16}},[e("span",{staticClass:"text"},[t._v($t("buxgc45","最多可选 ","lang")+t._s(t.goodslimit)+$t("cjrf54"," 件商品","lang"))])]),e("el-col",{staticClass:"row-fright",attrs:{span:8}},[e("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:t.handleAddItems}},[t._v($t("mwtd0l6"," 选择商品 ","lang"))])],1)],1),e("SkuSelector",{ref:"itemsSku",staticClass:"itemsSku",attrs:{limit:t.goodslimit,data:t.relItems},on:{change:t.getItems}})],1),t.post_info&&t.post_info.status?e("el-form-item",{attrs:{label:$t("cdfx7p4","当前状态","lang")}},[e("span",{staticClass:"text"},[t._v(" "+t._s(t.post_info.status_text)+" ")])]):t._e()],1),t.flagModalShow?e("flagModal",{attrs:{"dialog-is-show":t.flagModalShow,"duf-check-flag":t.relFlag},on:{cancelLabelsDialog:t.flagModalHide,modalHandle:t.flagModalHandle}}):t._e(),t.topicModalShow?e("topicModal",{attrs:{"dialog-is-show":t.topicModalShow,"duf-check-topic":t.relTopics},on:{cancelLabelsDialog:t.topicModalHide,modalHandle:t.topicModalHandle}}):t._e()],2)},[],!1,null,"dc998484",null).exports}}]);