"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[6103],{16103:function(e,t,a){a.r(t),a.d(t,{default:function(){return u}});a(18111),a(22489),a(44114),a(7588),a(72505),a(18306);var s=a(95353),i=a(71196),n=a(5134),l=a(5748),r=a(25159);a(2038);let o={default:{title:$t("2i63ask","不支持任务制：商品不按任务制模式获得佣金","lang"),description:""},total_money:{title:$t("gebo8je","任务制：商品月度销售金额设置","lang"),description:$t("rb43x613","任务制说明：阶梯设置商品月度销售金额目标及对应业绩，每月月底达标后可获得业绩。","lang")},total_num:{title:$t("m0ttxce","任务制：商品月度销售数量设置","lang"),description:$t("sq8ewd13","任务制说明：阶梯设置商品月度销售数量目标及对应业绩，每月月底达标后可获得业绩。","lang")}};var c={components:{shopSelect:r.default,SideBar:i.A},data(){return{changeRebateType:"default",changeRebateTypeVisible:!1,current:{},selectGoodsIds:[],rebateSpecItems:[],show_sideBar:!1,show_task_sideBar:!1,activeName:"first",submitLoading:!1,allSelect:!1,total_count:0,loading:!1,itemsList:[],changeRebateTypeMap:o,params:{item_type:"normal",page:1,pageSize:10,keywords:""},popularizeSetting:{popularize_ratio:{type:"profit"}},tabList:[{name:$t("av9wor4","全部商品","lang"),value:null,activeName:"first"}],floorHead:[{label:$t("fvfde54","第一阶梯","lang"),property:"name"},{label:$t("fvi97d4","第二阶梯","lang"),property:"name"},{label:$t("fvfk2e4","第三阶梯","lang"),property:"name"}],statusOptions:[{value:1,label:$t("eymx2","启用","lang")},{value:2,label:$t("fixz73","未启用","lang")}],status:"",alertTip:{title:"",description:""}}},computed:{...(0,s.L8)(["wheight"])},watch:{status:{handler:function(e){this.getGoodsList(e)}},"current.rebate_type":{handler:function(e){e=e||"default",this.alertTip={title:o[e].title,description:o[e].description}},immediate:!0}},mounted(){this.loginType=this.$store.getters.login_type,this.params.pathSource=this.$route.path,(0,n.getPopularizeSettingStore)(this.params).then(e=>{this.popularizeSetting=e.data.data,"all"==e.data.data.goods?this.allSelect=!0:this.allSelect=!1,this.getGoodsList()})},methods:{handleChangeRebate:function(e){},filterHandler(e){this.params.page=1,this.params.rebate=e.rebate[0],this.getGoodsList()},handleClick(){"first"!=this.activeName?this.params.rebate_type=this.activeName:this.params.rebate_type="",this.params.page=1,this.getGoodsList()},handleSizeChange(e){this.params.page=1,this.params.pageSize=e,this.getGoodsList()},getList(){this.loading=!0,this.getGoodsList(),this.loading=!1},storeChange(e){e&&e.shop_id,this.params.distributor_id=e.shop_id,this.params.page=1,this.getList()},initChange(){this.shopId=""},handleCurrentChange(e){this.params.page=e,this.getGoodsList()},handleItemsSelectionChange(e){let t=[];for(let a in e)t.push(e[a].goods_id);this.selectGoodsIds=t},showChangeRebateType(){0==this.selectGoodsIds.lenght?this.$message({type:"success",message:$t("b1avoda","未选择商品，无需更新","lang")}):(this.changeRebateTypeVisible=!0,this.changeRebateType=this.activeName)},goodsSearch(){this.params.page=1,this.getGoodsList()},switchStatusChange(e){var t=e.rebate?1:0;(0,l.updateGoodsInfo)({goods_id:e.goods_id,rebate:t}).then(e=>{this.$message({type:"success",message:$t("d1spvi4","操作成功","lang")}),this.getGoodsList()})},handleBatchChangeStatus(){0==this.selectGoodsIds.length?this.$message({type:"success",message:$t("b1avoda","未选择商品，无需更新","lang")}):(0,l.updateGoodsInfo)({goods_id:this.selectGoodsIds,rebate:1}).then(e=>{this.$message({type:"success",message:$t("d1spvi4","操作成功","lang")}),this.getGoodsList()})},handleBatchChange(){0==this.selectGoodsIds.length?(this.$message({type:"success",message:$t("b1avoda","未选择商品，无需更新","lang")}),this.changeRebateTypeVisible=!1):(0,l.updateGoodsInfo)({goods_id:this.selectGoodsIds,rebate_type:this.changeRebateType}).then(e=>{this.$message({type:"success",message:$t("d1spvi4","操作成功","lang")}),this.changeRebateTypeVisible=!1,this.getGoodsList()})},saveRebateConf(){var e=[],t=[];this.rebateSpecItems.forEach(a=>{var s=a.rebate_conf;s.ratio_type=this.popularizeSetting.popularize_ratio.type,s.rebate_task[0].money,s.rebate_task[0].filter,t=s.rebate_task,e.push(s)});var a="",s=0;t.forEach((e,t)=>{""!=e.money&&""!=e.filter&&s++}),t.forEach((e,t)=>{s>0&&(""!=e.money&&""==e.filter||""==e.money&&""!=e.filter)&&(a=$t("t5j5h1b","满足条件或金额不能为空","lang"))}),"default"==this.current.rebate_type||""==a?(0,l.updateItemRebateConf)({rebateConf:JSON.stringify(e),rebate_type:this.current.rebate_type}).then(e=>{this.$message({message:$t("aghf564","保存成功","lang"),type:"success",duration:2e3})}):this.$message({type:"error",message:$t("t5j5h1b","满足条件或金额不能为空","lang")})},handleRebateConf(e,t){1==t?(this.show_sideBar=!0,this.show_task_sideBar=!1):(this.show_sideBar=!1,this.show_task_sideBar=!0),this.current=e,(0,l.getItemsList)({page:1,pageSize:1e3,is_sku:!0,item_id:e.item_id,item_type:"normal"}).then(e=>{var t=[];e.data.data.list.forEach(e=>{if(e.rebate_conf){if(this.popularizeSetting.popularize_ratio.type!=e.rebate_conf.ratio_type&&"money"!=e.rebate_conf.type)for(var a in this.popularizeSetting.popularize_ratio.profit)e.rebate_conf.value[a]=""}else for(var a in e.rebate_conf={},e.rebate_conf.type="money",e.rebate_conf.rebate_task_type="money",e.rebate_conf.value={},this.popularizeSetting.popularize_ratio.profit)e.rebate_conf.value[a]="";if(!e.rebate_conf.rebate_task)for(var s in e.rebate_conf.rebate_task=[],[0,1,2])e.rebate_conf.rebate_task[s]={},e.rebate_conf.rebate_task[s].filter="",e.rebate_conf.rebate_task[s].ratio="",e.rebate_conf.rebate_task[s].money="";e.rebate_conf.item_id=e.item_id,t.push(e)}),this.rebateSpecItems=t})},getGoodsList(e){this.loading=!0,1!==e&&2!==e&&e||(this.params.rebate=e?1===e?1:0:void 0),(0,l.getItemsList)(this.params).then(e=>{this.itemsList=e.data.data.list,this.itemsList.forEach(e=>{e.rebate_audit="",e.rebate_audit=e.rebate,e.rebate="1"===e.rebate}),this.total_count=e.data.data.total_count,this.loading=!1})},nextChange(e,t,a){let s=this.rebateSpecItems.findIndex(e=>e.itemId===a.itemId);this.rebateSpecItems[s].rebate_conf.rebate_task[t+1].filter<=Number(e)&&(a.rebate_conf.rebate_task[t+1].filter=Number(e)+1,this.$nextTick(()=>{a.rebate_conf.rebate_task[t+1].filter=Number(e)+1}))},changeLimit(e,t,a){if(t>0){let s=this.rebateSpecItems.findIndex(e=>e.itemId===a.itemId),i=this.rebateSpecItems[s].rebate_conf.rebate_task[t-1].filter;""!==i&&(a.rebate_conf.rebate_task[t].filter=Number(e),this.$nextTick(()=>{let s=Math.max(Number(e),Number(i)+1);a.rebate_conf.rebate_task[t].filter=Number(s)}))}if(0===t){this.nextChange(e,0,a);let t=this.rebateSpecItems.findIndex(e=>e.itemId===a.itemId),s=this.rebateSpecItems[t].rebate_conf.rebate_task[1].filter;this.nextChange(s,1,a)}else 1===t&&this.nextChange(e,t,a)}}},p=(0,a(81656).A)(c,function(){var e=this,t=e._self._c;return t("SpPage",[t("shop-select",{attrs:{distributors:""},on:{update:e.storeChange,init:e.initChange}}),t("div",{staticClass:"content-bottom-padded"},[t("el-row",{staticClass:"content-bottom-padded",attrs:{gutter:20}},[t("el-col",{attrs:{span:6}},[t("el-input",{staticStyle:{width:"100%"},attrs:{size:"mini",placeholder:$t("mf25uh7","请输入商品名称","lang")},model:{value:e.params.keywords,callback:function(t){e.$set(e.params,"keywords",t)},expression:"params.keywords"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.goodsSearch},slot:"append"})],1)],1),t("el-col",{attrs:{span:6}},[t("el-select",{attrs:{size:"mini",clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:e.status,callback:function(t){e.status=t},expression:"status"}},e._l(e.statusOptions,function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:24}},[t("el-button-group",[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.handleBatchChangeStatus()}}},[e._v($t("9y0zg58"," 批量设置开启 ","lang"))])],1)],1)],1)],1),t("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.tabList,function(a,s){return t("el-tab-pane",{key:s,attrs:{label:a.name,name:a.activeName}},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleItemsTable",refInFor:!0,staticStyle:{width:"100%"},attrs:{data:e.itemsList,height:e.wheight-240},on:{"selection-change":e.handleItemsSelectionChange,"filter-change":e.filterHandler}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),t("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),width:"160"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{staticClass:"btn-gap",attrs:{type:"text"},on:{click:function(t){return e.handleRebateConf(a.row,1)}}},[e._v($t("9pw6le6"," 设置参数 ","lang"))]),("distributor"!=e.$store.getters.login_type&&e.$store.getters.login_type,e._e())]}}],null,!0)}),t("el-table-column",{attrs:{label:$t("k1e32","状态","lang"),width:"160","column-key":"rebate","filter-multiple":!1},scopedSlots:e._u([{key:"default",fn:function(a){return[e.allSelect&&"distributor"!=e.$store.getters.login_type?t("div",[t("el-switch",{attrs:{"active-color":"#13ce66",disabled:""},model:{value:e.allSelect,callback:function(t){e.allSelect=t},expression:"allSelect"}})],1):t("div",[2===a.row.rebate_audit?t("el-tag",{attrs:{size:"mini"}},[e._v($t("cesw256"," 等待审核 ","lang"))]):e._e(),3===a.row.rebate_audit?t("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v($t("vts2ym6"," 审核拒绝 ","lang"))]):e._e(),2===a.row.rebate_audit||1===a.row.rebate_audit&&"distributor"==e.$store.getters.login_type?t("el-switch",{attrs:{disabled:"","active-color":"#13ce66"},on:{change:function(t){return e.switchStatusChange(a.row)}},model:{value:a.row.rebate,callback:function(t){e.$set(a.row,"rebate",t)},expression:"scope.row.rebate"}}):t("el-switch",{attrs:{"active-color":"#13ce66"},on:{change:function(t){return e.switchStatusChange(a.row)}},model:{value:a.row.rebate,callback:function(t){e.$set(a.row,"rebate",t)},expression:"scope.row.rebate"}})],1)]}}],null,!0)}),t("el-table-column",{attrs:{label:$t("b41bic4","商品图片","lang"),width:"80"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("el-avatar",{attrs:{shape:"square",size:60,fit:"fit",src:e.row.pics[0]}})]}}],null,!0)}),t("el-table-column",{attrs:{label:$t("ij5d2","标题","lang"),prop:"item_name","min-width":"250"}}),t("el-table-column",{attrs:{label:$t("gwn72","店铺","lang"),prop:"distributor_name.name","min-width":"250"}}),t("el-table-column",{attrs:{label:$t("m8lft3","销售价","lang")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.price/100)+$t("dtml2","元 ","lang"))]}}],null,!0)}),t("el-table-column",{attrs:{label:$t("ev2aj3","成本价","lang")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.cost_price/100)+$t("dtml2","元 ","lang"))]}}],null,!0)}),t("el-table-column",{attrs:{prop:"store",label:$t("gl5x2","库存","lang"),width:"80"}}),t("el-table-column",{attrs:{prop:"approve_status",label:$t("k1e32","状态","lang"),"min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(a){return["onsale"===a.row.approve_status?t("el-tag",{staticClass:"grid-content",attrs:{type:"success"}},[e._v($t("bzssl67"," 前台可销售 ","lang"))]):"offline_sale"===a.row.approve_status?t("el-tag",{staticClass:"grid-content",attrs:{type:"info"}},[e._v($t("cyn37z7"," 前台不展示 ","lang"))]):t("el-tag",{staticClass:"grid-content",attrs:{type:"danger"}},[e._v($t("nmf48g6"," 不可销售 ","lang"))])]}}],null,!0)})],1),t("div",{staticClass:"mt-4 text-right"},[t("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next","current-page":e.params.page,"page-sizes":[10,20,50],total:e.total_count,"page-size":e.params.pageSize},on:{"update:currentPage":function(t){return e.$set(e.params,"page",t)},"update:current-page":function(t){return e.$set(e.params,"page",t)},"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)],1)}),1),t("SideBar",{attrs:{visible:e.show_task_sideBar,title:$t("zgpjn55","任务制配置","lang"),width:"67"},on:{"update:visible":function(t){e.show_task_sideBar=t}}},[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",{staticClass:"title"},[e._v(e._s(e.current.item_name))]),t("span",[t("el-alert",{staticClass:"alert-text",attrs:{title:e.alertTip.title,description:e.alertTip.description,type:"info","close-text":" ","show-icon":""}})],1)]),t("el-radio-group",{model:{value:e.current.rebate_type,callback:function(t){e.$set(e.current,"rebate_type",t)},expression:"current.rebate_type"}})],1),"default"!=e.current.rebate_type?t("el-card",{staticClass:"box-card"},[t("el-table",{attrs:{data:e.rebateSpecItems}},[t("el-table-column",{attrs:{label:$t("o06w2","规格","lang"),prop:"item_spec_desc","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.item_spec_desc?t("span",[e._v(e._s(a.row.item_spec_desc))]):t("span",[e._v($t("cvevh3","单规格","lang"))])]}}],null,!1,215542460)}),t("el-table-column",{attrs:{label:$t("m8lft3","销售价","lang"),"min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" ¥"+e._s(t.row.price/100)+" ")]}}],null,!1,133717387)}),t("el-table-column",{attrs:{label:$t("ev2aj3","成本价","lang"),"min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" ¥"+e._s(t.row.cost_price/100)+" ")]}}],null,!1,1804956287)}),e._l(e.floorHead,function(a,s){return t("el-table-column",{key:s,attrs:{label:a.label,"min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[e._v($t("u87dqf6"," 满足条件 ","lang")),t("el-input",{attrs:{min:0,size:"mini",type:"number"},on:{input:function(t){return e.changeLimit(arguments[0],s,a.row)}},model:{value:a.row.rebate_conf.rebate_task[s].filter,callback:function(t){e.$set(a.row.rebate_conf.rebate_task[s],"filter",t)},expression:"scope.row.rebate_conf.rebate_task[key].filter"}}),e._v($t("mna1g4"," 金额 ","lang")),"money"==a.row.rebate_conf.rebate_task_type?t("el-input",{attrs:{size:"mini",type:"number","suffix-icon":"iconfont icon-yen-sign"},model:{value:a.row.rebate_conf.rebate_task[s].money,callback:function(t){e.$set(a.row.rebate_conf.rebate_task[s],"money",t)},expression:"scope.row.rebate_conf.rebate_task[key].money"}}):t("el-input",{attrs:{size:"mini",type:"number","suffix-icon":"iconfont icon-percent"},model:{value:a.row.rebate_conf.rebate_task[s].ratio,callback:function(t){e.$set(a.row.rebate_conf.rebate_task[s],"ratio",t)},expression:"scope.row.rebate_conf.rebate_task[key].ratio"}})]}}],null,!0)})})],2)],1):e._e(),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:e.saveRebateConf}},[e._v($t("cp35x4"," 保存 ","lang"))])],1)],1),t("SideBar",{attrs:{visible:e.show_sideBar,title:$t("azvj8v4","参数配置","lang"),width:"67"},on:{"update:visible":function(t){e.show_sideBar=t}}},[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",{staticClass:"title"},[e._v(e._s(e.current.item_name))]),t("div",{staticClass:"frm-tips"},[e._v($t("p0lgrg11"," 如果设置为固定金额，金额就是设置的固定金额。否则按照 【计算类型】计算 ","lang"))]),"profit"==e.popularizeSetting.popularize_ratio.type&&"money"==e.popularizeSetting.commission_type?t("span",[t("el-alert",{staticClass:"alert-text",attrs:{title:$t("xa5h2pb","计算类型: 【按利润】","lang"),description:$t("evq9r41e","计算方式：商品利润 ×  百分比，其中商品利润为【支付金额-运费-商品成本价】，如果不填则不进行计算","lang"),type:"info","close-text":" ","show-icon":""}})],1):"profit"==e.popularizeSetting.popularize_ratio.type&&"point"==e.popularizeSetting.commission_type?t("span",[t("el-alert",{staticClass:"alert-text",attrs:{title:$t("xa5h2pb","计算类型: 【按利润】","lang"),description:$t("a3owp41p","计算方式： 商品利润 × 百分比 × 积分与现金的抵扣比例，其中商品利润为【支付金额-运费-商品成本价】，如果不填则不进行","lang"),type:"info","close-text":" ","show-icon":""}})],1):"order_money"==e.popularizeSetting.popularize_ratio.type&&"money"==e.popularizeSetting.commission_type?t("span",[t("el-alert",{staticClass:"alert-text",attrs:{title:$t("bdfeszd","计算类型: 【按订单金额】","lang"),description:$t("6hexsx19","计算方式： 订单金额 × 百分比，其中订单金额为【支付金额-运费】，如果不填则使用通用配置","lang"),type:"info","close-text":" ","show-icon":""}})],1):"order_money"==e.popularizeSetting.popularize_ratio.type&&"point"==e.popularizeSetting.commission_type?t("span",[t("el-alert",{staticClass:"alert-text",attrs:{title:$t("bdfeszd","计算类型: 【按订单金额】","lang"),description:$t("my8gr31m","计算方式： 订单金额 × 百分比 × 积分与现金的抵扣比例，其中订单金额为【支付金额-运费】，如果不填则使用通用配置","lang"),type:"info","close-text":" ","show-icon":""}})],1):e._e()]),t("el-table",{attrs:{data:e.rebateSpecItems}},[t("el-table-column",{attrs:{label:$t("o06w2","规格","lang"),prop:"item_spec_desc","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.item_spec_desc?t("span",[e._v(e._s(a.row.item_spec_desc))]):t("span",[e._v($t("cvevh3","单规格","lang"))])]}}])}),t("el-table-column",{attrs:{label:$t("m8lft3","销售价","lang"),"min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" ¥"+e._s(t.row.price/100)+" ")]}}])}),t("el-table-column",{attrs:{label:$t("ev2aj3","成本价","lang"),"min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" ¥"+e._s(t.row.cost_price/100)+" ")]}}])}),t("el-table-column",{attrs:{label:$t("lnjk2","类型","lang"),width:"160"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-switch",{attrs:{"active-value":"money","inactive-value":"ratio","active-text":$t("pn1o2","金额","lang"),"inactive-text":$t("irzr2","比例","lang")},model:{value:a.row.rebate_conf.type,callback:function(t){e.$set(a.row.rebate_conf,"type",t)},expression:"scope.row.rebate_conf.type"}})]}}])}),e._l(e.popularizeSetting.popularize_ratio.profit,function(a,s){return t("el-table-column",{key:s,attrs:{label:a.name,"min-width":"110"},scopedSlots:e._u([{key:"default",fn:function(a){return["money"==a.row.rebate_conf.type?t("div",{style:{display:"flex",alignItems:"flex-end"}},[t("el-input-number",{attrs:{precision:"3",step:"0.001",size:"mini"},model:{value:a.row.rebate_conf.value[s],callback:function(t){e.$set(a.row.rebate_conf.value,s,t)},expression:"scope.row.rebate_conf.value[key]"}}),e._v($t("dtml2","元 ","lang"))],1):t("div",{style:{display:"flex",alignItems:"flex-end"}},[t("el-input-number",{attrs:{precision:"3",step:"0.001",size:"mini"},model:{value:a.row.rebate_conf.value[s],callback:function(t){e.$set(a.row.rebate_conf.value,s,t)},expression:"scope.row.rebate_conf.value[key]"}}),e._v("% ")],1)]}}],null,!0)})})],2)],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:e.saveRebateConf}},[e._v($t("cp35x4"," 保存 ","lang"))])],1)],1),t("el-dialog",{attrs:{title:$t("p2204h8","更改商任务制支持","lang"),visible:e.changeRebateTypeVisible,width:"30%"},on:{"update:visible":function(t){e.changeRebateTypeVisible=t}}},[t("el-radio-group",{model:{value:e.changeRebateType,callback:function(t){e.changeRebateType=t},expression:"changeRebateType"}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.changeRebateTypeVisible=!1}}},[e._v($t("caoqm3","取 消","lang"))]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleBatchChange}},[e._v($t("hnjoo3","确 定","lang"))])],1)],1)],1)},[],!1,null,null,null),u=p.exports}}]);