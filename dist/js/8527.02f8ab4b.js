"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[8527],{88527:function(e,t,a){a.r(t),a.d(t,{default:function(){return n}});a(44114),a(18111),a(20116),a(7588),a(61701);var i=a(22541),o=a(17659),r=a(81046),l={name:"",data(){const e=this.$createElement;return{queryForm:{mobile:"",account:"",email:"",member_mobile:"",distributor_id:"",enterprise_id:[]},enterpriseList:[],setting:(0,i.createSetting)({actions:[{name:$t("mekb2","编辑","lang"),key:"edit",type:"button",buttonType:"text",visible:e=>!(this.IS_ADMIN()&&"0"!=e.distributor_id),action:{handler:async([e])=>{Object.keys(this.employeeForm).forEach(t=>this.employeeForm[t]=e[t]),this.addDialog=!0}}},{name:$t("eslg2","删除","lang"),key:"delete",type:"button",buttonType:"text",visible:e=>!(this.IS_ADMIN()&&"0"!=e.distributor_id),action:{handler:async([e])=>{await this.$confirm(`${$t("k2leky7","确认是否删除？","lang")}`,$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang")}),await this.$api.member.deleteEmployee(e.id),this.$refs.finder.refresh()}}}],columns:[{name:$t("ewbd43","手机号","lang"),key:"mobile"},{name:$t("fqmy2","姓名","lang"),key:"name"},{name:$t("fcjfai4","登录类型","lang"),key:"auth_type",formatter:(e,{auth_type:t},a)=>{const i=r.h.find(e=>e.value==t)?.name;return i}},{name:$t("ogwh2","账号","lang"),key:"account"},{name:$t("g9ob2","密码","lang"),key:"auth_code"},{name:$t("padf2","邮箱","lang"),key:"email"},{name:$t("di507i4","来源店铺","lang"),key:"distributor_name"},{name:$t("aa61as4","企业ID","lang"),key:"enterprise_id"},{name:$t("aaky9o4","企业名称","lang"),key:"enterprise_name"},{name:$t("aas9es4","企业编码","lang"),key:"enterprise_sn"},{name:$t("ytf6465","会员手机号","lang"),key:"member_mobile"}]}),addDialog:!1,companyList:[],addDialogLoading:!1,employeeForm:{id:"",enterprise_id:"",name:"",mobile:"",account:"",auth_code:"",email:""},employeeFormList:[{label:$t("ikvqd54","选择企业","lang"),key:"enterprise_id",component:()=>e("el-select",{directives:[{name:"scroll",value:()=>this.pages.nextPage()}],attrs:{filterable:!0},model:{value:this.employeeForm.enterprise_id,callback:e=>{this.$set(this.employeeForm,"enterprise_id",e)}}},[this.companyList.map((t,a)=>e("el-option",{key:`company-item__${a}`,attrs:{label:t.name,value:t.id}}))]),validator:(e,t,a)=>{t?a():a($t("2eokls5","请选择企业","lang"))}},{label:$t("fqmy2","姓名","lang"),key:"name",type:"input",required:!0,message:$t("adohlc4","不能为空","lang")},{label:$t("ewbd43","手机号","lang"),key:"mobile",type:"input",isShow:()=>"mobile"==this.authType||"qr_code"==this.authType,validator:(e,t,a)=>{"mobile"==this.authType||"qr_code"==this.authType?t?a():a($t("adohlc4","不能为空","lang")):a()}},{label:$t("ogwh2","账号","lang"),key:"account",type:"input",isShow:()=>"account"==this.authType,validator:(e,t,a)=>{"account"==this.authType?t?a():a($t("adohlc4","不能为空","lang")):a()}},{label:$t("g9ob2","密码","lang"),key:"auth_code",type:"input",isShow:()=>"account"==this.authType,validator:(e,t,a)=>{"account"==this.authType?t?a():a($t("adohlc4","不能为空","lang")):a()}},{label:$t("padf2","邮箱","lang"),key:"email",type:"input",isShow:()=>"email"==this.authType,validator:(e,t,a)=>{"email"==this.authType?t?a():a($t("adohlc4","不能为空","lang")):a()}}]}},computed:{authType(){const{auth_type:e}=this.companyList.find(e=>e.id==this.employeeForm.enterprise_id)||{};return e}},created(){this.pages=new o.A({fetch:this.getCompanyList}).nextPage(),this.pagesQuery=new o.A({fetch:this.getEnterpriseList}).nextPage(),this.$route.query.company_id&&(this.queryForm.enterprise_id=[this.$route.query.company_id])},methods:{beforeSearch(e){return{...e,...this.queryForm}},onSearch(){this.$refs.finder.refresh()},async handleExport(){let e={page:1,pageSize:20,...this.queryForm},t=await this.$api.member.exportEmployees(e);if(t.status)return this.$message({type:"success",message:$t("xdh90kk","已加入执行队列，请在设置-导出列表中下载","lang")}),void this.$export_open("employee_purchase_employees");t.url?(this.downloadUrl=t.url,this.downloadName=t.filename,this.downloadView=!0):this.$message({type:"error",message:$t("d17rj2j","无内容可导出 或 执行失败，请检查重试","lang")})},handleImportEmployee(){this.$router.push({path:this.matchRoutePath("import")})},addEmployee(){this.employeeForm=this.$options.data().employeeForm,this.addDialog=!0},async onEmployeeFormSubmit(){let e=JSON.parse(JSON.stringify(this.employeeForm));this.addDialogLoading=!0;try{e.id?await this.$api.member.updateEmployee(e.id,e):await this.$api.member.addEmployee(e),this.addDialog=!1,this.addDialogLoading=!1,this.$refs.finder.refresh()}catch(e){this.addDialogLoading=!1}},async getCompanyList({page:e,pageSize:t}){const a={page:e,pageSize:t,is_employee_check_enabled:"true"};this.IS_ADMIN()&&(a.distributor_id=0);const{list:i,total_count:o}=await this.$api.member.getPurchaseCompanyList(a);this.pages.setTotal(o),this.companyList=this.companyList.concat(i)},async getEnterpriseList({page:e,pageSize:t}){const{list:a,total_count:i}=await this.$api.member.getPurchaseCompanyList({page:e,pageSize:t});this.pagesQuery.setTotal(i),this.enterpriseList=this.enterpriseList.concat(a)}}},n=(0,a(81656).A)(l,function(){var e=this,t=e._self._c;return t("SpPage",[t("SpRouterView",[t("SpFilterForm",{attrs:{model:e.queryForm},on:{onSearch:e.onSearch,onReset:e.onSearch}},[t("SpFilterFormItem",{attrs:{prop:"mobile",label:$t("cttsc24","手机号:","lang")}},[t("el-input",{attrs:{placeholder:$t("kp8kv27","请输入手机号码","lang")},model:{value:e.queryForm.mobile,callback:function(t){e.$set(e.queryForm,"mobile",t)},expression:"queryForm.mobile"}})],1),t("SpFilterFormItem",{attrs:{prop:"account",label:$t("l2k093","账号:","lang")}},[t("el-input",{attrs:{placeholder:$t("2j1oau5","请输入账号","lang")},model:{value:e.queryForm.account,callback:function(t){e.$set(e.queryForm,"account",t)},expression:"queryForm.account"}})],1),t("SpFilterFormItem",{attrs:{prop:"email",label:$t("lrxlj3","邮箱:","lang")}},[t("el-input",{attrs:{placeholder:$t("2j0utw5","请输入邮箱","lang")},model:{value:e.queryForm.email,callback:function(t){e.$set(e.queryForm,"email",t)},expression:"queryForm.email"}})],1),t("SpFilterFormItem",{attrs:{prop:"member_mobile",label:$t("dvdfww6","会员手机号:","lang")}},[t("el-input",{attrs:{placeholder:$t("8sc3278","请输入会员手机号","lang")},model:{value:e.queryForm.member_mobile,callback:function(t){e.$set(e.queryForm,"member_mobile",t)},expression:"queryForm.member_mobile"}})],1),t("SpFilterFormItem",{attrs:{prop:"enterprise_id",label:$t("bxvdt3","企业:","lang"),size:"max"}},[t("el-select",{directives:[{name:"scroll",rawName:"v-scroll",value:()=>e.pagesQuery.nextPage(),expression:"() => pagesQuery.nextPage()"}],attrs:{multiple:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:e.queryForm.enterprise_id,callback:function(t){e.$set(e.queryForm,"enterprise_id",t)},expression:"queryForm.enterprise_id"}},e._l(e.enterpriseList,function(e,a){return t("el-option",{key:`enterprise-item__${a}`,attrs:{label:e.name,value:e.id}})}),1)],1),t("SpFilterFormItem",{attrs:{prop:"distributor_id",label:$t("7kd5ck5","来源店铺:","lang")}},[t("SpSelectShop",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:e.queryForm.distributor_id,callback:function(t){e.$set(e.queryForm,"distributor_id",t)},expression:"queryForm.distributor_id"}})],1)],1),t("div",{staticClass:"action-container"},[t("el-button",{attrs:{type:"primary",icon:"iconfont icon-xinzengcaozuo-01"},on:{click:e.addEmployee}},[e._v($t("trhr726"," 添加员工 ","lang"))]),t("el-button",{attrs:{type:"primary",icon:"iconfont icon-daorucaozuo-01"},on:{click:e.handleImportEmployee}},[e._v($t("u9wioa6"," 导入员工 ","lang"))]),t("el-button",{attrs:{type:"primary",plain:""},on:{click:e.handleExport}},[e._v($t("efepu4"," 导出 ","lang"))])],1),t("SpFinder",{ref:"finder",attrs:{"no-selection":"",setting:e.setting,"row-actions-align":"left",hooks:{beforeSearch:e.beforeSearch},url:"/employees"}}),t("SpDialog",{ref:"addDialogRef",attrs:{title:e.employeeForm.id?$t("gmhn2g4","编辑员工","lang"):$t("e7w76a4","添加员工","lang"),modal:!1,form:e.employeeForm,"form-list":e.employeeFormList,"confirm-status":e.addDialogLoading},on:{onSubmit:e.onEmployeeFormSubmit},model:{value:e.addDialog,callback:function(t){e.addDialog=t},expression:"addDialog"}})],1)],1)},[],!1,null,null,null).exports}}]);