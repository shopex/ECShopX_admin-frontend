"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[4158],{14158:function(e,t,s){s.r(t),s.d(t,{default:function(){return o}});s(44114),s(18111),s(7588),s(57270);var a=s(77825),l=s(81193),i={mixins:[a.v8],data(){return{menu:[],defaultProps:{children:"children",label:"name"},isEdit:!1,editRoleVisible:!1,editRoleTitle:"",form:{role_name:"",role_id:"",permission:[]},defaultCheckedKeys:[],rolesList:[],loading:!1,total_count:0,params:{role_name:""}}},mounted(){this.fetchList();const e=this.$store.state.user.accessMenus;this.menu=e},methods:{handleCancel(){this.editRoleVisible=!1,this.$refs.tree.setCheckedKeys([])},addRoleLabels(){this.editRoleTitle=$t("hxff1h4","角色添加","lang"),this.editRoleVisible=!0,this.isEdit=!1,this.form.role_name="",this.form.role_id="",this.form.permission=[],this.$refs.tree?this.$refs.tree.setCheckedKeys([]):this.defaultCheckedKeys=[]},editRoleAction(e,t){this.editRoleTitle=$t("hxintn4","角色编辑","lang"),this.editRoleVisible=!0,this.isEdit=!0,this.form.role_name=t.role_name,this.form.role_id=t.role_id,this.$refs.tree?this.$refs.tree.setCheckedKeys(t.permission.shopmenu_alias_name):this.defaultCheckedKeys=t.permission.shopmenu_alias_name},submitRoleAction(){var e=this.$refs.tree.getCheckedNodes(),t=[];e.forEach(e=>{e.isChildrenMenu||t.push(e.alias_name)});var s=this.$store.getters.menus&&this.$store.getters.menus[0]?.version;this.form.permission={shopmenu_alias_name:t,version:s},this.form.role_id?(0,l.updateRolesInfo)(this.form.role_id,this.form).then(e=>{this.editRoleVisible=!1,this.fetchList(),this.handleCancel()}):(0,l.createRoles)(this.form).then(e=>{this.editRoleVisible=!1,this.fetchList(),this.handleCancel()})},fetchList(){this.loading=!0,this.params.service_type="timescard";const{pageIndex:e,pageSize:t}=this.page;let s={page:e,pageSize:t,...this.params};(0,l.getRolesList)(s).then(e=>{this.rolesList=e.data.data.list,this.total_count=e.data.data.total_count,this.loading=!1}).catch(e=>{this.loading=!1,this.$message({type:"error",message:$t("o3tx49b","页面已过期，请刷新重试","lang")})})},deleteRoleAction(e,t){this.$confirm($t("sq2zc0g","此操作将删除该角色, 是否继续?","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(()=>{(0,l.deleteRole)(t.role_id).then(t=>{this.rolesList.splice(e,1),this.$message({message:$t("azeh8z4","删除成功","lang"),type:"success",duration:5e3})})}).catch(()=>{this.$message({type:"info",message:$t("e68dg3","已取消","lang")})})}}},n=(0,s(81656).A)(i,function(){var e=this,t=e._self._c;return t("SpPage",[t("SpFilterForm",{attrs:{model:e.params},on:{onSearch:e.onSearch,onReset:e.onSearch}},[t("SpFilterFormItem",{attrs:{prop:"role_name",label:$t("ck8ix55","角色名称:","lang")}},[t("el-input",{attrs:{placeholder:$t("flrstw7","请输入角色名称","lang")},model:{value:e.params.role_name,callback:function(t){e.$set(e.params,"role_name",t)},expression:"params.role_name"}})],1)],1),t("div",{staticClass:"action-container"},[t("el-button",{attrs:{type:"primary",icon:"plus"},on:{click:e.addRoleLabels}},[e._v($t("tzhybf6"," 添加角色 ","lang"))])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"",data:e.rolesList}},[t("el-table-column",{attrs:{prop:"role_name",label:$t("hxb80z4","角色名称","lang")}}),t("el-table-column",{attrs:{prop:"permission",label:$t("hxen9p4","角色权限","lang")},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tree",{attrs:{data:s.row.permission_tree,props:e.defaultProps}})]}}])}),t("el-table-column",{attrs:{label:$t("hkxb2","操作","lang")},scopedSlots:e._u([{key:"default",fn:function(s){return[t("div",{staticClass:"operating-icons"},[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.editRoleAction(s.$index,s.row)}}},[e._v($t("mekb2","编辑","lang"))]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.deleteRoleAction(s.$index,s.row)}}},[e._v($t("db22k4"," 删除 ","lang"))])],1)]}}])})],1),t("div",{staticClass:"content-center content-top-padded"},[t("el-pagination",{attrs:{layout:"prev, pager, next","current-page":e.page.pageIndex,total:e.total_count,"page-size":e.page.pageSize},on:{"update:currentPage":function(t){return e.$set(e.page,"pageIndex",t)},"update:current-page":function(t){return e.$set(e.page,"pageIndex",t)},"current-change":e.onCurrentChange}})],1),t("el-dialog",{attrs:{title:e.editRoleTitle,visible:e.editRoleVisible,"before-close":e.handleCancel},on:{"update:visible":function(t){e.editRoleVisible=t}}},[[t("el-form",{ref:"form",staticClass:"demo-ruleForm",attrs:{model:e.form,"label-width":"90px"}},[t("el-form-item",{attrs:{label:$t("hxb80z4","角色名称","lang")}},[t("el-col",{attrs:{span:14}},[t("el-input",{attrs:{maxlength:20,placeholder:$t("5lqo0me","订单管理员、商品管理员、等等","lang")},model:{value:e.form.role_name,callback:function(t){e.$set(e.form,"role_name",t)},expression:"form.role_name"}})],1)],1),t("el-form-item",{attrs:{label:$t("hxen9p4","角色权限","lang")}},[t("el-tree",{ref:"tree",attrs:{data:e.menu,"default-checked-keys":e.defaultCheckedKeys,"node-key":"alias_name",props:e.defaultProps,"show-checkbox":""}})],1)],1)],t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{nativeOn:{click:function(t){return e.handleCancel.apply(null,arguments)}}},[e._v($t("dd4ni4"," 取消 ","lang"))]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitRoleAction}},[e._v($t("cp35x4"," 保存 ","lang"))])],1)],2)],1)},[],!1,null,null,null),o=n.exports}}]);