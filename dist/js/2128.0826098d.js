"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[2128],{42128:function(t,i,e){e.r(i),e.d(i,{default:function(){return o}});e(18111),e(20116),e(61701),e(44114);var s=e(95353),a=(e(27810),e(15530),e(25159),e(77825)),l=(e(59025),e(78069)),r=(e(26456),{mixins:[a.Ay,a.v8],data(){const t=this.$createElement;return{tableList:null,loading:!1,params:{...{username:void 0,distributor_id:void 0,mobile:void 0}},dialogTitle:"",editType:"",whitelistDialog:!1,whitelistForm:{id:null,distributors:[],username:"",mobile:""},whitelistFormList:[{label:$t("ewbd43","手机号","lang"),key:"mobile",type:"input",message:$t("7ji3y96","请输入手机号","lang"),isShow:()=>"delAll"!==this.editType,validator:(t,i,e)=>{const{mobile:s}=this.whitelistForm;"delAll"!==this.editType?s?(0,l.Fr)(s)?e():e(new Error($t("srjmr37","手机号格式错误","lang"))):e(new Error($t("vxswh47","手机号不能为空","lang"))):e()}},{label:$t("fqmy2","姓名","lang"),key:"username",type:"input",message:$t("7f02ae6","请输入联系人","lang"),isShow:()=>"delAll"!==this.editType,validator:(t,i,e)=>{const{username:s}=this.whitelistForm;"delAll"!==this.editType?s?e():e(new Error($t("fvkkcj7","联系人不能为空","lang"))):e()}},{label:$t("ikyrsz4","选择店铺","lang"),key:"num",isShow:()=>"edit"!==this.editType||!this.IS_DISTRIBUTOR(),component:()=>t("div",{class:"distributor-tags"},[this.whitelistForm.distributors.map((i,e)=>t("el-tag",{key:i.name,attrs:{closable:!0},on:{close:this.storeClose.bind(this,e)}},[i.name])),t("el-button",{attrs:{type:"text"},on:{click:this.addStoreAction}},[$t("yfpdbi6","添加适用店铺","lang")])]),validator:(t,i,e)=>{const{distributors:s}=this.whitelistForm;0==s.length?e(new Error($t("2elj5y5","请选择店铺","lang"))):e()}}],selectMobile:""}},computed:{...(0,s.L8)(["shopId"])},mounted(){this.fetchList()},methods:{async handleWhitelistExport(){if(this.selectMobile.length){const t={search_mobile:this.selectMobile,...this.getParams()},{status:i}=await this.$api.company.whitelistExport(t);i?(this.$message.success($t("xdh90kk","已加入执行队列，请在设置-导出列表中下载","lang")),this.$export_open("distributor_white_list")):this.$message.error($t("by46j64","导出失败","lang"))}else this.$message({type:"warning",message:$t("mbrdmca","请选择需要导出的数据","lang")})},clickAddWhiteList(){this.whitelistForm.id=void 0,this.whitelistForm.distributors=[],this.whitelistForm.username="",this.whitelistForm.mobile="",this.editType="add",this.dialogTitle=$t("er0oao5","添加白名单","lang"),this.whitelistDialog=!0},async addStoreAction(){const t=this.whitelistForm.distributors.map(t=>t.distributor_id),{data:i}=await this.$picker.shop({data:t});this.whitelistForm.distributors=JSON.parse(JSON.stringify(i))},storeClose(t){this.whitelistForm.distributors.splice(t,1)},async addWhitelistFormSubmit(){const{distributors:t,username:i,mobile:e,id:s}=this.whitelistForm;let a={id:s,distributor_id:t.map(t=>t.distributor_id),username:i,mobile:e};const{status:l}=await this.$api.company.saveShopWhiteList(a);l?this.$message.success($t("e7ygyc4","添加成功","lang")):this.$message.error($t("e7xa6x4","添加失败","lang")),this.whitelistForm={id:null,distributors:[],username:"",mobile:""},this.whitelistDialog=!1,this.fetchList()},async onWhitelistFormSubmit(){"delAll"===this.editType?this.delWhitelist():this.addWhitelistFormSubmit()},uploadHandleChange(t,i){this.$router.push({path:this.matchRoutePath("storewhitelistUpload")})},editShopWhite(t){const{distributor_info:i,mobile:e,username:s,id:a}=t,l=i.map(t=>({distributor_id:t.distributor_id,name:t.name}));this.whitelistForm={id:a,distributors:l,username:s,mobile:e},this.dialogTitle=$t("iadb0q5","编辑白名单","lang"),this.editType="edit",this.whitelistDialog=!0},async delWhitelist(t){const i="delAll"===this.editType?"distributor":"id",e=this.whitelistForm.distributors.map(t=>t.distributor_id),s={type:i,id:"delAll"===this.editType?e:[t.id],login_type:this.IS_DISTRIBUTOR()?"distributor":""},{status:a}=await this.$api.company.delShopWhite(s);a?this.$message.success($t("azeh8z4","删除成功","lang")):this.$message.error($t("azdahk4","删除失败","lang")),this.whitelistDialog=!1,this.fetchList()},async clickDelAllWhiteList(){this.dialogTitle=$t("v0wrnx7","清空店铺白名单","lang"),this.editType="delAll",this.whitelistDialog=!0,this.whitelistForm.distributors=[]},onSearch(){this.page.pageIndex=1,this.$nextTick(()=>{this.fetchList()})},onReset(){this.params={...this.initialParams},this.onSearch()},getParams(){return{...this.params}},async fetchList(){this.loading=!0;const{pageIndex:t,pageSize:i}=this.page;let e={page:t,pageSize:i,...this.getParams()};e.distributor_id&&!Array.isArray(e.distributor_id)&&(e.distributor_id=[e.distributor_id]);const{list:s,total_count:a}=await this.$api.company.getShopWhiteList(e);this.tableList=s,this.page.total=a,this.loading=!1},handleSelectionChange(t){let i=[];for(let e in t)i.push(t[e].mobile);this.selectMobile=i}},beforeRouteUpdate(t,i,e){e(),-1===t.path.indexOf("editor")&&-1===t.path.indexOf("details")&&this.fetchList()}}),o=(0,e(81656).A)(r,function(){var t=this,i=t._self._c;return i("SpPage",{staticClass:"store-wihitelist"},[i("SpRouterView",[i("SpFilterForm",{attrs:{model:t.params},on:{onSearch:t.onSearch,onReset:t.onReset}},[i("SpFilterFormItem",{attrs:{prop:"mobile",label:$t("cttsc24","手机号:","lang")}},[i("el-input",{attrs:{placeholder:$t("7ji3y96","请输入手机号","lang")},model:{value:t.params.mobile,callback:function(i){t.$set(t.params,"mobile",i)},expression:"params.mobile"}})],1),i("SpFilterFormItem",{attrs:{prop:"username",label:$t("djxsw3","姓名:","lang")}},[i("el-input",{attrs:{placeholder:$t("2jaekd5","请输入姓名","lang")},model:{value:t.params.username,callback:function(i){t.$set(t.params,"username",i)},expression:"params.username"}})],1),i("SpFilterFormItem",{attrs:{prop:"distributor_id",label:$t("ek40n3","店铺:","lang")}},[i("SpSelectShop",{attrs:{multiple:"",clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:t.params.distributor_id,callback:function(i){t.$set(t.params,"distributor_id",i)},expression:"params.distributor_id"}})],1)],1),i("div",{staticClass:"action-container"},[i("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus"},on:{click:function(i){return t.clickAddWhiteList()}}},[t._v($t("3jtao07"," 添加白名单 ","lang"))]),i("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus"},on:{click:function(i){return t.uploadHandleChange()}}},[t._v($t("jeiyhw7"," 导入白名单 ","lang"))]),i("el-button",{attrs:{type:"primary"},on:{click:t.handleWhitelistExport}},[t._v($t("efepu4"," 导出 ","lang"))]),i("el-button",{attrs:{type:"primary",icon:"el-icon-delete",plain:""},on:{click:function(i){return t.clickDelAllWhiteList()}}},[t._v($t("m1ig5s7"," 清空白名单 ","lang"))])],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.tableList,border:""},on:{"selection-change":t.handleSelectionChange}},[i("el-table-column",{attrs:{label:$t("hkxb2","操作","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"text"},on:{click:function(i){return t.editShopWhite(e.row)}}},[t._v($t("juz394"," 编辑 ","lang"))]),i("el-button",{attrs:{type:"text"},on:{click:function(i){return t.delWhitelist(e.row)}}},[t._v($t("db22k4"," 删除 ","lang"))])]}}])}),i("el-table-column",{attrs:{type:"selection",align:"center",label:$t("emxt2","全选","lang")}}),i("el-table-column",{attrs:{prop:"mobile",label:$t("ewbd43","手机号","lang")}}),i("el-table-column",{attrs:{prop:"username",label:$t("fqmy2","姓名","lang")}}),i("el-table-column",{attrs:{prop:"distributor_info",label:$t("cs44ip4","所属店铺","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[t.IS_DISTRIBUTOR()?i("span",[t._v(t._s(e.row.distributor_info.find(i=>i.distributor_id===t.shopId)?.name))]):i("span",[t._v(t._s(e.row.distributor_info.map(t=>t.name).join(",")))])]}}])}),i("el-table-column",{attrs:{prop:"distributor_info",label:$t("ekkk43","店铺号","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[t.IS_DISTRIBUTOR()?i("span",[t._v(t._s(e.row.distributor_info.find(i=>i.distributor_id===t.shopId)?.shop_code))]):i("span",[t._v(t._s(e.row.distributor_info.map(t=>t.shop_code).join(",")))])]}}])})],1),i("div",{staticClass:"mt-4 text-right"},[i("el-pagination",{attrs:{background:"","current-page":t.page.pageIndex,"page-sizes":[10,20,50,100],"page-size":t.page.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.page.total},on:{"update:currentPage":function(i){return t.$set(t.page,"pageIndex",i)},"update:current-page":function(i){return t.$set(t.page,"pageIndex",i)},"current-change":t.onCurrentChange,"size-change":t.onSizeChange}})],1),i("SpDialog",{ref:"whitelistDialogRef",attrs:{title:t.dialogTitle,modal:!1,form:t.whitelistForm,"form-list":t.whitelistFormList},on:{onSubmit:t.onWhitelistFormSubmit},model:{value:t.whitelistDialog,callback:function(i){t.whitelistDialog=i},expression:"whitelistDialog"}})],1)],1)},[],!1,null,"281f8827",null).exports}}]);