"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[3098],{30717:function(e,t,a){a.r(t),a.d(t,{default:function(){return m}});a(44114),a(18111),a(7588);var i=a(5134),l=(a(87378),a(43224)),r=a(98818),n=a(65124),o=a(99502),s={inject:["refresh"],components:{imgBox:l.A,StoreSelect:o.default},data(){return{pickerOptions2:{shortcuts:[{text:$t("dl4oop4","最近一周","lang"),onClick(e){const t=new Date;t.setHours(23,59,59,0);const a=new Date;a.setHours(0,0,0,0),t.setTime(t.getTime()+6048e5),e.$emit("pick",[a,t])}},{text:$t("4znkgj5","最近一个月","lang"),onClick(e){const t=new Date;t.setHours(23,59,59,0);const a=new Date;a.setHours(0,0,0,0),t.setTime(t.getTime()+2592e6),e.$emit("pick",[a,t])}},{text:$t("4zndsa5","最近三个月","lang"),onClick(e){const t=new Date;t.setHours(23,59,59,0);const a=new Date;a.setHours(0,0,0,0),t.setTime(t.getTime()+7776e6),e.$emit("pick",[a,t])}}]},used_scene:{1:$t("hypfnl4","订单抵扣","lang")},level:0,levelData:[],monthOptions:[],weekOptions:[],dayOptions:[],memberDay:{month:"",week:"",day:"",begin_time:"",end_time:"",date:[]},submitLoading:!1,condition:"",vipGrade:[],memberGrade:[],form:{activity_id:"",title:"",trigger_condition:[],begin_time:"",end_time:"",is_forever:!1,condition_value:"",valid_grade:[],trigger_amount:"",shop_ids:[],condition_type:"multiple",use_shop:"0"},activity_date:"",imgDialog:!1,condition_type:"multiple",has_trigger_amount:"0",use_shop:"0",relStores:[],is_distributor:!1,setStatus:!1,storeVisible:!1,hasSaveButton:!0}},watch:{relStores(e){}},mounted(){function e(e){var t="";switch(e){case 1:t=$t("feo1","一","lang");break;case 2:t=$t("fik1","二","lang");break;case 3:t=$t("fex1","三","lang");break;case 4:t=$t("h5n1","四","lang");break;case 5:t=$t("fis1","五","lang");break;case 6:t=$t("g311","六","lang");break;case 7:t=$t("k4l1","日","lang")}return t}for(var t=[],a=[],i=[],l=0;l<12;l++){let e={};e.value=l+1,e.label=e.value+$t("kco1","月","lang"),t.push(e)}for(l=0;l<7;l++){let t={};t.value=l+1,t.label=$t("hxpc2","星期","lang")+e(t.value),a.push(t)}for(l=0;l<31;l++){let e={};e.value=l+1,e.label=e.value+$t("k4l1","日","lang"),i.push(e)}this.monthOptions=t,this.weekOptions=a,this.dayOptions=i,(0,r.listVipGrade)().then(e=>{null!=e&&e.data.data&&e.data.data.length>0&&(this.vipGrade=e.data.data)}),(0,n.getGradeList)().then(e=>{if(null!=e&&e.data.data&&e.data.data.length>0){var t=e.data.data;t&&(this.memberGrade=t)}}),this.$route.params.id&&this.getActivityDetail(this.$route.params.id),this.$route.query.isnodata&&(this.hasSaveButton=!1)},methods:{dateChange(e){this.memberDay.date=e},submitActivityAction(){const e=this;let t="",a="";this.memberDay.date.length>0&&(t=this.memberDay.date[0],a=this.memberDay.date[1]);let l={type:this.condition,month:this.memberDay.month,week:this.memberDay.week,day:this.memberDay.day,begin_time:t,end_time:a};this.form.trigger_condition={trigger_time:l},this.activity_date.length>0&&(this.form.begin_time=this.activity_date[0],this.form.end_time=this.activity_date[1]),this.form.shop_ids=[],"1"==this.form.use_shop&&this.relStores&&this.relStores.length>0&&this.relStores.forEach(e=>{this.form.shop_ids.push(e.distributor_id)}),"0"==this.has_trigger_amount&&(this.form.trigger_amount=0);let r=JSON.stringify(this.form);r=JSON.parse(r),r.items=JSON.stringify(r.items),r.item_category=JSON.stringify(r.item_category),this.form.activity_id?(0,i.updateExtrapoint)(r).then(t=>{if(!t.data.data.activity_id)return this.$message.error($t("uzl20e5","保存失败!","lang")),!1;this.loading=!1,this.$message({message:$t("deua4r4","更新成功","lang"),type:"success",duration:2e3,onClose(){e.refresh(),e.$router.push({path:"/marketing/member/extrapoint"})}})}):(0,i.createExtrapoint)(r).then(t=>{if(!t.data.data.activity_id)return this.$message.error($t("uzl20e5","保存失败!","lang")),!1;this.loading=!1,this.$message({message:$t("e7ygyc4","添加成功","lang"),type:"success",duration:2e3,onClose(){e.refresh(),e.$router.push({path:"/marketing/member/extrapoint"})}})})},getTaskTime(e){let t=new Date(e),a=t.getFullYear(),i=t.getMonth()+1;i=i<10?"0"+i:i;let l=t.getDate();return l=l<10?"0"+l:l,a+"-"+i+"-"+l},getActivityDetail(e){(0,i.getExtrapointInfo)(e).then(e=>{let t=e.data.data,a={activity_id:t.activity_id,title:t.title,trigger_condition:t.trigger_condition,begin_time:t.begin_time,end_time:t.end_time,upvaluation:t.upvaluation,max_up_point:t.max_up_point,valid_grade:t.valid_grade,used_scene:t.used_scene,is_forever:t.is_forever,condition_value:t.condition_value,trigger_amount:t.trigger_condition.trigger_amount,use_shop:t.use_shop};void 0===t.trigger_condition.trigger_amount?this.has_trigger_amount="0":this.has_trigger_amount="1",Object.assign(this.form,a);const i=t.trigger_condition.trigger_time;this.activity_date=[t.begin_time,t.end_time],this.condition=i.type,this.memberDay.day=Number(i.day||1),this.memberDay.month=Number(i.month||1),this.memberDay.week=Number(i.week||1),this.memberDay.date=[i.begin_time||"",i.end_time||""],this.relStores=t.storeLists||[]})},formatDate(e,t){const a=Number(t)||1,i=[$t("feo1","一","lang"),$t("fik1","二","lang"),$t("fex1","三","lang"),$t("h5n1","四","lang"),$t("fis1","五","lang"),$t("g311","六","lang"),$t("k4l1","日","lang")];return{week:`${$t("hxpc2","星期","lang")}${i[a-1]}`,month:`${a}${$t("kco1","月","lang")}`,day:`${a}${$t("k4l1","日","lang")}`}[e]},handleCancel:function(){this.$router.go(-1)},relStoresClick(){this.storeVisible=!0,this.setStatus=!0},chooseStoreAction(e){this.storeVisible=!1,this.form.shop_ids=[],null===e||e.length<=0||(this.relStores=e)},closeStoreDialogAction(){this.storeVisible=!1},deleteStoreRow(e){this.setStatus=!1,this.relStores.splice(e,1)}}},d=(0,a(81656).A)(s,function(){var e=this,t=e._self._c;return t("SpPage",[t("el-form",{ref:"form",staticClass:"box-set",attrs:{model:e.form,"label-width":"120px"}},[t("el-card",{attrs:{header:$t("t6wv6l8","指定日期额外积分","lang"),shadow:"naver"}},[t("el-form-item",{attrs:{label:$t("e4hvdc4","活动名称","lang"),prop:"title",rules:{required:!0,message:$t("750pjq6","活动名称必填","lang"),trigger:"blur"}}},[t("el-col",{attrs:{span:8}},[t("el-input",{attrs:{disabled:!e.hasSaveButton,maxlength:30,placeholder:$t("jel5hj7","请输入活动名称","lang")},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1)],1),t("el-form-item",{attrs:{label:$t("e4l2kr4","活动时间","lang")}},[t("el-date-picker",{attrs:{type:"datetimerange",align:"right","value-format":"yyyy-MM-dd HH:mm:ss","unlink-panels":"","range-separator":$t("po31","至","lang"),"start-placeholder":$t("cd0ag54","开始日期","lang"),"end-placeholder":$t("gfhy2u4","结束日期","lang"),disabled:!(e.hasSaveButton&&!e.form.is_forever),"default-time":["00:00:00","23:59:59"],"picker-options":e.pickerOptions2},model:{value:e.activity_date,callback:function(t){e.activity_date=t},expression:"activity_date"}}),e._v("     "),t("el-checkbox",{model:{value:e.form.is_forever,callback:function(t){e.$set(e.form,"is_forever",t)},expression:"form.is_forever"}},[e._v($t("q5tipr6"," 长期有效 ","lang"))])],1),t("el-form-item",{attrs:{label:$t("hwbe2","日期","lang")}},[t("el-radio-group",{attrs:{disabled:!e.hasSaveButton},model:{value:e.condition,callback:function(t){e.condition=t},expression:"condition"}},[t("el-radio",{attrs:{label:"every_year"}},[e._v($t("gsyzf4"," 每年 ","lang"))]),t("el-radio",{attrs:{label:"every_month"}},[e._v($t("gufif4"," 每月 ","lang"))]),t("el-radio",{attrs:{label:"every_week"}},[e._v($t("gr9gn4"," 每周 ","lang"))]),t("el-radio",{attrs:{label:"date"}},[e._v($t("buvwml6"," 指定日期 ","lang"))])],1),t("transition",{attrs:{name:"el-fade-in-linear"}},["every_year"===e.condition?t("div",[t("el-select",{attrs:{placeholder:$t("2ekhas5","请选择月份","lang")},model:{value:e.memberDay.month,callback:function(t){e.$set(e.memberDay,"month",t)},expression:"memberDay.month"}},e._l(e.monthOptions,function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),t("el-select",{attrs:{placeholder:$t("2ekjhr5","请选择日期","lang")},model:{value:e.memberDay.day,callback:function(t){e.$set(e.memberDay,"day",t)},expression:"memberDay.day"}},e._l(e.dayOptions,function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e(),"every_month"===e.condition?t("div",[t("el-select",{attrs:{placeholder:$t("2ekjhr5","请选择日期","lang")},model:{value:e.memberDay.day,callback:function(t){e.$set(e.memberDay,"day",t)},expression:"memberDay.day"}},e._l(e.dayOptions,function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e(),"every_week"===e.condition?t("div",[t("el-select",{attrs:{placeholder:$t("2eki3t5","请选择星期","lang")},model:{value:e.memberDay.week,callback:function(t){e.$set(e.memberDay,"week",t)},expression:"memberDay.week"}},e._l(e.weekOptions,function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e(),"date"===e.condition?t("div",{staticStyle:{width:"350px"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":$t("po31","至","lang"),"start-placeholder":$t("cd0ag54","开始日期","lang"),"end-placeholder":$t("gfhy2u4","结束日期","lang"),"value-format":"yyyy-MM-dd"},on:{change:e.dateChange},model:{value:e.memberDay.date,callback:function(t){e.$set(e.memberDay,"date",t)},expression:"memberDay.date"}})],1):e._e()])],1),t("el-form-item",{attrs:{label:$t("fq281m4","积分倍数","lang"),prop:"condition_value",rules:{required:!0,message:$t("nbg9426","升值倍数必填","lang"),trigger:"blur"}}},[e._v($t("onw5arj"," 活动期内，到账积分为获得基础积分的 ","lang")),t("el-input",{staticStyle:{width:"150px"},attrs:{type:"number",maxlength:30,placeholder:$t("mot2m77","请输入升值倍数","lang"),min:1,disabled:!e.hasSaveButton},model:{value:e.form.condition_value,callback:function(t){e.$set(e.form,"condition_value",t)},expression:"form.condition_value"}}),e._v($t("e9xv3"," 倍 ","lang"))],1),t("el-form-item",{attrs:{label:$t("lnjk2","类型","lang")}},[t("el-radio-group",{model:{value:e.condition_type,callback:function(t){e.condition_type=t},expression:"condition_type"}},[t("el-radio",{attrs:{label:"multiple"}},[e._v($t("crskd4"," 倍数 ","lang"))])],1)],1),t("el-form-item",{attrs:{label:$t("ekppnr4","满足条件","lang")}},[t("el-radio-group",{attrs:{disabled:!e.hasSaveButton},model:{value:e.has_trigger_amount,callback:function(t){e.has_trigger_amount=t},expression:"has_trigger_amount"}},[t("el-radio",{attrs:{label:"1"}},[e._v($t("i1gx3"," 是 ","lang"))]),t("el-radio",{attrs:{label:"0"}},[e._v($t("ez163"," 否 ","lang"))])],1),"1"==e.has_trigger_amount?t("p",{staticClass:"frm-tips"},[e._v($t("ie4boi7"," 订单金额满 ","lang")),t("el-input",{staticStyle:{width:"150px"},attrs:{type:"number",maxlength:30,min:0,disabled:!e.hasSaveButton},model:{value:e.form.trigger_amount,callback:function(t){e.$set(e.form,"trigger_amount",t)},expression:"form.trigger_amount"}}),e._v($t("rbgb12h"," 元时，可享受该活动（不含运费） ","lang"))],1):e._e()],1),t("el-form-item",{attrs:{label:$t("infiw44","适用会员","lang")}},[t("el-checkbox-group",{attrs:{disabled:!e.hasSaveButton},model:{value:e.form.valid_grade,callback:function(t){e.$set(e.form,"valid_grade",t)},expression:"form.valid_grade"}},[e._l(e.memberGrade,function(a){return t("el-checkbox",{key:a.grade_id,attrs:{label:a.grade_id}},[e._v(" "+e._s(a.grade_name)+" ")])}),e._l(e.vipGrade,function(a){return t("el-checkbox",{key:a.lv_type,attrs:{label:a.lv_type}},[e._v($t("euf53"," 付费","lang")+e._s(a.grade_name)+" ")])})],2)],1),t("el-form-item",{attrs:{label:$t("ck0goz4","店铺选择","lang")}},[t("el-radio-group",{attrs:{disabled:!e.hasSaveButton},model:{value:e.form.use_shop,callback:function(t){e.$set(e.form,"use_shop",t)},expression:"form.use_shop"}},[t("el-radio",{attrs:{label:"0"}},[e._v($t("g5xxr7"," 全店铺适用 ","lang"))]),t("el-radio",{attrs:{label:"1"}},[e._v($t("ib1uw48"," 指定店铺适用 ","lang"))])],1),"1"==e.form.use_shop?t("el-card",{attrs:{header:$t("gdpm984","绑定店铺","lang"),shadow:"naver"}},[t("el-button",{attrs:{type:"primary"},on:{click:e.relStoresClick}},[e._v($t("myhesd6"," 选择店铺 ","lang"))]),e.relStores.length>0?t("el-table",{staticStyle:{"line-height":"normal"},attrs:{data:e.relStores}},[t("el-table-column",{attrs:{label:"ID",prop:"distributor_id",width:"60"}}),t("el-table-column",{attrs:{label:$t("eyrn2","名称","lang"),prop:"name"}}),t("el-table-column",{attrs:{prop:"address",label:$t("fb4g2","地址","lang"),"show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),width:"50"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("i",{staticClass:"iconfont icon-trash-alt",on:{click:function(t){return e.deleteStoreRow(a.$index,e.form.items)}}})]}}],null,!1,3604158687)})],1):e._e(),t("StoreSelect",{attrs:{"store-visible":e.storeVisible,"is-valid":!0,"rel-shop-ids":e.relStores,"get-status":e.setStatus},on:{chooseStore:e.chooseStoreAction,closeStoreDialog:e.closeStoreDialogAction}})],1):e._e()],1)],1)],1),t("template",{slot:"page-footer"},[t("div",{staticClass:"text-center"},[t("el-button",{nativeOn:{click:function(t){return e.handleCancel.apply(null,arguments)}}},[e._v($t("m1m0m4"," 返回 ","lang"))]),e.hasSaveButton?t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitActivityAction()}}},[e._v($t("cp35x4"," 保存 ","lang"))]):e._e()],1)])],2)},[],!1,null,null,null),m=d.exports}}]);