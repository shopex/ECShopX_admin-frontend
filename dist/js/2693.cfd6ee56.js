"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[2693],{52693:function(t,e,i){i.r(e),i.d(e,{default:function(){return d}});i(44114),i(18111),i(7588);var s=i(95353),a=i(25159),l=i(5134),n=i(54573),o=i(71196),r=i(77825),c={components:{shopSelect:a.default,sideBar:o.A,GoodsSelect:n.default},mixins:[r.v8],provide(){return{refresh:this.fetchList}},props:["isLoad"],data(){return{editItemSortVisible:!1,itemVisible:!1,itemVisible:!1,setItemStatus:!1,show_sideBar:!1,relItemsIds:[],loading:!1,form:{items:[]},params:{distributor_id:"",is_warning:!1,keywords:""},list:[]}},computed:{...(0,s.L8)(["wheight"])},watch:{isLoad(t){t&&this.fetchList()}},mounted(){this.fetchList()},methods:{getParams(){return{...this.params}},async fetchList(){this.loading=!0;const{pageIndex:t,pageSize:e}=this.page;let i={page:t,pageSize:e,...this.getParams()};const{list:s,total_count:a}=await this.$api.promotions.getRecommendLikeItemList(i);this.tableList=s,this.page.total=Number(a),this.loading=!1},AddRecommendLikeItem(){this.show_sideBar=!0,(0,l.getRecommendLikeItems)().then(t=>{t.data.data.list&&(this.relItemsIds=t.data.data.list)})},DelItemData(t,e){this.show_sideBar=!1;let i=$t("i5yb4ke","将删除该商品推荐，是否继续?","lang"),s="";e&&(s=e.id),"true"===t&&(i=$t("adjan5d","将清除所有商品，是否继续?","lang"),s="all"),s?this.$confirm(i,$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(()=>{(0,l.deleteRecommendLikeItem)(s).then(t=>{this.fetchList(),this.$message({type:"success",message:$t("azeh8z4","删除成功","lang")})})}).catch(()=>{this.$message({type:"info",message:$t("e68dg3","已取消","lang")})}):this.$message({type:"info",message:$t("uz0dsd6","操作数据有误","lang")})},relItems(){this.itemVisible=!0,this.setItemStatus=!0},handleCancel(){this.show_sideBar=!1},submitActivityAction(){(0,l.saveRecommendLikeItem)(this.form).then(t=>{this.fetchList(),this.$message({type:"success",message:$t("aghf564","保存成功","lang")}),this.show_sideBar=!1,this.itemVisible=!1,this.form.items=[],this.relItemsIds=[],this.setItemStatus=!1})},chooseItemsAction(t){if(this.itemVisible=!1,this.setItemStatus=!1,this.relItemsIds=t,null===t||t.length<=0)return;let e=[];t.forEach((t,i)=>{let s="";s=-1==this.form.items.findIndex(e=>e.item_id==t.itemId)?{distributor_id:t.distributor_id,item_id:t.itemId,item_name:t.itemName,sort:t.sort}:this.form.items[i],e.push(s)}),this.form.items=e},closeItemDialogAction(){this.itemVisible=!1},deleteItemRow(t,e){e.splice(t,1),this.form.items=e,this.setItemStatus=!1,this.relItemsIds.splice(t,1)},editItemSort(t,e){let i={id:e.id,item_id:e.item_id,sort:e.sort};(0,l.updateRecommendLikeSort)(i).then(t=>{t.data.data&&this.$message({type:"success",message:$t("ai8d7e4","修改成功","lang")})})},editItemsStore(t,e){if(!1===e.is_total_store&&(""==e.store||e.store<=0))return void this.$message({type:"error",message:$t("8lasinh","非总部发货时，库存不能小于等于0!","lang")});let i={distributor_id:e.distributor_id,item_id:e.item_id,is_total_store:e.is_total_store,store:e.store};this.updateDistributorItem(i)},async getDistributorItemList(){let t=await this.getDefaultDistributor();t&&(this.params.distributor_id=t.distributor_id)},onCurrentChange(t){this.page.pageIndex=t,this.fetchList()},onSizeChange(t){this.page.pageIndex=1,this.page.pageSize=t,this.fetchList()}}},m=(0,i(81656).A)(c,function(){var t=this,e=t._self._c;return e("SpPage",[t.VERSION_SHUYUN()?t._e():e("SpPlatformTip",{attrs:{h5:"",app:"",pc:"",alipay:""}}),e("div",{staticClass:"action-container"},[e("el-button",{attrs:{type:"primary",icon:"iconfont icon-xinzengcaozuo-01"},on:{click:t.AddRecommendLikeItem}},[t._v($t("trl3pc6"," 添加商品 ","lang"))]),e("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){return t.DelItemData("true")}}},[t._v($t("capwrh8"," 清除所有商品 ","lang"))])],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleItemsTable",attrs:{border:"",data:t.tableList}},[e("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),width:"100"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.DelItemData("false",i.row)}}},[t._v($t("f4nq36"," 删除关联 ","lang"))])]}}])}),e("el-table-column",{attrs:{type:"selection",width:"55"}}),e("el-table-column",{attrs:{prop:"itemName",label:$t("b40v0e4","商品名称","lang")}}),e("el-table-column",{attrs:{prop:"price",label:$t("b3zwdc4","商品价格","lang"),width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.price/100)+$t("dtml2","元 ","lang"))]}}])}),e("el-table-column",{attrs:{prop:"sort",label:$t("b43cmw4","商品排序","lang"),width:"120"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-input",{on:{change:function(e){return t.editItemSort(i.$index,i.row)}},model:{value:i.row.sort,callback:function(e){t.$set(i.row,"sort",e)},expression:"scope.row.sort"}},[e("i",{staticClass:"el-input__icon el-icon-edit",attrs:{slot:"suffix"},slot:"suffix"})])]}}])}),e("el-table-column",{attrs:{prop:"approve_status",label:$t("k1e32","状态","lang"),width:"100"},scopedSlots:t._u([{key:"default",fn:function(i){return["onsale"===i.row.approve_status?e("div",{staticClass:"grid-content"},[t._v($t("meu01y5","前台可销售","lang"))]):"offline_sale"===i.row.approve_status?e("div",{staticClass:"grid-content"},[t._v($t("cyn37z7"," 前台不展示 ","lang"))]):e("div",{staticClass:"grid-content"},[t._v($t("a7er004","不可销售","lang"))])]}}])})],1),t.page.total>t.page.pageSize?e("div",{staticClass:"mt-4 text-right"},[e("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":t.page.pageIndex,"page-sizes":[10,20,50],total:t.page.total,"page-size":t.page.pageSize},on:{"update:currentPage":function(e){return t.$set(t.page,"pageIndex",e)},"update:current-page":function(e){return t.$set(t.page,"pageIndex",e)},"current-change":t.onCurrentChange,"size-change":t.onSizeChange}})],1):t._e(),e("sideBar",{attrs:{visible:t.show_sideBar,title:$t("ikwu2j4","选择商品","lang"),width:"60"},on:{"update:visible":function(e){t.show_sideBar=e}}},[t.editItemSortVisible?e("div",[e("el-row",[e("el-col",{attrs:{span:4}},[e("el-button",{attrs:{type:"primary",loading:t.loading,size:"mini"},on:{click:t.submitActivityAction}},[t._v($t("cp35x4"," 保存 ","lang"))])],1)],1),t.form.items.length>0?e("el-table",{staticStyle:{"line-height":"normal"},attrs:{data:t.form.items}},[e("el-table-column",{attrs:{label:"ID",prop:"item_id",width:"60"}}),e("el-table-column",{attrs:{label:$t("eyrn2","名称","lang"),prop:"item_name"}}),e("el-table-column",{attrs:{label:$t("hge52","排序","lang"),width:"80"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-input",{attrs:{size:"mini"},model:{value:i.row.sort,callback:function(e){t.$set(i.row,"sort",e)},expression:"scope.row.sort"}})]}}],null,!1,243219967)})],1):t._e()],1):e("div",[e("el-row",[e("el-col",{attrs:{span:8}},[e("el-button",{staticClass:"el-icon-plus",attrs:{type:"primary",size:"mini"},on:{click:t.relItems}},[t._v($t("mwtd0l6"," 选择商品 ","lang"))])],1),e("el-col",{attrs:{span:4}},[e("el-button",{attrs:{size:"mini"},nativeOn:{click:function(e){return t.handleCancel.apply(null,arguments)}}},[t._v($t("m1m0m4"," 返回 ","lang"))]),e("el-button",{attrs:{type:"primary",loading:t.loading,size:"mini"},on:{click:t.submitActivityAction}},[t._v($t("cp35x4"," 保存 ","lang"))])],1)],1),t.form.items.length>0?e("el-table",{staticStyle:{"line-height":"normal"},attrs:{data:t.form.items}},[e("el-table-column",{attrs:{label:"ID",prop:"item_id",width:"60"}}),e("el-table-column",{attrs:{label:$t("eyrn2","名称","lang"),prop:"item_name"}}),e("el-table-column",{attrs:{label:$t("hge52","排序","lang"),width:"80"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-input",{attrs:{size:"mini"},model:{value:i.row.sort,callback:function(e){t.$set(i.row,"sort",e)},expression:"scope.row.sort"}})]}}],null,!1,243219967)}),e("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),width:"50"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("i",{staticClass:"iconfont icon-trash-alt",on:{click:function(e){return t.deleteItemRow(i.$index,t.form.items)}}})]}}],null,!1,1914607797)})],1):t._e()],1)]),e("GoodsSelect",{attrs:{"items-visible":t.itemVisible,"get-status":t.setItemStatus,"rel-items-ids":t.relItemsIds},on:{chooseStore:t.chooseItemsAction,closeStoreDialog:t.closeItemDialogAction}})],1)},[],!1,null,null,null),d=m.exports}}]);