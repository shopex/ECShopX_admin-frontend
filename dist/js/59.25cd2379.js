"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[59],{60059:function(t,e,a){a.r(e),a.d(e,{default:function(){return o}});a(44114);var i=a(95353),s=a(81193),n=a(5134),r={mixins:[a(77825).v8],provide(){return{refresh:this.refresh}},props:["getStatus"],data(){const t={create_time:[],status:"all",name:void 0,seckill_type:"limited_time_sale"};return{initialParams:t,params:{...t},downloadfilename:"",downloadUrl:"",loading:!1,communityVisible:!1,couponVisible:!1,goodsVisible:!1,goodsList:[],goodsCount:0,distributors:[],goodsPageSize:10,goodsPage:1,nowActivity:"",cursymbol:"",dialogVisible:!1,currency:{},tabList:[{name:$t("en402","全部","lang"),activeName:"all"},{name:$t("fkmt13","未开始","lang"),activeName:"waiting"},{name:$t("mqz6v3","预告中","lang"),activeName:"in_the_notice"},{name:$t("cvr5x3","售卖中","lang"),activeName:"in_sale"},{name:$t("edie63","已结束","lang"),activeName:"it_has_ended"}]}},computed:{...(0,i.L8)(["wheight"])},watch:{getStatus(t){t&&this.fetchList()}},mounted(){this.fetchList(),this.getCurrencyInfo()},methods:{editActionVisible({status:t,source_id:e}){if("it_has_ended"!==t){if(this.IS_ADMIN()&&"0"==e)return!0;if(this.IS_DISTRIBUTOR())return!0}return!1},getParams(){const t={},e=this.params.create_time;return e&&e.length>0&&(t.start_time=this.dateStrToTimeStamp(e[0]+" 00:00:00"),t.end_time=this.dateStrToTimeStamp(e[1]+" 23:59:59")),{...this.params,status:"all"===this.params.status?void 0:this.params.status,create_time:[],...t}},onSearch(){this.page.pageIndex=1,this.$nextTick(()=>{this.fetchList()})},onReset(){this.params={...this.initialParams},this.onSearch()},async fetchList(){this.loading=!0;const{pageIndex:t,pageSize:e}=this.page;let a={page:t,pageSize:e,...this.getParams()};const{list:i,total_count:s}=await this.$api.promotions.seckillActivityGetList(a);this.tableList=i,this.page.total=s,this.loading=!1,this.loading=!1},uploadActionWxaCode(t,e,a=0){var i={seckill_type:e.seckill_type,seckill_id:e.seckill_id};if(a)i.distributor_id=a;else if(null===e.distributor_id)i.distributor_id=0;else if(1===e.distributor_id.length)i.distributor_id=e.distributor_id[0];else if(e.distributor_id.length>1)return this.distributors=e,void(this.dialogVisible=!0);this.downloadfilename=e.activity_name+".jpg",(0,n.seckillActivityWxcode)(i).then(t=>{this.downloadUrl=t.data.data.code,setTimeout(()=>{this.$refs.download.click()},200)})},handleTabClick(t,e){this.onSearch()},addActivityData(){this.$router.push({path:this.matchRoutePath("editor")})},editAction(t,e){this.$router.push({path:this.matchRoutePath("editor/")+e.seckill_id})},updateStatusCommunityAction(t){var e=$t("3pkh9yi","此操作将永久终止该活动, 是否继续?","lang");this.$confirm(e,$t("hn562","提示","lang"),{cancelButtonText:$t("ev022","取消","lang"),confirmButtonText:$t("kzjg2","确定","lang"),type:"warning",beforeClose:(e,a,i)=>{"confirm"===e&&(0,n.seckillActivityUpdateStatus)({seckill_id:t.seckill_id}).then(t=>{this.fetchList(),this.$message({message:$t("c6bhfy8","修改活动状态成功","lang"),type:"success",duration:5e3})}),i()}})},dateChange(t){this.params.status="",t&&t.length>0?(this.params.start_time=this.dateStrToTimeStamp(t[0]+" 00:00:00"),this.params.end_time=this.dateStrToTimeStamp(t[1]+" 23:59:59")):(this.params.start_time="",this.params.end_time=""),this.params.page=1,this.fetchList()},dateStrToTimeStamp(t){return Date.parse(new Date(t))/1e3},viewCouponList(t){this.couponVisible=!0},handleCancel(){this.communityVisible=!1,this.couponVisible=!1,this.goodsVisible=!1},getCurrencyInfo(){(0,s.getDefaultCurrency)().then(t=>{this.currency=t.data.data,this.cursymbol=this.currency.symbol})},updateActivityData(t){updateActivityItemData(t).then(t=>{})},editItemPrice(t){let e={id:t.id,item_id:t.item_id,activity_price:t.activity_price,vip_price:t.vip_price,svip_price:t.svip_price,activity_store:t.activity_store,points:t.points};this.updateActivityData(e)},refresh(){this.fetchList(),this.getCurrencyInfo()}}},l=r,o=(0,a(81656).A)(l,function(){var t=this,e=t._self._c;return e("SpPage",[-1===t.$route.path.indexOf("editor")?[t.VERSION_SHUYUN()?t._e():e("SpPlatformTip",{attrs:{h5:"",app:"",pc:"",alipay:""}}),e("SpFilterForm",{attrs:{model:t.params},on:{onSearch:t.onSearch,onReset:t.onReset}},[e("SpFilterFormItem",{attrs:{prop:"name",label:$t("bopooa5","活动名称:","lang")}},[e("el-input",{attrs:{placeholder:$t("e4hvdc4","活动名称","lang")},model:{value:t.params.name,callback:function(e){t.$set(t.params,"name",e)},expression:"params.name"}})],1),e("SpFilterFormItem",{attrs:{prop:"create_time",label:$t("fn58c3","时间:","lang")}},[e("el-date-picker",{attrs:{type:"daterange","value-format":"yyyy/MM/dd",placeholder:$t("t9q3f56","添加时间筛选","lang")},model:{value:t.params.create_time,callback:function(e){t.$set(t.params,"create_time",e)},expression:"params.create_time"}})],1)],1),e("div",{staticClass:"action-container"},[e("el-button",{attrs:{type:"primary",icon:"iconfont icon-xinzengcaozuo-01"},on:{click:t.addActivityData}},[t._v($t("tv32jy6"," 添加活动 ","lang"))])],1),e("el-tabs",{attrs:{type:"card"},on:{"tab-click":t.handleTabClick},model:{value:t.params.status,callback:function(e){t.$set(t.params,"status",e)},expression:"params.status"}},t._l(t.tabList,function(a,i){return e("el-tab-pane",{key:i,attrs:{label:a.name,name:a.activeName}},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{border:"",data:t.tableList,height:t.wheight-200}},[e("el-table-column",{attrs:{prop:"seckill_id",label:"ID",width:"80"}}),e("el-table-column",{attrs:{prop:"activity_name",label:$t("e4hvdc4","活动名称","lang"),"min-width":"180"}}),e("el-table-column",{attrs:{prop:"created_date",label:$t("ar84e54","创建时间","lang"),"min-width":"150"}}),e("el-table-column",{attrs:{label:$t("e4l2kr4","活动时间","lang"),"min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",[t._v(t._s(a.row.activity_start_date))]),e("div",[t._v("~")]),e("div",[t._v(t._s(a.row.activity_end_date))])]}}],null,!0)}),e("el-table-column",{attrs:{prop:"status",label:$t("k1e32","状态","lang"),"min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(a){return["waiting"==a.row.status?e("span",[t._v($t("egbo03","待开始","lang"))]):"in_the_notice"==a.row.status?e("span",[t._v($t("mqz6v3","预告中","lang"))]):"in_sale"==a.row.status?e("span",[t._v($t("lq5q43","进行中","lang"))]):"it_has_ended"==a.row.status?e("span",[t._v($t("edie63","已结束","lang"))]):"close"==a.row.status?e("span",[t._v($t("edix83","已终止","lang"))]):t._e()]}}],null,!0)}),e("el-table-column",{attrs:{"min-width":"70",prop:"source_name",label:$t("gwn72","店铺","lang")}}),e("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),width:"250"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("a",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"download",refInFor:!0,attrs:{href:t.downloadUrl,download:t.downloadfilename}}),"Y"==a.row.edit_btn?[t.editActionVisible(a.row)?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.editAction(a.$index,a.row)}}},[t._v($t("xefpa06"," 编辑活动 ","lang"))]):t._e()]:t._e(),t.editActionVisible(a.row)?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.updateStatusCommunityAction(a.row)}}},[t._v($t("rn93i16"," 终止活动 ","lang"))]):t._e(),"it_has_ended"==a.row.status?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.editAction(a.$index,a.row)}}},[t._v($t("anskst6"," 查看活动 ","lang"))]):t._e()]}}],null,!0)})],1),t.page.total>t.page.pageSize?e("div",{staticClass:"content-center content-top-padded"},[e("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":t.page.pageIndex,"page-sizes":[10,20,50],total:t.page.total,"page-size":t.page.pageSize},on:{"update:currentPage":function(e){return t.$set(t.page,"pageIndex",e)},"update:current-page":function(e){return t.$set(t.page,"pageIndex",e)},"current-change":t.onCurrentChange,"size-change":t.onSizeChange}})],1):t._e()],1)}),1)]:t._e(),e("el-dialog",{attrs:{title:$t("urpeh98","活动支持店铺列表","lang"),visible:t.dialogVisible,width:"50%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.distributors.distributor_info,height:t.wheight-500}},[e("el-table-column",{attrs:{prop:"name",label:$t("cjqdxi4","店铺名称","lang"),"min-width":"180"}}),e("el-table-column",{attrs:{prop:"address",label:$t("fb4g2","地址","lang"),"min-width":"180"}}),e("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),width:"250"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.uploadActionWxaCode(a.$index,t.distributors,a.row.distributor_id)}}},[t._v($t("w0rbb48"," 下载小程序码 ","lang"))])]}}])})],1)],1),e("router-view")],2)},[],!1,null,"0278099c",null).exports}}]);