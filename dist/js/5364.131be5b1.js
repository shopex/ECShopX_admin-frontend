"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[5364],{52983:function(t,s,e){e.r(s),e.d(s,{default:function(){return o}});e(18111),e(61701);var a=e(77825),i=e(26456),r={mixins:[a.Ay,a.v8],data(){const t=this.$createElement;return{params:{distributor_id:"",regionList:[]},regions:[],tableLoading:!1,dialogTitle:$t("qvp1rp6","添加售后地址","lang"),datapass_block:1,addressDialog:!1,addressForm:{address_id:"",distributors:[],regions_id:[],address:"",contact:"",mobile:""},addressFormList:[{label:$t("gwn72","店铺","lang"),key:"num",component:()=>t("div",{class:"distributor-tags"},[this.addressForm.distributors.map((s,e)=>t("el-tag",{key:s.name,attrs:{closable:!this.addressForm.address_id},on:{close:this.storeClose.bind(this,e)}},[s.name])),!this.addressForm.address_id&&t("el-button",{attrs:{type:"text"},on:{click:this.addStoreAction}},[$t("yfpdbi6","添加适用店铺","lang")])]),validator:(t,s,e)=>{const{distributors:a}=this.addressForm;0==a.length?e(new Error($t("2elj5y5","请选择店铺","lang"))):e()}},{label:$t("fabu2","地区","lang"),key:"regions_id",component:()=>t("el-cascader",{attrs:{options:this.regions},model:{value:this.addressForm.regions_id,callback:t=>{this.$set(this.addressForm,"regions_id",t)}}}),validator:(t,s,e)=>{const{regions_id:a}=this.addressForm;0==a.length?e(new Error($t("2en5hb5","请选择地区","lang"))):e()}},{label:$t("i67wds4","详细地址","lang"),key:"address",type:"input",required:!0,message:$t("fcv4h37","请输入详细地址","lang")},{label:$t("jed0z3","联系人","lang"),key:"contact",type:"input",required:!0,message:$t("7f02ae6","请输入联系人","lang")},{label:$t("gphnfh4","联系方式","lang"),key:"mobile",type:"input",required:!0,message:$t("gtldfe7","请输入联系方式","lang")}]}},async created(){const t=await this.$api.common.getAddress();this.regions=t},mounted(){this.fetchList()},methods:{onSearch(){this.page.pageIndex=1,this.$nextTick(()=>{this.fetchList()})},async fetchList(){this.tableLoading=!0;const{pageIndex:t,pageSize:s}=this.page,[e,a,r]=(0,i.SK)(this.params.regionList,this.regions),{distributor_id:o}=this.params,d={page:t,page_size:s,distributor_id:o,province:e,city:a,area:r},{list:n,total_count:l,datapass_block:c}=await this.$api.aftersales.getAftersalesAddressList(d);this.tableList=n,this.page.total=l,this.datapass_block=c,this.tableLoading=!1},async onEditSalesAfterAddress({address_id:t,distributor_id:s,regions_id:e,address:a,contact:i,mobile:r}){this.dialogTitle=$t("5inhqt6","编辑售后地址","lang");const o=await this.$api.marketing.getDistributorInfo({distributor_id:s});this.addressForm.address_id=t,this.addressForm.distributors=[o],this.addressForm.regions_id=JSON.parse(e),this.addressForm.address=a,this.addressForm.contact=i,this.addressForm.mobile=r,this.addressDialog=!0},handleCreate(){this.dialogTitle=$t("qvp1rp6","添加售后地址","lang"),this.addressForm.address_id="",this.addressForm.distributors=[],this.addressForm.regions_id=[],this.addressForm.address="",this.addressForm.contact="",this.addressForm.mobile="",this.addressDialog=!0},async handleDelete(t){await this.$confirm($t("srl5tmm","此操作将永久删除该店铺售后地址, 是否继续?","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"});const{status:s}=await this.$api.aftersales.deleteAftersalesAddress(t.address_id);s?this.$message.success($t("eo3f4i5","删除成功!","lang")):this.$message.error($t("ep48qf5","删除失败!","lang")),this.fetchList()},async addStoreAction(){const t=this.addressForm.distributors.map(t=>t.distributor_id),{data:s}=await this.$picker.shop({data:t});this.addressForm.distributors=JSON.parse(JSON.stringify(s))},async onAddressFormSubmit(){const[t,s,e]=(0,i.SK)(this.addressForm.regions_id,this.regions),{distributors:a,regions_id:r,address:o,contact:d,mobile:n}=this.addressForm,l=a.map(t=>t.distributor_id);let c={distributor_id:JSON.stringify(l),regions_id:JSON.stringify(r),regions:JSON.stringify([t,s,e]),province:t,city:s,area:e,address:o,contact:d,mobile:n};if(this.addressForm.address_id){const[t]=this.addressForm.distributors.map(t=>t.distributor_id);c={...c,distributor_id:t,address_id:this.addressForm.address_id};const{status:s}=await this.$api.aftersales.updateAftersalesAddress(c);s?this.$message.success($t("ai8d7e4","修改成功","lang")):this.$message.error($t("ai76fz4","修改失败","lang"))}else{const{status:t}=await this.$api.aftersales.createAftersalesAddress(c);t?this.$message.success($t("e7ygyc4","添加成功","lang")):this.$message.error($t("e7xa6x4","添加失败","lang"))}this.addressDialog=!1,this.fetchList()},async onSwitchChange({address_id:t}){const{status:s}=await this.$api.aftersales.updateAftersalesAddress({address_id:t,set_default:!0});s&&(this.$message.success($t("ai8d7e4","修改成功","lang")),this.fetchList())},storeClose(t){this.addressForm.distributors.splice(t,1)}}},o=(0,e(81656).A)(r,function(){var t=this,s=t._self._c;return s("SpPage",{staticClass:"distributorAftersalesAddress"},[s("SpPlatformTip",{attrs:{h5:"",app:"",alipay:""}}),s("SpFilterForm",{attrs:{model:t.params},on:{onSearch:t.onSearch,onReset:t.onSearch}},[s("SpFilterFormItem",{attrs:{prop:"distributor_id",label:$t("ek40n3","店铺:","lang")}},[s("SpSelectShop",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:t.params.distributor_id,callback:function(s){t.$set(t.params,"distributor_id",s)},expression:"params.distributor_id"}})],1),s("SpFilterFormItem",{attrs:{prop:"regionList",label:$t("b4wz005","售后地区:","lang")}},[s("el-cascader",{attrs:{placeholder:$t("b3i65m4","售后地区","lang"),options:t.regions,props:{checkStrictly:!0,value:"label"},clearable:""},model:{value:t.params.regionList,callback:function(s){t.$set(t.params,"regionList",s)},expression:"params.regionList"}})],1)],1),s("div",{staticClass:"action-container"},[s("el-button",{attrs:{icon:"el-icon-circle-plus",type:"primary"},on:{click:t.handleCreate}},[t._v($t("k59ok58"," 添加售后地址 ","lang"))])],1),s("el-row",{attrs:{gutter:20}},[s("el-col")],1),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],attrs:{data:t.tableList,border:""}},[s("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return["0"==t.datapass_block?s("el-button",{attrs:{type:"text"},on:{click:function(s){return t.onEditSalesAfterAddress(e.row)}}},[t._v($t("juz394"," 编辑 ","lang"))]):t._e(),s("el-button",{attrs:{type:"text"},on:{click:function(s){return t.handleDelete(e.row)}}},[t._v($t("db22k4"," 删除 ","lang"))])]}}])}),s("el-table-column",{attrs:{prop:"name",label:$t("gwn72","店铺","lang")}}),s("el-table-column",{attrs:{label:$t("b3i6y84","售后地址","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[s("i",{staticClass:"el-icon-place"}),t._v(" "+t._s(e.row.province+" "+e.row.city+" "+e.row.area+" "+e.row.address)+" ")]}}])}),s("el-table-column",{attrs:{prop:"contact",label:$t("jed0z3","联系人","lang"),width:"250"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",{},[s("i",{staticClass:"el-icon-user"}),t._v(" "+t._s(e.row.contact))])]}}])}),s("el-table-column",{attrs:{prop:"contact",label:$t("gpkj3j4","联系电话","lang"),width:"250"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",{},[s("i",{staticClass:"el-icon-mobile-phone"}),t._v(" "+t._s(e.row.mobile))])]}}])}),s("el-table-column",{attrs:{label:$t("d92ns34","是否默认","lang"),width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-switch",{attrs:{"active-value":"1","inactive-value":"0",disabled:1==e.row.is_default},on:{change:function(s){return t.onSwitchChange(e.row)}},model:{value:e.row.is_default,callback:function(s){t.$set(e.row,"is_default",s)},expression:"scope.row.is_default"}})]}}])})],1),s("div",{staticClass:"content-center content-top-padded"},[s("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next","current-page":t.page.pageIndex,"page-sizes":[10,20,50,100],total:t.page.total,"page-size":t.page.pageSize},on:{"current-change":t.onCurrentChange,"size-change":t.onSizeChange}})],1),s("SpDialog",{ref:"addressDialogRef",attrs:{title:t.dialogTitle,modal:!1,form:t.addressForm,"form-list":t.addressFormList},on:{onSubmit:t.onAddressFormSubmit},model:{value:t.addressDialog,callback:function(s){t.addressDialog=s},expression:"addressDialog"}})],1)},[],!1,null,"ae30c0b2",null).exports}}]);