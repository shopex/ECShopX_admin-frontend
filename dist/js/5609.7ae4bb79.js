"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[5609],{25609:function(e,t,n){n.r(t),n.d(t,{default:function(){return g}});n(18111),n(61701);var a=n(89435),o=(n(22489),n(7588),n(33318)),s={name:"CompGoodsList",props:["value"],data(){return{items:[],goodCategoryMap:o.g5}},watch:{value:function(e){this.items=e.items}},created(){},methods:{onChangeItem(){const e=this.items.filter(e=>e.checked).map(e=>({id:e.id,num:e.refundNum}));this.$emit("onChange",e)},setSelectAllGoods(){this.items.forEach(e=>{e.left_aftersales_num&&(e.checked=!0,e.refundNum=e.left_aftersales_num)}),this.onChangeItem()}}},l=n(81656),r=(0,l.A)(s,function(){var e=this,t=e._self._c;return e.value?t("div",{staticClass:"comp-goods-list"},[t("el-table",{attrs:{data:e.items}},[t("el-table-column",{attrs:{width:"60"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("el-checkbox",{staticClass:"item-checkbox",attrs:{disabled:!n.row.left_aftersales_num},on:{change:e.onChangeItem},model:{value:n.row.checked,callback:function(t){e.$set(n.row,"checked",t)},expression:"scope.row.checked"}})]}}],null,!1,3628095749)}),t("el-table-column",{attrs:{prop:"pic",label:$t("b41bic4","商品图片","lang"),width:"120"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("el-image",{staticClass:"item-image",attrs:{src:e.row.pic,fit:"fit"}})]}}],null,!1,3234839163)}),t("el-table-column",{attrs:{label:$t("b40p614","商品参数","lang"),width:"180"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("div",{staticClass:"item-info"},[t("div",{staticClass:"item-name"},[e._v(e._s(n.row.item_name))]),t("div",{staticClass:"item-price"},[e._v(e._s("¥"+n.row.total_fee/n.row.num/100))]),n.row.item_spec_desc?t("div",{staticClass:"spec-desc"},[e._v(" "+e._s(`${$t("kpkbm3","规格：","lang")}${n.row.item_spec_desc}`)+" ")]):e._e(),t("el-input-number",{attrs:{size:"mini",disabled:!n.row.left_aftersales_num,step:1,min:1,max:n.row.left_aftersales_num},on:{change:e.onChangeItem},model:{value:n.row.refundNum,callback:function(t){e.$set(n.row,"refundNum",t)},expression:"scope.row.refundNum"}})],1)]}}],null,!1,2473373321)}),t("el-table-column",{attrs:{prop:"point_fee",label:$t("cv6uv94","抵扣积分","lang"),width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.point_fee/100)+" ")]}}],null,!1,3029030358)}),e.VERSION_STANDARD()?e._e():t("el-table-column",{attrs:{prop:"pic",label:$t("b3lhxt6","成本价(¥)","lang"),width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.fee_symbol)+e._s(t.row.cost_price/100)+" ")]}}],null,!1,3610830787)}),t("el-table-column",{attrs:{prop:"item_holder",label:$t("b47jsb4","商品类型","lang"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("div",{staticClass:"ell3"},[e._v(" "+e._s(e.goodCategoryMap[n.row.item_holder])+" ")])]}}],null,!1,959559226)}),t("el-table-column",{attrs:{prop:"supplier_name",label:$t("7msy3i5","来源供应商","lang"),width:"100"}})],1)],1):e._e()},[],!1,null,null,null).exports,i=(n(18237),{name:"CompRefundAmount",props:["value"],data(){return{fee:0,refundFee:0}},created(){},methods:{getTotalFee(){const{items:e=[]}=this.value||{},t=e.filter(e=>e.checked).reduce((e,t)=>e+t.total_fee/t.num*t.refundNum,0);this.refundFee=(t/100).toFixed(2),this.fee=this.refundFee,this.$emit("onChangeFee",this.refundFee)},onChangeFee(){this.$emit("onChangeFee",this.fee)},refundAll(){this.$emit("onChange")}}}),u=(0,l.A)(i,function(){var e=this,t=e._self._c;return t("div",{staticClass:"comp-refund-amount"},[t("el-input",{attrs:{type:"text"},on:{change:e.onChangeFee},model:{value:e.fee,callback:function(t){e.fee=t},expression:"fee"}}),t("div",{staticClass:"refund-amount-tip"},[e._v($t("ff4aoa8"," 实际可退金额：","lang")+e._s(e.refundFee)+" "),t("el-button",{attrs:{type:"text"},on:{click:e.refundAll}},[e._v($t("avk0qm4","全部退款","lang"))])],1)],1)},[],!1,null,null,null).exports,f={name:"CompRefundPoint",props:["value"],data(){return{fee:0}},created(){},methods:{getTotalFee(){const{items:e=[]}=this.value||{};let t=0;return e.forEach(e=>{e.checked&&(t=e.refundNum===e.left_aftersales_num?e.remain_point/100:parseInt(e.remain_point/100/e.left_aftersales_num*e.refundNum))}),t},onChangeFee(){this.$emit("onChange",this.fee)},refundAll(){const e=this.getTotalFee();this.fee=e,this.$emit("onChange",e)}}},m=(0,l.A)(f,function(){var e=this,t=e._self._c;return t("div",{staticClass:"comp-refund-amount"},[t("el-input",{attrs:{type:"text"},on:{change:e.onChangeFee},model:{value:e.fee,callback:function(t){e.fee=t},expression:"fee"}}),t("div",{staticClass:"refund-amount-tip"},[e._v($t("eggot17","实际可退积分：","lang")+e._s(e.getTotalFee()))])],1)},[],!1,null,null,null).exports,d={name:"CompRefundPoint",props:["value"],data(){return{fee:0}},created(){},methods:{getTotalFee(){return(this.value?.refund_freight_amount||0)/100},onChangeFee(){this.$emit("onChange",this.fee)},refundAll(){const e=this.getTotalFee();this.fee=e,this.$emit("onChange",e)}}},c=(0,l.A)(d,function(){var e=this,t=e._self._c;return t("div",{staticClass:"comp-refund-amount"},[t("el-input",{attrs:{type:"text"},on:{change:e.onChangeFee},model:{value:e.fee,callback:function(t){e.fee=t},expression:"fee"}}),t("div",{staticClass:"refund-amount-tip"},[t("div",[e._v($t("ecz93b7","实际可退运费：","lang")+e._s(e.getTotalFee()))]),t("el-button",{attrs:{type:"text"},on:{click:e.refundAll}},[e._v($t("avk0qm4","全部退款","lang"))])],1)],1)},[],!1,null,null,null).exports;const h=[{title:$t("jmuqgf5","收到残次品","lang"),value:"1"},{title:$t("am362u5","商品有污渍","lang"),value:"2"},{title:$t("qkqauqa","包装破损导致商品损坏","lang"),value:"3"},{title:$t("itnc0k7","七天无理由退货","lang"),value:"4"}];var p={name:"",data(){const e=this.$createElement;return{orderInfo:null,form:{order_id:"",aftersales_type:"ONLY_REFUND",reason:"1",goods_returned:!1,items:[],refund_point:0,refund_fee:0,description:"",pic:"",freight:0},formList:[{label:"",component:()=>{const{id:t}=this.$route.params;return e(a.A,{attrs:{orderId:t},on:{onLoad:this.onLoad}})}},{label:$t("b3jmod4","售后形式","lang"),key:"aftersales_type",type:"radio",options:[{label:"ONLY_REFUND",name:$t("je736r9","仅退款（无需退货）","lang")},{label:"REFUND_GOODS",name:$t("ir7xyd4","退货退款","lang")}],onChange:e=>{this.formList[6].isShow="REFUND_GOODS"==e}},{label:$t("ilyr4v4","退款原因","lang"),key:"reason",placeholder:$t("wmjii27","请选择退款原因","lang"),type:"select",options:h},{label:$t("ilz0u14","退款商品","lang"),key:"items",component:()=>e(r,{ref:"compGoodsRef",attrs:{value:this.orderInfo},on:{onChange:e=>{this.form.items=e,this.$refs.compRefundRef.getTotalFee()}}}),validator:(e,t,n)=>{this.form.items.length>0?n():n($t("uw3n2q7","请选择售后商品","lang"))}},{label:$t("lohyv3","退积分","lang"),key:"refund_point",component:()=>e(m,{attrs:{value:this.orderInfo},on:{onChange:e=>{this.form.refund_point=e}}}),validator:(e,t,n)=>{this.form.refund_point>this.orderInfo?.refund_point_amount/100?n($t("wfvubl9","退积分超过可退积分","lang")):""===this.form.refund_point||null===this.form.refund_point||void 0===this.form.refund_point?n($t("gvjslj7","退积分不能为空","lang")):n()}},{label:$t("im9oyy4","退款金额","lang"),key:"refund_fee",component:()=>e(u,{ref:"compRefundRef",attrs:{value:this.orderInfo},on:{onChangeFee:e=>{this.form.refund_fee=e},onChange:e=>{this.$refs.compGoodsRef.setSelectAllGoods()}}}),validator:(e,t,n)=>{""===this.form.refund_fee||null===this.form.refund_fee||void 0===this.form.refund_fee?n($t("5awv5m8","退款金额不能为空","lang")):parseFloat(this.form.refund_fee)>parseFloat(this.$refs.compRefundRef.refundFee)?n($t("8mhv87a","退款金额超过可退金额","lang")):n()}},{label:$t("lsjmx3","退运费","lang"),key:"freight",component:()=>e(c,{attrs:{value:this.orderInfo},on:{onChange:e=>{this.form.freight=e}}}),validator:(e,t,n)=>{""===this.form.freight||null===this.form.freight||void 0===this.form.freight?n($t("bzv9jb7","退运费不能为空","lang")):parseFloat(this.form.freight)>parseFloat(this.orderInfo?.refund_freight_amount/100)?n($t("c72onv9","退运费超过可退运费","lang")):n()}},{label:$t("bcd7ks4","回寄方式","lang"),key:"goods_returned",type:"radio",options:[{label:!1,name:$t("cp1ohp4","快递发货","lang")},{label:!0,name:$t("f4lgztb","到店退货（店员已验货）","lang")}],isShow:!1},{label:$t("hjpnr54","补充描述","lang"),key:"description",type:"textarea"},{label:$t("a6cdai4","上传凭证","lang"),key:"pic",component:({key:t},n)=>e("SpImagePicker",{model:{value:n[t],callback:e=>{this.$set(n,t,e)}}})}]}},created(){},methods:{onLoad({orderInfo:e}){e.items=e.items.map(e=>({...e,refundNum:e.left_aftersales_num,checked:!1})),this.orderInfo=e},async submitRefund(){try{await this.$refs.form.handleSubmit()}catch(e){const t=e.items?.[0]?.message;this.$message.error(t)}},async onSubmit(){await this.$confirm($t("wdv4hd7","请确认申请售后","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang")});const{id:e}=this.$route.params,t=h.find(e=>e.value==this.form.reason).title,n={order_id:e,aftersales_type:this.form.aftersales_type,goods_returned:this.form.goods_returned,reason:t,detail:JSON.stringify(this.form.items),refund_fee:100*this.form.refund_fee,refund_point:this.form.refund_point,freight:100*this.form.freight,description:this.form.description,evidence_pic:[this.form.pic]};try{await this.$api.trade.salesAfterApply(n)}catch(e){return void this.$message.error(e.message)}this.$message.success($t("hxpwih8","售后申请提交成功","lang")),this.$EventBus.$emit("event.tradelist.refresh"),setTimeout(()=>{this.$router.go(-1)},1e3)}}},g=(0,l.A)(p,function(){var e=this,t=e._self._c;return t("SpPage",{attrs:{title:$t("b3nl504","售后申请","lang")}},[t("template",{slot:"page-footer"},[t("div",{staticClass:"text-center"},[t("el-button",{on:{click:()=>{this.$router.go(-1)}}},[e._v($t("dd4ni4"," 取消 ","lang"))]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitRefund}},[e._v($t("cp35x4"," 保存 ","lang"))])],1)]),t("SpForm",{ref:"form",staticClass:"sale-after-form",attrs:{"form-list":e.formList,submit:!1},on:{onSubmit:e.onSubmit},model:{value:e.form,callback:function(t){e.form=t},expression:"form"}})],2)},[],!1,null,null,null).exports}}]);