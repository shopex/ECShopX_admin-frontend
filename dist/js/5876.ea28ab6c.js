"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[5876],{65876:function(e,t,a){a.r(t),a.d(t,{default:function(){return y}});a(44114),a(18111),a(22489),a(20116),a(61701);var i=a(94644),o=a(95093),n=a.n(o),l=a(63366),r=a(41472),s=a(49986);const c=e=>(0,r.u)([{key:"invoice_status",label:$t("b2x14y4","发票状态","lang"),type:"select",defaultValue:"",options:s.C},{key:"invoice_type",label:$t("ctp5dk4","抬头类型","lang"),defaultValue:"individual",component({key:e},t){const a=this.$createElement;return a("div",[a("el-radio-group",{model:{value:t.invoice_type,callback:e=>{this.$set(t,"invoice_type",e)}}},[a("el-radio",{attrs:{label:"individual"}},[$t("dq6o2","个人","lang")]),a("el-radio",{attrs:{label:"enterprise"}},[$t("eb642","公司","lang")])])])}},{key:"invoice_type_code",label:$t("b2ynaf4","发票类型","lang"),defaultValue:"02",component({key:e},t){const a=this.$createElement;return a("div",[a("el-radio-group",{model:{value:t.invoice_type_code,callback:e=>{this.$set(t,"invoice_type_code",e)}}},[a("el-radio",{attrs:{label:"02"}},[$t("fsjjvi6","电子普通发票","lang")]),a("el-radio",{attrs:{label:"01"}},[$t("ac2vho4","专用发票","lang")])])])},isShow(){return"enterprise"===e.dialogForm.invoice_type}},{key:"company_title",label:$t("a6x9so4","个人抬头","lang"),type:"input",defaultValue:"",isShow(){return"individual"===e.dialogForm.invoice_type}},{key:"company_title",label:$t("amhfys4","公司抬头","lang"),type:"input",defaultValue:"",isShow(){return"enterprise"===e.dialogForm.invoice_type}},{key:"company_tax_number",label:$t("4yz4qb6","纳税人识别号","lang"),type:"input",defaultValue:"",isShow(){return"enterprise"===e.dialogForm.invoice_type}},{key:"email",label:$t("estanp5","收票人邮箱","lang"),type:"input",defaultValue:""},{key:"mobile",label:$t("et1aqx5","收票人手机","lang"),type:"input",defaultValue:"",component({key:e},t){const a=this.$createElement;return a("div",[a("el-input",{attrs:{placeholder:$t("2jbrwj5","请输入内容","lang")},model:{value:t.mobile,callback:e=>{this.$set(t,"mobile",e)}}})])}},{key:"company_address",label:$t("amfh984","公司地址","lang"),type:"input",defaultValue:"",isShow(){return"enterprise"===e.dialogForm.invoice_type}},{key:"company_telephone",label:$t("amkvh04","公司电话","lang"),type:"input",defaultValue:"",isShow(){return"enterprise"===e.dialogForm.invoice_type}},{key:"bank_name",label:$t("cegvwt4","开户银行","lang"),type:"input",defaultValue:"",isShow(){return"enterprise"===e.dialogForm.invoice_type}},{key:"bank_account",label:$t("t95shy5","开户行账户","lang"),type:"input",defaultValue:"",isShow(){return"enterprise"===e.dialogForm.invoice_type}}],e),m=e=>(0,r.u)([{key:"remark",label:"",type:"textarea",defaultValue:""}],e),d=e=>(0,r.u)([{key:"email",label:$t("padf2","邮箱","lang"),type:"input",defaultValue:"",required:!0,message:$t("2j0utw5","请输入邮箱","lang"),tip:$t("ik95emp","电子发票需要一定时间才能发送到您的邮箱,请耐心等待","lang")}],e);var u=a(77825),p=(a(26456),a(33318)),h=a(89886),f={mixins:[u.v8],data(){return{activeName:"all",status:s.h5,selectedRows:[],editRow:null,areas:[],dialogForm:(0,r.C)(c(this)),dialogShow:!1,remarkDialogShow:!1,remarkForm:(0,r.C)(m(this)),remarkRuleForm:m(this),confirmDialogShow:!1,confirmForm:(0,r.C)(d(this)),confirmStatus:!1,confirmRuleForm:d(this),showLogInfoDrawer:!1,logListData:[],logTableSchema:(e=this,(0,i.createSetting)({columns:[{name:$t("d1x8m74","操作类型","lang"),key:"operator_type",render(e,{row:t}){return e("span",[" ",s.js[t.operator_type]," "])}},{name:$t("d1pydf4","操作内容","lang"),key:"operator_content",width:400,render(t,{row:a}){const i=arguments[0];return"string"==typeof a.operator_content?i("span",[" ",a.operator_content," "]):i("SpFinder",{ref:"finder",attrs:{"fixed-row-action":!0,"row-actions-width":"200px",data:a.operator_content,"no-selection":!0,"show-pager":!1,setting:e.innerTableSchema,"row-actions-fixed-align":"left"}})}},{name:$t("f5g8b3","操作人","lang"),key:"operator"},{name:$t("i5z22","时间","lang"),key:"update_time",render(e,{row:t}){return e("span",[" ",n()(1e3*t.update_time).format("yyyy-MM-DD HH:mm:ss")," "])}}]})),innerTableSchema:(0,i.createSetting)({columns:[{name:$t("c74wy3","修改前","lang"),key:"oldValue"},{name:$t("c759f3","修改后","lang"),key:"newValue"}]}),defaultTime:["00:00:00","23:59:59"],formData:{distributor_id:"",order_id:"",invoice_apply_bn:"",company_title:"",invoice_source:"",mobile:"",email:"",invoice_type_code:"",cycleTime:[]},invoiceSourceList:s.Yv,typeList:[{value:"01",title:$t("ac2vho4","专用发票","lang")},{value:"02",title:$t("fsjjvi6","电子普通发票","lang")}],orderCategory:this.VERSION_STANDARD()?p.In.filter(e=>"distributor"!=e.value):p.In};var e},computed:{tableSchema(){return e=this,(0,i.createSetting)({actions:[{name:$t("obrz2","详情","lang"),key:"detail",type:"button",buttonType:"text",action:{handler:(0,l.default)(([t])=>{e.$router.push({path:`${e.$route.path}/detail`,query:{id:t.id}})},2e3,{leading:!0})}},{name:$t("mekb2","编辑","lang"),key:"edit",type:"button",buttonType:"text",action:{handler:(0,l.default)(([t])=>{e.editRowHandle(t)},2e3,{leading:!0})},visible:e=>"online"!=e.invoice_method&&"failed"!=e.invoice_status},{name:$t("cy7nbm5","重发至邮箱","lang"),key:"pushPack",type:"button",buttonType:"text",action:{handler:(0,l.default)(([t])=>{e.pushEmailHandle(t)},1e3,{leading:!0})},visible:e=>"success"==e.invoice_status&&"online"==e.invoice_method||"failed"==e.invoice_status&&"online"!=e.invoice_method},{name:$t("fqo12","备注","lang"),key:"remark",type:"button",buttonType:"text",action:{handler:(0,l.default)(([t])=>{e.remarkHandle(t)},2e3,{leading:!0})}},{name:$t("huvm2","日志","lang"),key:"linkPath",type:"button",buttonType:"text",action:{handler:(0,l.default)(([t])=>{e.showLogHandle(t)},2e3,{leading:!0})}},{name:$t("it38kj4","重推开票","lang"),key:"reInvoice",type:"button",buttonType:"text",action:{handler:(0,l.default)(([t])=>{e.reInvoiceHandle(t)},2e3,{leading:!0})},visible:e=>"failed"==e.invoice_status}],columns:[{name:$t("pzs0v6","开票申请流水","lang"),key:"invoice_apply_bn",width:"200"},{name:$t("kuwys3","订单号","lang"),key:"order_id",width:"180",render(t,{row:a}){const i=arguments[0];return i("div",[i("div",{class:"order-num"},[a.order_id,i("el-tooltip",{attrs:{effect:"dark",content:$t("fljd2","复制","lang"),placement:"top-start"}},[i("i",{class:"el-icon-document-copy",style:{marginLeft:"6px"},on:{click:()=>{e.$copyText(a.order_id).then(t=>{e.onCopySuccess()})}}})])]),i("div",{class:"order-store"},[i("el-tooltip",{attrs:{effect:"dark",content:$t("ekkkq3","店铺名","lang"),placement:"top-start"}},[i("i",{class:"el-icon-office-building"})]),a.distributor_name]),i("div",{class:"order-time"},[i("el-tooltip",{attrs:{effect:"dark",content:$t("a72nl44","下单时间","lang"),placement:"top-start"}},[i("i",{class:"el-icon-time",style:{marginRight:"6px"}})]),n()(1e3*a.create_time).format("YYYY-MM-DD HH:mm:ss")])])}},{name:$t("hymqnc4","订单分类","lang"),key:"order_holder",width:"120",render(t,{row:a}){return(0,arguments[0])("span",[" ",e.getOrderCategoryName(a.order_holder)," "])}},{name:$t("5lywg87","开票金额（¥）","lang"),key:"invoice_amount",width:"120",render(e,{row:t}){return(0,arguments[0])("span",[" ",t.invoice_amount/100," "])}},{name:$t("chp4kz4","开票状态","lang"),key:"invoice_status",width:"120",render(e,{row:t}){return"success"===t.invoice_status?e("span",{style:{color:"green"}},[" ",s.Lp[t.invoice_status]," "]):"failed"===t.invoice_status?e("span",{style:{color:"red"}},[" ",s.Lp[t.invoice_status]," "]):e("span",[" ",s.Lp[t.invoice_status]," "])}},{name:$t("ctp5dk4","抬头类型","lang"),key:"invoice_type",width:"120",render(e,{row:t}){return(0,arguments[0])("span",[" ",{enterprise:$t("dv7d2","企业","lang"),individual:$t("dq6o2","个人","lang")}[t.invoice_type]," "])}},{name:$t("b2u9kv4","发票抬头","lang"),key:"company_title",width:"120"},{name:$t("b2ynaf4","发票类型","lang"),key:"invoice_type_code",width:"120",render(e,{row:t}){return e("span",[" ",s.W1[t.invoice_type_code]," "])}},{name:$t("chom1n4","开票渠道","lang"),key:"invoice_method",width:"120",render(e,{row:t}){return e("span",[" ",s.sk[t.invoice_method]," "])}},{name:$t("i6yz2","来源","lang"),key:"invoice_source",render(e,{row:t}){return e("span",[" ",s.Bi[t.invoice_source]," "])}},{name:$t("ac4xwf4","会员编号","lang"),key:"user_card_code",width:"100"},{name:$t("fqo12","备注","lang"),key:"remark",width:"120"},{name:$t("ar84e54","创建时间","lang"),key:"created",width:"120",render(e,{row:t}){return e("span",[" ",n()(1e3*t.create_time).format("yyyy-MM-DD HH:mm:ss")," "])}},{name:$t("devbay4","更新时间","lang"),key:"updated",width:"120",render(e,{row:t}){return e("span",[" ",n()(1e3*t.update_time).format("yyyy-MM-DD HH:mm:ss")," "])}}]});var e},dialogRuleForm(){return c(this)}},mounted(){this.getAreas()},methods:{onSearch(){this.refresh()},getAreas(){h.default.regionauth.getRegionauth().then(e=>{this.areas=e?.list?.map(e=>({value:e.regionauth_id,label:e.regionauth_name,title:e.regionauth_name}))})},refresh(){this.$refs.finder.refresh(!0)},onCopySuccess(){this.$notify.success({message:$t("bkv2mw4","复制成功","lang"),showClose:!0})},beforeSearch(e){const t={...e,...this.formData};return t.cycleTime.length&&(t.start_time=n()(t.cycleTime[0]).unix(),t.end_time=n()(t.cycleTime[1]).unix()),delete t.cycleTime,"all"===this.activeName?delete t.invoice_status:t.invoice_status=this.activeName,t},editRowHandle(e){this.editRow=e,this.dialogShow=!0,this.dialogForm=(0,r.C)(c(this),e)},handleClick(){this.refresh()},getOrderCategoryName(e){return this.orderCategory.find(t=>t.value==e)?.title??""},remarkHandle(e){this.editRow=e,this.remarkDialogShow=!0,this.remarkForm=(0,r.C)(m(this),e)},pushEmailHandle(e){this.editRow=e,this.confirmDialogShow=!0,this.confirmForm=(0,r.C)(d(this),{})},showLogHandle(e){this.$router.push({path:`${this.$route.path}/process?id=${e.id}`})},handleSelectionChange(e){this.selectedRows=e},onConfirmFormSubmit(){this.confirmStatus=!0,h.default.financial.resendInvoiceEmail({id:this.editRow.id,confirm_email:this.confirmForm.email}).then(e=>{this.$message.success($t("b65a734","发送成功","lang")),this.confirmDialogShow=!1,this.refresh()}).finally(()=>{this.confirmStatus=!1})},onRemarkFormSubmit(){this.confirmStatus=!0,h.default.financial.updateInvoiceRemark(this.editRow.id,this.remarkForm).then(e=>{this.$message.success($t("deua4r4","更新成功","lang")),this.remarkDialogShow=!1,this.refresh()}).finally(()=>{this.confirmStatus=!1})},onDialogFormSubmit(){h.default.financial.updateInvoice(this.editRow.id,this.dialogForm).then(e=>{this.$message.success($t("deua4r4","更新成功","lang")),this.dialogShow=!1,this.refresh()})},reInvoiceHandle(e){this.$confirm($t("dcspv56","确定重推开票","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(async()=>{await this.$api.trade.retryFailedInvoice({invoice_id:e.id}),this.$message.success($t("wpaz1u6","重推开票成功","lang")),this.refresh()})}}},g=f,y=(0,a(81656).A)(g,function(){var e=this,t=e._self._c;return t("SpPage",[t("SpRouterView",[t("SpFilterForm",{attrs:{model:e.formData},on:{onSearch:e.onSearch,onReset:e.onSearch}},[t("SpFilterFormItem",{attrs:{prop:"distributor_id",label:$t("7kd5ck5","来源店铺:","lang")}},[t("SpSelectShop",{ref:"selectShop",attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:e.formData.distributor_id,callback:function(t){e.$set(e.formData,"distributor_id",t)},expression:"formData.distributor_id"}})],1),t("SpFilterFormItem",{attrs:{prop:"order_id",label:$t("hymdzq4","订单号:","lang")}},[t("el-input",{attrs:{placeholder:$t("7djicl6","请输入订单号","lang")},model:{value:e.formData.order_id,callback:function(t){e.$set(e.formData,"order_id",t)},expression:"formData.order_id"}})],1),t("SpFilterFormItem",{attrs:{prop:"invoice_apply_bn",label:$t("mdt4sb7","开票申请流水:","lang")}},[t("el-input",{attrs:{placeholder:$t("qbeszs9","请输入开票申请流水","lang")},model:{value:e.formData.invoice_apply_bn,callback:function(t){e.$set(e.formData,"invoice_apply_bn",t)},expression:"formData.invoice_apply_bn"}})],1),t("SpFilterFormItem",{attrs:{prop:"company_title",label:$t("bpi0v95","发票抬头:","lang")}},[t("el-input",{attrs:{placeholder:$t("mg8ra07","请输入发票抬头","lang")},model:{value:e.formData.company_title,callback:function(t){e.$set(e.formData,"company_title",t)},expression:"formData.company_title"}})],1),t("SpFilterFormItem",{attrs:{prop:"invoice_source",label:$t("w1hh7r5","开票来源:","lang")}},[t("el-select",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:e.formData.invoice_source,callback:function(t){e.$set(e.formData,"invoice_source",t)},expression:"formData.invoice_source"}},e._l(e.invoiceSourceList,function(e){return t("el-option",{key:e.value,attrs:{label:e.title,size:"mini",value:e.value}})}),1)],1),t("SpFilterFormItem",{attrs:{prop:"mobile",label:$t("ht54g28","开票申请手机号:","lang")}},[t("el-input",{attrs:{placeholder:$t("yfw6iba","请输入开票申请手机号","lang")},model:{value:e.formData.mobile,callback:function(t){e.$set(e.formData,"mobile",t)},expression:"formData.mobile"}})],1),t("SpFilterFormItem",{attrs:{prop:"email",label:$t("mj2kej7","开票申请邮箱:","lang")}},[t("el-input",{attrs:{placeholder:$t("qbkwzc9","请输入开票申请邮箱","lang")},model:{value:e.formData.email,callback:function(t){e.$set(e.formData,"email",t)},expression:"formData.email"}})],1),t("SpFilterFormItem",{attrs:{prop:"invoice_type_code",label:$t("blq7v15","发票类型:","lang")}},[t("el-select",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:e.formData.invoice_type_code,callback:function(t){e.$set(e.formData,"invoice_type_code",t)},expression:"formData.invoice_type_code"}},e._l(e.typeList,function(e){return t("el-option",{key:e.value,attrs:{label:e.title,size:"mini",value:e.value}})}),1)],1),t("SpFilterFormItem",{attrs:{prop:"cycleTime",label:$t("lpkhnn5","创建时间:","lang"),size:"max"}},[t("el-date-picker",{attrs:{clearable:"",type:"datetimerange",format:"yyyy-MM-dd HH:mm:ss","range-separator":$t("po31","至","lang"),"start-placeholder":$t("cd0k3t4","开始时间","lang"),"end-placeholder":$t("gfi7qi4","结束时间","lang"),"prefix-icon":"null","default-time":e.defaultTime},model:{value:e.formData.cycleTime,callback:function(t){e.$set(e.formData,"cycleTime",t)},expression:"formData.cycleTime"}})],1)],1),t("SpFinder",{ref:"finder",attrs:{url:"/order/invoice/list","fixed-row-action":"","row-actions-width":"200px",setting:e.tableSchema,hooks:{beforeSearch:e.beforeSearch},"row-actions-fixed-align":"left"},on:{"select-all":e.handleSelectionChange,"selection-change":e.handleSelectionChange},scopedSlots:e._u([{key:"tableTop",fn:function(){return[t("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.status,function(e){return t("el-tab-pane",{key:e.value,attrs:{label:e.label,name:e.value}})}),1)]},proxy:!0}])}),t("SpDialog",{ref:"dialogRef",staticClass:"base-form",attrs:{title:$t("gmhp9u4","编辑发票","lang"),modal:!1,form:e.dialogForm,"form-list":e.dialogRuleForm},on:{onSubmit:e.onDialogFormSubmit},model:{value:e.dialogShow,callback:function(t){e.dialogShow=t},expression:"dialogShow"}}),t("SpDialog",{ref:"dialogRef1",staticClass:"base-form",attrs:{title:$t("fqo12","备注","lang"),modal:!1,"confirm-status":e.confirmStatus,form:e.remarkForm,"form-list":e.remarkRuleForm},on:{onSubmit:e.onRemarkFormSubmit},model:{value:e.remarkDialogShow,callback:function(t){e.remarkDialogShow=t},expression:"remarkDialogShow"}}),t("SpDialog",{ref:"dialogRef2",staticClass:"base-form",attrs:{title:$t("z9bdv07","请确认重发邮箱","lang"),"confirm-btn-text":$t("o18mi07","邮箱正确并发送","lang"),modal:!1,"confirm-status":e.confirmStatus,form:e.confirmForm,"form-list":e.confirmRuleForm},on:{onSubmit:e.onConfirmFormSubmit},model:{value:e.confirmDialogShow,callback:function(t){e.confirmDialogShow=t},expression:"confirmDialogShow"}}),t("SpDrawer",{staticClass:"config-drawer",attrs:{title:$t("b2uumh4","发票日志","lang"),footer:!1,width:1e3},model:{value:e.showLogInfoDrawer,callback:function(t){e.showLogInfoDrawer=t},expression:"showLogInfoDrawer"}},[t("SpFinder",{ref:"finder",attrs:{"fixed-row-action":"","row-actions-width":"200px","no-selection":"",data:e.logListData,setting:e.logTableSchema,"row-actions-fixed-align":"left","show-pager":!1}})],1)],1)],1)},[],!1,null,null,null).exports}}]);