"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[6757],{76757:function(e,t,i){i.r(t),i.d(t,{default:function(){return m}});i(44114);var a=i(87378),s=i(5134),r=i(47003),o=i(5748),l={inject:["refresh"],components:{imgPicker:a.default},data(){return{cursymbol:"￥",itemsTotalCount:0,goodsDialogVisible:!1,goods:{},itemsList:[],itemsParams:{page:1,pageSize:20,item_type:"normal",nospec:!0,keywords:""},itemsLoading:!1,goodsTypeTitle:$t("dl86755","实体类商品","lang"),imgDialog:!1,isGetImage:!1,picsDialog:!1,isGetPics:!1,isPicsAdd:!0,picsEditIndex:0,productPicDialog:!1,isGetProductPic:!1,thumbDialog:!1,isGetThumb:!1,form:{item_id:"",bargain_id:"",title:"",ad_pic:"",help_pics:[],bargains_datetime_begin:"",bargains_datetime_end:"",bargain_rules:"",item_name:"",item_pics:"",mkt_price:"",price:"",price_min:0,price_max:0,people_min:0,people_max:0,min_price:"",limit_num:"",item_intro:"",share_msg:""},rules:{title:[{required:!0,message:$t("jel5hj7","请输入活动名称","lang"),trigger:"blur"}],ad_pic:[{required:!0,message:$t("ga8mzc7","请上传活动海报","lang"),trigger:"change"}],bargains_datetime:[{required:!0,validator:(e,t,i)=>""==this.form.bargains_datetime_begin&&""==this.form.bargains_datetime_end?i(new Error($t("n16319","请选择活动起止时间","lang"))):""==this.form.bargains_datetime_begin?i(new Error($t("5aitwz9","请选择活动开始时间","lang"))):""==this.form.bargains_datetime_end?i(new Error($t("1816aa9","请选择活动结束时间","lang"))):void i(),trigger:"blur"}],bargain_rules:[{required:!0,message:$t("jec8fp7","请输入活动规则","lang"),trigger:"blur"}],item_name:[{required:!0,message:$t("n94gm27","请输入产品名称","lang"),trigger:"blur"}],item_pics:[{required:!0,message:$t("k4vomo7","请上传产品图片","lang"),trigger:"blur"}],mkt_price:[{required:!0,validator:(e,t,i)=>{if(""==this.form.mkt_price)return i(new Error($t("n94rqd7","请输入产品原价","lang")));if(/^(([1-9]\d*)|0)(\.\d{1,2})?$/.test(this.form.mkt_price)){if(+this.form.mkt_price<+this.form.price)return i(new Error($t("6ylhrmc","产品原价必须大于产品低价","lang")));i()}else i(new Error($t("lnsh3wg","产品原价正数，精确到小数点后2位","lang")))},trigger:"blur"}],price:[{required:!0,validator:(e,t,i)=>{if(""==this.form.price)return i(new Error($t("n92wm37","请输入产品底价","lang")));if(/^(([1-9]\d*)|0)(\.\d{1,2})?$/.test(this.form.price)){if(+this.form.price>+this.form.mkt_price)return i(new Error($t("nedyqlc","产品底价必须小于产品原价","lang")));i()}else i(new Error($t("sk5yy6g","产品底价正数，精确到小数点后2位","lang")))},trigger:"blur"}],price_range:[{required:!0,validator:(e,t,i)=>""==this.form.price_min&&""==this.form.price_max?i(new Error($t("mr8nez7","请输入助力区间","lang"))):""==this.form.price_min?i(new Error($t("p9mmcf9","请输入最低可砍金额","lang"))):""==this.form.price_max?i(new Error($t("e19frp9","请输入最高可砍金额","lang"))):this.form.price_max<=this.form.price_min+1?i(new Error($t("yodnw1f","最大助力金额要大于最低助力金额","lang"))):void i(),trigger:"blur"}],people_range:[{required:!0,validator:(e,t,i)=>/^\+?[1-9][0-9]*$/.test(this.form.people_min)?/^\+?[1-9][0-9]*$/.test(this.form.people_max)?this.form.people_min<1?i(new Error($t("rhdbqvf","最少助力人数要大于1且为正整数","lang"))):+this.form.people_max<=+this.form.people_min?i(new Error($t("47yy81f","最多助力人数要大于最少助力人数","lang"))):void i():i(new Error($t("rmag9vc","最多助力人数必须为正整数","lang"))):i(new Error($t("40yw5wc","最少助力人数必须为正整数","lang"))),trigger:"blur"}],min_price:[{required:!0,message:$t("obfmbc9","请输入最少助力金额","lang"),trigger:"blur"}],limit_num:[{required:!0,type:"number",message:$t("n91dfi7","请输入产品数量","lang"),trigger:"blur"}],item_intro:[{required:!0,message:$t("n8v3lq7","请输入产品详情","lang"),trigger:"blur"}],share_msg:[{required:!0,message:$t("muq3oe7","请输入分享内容","lang"),trigger:"blur"}]}}},mounted(){this.$route.params.bargain_id&&(0,s.getBargainsDetail)(this.$route.params.bargain_id).then(e=>{let t=e.data.data;t.price=t.price/100,t.limit_num=+t.limit_num,t.mkt_price=t.mkt_price/100,t.price_min=t.bargain_range.min/100,t.price_max=t.bargain_range.max/100,t.people_min=t.people_range.min,t.people_max=t.people_range.max,t.min_price=t.min_price/100,t.bargains_datetime_begin=new Date(1e3*parseInt(t.begin_time)),t.bargains_datetime_end=new Date(1e3*parseInt(t.end_time)),this.form=t,this.goodsShow(this.form)}).catch(e=>{this.$router.go(-1)})},methods:{changeItem(){this.goodsDialogVisible=!0,this.getGoodsList()},goodsHandleCurrentChange(e){this.itemsParams.page=e,this.getGoodsList()},goodsSearch(){this.getGoodsList()},getGoodsList(){this.itemsLoading=!0;let e=this.itemsParams;e.approve_status=["onsale"],e.is_gift=!1,(0,o.getItemsList)(e).then(e=>{this.itemsLoading=!1,this.itemsList=e.data.data.list,this.itemsTotalCount=e.data.data.total_count}).catch(e=>{this.itemsLoading=!1,this.$message({type:"error",message:$t("up12y1c","获取商品列表列表信息出错","lang")})})},changeGoods(e){switch(e){case"every":this.$set(this.itemsParams,"consume_type","every"),this.$delete(this.itemsParams,"item_type"),this.goodsTypeTitle=$t("cbhw3i5","服务类商品","lang");break;case"normal":this.$set(this.itemsParams,"item_type","normal"),this.$delete(this.itemsParams,"consume_type"),this.goodsTypeTitle=$t("dl86755","实体类商品","lang")}this.getGoodsList()},priceformatter(e,t){return this.cursymbol+e.price/100},chooseItem(e){this.goodsDialogVisible=!1,this.goods=e,this.goods.price=this.goods.price/100,this.form.item_id=e.itemId,this.form.item_name=e.itemName,this.form.item_pics=e.pics[0],this.form.mkt_price=this.goods.price,this.form.limit_num=this.goods.store},goodsShow(e){let t={pics:[e.item_pics],itemName:e.item_name,price:e.mkt_price,store:e.limit_num};this.goodsDialogVisible=!1,this.goods=t},handleImgChange(){this.imgDialog=!0,this.isGetImage=!0},pickImg(e){this.form.ad_pic=e.url,this.imgDialog=!1},closeImgDialog(){this.imgDialog=!1},handlePicsChange(){this.picsDialog=!0,this.isGetPics=!0,this.isPicsAdd=!0},pickPics(e){this.isPicsAdd?this.form.help_pics.push(e.url):this.form.help_pics[this.picsEditIndex]=e.url,this.picsDialog=!1},closePicsDialog(){this.picsDialog=!1},handleProductPicChange(){this.productPicDialog=!0,this.isGetProductPic=!0},productPic(e){this.form.item_pics=e.url,this.productPicDialog=!1},closeProductPicDialog(){this.productPicDialog=!1},cancel(){this.$router.go(-1)},updateBargainsRule(e){this.form.bargain_rules=e},updateProductDetail(e){this.form.item_intro=e},save(){const e=this;this.$refs.form.validate(t=>{if(t){var i={min:this.form.price_min,max:this.form.price_max},a={min:this.form.people_min,max:this.form.people_max};""===this.form.item_id&&this.$message.error($t("3l3hw16","请选择商品!","lang"));var o={title:this.form.title,ad_pic:this.form.ad_pic,item_name:this.form.item_name,item_pics:this.form.item_pics,item_intro:this.form.item_intro,price:this.form.price,mkt_price:this.form.mkt_price,limit_num:this.form.limit_num,bargain_rules:this.form.bargain_rules,bargain_range:i,people_range:a,min_price:this.form.min_price,begin_time:r.A.formatDate.format(this.form.bargains_datetime_begin,"y-M-d h:m:s"),end_time:r.A.formatDate.format(this.form.bargains_datetime_end,"y-M-d h:m:s"),share_msg:this.form.share_msg,help_pics:this.form.help_pics,item_id:this.form.item_id};this.form.bargain_id?(o.bargain_id=this.form.bargain_id,(0,s.updateBargains)(this.form.bargain_id,o).then(t=>{if(!t.data.data.bargain_id)return this.$message.error($t("q2qnzi9","更新助力活动失败!","lang")),!1;this.$message({message:$t("deua4r4","更新成功","lang"),type:"success",duration:2e3,onClose(){e.refresh(),e.$router.go(-1)}})})):(0,s.addBargins)(o).then(t=>{if(!t.data.data.bargain_id)return this.$message.error($t("p47ew99","添加助力活动失败!","lang")),!1;this.$message({message:$t("e7ygyc4","添加成功","lang"),type:"success",duration:2e3,onClose(){e.refresh(),e.$router.go(-1)}})})}})},picsEdit(e){this.isPicsAdd=!1,this.picsEditIndex=e,this.picsDialog=!0,this.isGetPics=!0},picsDelete(e){this.form.help_pics.splice(e,1)},addImgPreview(){this.thumbDialog=!0,this.isGetThumb=!0},pickThumb(e){if(e&&""!==e.url){this.thumbDialog=!1;this.$refs.editor.$el.id;var t=this.$refs.editor,i=new Image;i.src=this.wximageurl+e.url,t.range?t.range.insertNode(i):(t.$refs.content.appendChild(i),t.focus(),t.restoreSelection()),this.form.item_intro=t.$refs.content.innerHTML}},closeThumbDialog(){this.thumbDialog=!1}}},n=l,m=(0,i(81656).A)(n,function(){var e=this,t=e._self._c;return t("div",{staticClass:"section-white content-padded bargain-box"},[t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"110px"}},[t("el-form-item",{attrs:{label:$t("e4hvdc4","活动名称","lang"),prop:"title"}},[t("el-input",{staticStyle:{width:"280px"},attrs:{maxlength:20},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}}),e._v(" "),t("span",{staticClass:"frm-tips"},[e._v(e._s(e.form.title.length)+"/20")])],1),t("el-form-item",{attrs:{label:$t("e4m2e34","活动海报","lang"),prop:"ad_pic"}},[t("p",{staticClass:"frm-tips"},[e._v($t("afg3x8k","点击图片可更换，图片大小不能超过 2MB","lang"))]),t("div",{staticClass:"activity-poster"},[t("div",{staticClass:"upload-box",on:{click:e.handleImgChange}},[e.form.ad_pic?t("img",{staticClass:"avatar",attrs:{src:e.wximageurl+e.form.ad_pic}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])]),t("imgPicker",{attrs:{"dialog-visible":e.imgDialog,"sc-status":e.isGetImage},on:{chooseImg:e.pickImg,closeImgDialog:e.closeImgDialog}})],1),t("el-form-item",{attrs:{label:$t("e4l2kr4","活动时间","lang"),prop:"bargains_datetime"}},[t("el-date-picker",{attrs:{type:"datetime",placeholder:$t("bnj1ct8","选择开始日期时间","lang")},model:{value:e.form.bargains_datetime_begin,callback:function(t){e.$set(e.form,"bargains_datetime_begin",t)},expression:"form.bargains_datetime_begin"}}),e._v(" ~ "),t("el-date-picker",{attrs:{type:"datetime",placeholder:$t("7ve96k8","选择结束日期时间","lang")},model:{value:e.form.bargains_datetime_end,callback:function(t){e.$set(e.form,"bargains_datetime_end",t)},expression:"form.bargains_datetime_end"}})],1),t("el-form-item",{attrs:{label:$t("e4qsf64","活动规则","lang"),prop:"bargain_rules"}},[t("el-col",{attrs:{span:12}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.form.bargain_rules,callback:function(t){e.$set(e.form,"bargain_rules",t)},expression:"form.bargain_rules"}})],1)],1),t("el-form-item",{attrs:{label:$t("gma35m4","翻牌图片","lang"),prop:"bargain_pics"}},[t("p",{staticClass:"frm-tips"},[e._v($t("ci0i5gw","建议图片尺寸151px * 185px，图片大小不能超过 2MB","lang"))]),t("div",{staticClass:"pics-box"},[t("div",{staticClass:"pics-list"},[e._l(e.form.help_pics,function(i,a){return[t("div",{staticClass:"pics-item"},[t("img",{attrs:{src:e.wximageurl+i}}),t("div",{staticClass:"bg-mask"},[t("i",{staticClass:"icon el-icon-edit-outline",on:{click:function(t){return e.picsEdit(a)}}}),t("i",{staticClass:"icon el-icon-delete",on:{click:function(t){return e.picsDelete(a)}}})])])]}),t("div",{staticClass:"upload-box",on:{click:e.handlePicsChange}},[t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],2)]),t("imgPicker",{attrs:{"dialog-visible":e.picsDialog,"sc-status":e.isGetPics},on:{chooseImg:e.pickPics,closeImgDialog:e.closePicsDialog}})],1),t("el-form-item",{attrs:{label:$t("art8jw4","助力产品","lang")}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{staticStyle:{"padding-left":"0px"},attrs:{span:20}},[t("p",{staticClass:"frm-tips"}),t("div",{staticClass:"logo-box"},[t("div",{staticClass:"bran-img"},[e.goods.pics?t("div",{staticClass:"groups-addgoods"},[t("img",{staticClass:"groups-goodspic",attrs:{src:e.wximageurl+e.goods.pics[0]}}),t("div",{staticClass:"gooups-goodsmsg"},[t("div",[e._v(e._s(e.goods.itemName))]),t("div",[e._v($t("awi2ir4","原价：￥","lang")+e._s(e.goods.price))]),"normal"==e.goods.item_type||e.goods.store>0?t("div",[e._v($t("ew22d4"," 库存：","lang")+e._s(e.goods.store)+" ")]):e._e()])]):t("div",{staticClass:"upload-box",attrs:{tabindex:"0"},on:{click:e.changeItem}},[t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.changeItem}},[e._v($t("mwtd0l6"," 选择商品 ","lang"))])],1)])],1)],1),t("el-form-item",{attrs:{label:$t("aa048s4","产品底价","lang"),prop:"price"}},[t("el-input",{staticStyle:{width:"120px"},model:{value:e.form.price,callback:function(t){e.$set(e.form,"price",t)},expression:"form.price"}}),e._v($t("y2mmehc"," 元，最多保留两位小数 ","lang"))],1),t("el-form-item",{attrs:{label:$t("artcaw4","助力人数","lang"),prop:"people_range"}},[t("el-input",{staticStyle:{width:"80px"},attrs:{type:"number",min:"1",placeholder:$t("ddk0xz4","最少人数","lang")},model:{value:e.form.people_min,callback:function(t){e.$set(e.form,"people_min",t)},expression:"form.people_min"}}),e._v(" ~ "),t("el-input",{staticStyle:{width:"80px"},attrs:{type:"number",min:"2",placeholder:$t("dd4e4w4","最多人数","lang")},model:{value:e.form.people_max,callback:function(t){e.$set(e.form,"people_max",t)},expression:"form.people_max"}})],1),t("el-form-item",{attrs:{label:$t("aocx6h4","分享内容","lang"),prop:"share_msg"}},[t("el-input",{staticStyle:{width:"280px"},model:{value:e.form.share_msg,callback:function(t){e.$set(e.form,"share_msg",t)},expression:"form.share_msg"}})],1),t("el-form-item",{staticClass:"content-center"},[t("el-button",{on:{click:e.cancel}},[e._v($t("m1m0m4"," 返回 ","lang"))]),t("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v($t("cp35x4"," 保存 ","lang"))])],1)],1),t("el-dialog",{attrs:{title:$t("ikwu2j4","选择商品","lang"),visible:e.goodsDialogVisible,center:""},on:{"update:visible":function(t){e.goodsDialogVisible=t}}},[t("el-button-group",{staticClass:"tab-group"}),t("el-row",{staticClass:"content-bottom-padded",attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-input",{attrs:{placeholder:$t("b40v0e4","商品名称","lang")},model:{value:e.itemsParams.keywords,callback:function(t){e.$set(e.itemsParams,"keywords",t)},expression:"itemsParams.keywords"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.goodsSearch},slot:"append"})],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.itemsLoading,expression:"itemsLoading"}],staticStyle:{width:"100%"},attrs:{data:e.itemsList,border:"",height:"500"}},[t("el-table-column",{attrs:{prop:"itemName",label:$t("b40v0e4","商品名称","lang")}}),t("el-table-column",{attrs:{label:$t("j6yhu3","缩略图","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("img",{attrs:{width:"20",src:e.wximageurl+i.row.pics[0]}})]}}])}),t("el-table-column",{attrs:{prop:"price",label:$t("m8lft3","销售价","lang"),formatter:e.priceformatter}}),t("el-table-column",{attrs:{prop:"itemName",label:$t("k1e32","状态","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[e.form.item_id!=i.row.itemId?t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.chooseItem(i.row)}}},[e._v($t("m4r284"," 选择 ","lang"))]):t("span",[e._v($t("egewi3","已选择","lang"))])]}}])})],1),e.itemsTotalCount>e.itemsParams.pageSize?t("div",{staticClass:"content-center content-top-padded"},[t("el-pagination",{attrs:{layout:"prev, pager, next","current-page":e.itemsParams.page,total:e.itemsTotalCount,"page-size":e.itemsParams.pageSize},on:{"update:currentPage":function(t){return e.$set(e.itemsParams,"page",t)},"update:current-page":function(t){return e.$set(e.itemsParams,"page",t)},"current-change":e.goodsHandleCurrentChange}})],1):e._e(),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.centerDialogVisible=!1}}},[e._v($t("bybnk3","关 闭","lang"))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.centerDialogVisible=!1}}},[e._v($t("hnjoo3","确 定","lang"))])],1)],1)],1)},[],!1,null,"121137d6",null).exports}}]);