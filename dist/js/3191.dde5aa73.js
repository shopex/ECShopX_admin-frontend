"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[3191],{23191:function(e,t,a){a.r(t),a.d(t,{default:function(){return n}});a(44114);var i=a(91142),l=a(77944);const r=[{name:$t("hu2t2","文本","lang"),type:1},{name:$t("hr6v2","数字","lang"),type:2},{name:$t("hwbe2","日期","lang"),type:3},{name:$t("eyqc2","单选","lang"),type:4},{name:$t("dqmui3","复选框","lang"),type:5},{name:$t("ewbd43","手机号","lang"),type:6}];var s={filters:{filterType(e){return r.find(t=>t.type===e).name}},data(){return{activeName:"first",pageTitle:$t("wv83e0d","会员中心个人信息录入项配置","lang"),settingStatus:!1,showAdd:!1,isLoading:!1,total_count:0,selectValue:{label:"",is_checked:0},isMustAuth:!1,formTypeList:r,pageParam:{page:1,page_size:10},tableData:[],editform:{module_type:1,label:"",field_type:1,alert_required_message:"",is_required:0,is_edit:1,range:{start:"",end:""},radio_list:[]},privacyForm:{privacy:{title:"",content:""},member_register:{title:"",content:""}},editformRules:{label:[{required:!0,message:$t("2j7m1y5","请输入标题","lang"),trigger:"blur"}],alert_required_message:[{required:!0,message:$t("7j6q866","请输入提示语","lang"),trigger:"blur"}],range:[{required:!0,validator:(e,t,a)=>{!t.start||!t.end||t.start>=t.end?a(new Error($t("52m8dka","请输入正确的数字范围","lang"))):a()},trigger:"blur"}],radio_list:[{required:!0,message:$t("6rdmpg5","请添加选项","lang"),trigger:"blur"}]},rules:{"privacy.title":[{required:!0,message:$t("mfu5gn7","请输入协议标题","lang"),trigger:"blur"}],"member_register.title":[{required:!0,message:$t("mfu5gn7","请输入协议标题","lang"),trigger:"blur"}],"privacy.content":[{required:!0,message:$t("mxwidd7","请输入充值协议","lang"),trigger:"blur"}],"member_register.content":[{required:!0,message:$t("jg81107","请输入注册协议","lang"),trigger:"blur"}]},rules2:{title:[{required:!0,message:$t("2j7m1y5","请输入标题","lang"),trigger:"blur"}],content:[{required:!0,message:$t("7jrwp16","请输入意向书","lang"),trigger:"blur"}]},modalTitle:"",medicineForm:{title:"",content:""}}},computed:{isSelectValue({selectValue:e}){return!!e.label}},mounted(){this.getFormItems(),this.getShopRules(),this.getMemberFieldSetting()},methods:{pageChange(e){this.pageParam.page=e,this.getFormItems()},async getFormItems(e=!1){this.isLoading=!0,e&&(this.pageParam.page=1);const{pageParam:t}=this,a=await(0,i.getRegForm)({module_type:1,id:-1,...t}),{list:l=[],total_count:r}=a.data.data;this.tableData=l,this.isLoading=!1,this.total_count=r},async getShopRules(){const e=await(0,l.getRulesInfo)(),t=Array.isArray(e.data.data)?{}:e.data.data;this.privacyForm.member_register=t.member_register||{title:"",content:""},this.privacyForm.privacy=t.privacy||{title:"",content:""},this.medicineForm=t.ehospital_risk_informed||{title:"",content:""}},saveForm(){this.$refs.editform.validate(async e=>{e&&(this.editform.id?await(0,i.updateRegForm)(this.editform):await(0,i.createRegForm)(this.editform),this.getFormItems(!0),this.cancelEdit())})},cancelEdit(){this.showAdd=!1,this.selectValue={label:"",is_checked:0},this.editform={module_type:1,label:"",field_type:1,alert_required_message:"",is_required:0,is_edit:1,range:{start:"",end:""},radio_list:[]},this.modalTitle=""},fieldTypeChange(){this.editform.radio_list=[],this.selectValue={label:"",is_checked:0}},saveSelect(){const{selectValue:e,editform:t}=this;e.label?(this.editform.radio_list.push(e),this.selectValue={label:"",is_checked:0}):this.$message({message:$t("r8aswo7","请填写正确的值","lang"),type:"warning"})},handleRmoveTag(e){const{editform:t}=this,{label:a}=e,i=t.radio_list.findIndex(e=>e.label===a);t.radio_list.splice(i,1)},showAddDialog(e={}){if(e.id){const{id:t="",module_type:a=1,label:i="",field_type:l=1,alert_required_message:r="",is_required:s=0,is_edit:n=1,range:o={start:"",end:""},validate_condition:c=[]}=e;this.editform={id:t,module_type:a,label:i,field_type:l,alert_required_message:r,is_required:0,is_edit:1,range:o,radio_list:[...c]},this.modalTitle=$t("gms6yk4","编辑配置","lang")}else this.modalTitle=$t("d7ere74","新增配置","lang");this.showAdd=!0},deleteField(e){const{id:t}=e;this.$confirm($t("mhpihgg","此操作将删除此规则, 是否继续?","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(async()=>{await(0,i.deleteRegForm)({id:t}),this.$message({type:"success",message:$t("eo3f4i5","删除成功!","lang")}),this.getFormItems(!0)})},async toggleStatus(e,t){const{id:a,status:l}=e;await(0,i.toggleRegForm)({id:a,type:t,switch:0===l?1:0}),this.getFormItems()},handleClick(e,t){const a={first:$t("wv83e0d","会员中心个人信息录入项配置","lang"),second:$t("62yossb","注册协议与隐私政策配置","lang"),third:$t("onm9zgh","互联网诊疗风险告知及知情同意书配置","lang")};this.pageTitle=a[this.activeName]},updateContent:function(e){this.privacyForm.member_register.content=e},updatePrivacyAgreement:function(e){this.privacyForm.privacy.content=e},async saveMedicineContent(){this.$refs.medicine.validate(e=>{e&&(0,l.putRulesInfo)({data:[{type:"ehospital_risk_informed",...this.medicineForm}]}).then(e=>{this.$message({message:$t("aghf564","保存成功","lang"),type:"success"}),this.getShopRules("medicine")})})},saveContent(e){this.$refs.privacy.validate(e=>{e&&(0,l.putRulesInfo)({data:[{type:"privacy",...this.privacyForm.privacy},{type:"member_register",...this.privacyForm.member_register}]}).then(e=>{this.$message({message:$t("aghf564","保存成功","lang"),type:"success"}),this.getShopRules()})})},async getMemberFieldSetting(){const e=await(0,i.getMemberFieldSetting)(),{switch_first_auth_force_validation:t}=e.data.data;this.isMustAuth=!!t},async onChangeMustAuth(){await(0,i.saveMemberFieldSetting)({switch_first_auth_force_validation:this.isMustAuth?1:0})}}},n=(0,a(81656).A)(s,function(){var e=this,t=e._self._c;return t("SpPage",{staticClass:"memberReg"},[e.VERSION_SHUYUN()?e._e():t("SpPlatformTip",{attrs:{h5:"",app:"",alipay:""}}),t("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:$t("ak6vo65","注册项配置","lang"),name:"first"}},[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"between",attrs:{slot:"header"},slot:"header"},[t("span",[e._v($t("wv83e0d","会员中心个人信息录入项配置","lang"))]),t("div",[e.VERSION_SHUYUN()?e._e():t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.showAddDialog()}}},[e._v($t("1nitzj6"," 新增配置 ","lang"))])],1)]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],attrs:{data:e.tableData}},[t("el-table-column",{attrs:{label:$t("e46m2","信息","lang"),prop:"label"}}),t("el-table-column",{attrs:{label:$t("d8pu5s4","是否启用","lang")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-switch",{attrs:{value:!!a.row.is_open,disabled:!!a.row.is_must_start_required},on:{change:function(t){return e.toggleStatus({id:a.row.id,status:a.row.is_open},1)}}})]}}])}),t("el-table-column",{attrs:{label:$t("ahbxj54","信息格式","lang")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("filterType")(t.row.field_type))+" ")]}}])}),t("el-table-column",{attrs:{label:$t("d3gn7v4","提示文案","lang"),prop:"alert_required_message"}}),t("el-table-column",{attrs:{label:$t("hkxb2","操作","lang")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.showAddDialog(a.row)}}},[e._v($t("juz394"," 编辑 ","lang"))]),e.VERSION_SHUYUN()||a.row.is_default?e._e():t("el-button",{staticClass:"delete",attrs:{type:"text"},on:{click:function(t){return e.deleteField(a.row)}}},[e._v($t("db22k4"," 删除 ","lang"))])]}}])})],1)],1),t("div",{staticClass:"pagination"},[e.total_count>0?t("el-pagination",{attrs:{small:"",layout:"prev, pager, next",total:e.total_count,"page-size":e.pageParam.page_size},on:{"current-change":e.pageChange}}):e._e()],1)],1),t("el-tab-pane",{staticClass:"paneSecond",attrs:{label:$t("62yossb","注册协议与隐私政策配置","lang"),name:"second"}},[t("div",{staticClass:"mainSecond"},[t("el-form",{ref:"privacy",attrs:{model:e.privacyForm,rles:e.rules,"label-width":"100px"}},[t("div",{staticClass:"section-white content-padded"},[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"text item"},[t("el-form-item",{attrs:{label:$t("yiijys6","注册协议标题","lang"),prop:"member_register.title"}},[t("el-input",{staticStyle:{width:"500px"},attrs:{placeholder:$t("yiijys6","注册协议标题","lang"),"show-word-limit":"",maxlength:"30"},model:{value:e.privacyForm.member_register.title,callback:function(t){e.$set(e.privacyForm.member_register,"title",t)},expression:"privacyForm.member_register.title"}})],1),t("el-form-item",{attrs:{label:$t("e2uztv4","注册协议","lang"),prop:"member_register.content"}},[t("SpRichText",{model:{value:e.privacyForm.member_register.content,callback:function(t){e.$set(e.privacyForm.member_register,"content",t)},expression:"privacyForm.member_register.content"}})],1)],1)])],1),t("div",{staticClass:"section-white content-padded"},[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"text item"},[t("el-form-item",{attrs:{label:$t("d8rkpz6","隐私政策标题","lang"),prop:"privacy.title"}},[t("el-input",{staticStyle:{width:"500px"},attrs:{placeholder:$t("d8rkpz6","隐私政策标题","lang"),"show-word-limit":"",maxlength:"30"},model:{value:e.privacyForm.privacy.title,callback:function(t){e.$set(e.privacyForm.privacy,"title",t)},expression:"privacyForm.privacy.title"}})],1),t("el-form-item",{attrs:{label:$t("jhz6y04","隐私政策","lang"),prop:"privacy.content"}},[t("SpRichText",{model:{value:e.privacyForm.privacy.content,callback:function(t){e.$set(e.privacyForm.privacy,"content",t)},expression:"privacyForm.privacy.content"}})],1)],1)])],1)]),t("div",{staticClass:"section-footer with-border content-center"},[t("el-button",{attrs:{type:"primary"},on:{click:e.saveContent}},[e._v($t("cp35x4"," 保存 ","lang"))])],1)],1)]),t("el-tab-pane",{staticClass:"paneSecond",attrs:{label:$t("onm9zgh","互联网诊疗风险告知及知情同意书配置","lang"),name:"third"}},[t("div",{staticClass:"mainSecond"},[t("el-form",{ref:"medicine",attrs:{model:e.medicineForm,rules:e.rules2,"label-width":"100px"}},[t("div",{staticClass:"section-white content-padded"},[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"text item"},[t("el-form-item",{attrs:{label:$t("8ylmgce","互联网诊疗风险告及知情同意书","lang"),prop:"title"}},[t("el-input",{staticStyle:{width:"500px"},attrs:{placeholder:$t("8ylmgce","互联网诊疗风险告及知情同意书","lang")},model:{value:e.medicineForm.title,callback:function(t){e.$set(e.medicineForm,"title",t)},expression:"medicineForm.title"}})],1),t("el-form-item",{attrs:{label:$t("8ylmgce","互联网诊疗风险告及知情同意书","lang"),prop:"content"}},[t("SpRichText",{model:{value:e.medicineForm.content,callback:function(t){e.$set(e.medicineForm,"content",t)},expression:"medicineForm.content"}})],1)],1)])],1)]),t("div",{staticClass:"section-footer with-border content-center"},[t("el-button",{attrs:{type:"primary"},on:{click:e.saveMedicineContent}},[e._v($t("cp35x4"," 保存 ","lang"))])],1)],1)])],1),t("el-dialog",{attrs:{visible:e.showAdd,title:e.modalTitle},on:{"update:visible":function(t){e.showAdd=t},close:e.cancelEdit}},[t("el-form",{ref:"editform",staticClass:"editform",attrs:{model:e.editform,rules:e.editformRules,"label-width":"120px"}},[t("el-form-item",{attrs:{label:$t("iuxnua4","配置标题","lang"),prop:"label"}},[t("el-input",{attrs:{type:"text",maxlength:"9","show-word-limit":""},model:{value:e.editform.label,callback:function(t){e.$set(e.editform,"label",t)},expression:"editform.label"}})],1),t("el-form-item",{attrs:{label:$t("ahbxj54","信息格式","lang")}},[t("el-select",{on:{change:e.fieldTypeChange},model:{value:e.editform.field_type,callback:function(t){e.$set(e.editform,"field_type",t)},expression:"editform.field_type"}},e._l(e.formTypeList,function(e){return t("el-option",{key:e.type,attrs:{label:e.name,value:e.type}})}),1)],1),2===e.editform.field_type?t("el-form-item",{attrs:{label:$t("d4z1gd4","数值范围","lang"),prop:"range"}},[t("el-row",{staticClass:"rangRow"},[t("el-col",{attrs:{span:11}},[t("el-input",{attrs:{type:"number"},model:{value:e.editform.range.start,callback:function(t){e.$set(e.editform.range,"start",t)},expression:"editform.range.start"}})],1),t("el-col",{staticStyle:{"text-align":"center"},attrs:{span:2}},[e._v(" - ")]),t("el-col",{attrs:{span:11}},[t("el-input",{attrs:{type:"number"},model:{value:e.editform.range.end,callback:function(t){e.$set(e.editform.range,"end",t)},expression:"editform.range.end"}})],1)],1)],1):e._e(),4===e.editform.field_type||5===e.editform.field_type?t("el-form-item",{staticClass:"select",attrs:{label:$t("isqo2s4","选项内容","lang"),prop:"select"}},[t("el-input",{attrs:{placeholder:$t("edas2","内容","lang"),type:"text","show-word-limit":""},model:{value:e.selectValue.label,callback:function(t){e.$set(e.selectValue,"label",t)},expression:"selectValue.label"}},[t("template",{slot:"append"},[t("el-button",{attrs:{type:"primary",disabled:!e.isSelectValue},on:{click:e.saveSelect}},[e._v($t("iv7ii4"," 确认 ","lang"))])],1)],2),t("div",{staticClass:"tags"},e._l(e.editform.radio_list,function(a,i){return t("el-tag",{key:i,staticClass:"item",attrs:{closable:""},on:{close:function(t){return e.handleRmoveTag(a)}}},[e._v(" "+e._s(a.label)+" ")])}),1)],1):e._e(),t("el-form-item",{attrs:{label:$t("d3gn7v4","提示文案","lang"),prop:"alert_required_message"}},[t("el-input",{attrs:{type:"text",maxlength:"15","show-word-limit":""},model:{value:e.editform.alert_required_message,callback:function(t){e.$set(e.editform,"alert_required_message",t)},expression:"editform.alert_required_message"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.saveForm}},[e._v($t("iv7ii4"," 确认 ","lang"))]),t("el-button",{on:{click:e.cancelEdit}},[e._v($t("dd4ni4"," 取消 ","lang"))])],1)],1)],1)],1)},[],!1,null,"886a180c",null).exports}}]);