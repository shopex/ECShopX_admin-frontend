"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[5090],{25090:function(t,e,a){a.r(e),a.d(e,{default:function(){return n}});a(18111),a(7588),a(18237);var s=a(5134),l=a(26456),i={data(){return{detailDialog:!1,detailDialog2:!1,activeName:this.VERSION_SHUYUN()?"second":"first",messageCount:0,smsTemlateList:{},messageAutograph:"",sms_buy_url:"",currentTemplate:{is_open:!1,content:"",send_time_desc:{title:""}},loading:!1,messageAutographDis:!0,testMobile:"",messgeLoading:!1,inquireVariableVis:!1,tableData:[{name:$t("d3hlvr4","支付时间","lang"),content:$t("1co9j4","19字符","lang")},{name:$t("d3p2yd4","支付金额","lang"),content:$t("ya20jbd","默认8字符，以实际发送为准","lang")},{name:$t("e4hvdc4","活动名称","lang"),content:$t("irwkdwe","默认30字符，以实际发送为准","lang")},{name:$t("bzxjxc4","审核结果","lang"),content:$t("4k73zsd","默认9字符，以实际发送为准","lang")}]}},computed:{messageTxtNums(){let t=Object.values(this.currentTemplate.send_time_desc.variables||{}).reduce((t,e)=>t+e,0);return this.currentTemplate.content.replace(/\{\{.*?\}\}/g,"").length+t+this.messageAutograph.length+4+("notice"!=this.currentTemplate.sms_type?6:0)}},mounted(){this.VERSION_SHUYUN()&&(this.activeName="second"),(0,s.getSmsBasic)().then(t=>{if(t.data.data.sms_remainder){let e=t.data.data.sms_remainder.info;this.messageCount=e.all_residual}this.sms_buy_url=t.data.data.sms_buy_url}),(0,s.getSmsTemplateList)().then(t=>{const{list:e}=t.data.data,a={};Object.keys(e).forEach(t=>{(0,l.bz)()?"merchant"!=t&&(a[t]=e[t]):a[t]=e[t]}),this.smsTemlateList=a}),(0,s.getSmsSign)().then(t=>{this.messageAutograph=t.data.data.sign||""})},methods:{closeDialog(){if(this.VERSION_SHUYUN()){const{tmpl_name:t,is_open:e,content:a}=this.currentTemplate;let l={template_name:t,is_open:e,content:a};this.loading=!0,(0,s.updateSmsTemplate)(l).then(t=>{t.data.data.status&&(this.detailDialog2=!1)}).finally(()=>{this.loading=!1})}else this.detailDialog=!1},toDetail(t){this.VERSION_SHUYUN()?this.detailDialog2=!0:this.detailDialog=!0,this.currentTemplate=t},openChange(t){let e={template_name:this.currentTemplate.tmpl_name,is_open:t};(0,s.updateSmsTemplate)(e).then(t=>{})},handleMessageTest(){const{tmpl_name:t,content:e}=this.currentTemplate,a={tmpl_name:t,mobile:this.testMobile,content:e};this.messgeLoading=!0,(0,s.testMessage)(a).then(t=>{t.data.data.status&&this.$message({type:"success",message:$t("b65a734","发送成功","lang")})}).finally(()=>{this.messgeLoading=!1})},saveSmsSignAction(){let t={sign:this.messageAutograph};(0,s.saveSmsSign)(t).then(t=>{this.$message({type:"success",message:$t("u8xuqm8","设置短信签名成功","lang")}),this.messageAutographDis=!0})},editSmsSignAction(){this.messageAutographDis=!this.messageAutographDis},handleInquireVariable(){this.inquireVariableVis=!0}}},n=(0,a(81656).A)(i,function(){var t=this,e=t._self._c;return e("SpPage",[e("div",{staticClass:"shopex-sms-page"},[e("div",{staticClass:"btn"},[t.VERSION_SHUYUN()?t._e():e("router-link",{staticClass:"link",attrs:{to:"/setting/datamessage"}},[t._v($t("jif2mh7"," 切换短信商 ","lang"))])],1),e("el-tabs",{attrs:{type:"border-card"},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[t.VERSION_SHUYUN()?t._e():e("el-tab-pane",{attrs:{label:$t("fgx36t4","短信账户","lang"),name:"first"}},[e("el-alert",{attrs:{type:"warning",title:$t("fgqa5p4","短信推送","lang"),"show-icon":"",description:$t("jns8jm1q","短信推送即通过发送短信，给买家推送交易等提醒信息，包括付款、预约、核销等，以提升买家的到店体验，获得会员到店转化率和复购率。","lang")}}),e("div",{staticClass:"content-padded message-content"},[t._v($t("2qlybi6"," 短信余额：","lang")),e("span",{staticClass:"message-count"},[t._v(t._s(t.messageCount))]),t._v($t("hl272","条 ","lang")),e("a",{attrs:{href:t.sms_buy_url,target:"_blank"}},[e("el-button",{attrs:{type:"primary",size:"mini"}},[t._v($t("cnrte3","去充值","lang"))])],1)])],1),e("el-tab-pane",{attrs:{label:$t("fgr5si4","短信模板","lang"),name:"second"}},[e("el-dialog",{attrs:{title:$t("gurc1m6","短信模版详情","lang"),size:"tiny",visible:t.detailDialog,"close-on-click-modal":!1},on:{"update:visible":function(e){t.detailDialog=e}}},[e("div",{staticClass:"section-body"},[e("el-form",{attrs:{"label-width":"100px"}},[e("el-form-item",{attrs:{label:$t("d8rhvq4","是否开启","lang")}},[e("el-switch",{attrs:{"active-text":" ","active-value":"true","inactive-text":" ","active-color":"#13ce66"},on:{change:t.openChange},model:{value:t.currentTemplate.is_open,callback:function(e){t.$set(t.currentTemplate,"is_open",e)},expression:"currentTemplate.is_open"}})],1),e("el-form-item",{attrs:{label:$t("8u3v6d5","发送时间点","lang")}},[t._v(" "+t._s(t.currentTemplate.send_time_desc.title)+" ")]),e("el-form-item",{attrs:{label:$t("fgmwrs4","短信内容","lang")}},[e("el-input",{staticStyle:{width:"60%"},attrs:{type:"textarea",rows:5,readonly:!0},model:{value:t.currentTemplate.content,callback:function(e){t.$set(t.currentTemplate,"content",e)},expression:"currentTemplate.content"}})],1),e("div",{staticClass:"section-footer with-border content-center",staticStyle:{width:"100%"}},[e("el-button",{attrs:{type:"primary"},on:{click:t.closeDialog}},[t._v($t("in1ck4"," 确定 ","lang"))])],1)],1)],1)]),e("div",{staticClass:"message-template"},t._l(t.smsTemlateList,function(a,s){return e("div",{key:`message-template__${s}`},[e("div",{staticClass:"section-header with-border"},["promotions"==s?e("span",[t._v($t("hacjaa4","营销权益","lang"))]):t._e(),"member"==s?e("span",[t._v($t("abx8tn4","会员关怀","lang"))]):t._e(),"trade"==s?e("span",[t._v($t("acisc14","交易提醒","lang"))]):t._e(),"registration"==s?e("span",[t._v($t("e4k5914","活动报名","lang"))]):t._e(),"merchant"==s?e("span",[t._v($t("b5zkfb4","商户入驻","lang"))]):t._e(),"vcode"==s?e("span",[t._v($t("nbcoc3","验证码","lang"))]):t._e(),"adapay"==s?e("span",[t._v($t("kizz928","Adapay分账","lang"))]):t._e()]),e("div",{staticClass:"section-body"},t._l(a,function(a,s){return e("div",{key:`item__${s}`,staticClass:"item",class:"true"==a.is_open?"succ-open-sms":"not-open-sms",on:{click:function(e){return t.toDetail(a)}}},[e("div",{staticClass:"item-title clearfix"},[t._v(" "+t._s(a.send_time_desc.tmpl_title)+" "),e("i",{staticClass:"el-icon-arrow-right"})]),e("div",{staticClass:"item-content"},[t._v(" "+t._s(a.content)+" ")]),e("div",{staticClass:"item-footer"},["true"==a.is_open?e("el-button",{attrs:{type:"default",size:"small"}},[t._v($t("bldbgs5"," 启用中 ","lang"))]):e("el-button",{attrs:{type:"default",size:"small"}},[t._v($t("duwobh5"," 未启用 ","lang"))])],1)])}),0)])}),0)],1),e("el-tab-pane",{attrs:{label:$t("fgu09v4","短信签名","lang"),name:"third"}},[e("div",{staticClass:"content-padded message-autograph"},[t._v($t("8le25z7"," 短信签名： ","lang")),e("el-input",{attrs:{disabled:t.messageAutographDis,placeholder:$t("i290l07","请输入短信签名","lang")},model:{value:t.messageAutograph,callback:function(e){t.messageAutograph=e},expression:"messageAutograph"}}),e("el-button",{on:{click:t.editSmsSignAction}},[t._v(" "+t._s(t.messageAutographDis?$t("mekb2","编辑","lang"):$t("ev022","取消","lang"))+" ")]),t.messageAutographDis?t._e():e("el-button",{attrs:{type:"primary"},on:{click:t.saveSmsSignAction}},[t._v($t("in1ck4"," 确定 ","lang"))])],1),e("div",{staticClass:"message-prompt"},[e("div",{staticClass:"prompt-title"},[e("span",[t._v($t("v8ss075","常见问题：","lang"))])]),e("div",{staticClass:"prompt-content"},[e("div",{staticClass:"prompt-item"},[e("div",{staticClass:"item-title"},[t._v($t("j8d5dj9","1. 签名设置规则","lang"))]),e("div",{staticClass:"item-content"},[e("div",[t._v($t("gmdni3q","自定义签名字数限制为3-8个字，可以包含数字、英文；","lang"))]),e("div",[t._v($t("bdtoshz","建议使用你的『店铺名』或『品牌名』，使用其他签名可能短信审核不会通过！","lang"))]),e("div",[t._v($t("vfpy7hh","短信签名不宜频繁修改，请谨慎设置；","lang"))]),e("div",[t._v($t("4xgrtcp","若签名内容侵犯到第三方权益必须获得第三方真实授权；","lang"))]),e("div",[t._v($t("6tuhona"," 签名设置规范详见 ","lang")),e("a",{attrs:{href:"http://bbs.shopex.cn/forum.php?mod=viewthread&tid=4397&extra=",target:"_blank"}},[t._v("http://bbs.shopex.cn/forum.php?mod=viewthread&tid=4397&extra=")])])])]),e("div",{staticClass:"prompt-item"},[e("div",{staticClass:"item-title"},[t._v($t("9k1d0if","2. 签名会出现在哪些短信中？","lang"))]),e("div",{staticClass:"item-content"},[e("div",[t._v($t("x9ui0bw",'设置签名后，"消息推送"中列出的短信都会带上你的自定义签名，即：',"lang"))]),e("div",[t._v($t("67q77zk","交易物流提醒：订单成功、预约成功、核销；","lang"))]),e("div",[t._v($t("k6xlmij","营销关怀提醒：获得会员卡、会员卡升级；","lang"))])])]),e("div",{staticClass:"prompt-item"},[e("div",{staticClass:"item-title"},[t._v($t("7uy7d09","3. 短信计价规则","lang"))]),e("div",{staticClass:"item-content"},[e("div",[t._v($t("neatyzv","单条70字，若超出70字需要分成多条时，将按照67字每条计算；","lang"))]),e("div",[t._v($t("oj3gxei","一个汉字、数字、字母、空格都算一字；","lang"))]),e("div",[t._v($t("q6y6m1x","含有标签（如短信签名、商品名、链接）的短信以实际发送时字符数计算。","lang"))])])])])])])],1),e("el-dialog",{staticClass:"message-dialog",attrs:{title:$t("fgx0ck4","短信设置","lang"),visible:t.detailDialog2,"close-on-click-modal":!1,width:"75%"},on:{"update:visible":function(e){t.detailDialog2=e}}},[e("div",{staticClass:"section-body"},[e("div",{staticClass:"message-tip"},[t._v($t("yox7fg20"," 1.“通知类”短信无发送时间限制；“营销类”短信可发送时间为每天08:00-22:00，超出可发送时间提交的短信任务将在下一个可发送时间发送。","lang")),e("br"),t._v($t("uiktcoa"," 2.关于短信长度：","lang")),e("el-button",{attrs:{type:"text"},on:{click:t.handleInquireVariable}},[t._v($t("qwxgfe8"," 变量预估长度 ","lang"))]),e("br"),t._v($t("vlcf111x"," 1）预估长度：是系统评估当前模板可能产生的计费条数和字数，可用于评估充值短信条数；预估长度=短信签名+退订文案+短信正文+变量预估长度。","lang")),e("br"),t._v($t("8spo811t"," 2）预扣费长度：短信任务执行时，将替换已知变量后（品牌名称、活动名称、支付金额等），重新预估短信长度，完成预扣费并提交至运营商。","lang")),e("br"),t._v($t("l4hu1j1t"," 3）实际扣费：短信发送成功后，待运营商返回发送账单（一般为5个自然日，大促期间可能会有延迟），根据账单中的实际发送结果进行返款。","lang")),e("br"),t._v($t("huxeai18"," 3.短信内容请输入汉字、英文、常用标点符号、数字。其他特殊字符在实际发送中会展示异常。","lang")),e("br"),t._v($t("ucvsgr1a"," 4.编辑“通知类”短信内容时，请慎重添加营销链接，可能会触发运营商拦截，导致短信发送失败。","lang")),e("br"),t._v($t("nk5bo14"," 5.应运营商要求，“通知类”短信不可添加退订文案；“营销类”必须添加退订文案。","lang")),e("br")],1),e("div",{staticClass:"message-content"},[e("el-form",{staticClass:"message-content-left",attrs:{"label-width":"100px"}},[e("el-form-item",{attrs:{label:$t("fmyj585","是否开启：","lang")}},[e("el-switch",{attrs:{"active-text":" ","active-value":"true","inactive-text":" ","active-color":"#13ce66"},model:{value:t.currentTemplate.is_open,callback:function(e){t.$set(t.currentTemplate,"is_open",e)},expression:"currentTemplate.is_open"}})],1),e("el-form-item",{attrs:{label:$t("egngl86","发送触发点：","lang")}},[t._v(" "+t._s(t.currentTemplate.send_time_desc.title)+" ")]),e("el-form-item",{attrs:{label:$t("26sywp5","模板名称：","lang")}},[t._v(" "+t._s(t.currentTemplate.send_time_desc.tmpl_title)+" ")]),e("el-form-item",{attrs:{label:$t("2ckay45","模板类型：","lang")}},[t._v(" "+t._s("notice"==t.currentTemplate.sms_type?$t("lox5c3","通知类","lang"):$t("k2tls3","营销类","lang"))+" ")]),e("el-form-item",{attrs:{label:$t("hw0rim5","短信内容：","lang")}},[e("el-input",{staticStyle:{width:"100%"},attrs:{type:"textarea",rows:5},model:{value:t.currentTemplate.content,callback:function(e){t.$set(t.currentTemplate,"content",e)},expression:"currentTemplate.content"}}),e("div",{staticClass:"content-tip"},[e("i",{staticClass:"el-icon-warning"}),t._v($t("fgz8z54","短信预计","lang")+t._s(t.messageTxtNums)+$t("a8wurz4","个字符（","lang")+t._s(Object.keys(t.currentTemplate.send_time_desc.variables||{}).length)+$t("gzra7q8","个变量），将分为","lang")+t._s(t.messageTxtNums>70?Math.ceil(t.messageTxtNums/67):1)+$t("7nlxk8m","条短信，以实际发送为准（可能超过默认字段） ","lang"))]),"notice"!=t.currentTemplate.sms_type?e("el-checkbox",{attrs:{value:"notice"!=t.currentTemplate.sms_type,disabled:""}},[t._v($t("68akj48"," 拒收请回复R ","lang"))]):t._e()],1),e("el-form-item",{attrs:{label:$t("hpwqy15","短信签名：","lang")}},[t.messageAutograph?[t._v(t._s(t.messageAutograph))]:[e("span",{staticClass:"message-sign"},[t._v($t("54vd376","无法获取签名","lang"))]),e("el-button",{attrs:{type:"text"}},[t._v($t("cxz6z3","去设置","lang"))])]],2),e("el-form-item",{attrs:{label:$t("j75sht5","测试手机：","lang")}},[e("el-row",{attrs:{gutter:18}},[e("el-col",{attrs:{span:16}},[e("el-input",{attrs:{placeholder:$t("mt1n23e",'不同的测试手机以","隔开"',"lang")},model:{value:t.testMobile,callback:function(e){t.testMobile=e},expression:"testMobile"}})],1),e("el-col",{attrs:{span:4}},[e("el-button",{attrs:{type:"primary",loading:t.messgeLoading},on:{click:t.handleMessageTest}},[t._v($t("yamwee6"," 测试发送 ","lang"))])],1)],1)],1)],1),e("div",{staticClass:"message-content-right"},[e("div",{staticClass:"message-mobile"},[e("div",{staticClass:"message-mobile-txt"},[e("div",{staticClass:"text-box"},[t._v(" 【"+t._s(t.messageAutograph)+"】"+t._s(t.currentTemplate.content)+" "),"notice"!=t.currentTemplate.sms_type?e("div",[t._v($t("wbav806","拒收请回复R","lang"))]):t._e()])])]),e("div",{staticClass:"message-mobile-tip"},[t._v($t("yu81fmf"," 1、当前通道单条短信字数限制","lang")),e("span",{staticClass:"num"},[t._v("70")]),t._v($t("bk3retc","个字;超出70个字，均按","lang")),e("span",{staticClass:"num"},[t._v("67")]),t._v($t("vc1lwh1c","个字一条计费； 2、上图仅为操作预览，变量无固定长度，最终字数和计费条数以实际执行时发送为准。 ","lang"))])])],1),e("div",{staticClass:"section-footer with-border content-center",staticStyle:{width:"100%"}},[e("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.closeDialog}},[t._v($t("in1ck4"," 确定 ","lang"))])],1)])]),e("el-dialog",{attrs:{title:$t("fgx0ck4","短信设置","lang"),visible:t.inquireVariableVis,width:"50%"},on:{"update:visible":function(e){t.inquireVariableVis=e}}},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,border:""}},[e("el-table-column",{attrs:{prop:"name",label:$t("fgnlor4","短信变量","lang"),width:"160",align:"center"}}),e("el-table-column",{attrs:{prop:"content",label:$t("jku1wz4","预估长度","lang"),align:"center"}})],1)],1)],1)])},[],!1,null,"72fb5ee3",null).exports}}]);