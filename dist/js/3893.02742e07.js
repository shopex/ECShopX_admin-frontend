"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[3893],{83893:function(t,e,i){i.r(e),i.d(e,{default:function(){return C}});i(44114),i(18111),i(7588),i(61701);var s=i(18979),a=i.n(s),r=i(18306),o=i(2895),l=i(99502),n=i(21837),d=i(98818),m=(i(50002),i(77944)),c=i(5748),u=i(59025),h=i(54573),g=i(54438),_={inject:["refresh"],components:{DistributorSelect:l.default,GoodsSelector:h.default,UploadGoods:g.default},props:{listData:{type:Object,defalut:{}}},data(){return{loading:!1,distributorVisible:!1,setDistributorStatus:!1,distributorList:[],showDistributorList:[],itemVisible:!1,setItemStatus:!1,relItems:[],storePageSize:20,storeCurrentPage:1,goodsList:[],allShowGoodsList:[],showGoodsList:[],goodsPageSize:6,goodsCurrentPage:1,searchGoodsName:"",showUpload:!1,uploadList:[],selectGoodsList:[]}},mounted(){this.init()},methods:{getRowList(t,e,i){let s=[];if(t&&t.length>0){let a=(e-1)*i,r=e*i;s=t.slice(a,r)}return s},searchkeyWord(t,e){let i=[];return t.forEach(t=>{t.itemName.indexOf(e)>=0&&i.push(t)}),i},init(){const{itemTreeLists:t=[],distributor_info:e=[]}=this.listData;t&&t.forEach(t=>{t.limit=t.use_limit||0}),this.initStoreList(e),this.initGoodsList(t)},cancelSubmit(){this.refresh(),this.$emit("changeShowEdit",!1),this.$router.go(-1)},submitDetail(){this.goodsList.length<1?this.$alert($t("xkznv6h","您还未选择商品，请选择商品后再提交","lang"),$t("hxu00b4","警告消息","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),type:"warning",callback:t=>{}}):this.$confirm($t("phqkv6z","活动创建成功后，活动开始之后商品和店铺相关信息不可修改，请确认是否提交","lang"),$t("garqz34","系统通知","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang")}).then(async()=>{const t=this.distributorList.map(t=>t.distributor_id),e=this.goodsList.map(t=>({id:t.itemId,limit:t.limit||0}));this.listData.distributor_ids=JSON.stringify(t),this.listData.items=JSON.stringify(e),this.$emit("submitList",this.listData)}).catch(()=>{this.$message({type:"info",message:$t("e68dg3","已取消","lang")})})},initStoreList(t){this.distributorList=t,this.showDistributorList=this.getRowList(t,1,this.storePageSize)},addDistributorAction(){this.distributorVisible=!0,this.setDistributorStatus=!0},closeDistributorDialogAction(){this.distributorVisible=!1},chooseDistributorAction(t){this.distributorList=t,this.showDistributorList=this.getRowList(t,this.storeCurrentPage,this.storePageSize),this.distributorVisible=!1},handleCurrentChange(t){this.storeCurrentPage=t,this.showDistributorList=this.getRowList(this.distributorList,t,this.storePageSize)},deleteStore(t){let e=this.distributorList.findIndex(e=>t.distributor_id===e.distributor_id);-1!==e&&(this.distributorList.splice(e,1),this.storeCurrentPage=1,this.showDistributorList=this.getRowList(this.distributorList,this.storeCurrentPage,this.storePageSize))},initGoodsList(t){this.searchGoodsName="",this.goodsList=t,this.allShowGoodsList=t,this.showGoodsList=this.getRowList(t,1,this.goodsPageSize)},changeGoodsList(){let t=this.selectGoodsList||[];this.uploadList.forEach(e=>{let i=t.findIndex(t=>t.itemId===e.itemId);-1!==i&&t.splice(i,1)}),this.initGoodsList(t.concat(this.uploadList))},handleGoodsDialogShow(){this.itemVisible=!0,this.setItemStatus=!0},handleGoodsSubmit(t){t.forEach(t=>{t.limit=t.store}),this.itemVisible=!1,this.selectGoodsList=t,this.changeGoodsList()},handleCurrentGoodsChange(t){this.goodsCurrentPage=t,this.showGoodsList=this.getRowList(this.allShowGoodsList,t,this.goodsPageSize)},handleGoodsDialogHide(){this.itemVisible=!1},searchGoods(){this.allShowGoodsList=this.searchkeyWord(this.goodsList,this.searchGoodsName),this.showGoodsList=this.getRowList(this.allShowGoodsList,1,this.goodsPageSize)},uploadFile(t){t.forEach(t=>{t.limit=Number(t.limit_num)}),this.uploadList=t,this.changeGoodsList(),this.showUpload=!1},changeLimit(t,e){let i=this.showGoodsList.findIndex(t=>t.itemId===e);this.showGoodsList[i].limit=Number(t);let s=this.goodsList.findIndex(t=>t.itemId===e);this.goodsList[s].limit=Number(t),this.$nextTick(()=>{let e=Math.max(Number(t),0);this.showGoodsList[i].limit=Number(e),this.goodsList[s].limit=Number(e),this.changeGoodsList()})}}},f=i(81656),p=(0,f.A)(_,function(){var t=this,e=t._self._c;return e("div",{staticClass:"gift-edit"},[e("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v($t("px85nb6","适用店铺信息","lang"))]),e("el-button",{staticStyle:{float:"right"},attrs:{disabled:t.listData.is_active,type:"primary",size:"mini"},on:{click:t.addDistributorAction}},[t._v($t("myhesd6"," 选择店铺 ","lang"))])],1),e("div",{staticClass:"content store-content"},[t.distributorList&&t.distributorList.length>0?[e("div",{staticClass:"account"},t._l(t.showDistributorList,function(i){return e("div",{key:i.distributor_id,staticClass:"list"},[e("div",{staticClass:"item"},[e("div",[t._v(t._s(i.name))]),t.listData.is_active?t._e():e("i",{staticClass:"el-icon-error close-icon",on:{click:function(e){return t.deleteStore(i)}}})])])}),0),e("div",{staticClass:"page"},[e("el-pagination",{attrs:{layout:"prev, pager, next",total:t.distributorList&&t.distributorList.length,"page-size":t.storePageSize,"current-page":t.storeCurrentPage},on:{"update:currentPage":function(e){t.storeCurrentPage=e},"update:current-page":function(e){t.storeCurrentPage=e},"current-change":t.handleCurrentChange}})],1)]:e("div",{staticClass:"tips"},[t._v($t("35d6fys"," 默认全部店铺适用，若该券只适用于部分店铺请点击右上角 ","lang")),e("span",{staticClass:"primary-color"},[t._v($t("700nfi6","「选择店铺」","lang"))])])],2)]),e("el-card",{staticClass:"box-card goods",attrs:{shadow:"never"}},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v($t("9zhpqt6","可兑商品信息","lang"))]),t.goodsList&&t.goodsList.length>0?e("span",{staticClass:"tips"},[t._v($t("3smnyo10"," (多规格商品支持SPU级别，如只能兑换其中一个规格产品请选择相应规格)","lang"))]):t._e(),e("div",{staticStyle:{float:"right"}},[t.goodsList&&t.goodsList.length>0?[e("span",[t._v($t("alshdq5","商品查询：","lang"))]),e("el-input",{staticClass:"goods-input",staticStyle:{width:"220px"},attrs:{size:"small",placeholder:$t("2jbrwj5","请输入内容","lang")},model:{value:t.searchGoodsName,callback:function(e){t.searchGoodsName=e},expression:"searchGoodsName"}},[e("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.searchGoods},slot:"append"})],1)]:t._e(),t._v("  "),e("el-button",{attrs:{disabled:t.listData.is_active,type:"primary",size:"mini"},on:{click:t.handleGoodsDialogShow}},[t._v($t("mwtd0l6"," 选择商品 ","lang"))]),e("el-button",{attrs:{disabled:t.listData.is_active,type:"primary",size:"mini"},on:{click:function(e){t.showUpload=!0}}},[t._v($t("7afr9o6"," 批量上传 ","lang"))])],2)]),e("div",{staticClass:"content"},[t.goodsList&&t.goodsList.length>0?[e("div",{staticClass:"goods-content"},t._l(t.showGoodsList,function(i){return e("div",{key:i.itemId,staticClass:"goods-list"},[e("div",{staticClass:"item goods-id",staticStyle:{width:"10%"}},[e("div",{staticClass:"title-tips"},[t._v($t("b3ly1i4","商品ID","lang"))]),e("div",[t._v(t._s(i.itemId))])]),e("div",{staticClass:"item goods-info",staticStyle:{width:"50%"}},[i.pics?e("img",{attrs:{src:i.pics[0],alt:""}}):t._e(),e("div",{staticClass:"goods-sku"},[e("div",[t._v(" "+t._s(i.itemName)+" ")]),e("div",{staticClass:"title-tips"},[t._v(" "+t._s(i.item_spec_desc)+" ")])])]),e("div",{staticClass:"item goods-price",staticStyle:{width:"10%"}},[e("div",{staticClass:"title-tips"},[t._v($t("e04l2","价格","lang"))]),e("div",[t._v("￥ "+t._s(i.price/100))])]),e("div",{staticClass:"item goods-count",staticStyle:{width:"10%"}},[e("div",{staticClass:"title-tips"},[t._v($t("gl5x2","库存","lang"))]),e("div",[t._v(t._s(i.store))])]),e("div",{staticClass:"item goods-limit",staticStyle:{width:"20%"}},[e("div",{staticClass:"title-tips"},[t._v($t("ao6b1z4","兑换上限","lang"))]),e("div",[e("el-input",{staticStyle:{width:"80px"},attrs:{disabled:t.listData.is_active,size:"small",type:"number",min:"0"},on:{input:function(e){return t.changeLimit(arguments[0],i.itemId)}},model:{value:i.limit,callback:function(e){t.$set(i,"limit",e)},expression:"item.limit"}})],1)])])}),0),e("div",{staticClass:"page"},[e("el-pagination",{attrs:{layout:"prev, pager, next",total:t.allShowGoodsList&&t.allShowGoodsList.length,"page-size":t.goodsPageSize,"current-page":t.goodsCurrentPage},on:{"update:currentPage":function(e){t.goodsCurrentPage=e},"update:current-page":function(e){t.goodsCurrentPage=e},"current-change":t.handleCurrentGoodsChange}})],1)]:e("div",{staticClass:"tips"},[t._v($t("8s82hlf"," 暂未无可兑商品，请点击右上角","lang")),e("span",{staticClass:"primary-color"},[t._v($t("6yclnq6","「选择商品」","lang"))]),t._v($t("bvg5l65","进行添加 ","lang"))])],2)]),e("div",{staticClass:"content-center"},[e("el-button",{on:{click:t.cancelSubmit}},[t._v($t("dd4ni4"," 取消 ","lang"))]),e("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{type:"primary"},on:{click:t.submitDetail}},[t._v($t("fk4a44"," 提交 ","lang"))])],1),e("DistributorSelect",{attrs:{"store-visible":t.distributorVisible,"is-valid":!0,"rel-data-ids":t.distributorList,"get-status":t.setDistributorStatus,"return-type":"selectRow"},on:{chooseStore:t.chooseDistributorAction,closeStoreDialog:t.closeDistributorDialogAction}}),t.itemVisible&&t.setItemStatus?e("GoodsSelector",{attrs:{"items-visible":t.itemVisible,"get-status":t.setItemStatus,"rel-items-ids":t.selectGoodsList,"item-type":"normal","limit-count":200,"set-search":!0,"is-change-store":!0,gift:!1},on:{chooseStore:t.handleGoodsSubmit,closeStoreDialog:t.handleGoodsDialogHide}}):t._e(),e("UploadGoods",{on:{uploadFile:t.uploadFile},model:{value:t.showUpload,callback:function(e){t.showUpload=e},expression:"showUpload"}})],1)},[],!1,null,"5fe42f42",null),b=p.exports,v=i(87301),y=i(65124),$=i(74353),w=i.n($),x={inject:["refresh"],components:{GiftEdit:b,TagSelect:v.default},data(){function t(t=0){let e=[];for(let i=t;i<=90;i++)e.push({text:i+$t("hm11","天","lang"),value:i});return e}const e=(t,e,i)=>{if(!e&&0!==e)return i(new Error($t("adohlc4","不能为空","lang")));setTimeout(()=>{Number.isInteger(e)?e<=0?i(new Error($t("w4g6rx5","必须大于0","lang"))):i():i(new Error($t("7j3kk46","请输入数字值","lang")))},500)},i={card_id:null,card_type:"new_gift",color:"#000000",title:"",description:"",quantity:null,date_type:"DATE_TYPE_LONG",send_begin_time:null,send_end_time:null,begin_time:null,days:1,end_time:null,get_limit:null,receive:!0,limit:0,lock_time:null,kq_status:0,distributor_ids:[],items:[],grade_ids:[],vip_grade_ids:[]};return{form:Object.assign({},i),params:i,rules:{title:[{required:!0,message:$t("yhkdrm8","请填写优惠券名称","lang"),trigger:"blur"}],quantity:[{required:!0,validator:e,trigger:"blur"}],date_type:[{required:!0,message:$t("xxachg7","请选择活动类型","lang"),trigger:"blur"}],begintime:[{required:!0,message:$t("w5mcg07","请选择开始时间","lang"),trigger:"blur"}],issuetime:[{required:!0,message:$t("usimde7","请选择发放时间","lang"),trigger:"blur"}],usetime:[{required:!0,message:$t("ub8bsu7","请选择使用时间","lang"),trigger:"blur"}],days:[{required:!0,validator:e,trigger:"blur"}],description:[{required:!0,message:$t("w1h4679","请填写卡券使用说明","lang"),trigger:"blur"}],lock_time:[{required:!0,validator:e,trigger:"blur"}],get_limit:[{validator:(t,e,i)=>{""===e||null===e?i():setTimeout(()=>{Number.isInteger(e)?e<=0?i(new Error($t("w4g6rx5","必须大于0","lang"))):i():i(new Error($t("7j3kk46","请输入数字值","lang")))},500)},trigger:"blur"}]},totalDays:t(),issueTotalDays:t(1),loading:!1,showGiftEdit:!1,gradeList:[],dialogVisible:!1,tagsList:[],validGrade:[],memberGrade:[],vipGrade:[]}},mounted(){this.$route.query.cardId&&(this.form.card_id=this.$route.query.cardId),this.getGradeList(),this.listVipGrade(),this.init()},methods:{toTimeStamp(t){return new Date(t).getTime()/1e3},toTimeDate(t){return w()(1e3*t).format("YYYY-MM-DD HH:mm:ss")},cancelSubmit(){this.$router.go(-1)},submitForm(t){this.form.days<=0?this.$message.error($t("2y1xub9","有效天数必须大于0","lang")):"number"==typeof this.form.days?this.$refs[t].validate(t=>{if(!t)return!1;"DATE_TYPE_LONG"===this.form.date_type?(this.form.send_begin_time=this.toTimeStamp(this.form.begintime),this.form.begin_time=this.form.limit):(this.form.send_begin_time=this.toTimeStamp(this.form.issuetime[0]),this.form.send_end_time=this.toTimeStamp(this.form.issuetime[1]),this.form.begin_time=this.toTimeStamp(this.form.usetime[0]),this.form.end_time=this.toTimeStamp(this.form.usetime[1])),this.submitGift(this.form,"first")}):this.$message.error($t("fzaaxv8","请输入有效的数字","lang"))},changeShowEdit(t){this.showGiftEdit=t},async submitGift(t,e){const i=this.params;if(Object.keys(i).forEach(e=>{i[e]=t[e]}),i.get_limit=i.get_limit||1,i.grade_ids=JSON.stringify(i.grade_ids),i.vip_grade_ids=JSON.stringify(i.vip_grade_ids),i.card_id){await(0,d.updateCard)(i)&&(this.$message.success($t("deua4r4","更新成功","lang")),"first"===e?this.showGiftEdit=!0:(this.refresh(),this.$router.go(-1)))}else{const{data:t}=await(0,d.creatCard)(i);t&&(this.params.card_id=t.data.status.card_id,this.form=t.data.status,this.$message.success($t("cx7dr74","提交成功","lang")),"first"===e?(this.showGiftEdit=!0,this.$emit("haddleShowTab",!1)):(this.refresh(),this.$router.go(-1)))}},async getGradeList(){const{data:t}=await(0,y.getGradeList)();t&&(this.gradeList=t.data,this.memberGrade=t.data)},async listVipGrade(){const{data:t}=await(0,d.listVipGrade)();t&&(this.vipGrade=t.data)},async init(){if(this.form.card_id){const{data:t}=await(0,d.getCardDetail)({card_id:this.form.card_id});let e=t.data;e.kq_status=Number(e.kq_status),e.quantity=Number(e.quantity),e.lock_time=Number(e.lock_time),e.get_limit=Number(e.get_limit),"DATE_TYPE_LONG"===e.date_type?(e.begintime=this.toTimeDate(e.send_begin_time),e.limit=e.begin_time):(e.issuetime=[this.toTimeDate(e.send_begin_time),this.toTimeDate(e.send_end_time)],e.usetime=[this.toTimeDate(e.begin_time),this.toTimeDate(e.end_time)]),this.form=e}},editGift(t){const e=this.params;Object.keys(e).forEach(t=>{e[t]=this.form[t]}),e.kq_status=Number(t),e.grade_ids=JSON.stringify(e.grade_ids),e.vip_grade_ids=JSON.stringify(e.vip_grade_ids),(0,d.updateCard)(e).then(t=>{t&&(this.$message.success($t("deua4r4","更新成功","lang")),this.refresh(),this.$router.go(-1))})},selectTags(t){this.tagsList=t,this.dialogVisible=!1}}},S=(0,f.A)(x,function(){var t=this,e=t._self._c;return e("div",{staticClass:"gift-coupon"},[t.showGiftEdit?e("GiftEdit",{attrs:{"list-data":t.form},on:{changeShowEdit:t.changeShowEdit,submitList:t.submitGift}}):e("el-form",{ref:"form",attrs:{rules:t.rules,model:t.form,"label-width":"140px"}},[e("el-card",{attrs:{shadow:"never",header:$t("blh1h04","基础信息","lang")}},[e("el-form-item",{attrs:{label:$t("xc26ml5","优惠券名称","lang"),prop:"title"}},[e("el-input",{staticStyle:{width:"400px"},attrs:{disabled:!!t.form.card_id,maxlength:15,placeholder:$t("7az3km8","请输入优惠券名称","lang"),"show-word-limit":""},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),e("el-form-item",{attrs:{label:$t("azvu4h4","发放总量","lang"),prop:"quantity"}},[e("el-input",{staticStyle:{width:"400px"},attrs:{disabled:1===t.form.kq_status||2===t.form.kq_status,placeholder:$t("8dl07td","发放数量需大于0，且为整数","lang")},model:{value:t.form.quantity,callback:function(e){t.$set(t.form,"quantity",t._n(e))},expression:"form.quantity"}},[e("template",{slot:"append"},[t._v($t("gu8w3"," 张 ","lang"))])],2)],1),e("el-form-item",{attrs:{label:$t("e4ok594","活动类型","lang"),prop:"date_type"}},[e("el-radio-group",{attrs:{disabled:!!t.form.card_id},model:{value:t.form.date_type,callback:function(e){t.$set(t.form,"date_type",e)},expression:"form.date_type"}},[e("el-radio",{attrs:{label:"DATE_TYPE_LONG"}},[t._v($t("q500q56"," 长期活动 ","lang"))]),e("el-radio",{attrs:{label:"DATE_TYPE_SHORT"}},[t._v($t("axjgh6"," 短期活动 ","lang"))])],1),"DATE_TYPE_LONG"===t.form.date_type?[e("el-form-item",{staticClass:"m-b-10",attrs:{"label-width":"80px",label:$t("cd0k3t4","开始时间","lang"),prop:"begintime"}},[e("el-date-picker",{attrs:{disabled:!!t.form.card_id,type:"datetime",placeholder:$t("tnwvfc6","选择日期时间","lang"),"value-format":"yyyy-MM-dd HH:mm:ss",size:"small"},model:{value:t.form.begintime,callback:function(e){t.$set(t.form,"begintime",e)},expression:"form.begintime"}}),t._v("   "),e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:$t("2q4tosb","该时间为活动开始时间点","lang"),placement:"top"}},[e("i",{staticClass:"el-icon-question tooltip"})])],1),e("el-form-item",{attrs:{"label-width":"80px",label:$t("qej42","领取","lang"),prop:"days"}},[[e("el-select",{staticStyle:{width:"100px"},attrs:{disabled:!!t.form.card_id,size:"small"},model:{value:t.form.limit,callback:function(e){t.$set(t.form,"limit",e)},expression:"form.limit"}},t._l(t.totalDays,function(t){return e("el-option",{key:t.value,attrs:{label:t.text,value:t.value}})}),1),e("span",{staticStyle:{padding:"0 8px"}},[t._v($t("b3bz2t4","后生效，","lang"))]),e("el-input",{staticStyle:{width:"120px","margin-top":"6px"},attrs:{disabled:!!t.form.card_id,size:"small"},model:{value:t.form.days,callback:function(e){t.$set(t.form,"days",t._n(e))},expression:"form.days"}},[e("template",{slot:"append"},[t._v($t("ftpz3"," 天 ","lang"))])],2),e("span",{staticStyle:{"padding-left":"8px"}},[t._v($t("ccrq63","内可用","lang"))])]],2)]:[e("el-form-item",{staticClass:"m-b-10",attrs:{"label-width":"80px",label:$t("azwu174","发放时间","lang"),prop:"issuetime"}},[e("el-date-picker",{attrs:{disabled:!!t.form.card_id,type:"datetimerange","range-separator":$t("po31","至","lang"),"start-placeholder":$t("cd0ag54","开始日期","lang"),"end-placeholder":$t("gfhy2u4","结束日期","lang"),"value-format":"yyyy-MM-dd HH:mm:ss",size:"small"},model:{value:t.form.issuetime,callback:function(e){t.$set(t.form,"issuetime",e)},expression:"form.issuetime"}})],1),e("el-form-item",{staticClass:"m-b-10",attrs:{"label-width":"80px",label:$t("aimjgn4","使用时间","lang"),prop:"usetime"}},[e("el-date-picker",{attrs:{disabled:!!t.form.card_id,type:"datetimerange","range-separator":$t("po31","至","lang"),"start-placeholder":$t("cd0ag54","开始日期","lang"),"end-placeholder":$t("gfhy2u4","结束日期","lang"),"value-format":"yyyy-MM-dd HH:mm:ss",size:"small"},model:{value:t.form.usetime,callback:function(e){t.$set(t.form,"usetime",e)},expression:"form.usetime"}})],1)]],2),e("el-form-item",{attrs:{label:$t("38ysh26","卡券使用说明","lang"),prop:"description"}},[e("el-input",{staticStyle:{width:"400px"},attrs:{disabled:1===t.form.kq_status||2===t.form.kq_status,required:"",maxlength:300,"show-word-limit":"",type:"textarea",rows:6,placeholder:$t("2jbrwj5","请输入内容","lang")},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)],1),e("el-card",{attrs:{shadow:"never",header:$t("q0mcl37","领取和适用规则","lang")}},[e("el-form-item",{attrs:{label:$t("jljwty4","领取限制","lang"),prop:"get_limit"}},[e("el-input",{staticStyle:{width:"150px"},attrs:{disabled:!!t.form.card_id},model:{value:t.form.get_limit,callback:function(e){t.$set(t.form,"get_limit",t._n(e))},expression:"form.get_limit"}},[e("template",{slot:"append"},[t._v($t("gu8w3"," 张 ","lang"))])],2),e("span",{staticClass:"tips after-tips"},[t._v($t("jv6besj","每个用户领券上限，如不填，则默认为1。","lang"))])],1),e("el-form-item",{attrs:{label:$t("jrejes6","前台直接领取","lang")}},[e("el-switch",{attrs:{disabled:1===t.form.kq_status||2===t.form.kq_status},model:{value:t.form.receive,callback:function(e){t.$set(t.form,"receive",e)},expression:"form.receive"}}),e("span",{staticClass:"tips after-tips"},[t._v($t("1kw6e0u","默认为开启。开启后用户可在卡券列表中领取，未开启需手动发放。","lang"))])],1),e("el-form-item",{attrs:{label:$t("c5crjc6","指定会员可领","lang")}},[e("el-checkbox-group",{staticClass:"checkbox",attrs:{disabled:1===t.form.kq_status||2===t.form.kq_status},model:{value:t.form.grade_ids,callback:function(e){t.$set(t.form,"grade_ids",e)},expression:"form.grade_ids"}},t._l(t.memberGrade,function(i){return e("el-checkbox",{key:i.grade_id,attrs:{label:i.grade_id}},[t._v(" "+t._s(i.grade_name)+" ")])}),1),e("el-checkbox-group",{staticClass:"checkbox",attrs:{disabled:1===t.form.kq_status||2===t.form.kq_status},model:{value:t.form.vip_grade_ids,callback:function(e){t.$set(t.form,"vip_grade_ids",e)},expression:"form.vip_grade_ids"}},t._l(t.vipGrade,function(i){return e("el-checkbox",{key:i.vip_grade_id,attrs:{label:i.vip_grade_id}},[t._v($t("euf53"," 付费","lang")+t._s(i.grade_name)+" ")])}),1),e("div",{staticClass:"tips after-tips"},[t._v($t("nc64k8a","未选默认所有会员适用","lang"))])],1)],1),e("el-card",{attrs:{shadow:"never",header:$t("aog3ba4","兑换规则","lang")}},[e("el-form-item",{attrs:{label:$t("u4c5b78","选定商品锁定时间","lang"),prop:"lock_time"}},[e("el-input",{staticStyle:{width:"100px"},attrs:{disabled:1===t.form.kq_status||2===t.form.kq_status},model:{value:t.form.lock_time,callback:function(e){t.$set(t.form,"lock_time",t._n(e))},expression:"form.lock_time"}}),t._v($t("gsxi14"," 小时 ","lang")),e("div",{staticClass:"tips"},[t._v($t("uczex81g"," 消费者使用兑换券选定商品后，为避免到店后无兑换商品，则该商品对应库存锁定时间，时间需大于0，且为整数 ","lang"))])],1)],1),e("div",{staticClass:"content-center"},[2!==t.form.kq_status?e("el-button",{on:{click:t.cancelSubmit}},[t._v($t("dd4ni4"," 取消 ","lang"))]):t._e(),t.form.card_id&&0===t.form.kq_status?[e("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.editGift(2)}}},[t._v($t("d7exy4"," 关闭 ","lang"))]),e("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.editGift(1)}}},[t._v($t("fymg64"," 暂停 ","lang"))])]:t._e(),2!==t.form.kq_status?[1===t.form.kq_status?e("el-button",{attrs:{type:"danger",plain:""},on:{click:function(e){return t.editGift(0)}}},[t._v($t("dg9c74"," 启用 ","lang"))]):e("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{type:"primary"},on:{click:function(e){return t.submitForm("form")}}},[t._v($t("fk4a44"," 提交 ","lang"))])]:t._e()],2)],1),e("TagSelect",{on:{selectTags:t.selectTags},model:{value:t.dialogVisible,callback:function(e){t.dialogVisible=e},expression:"dialogVisible"}})],1)},[],!1,null,"f968165e",null).exports,k={components:{StoreSelect:o.A,SkuSelector:n.A,DistributorSelect:l.default,Treeselect:a(),GiftCoupon:S},inject:["refresh"],data(){let t=[{text:$t("gpbq2","当天","lang"),value:0}],e=[];for(let i=1;i<=90;i++)t.push({text:i+$t("hm11","天","lang"),value:i}),e.push({text:i+$t("hm11","天","lang"),value:i});return{pickerOptions:{disabledDate(t){return t.getTime()<Date.now()-864e5}},totalDays:t,remainDays:e,datetimeStatus:!0,articleItemIndex:-1,articleOprHidden:!0,articleItem:{text:"",image_url:""},addImgDefaultHidden:!1,zdShopHidden:!0,storeVisible:!1,distributorVisible:!1,itemVisible:!1,setItemStatus:!1,date_range:"",setStatus:!1,setDistributorStatus:!1,relStores:[],distributor_info:[],relShopIds:[],relDistributorIds:[],submitDisabled:!1,is_distributor:!1,form:{color:"#000000",card_id:"",card_type:"discount",title:"",least_cost:0,reduce_cost:"",discount:"",gift:"",quantity:"",date_type:"DATE_TYPE_FIX_TIME_RANGE",begin_time:0,days:30,end_time:"",time_limit_date:[],get_limit:1,use_all_shops:"true",rel_shops_ids:[],distributor_id:[],text_image_list:[],receive:!0,store_self:!1,use_scenes:"ONLINE",if_push_wechat:!1,useCondition:1,self_consume_code:0,use_platform:"mall",rel_item_ids:[],use_all_items:"true",most_cost:999999,item_category:[],tag_ids:[],brand_ids:[]},relItems:[],kqhjCheckedItem:"",twxxCheckedItem:"",zdItemHidden:!0,rules:{gift:[{required:!0,message:$t("pwmaipa","兑换商品名称不能为空","lang"),trigger:"blur"}],discount:[{type:"number",required:!0,validator:(t,e,i)=>{""==e?i(new Error($t("hu9qdg8","折扣额度不能为空","lang"))):/(^[1-9]((\.)[0-9])?$)/.test(e)?i():i(new Error($t("wfewl6p","折扣额度为1-9.9之间的数字，精确到小数点后1位","lang")))},trigger:"blur"}],reduce_cost:[{type:"number",required:!0,validator:(t,e,i)=>{""==e?i(new Error($t("qj3lcq8","减免金额不能为空","lang"))):parseFloat(e)>0?i():i(new Error($t("so8c0n9","减免金额必须大于0","lang")))},trigger:"blur"}],title:[{required:!0,validator:(t,e,i)=>{""==e?i(new Error($t("s7htbp7","券名称不能为空","lang"))):this.inputValue.title_length>this.inputValue.title_max?i(new Error($t("v6oyoj8","券名称长度不超过","lang")+this.inputValue.title_max+$t("ab7xoe4","个汉字或","lang")+2*this.inputValue.title_max+$t("wldo3u5","个英文字母","lang"))):i()},trigger:"blur"}],date_type:[{required:!0,validator:(t,e,i)=>{"DATE_TYPE_FIX_TIME_RANGE"==e&&""==this.date_range?i(new Error($t("oy3qm86","固定日期必填","lang"))):i()},trigger:"blur"}],useCondition:[{required:!0,validator:(t,e,i)=>{if("cash"===this.form.card_type&&2===this.form.useCondition){""===this.form.least_cost?i(new Error($t("9hfedr5","请填写金额","lang"))):Number(this.form.least_cost)<=Number(this.form.reduce_cost)?i(new Error($t("vzdzkxc","填写金额必须大于减免金额","lang"))):i()}if("discount"===this.form.card_type&&2===this.form.useCondition){""===this.form.most_cost?i(new Error($t("9hfedr5","请填写金额","lang"))):Number(this.form.most_cost)<=Number(this.form.least_cost)?i(new Error($t("sq2ir4e","最高消费限额必须大于起用金额","lang"))):i()}i()},trigger:"blur"}],description:[{required:!0,validator:(t,e,i)=>{""==e?i(new Error($t("cprfrqa","卡券使用说明不能为空","lang"))):this.inputValue.description_length>this.inputValue.description_max?i(new Error($t("30y9r58","卡券使用说明长度","lang")+this.inputValue.description_max+$t("ab7xoe4","个汉字或","lang")+2*this.inputValue.description_max+$t("wldo3u5","个英文字母","lang"))):i()},trigger:"blur"}],quantity:[{required:!0,validator:(t,e,i)=>{""===e?i(new Error($t("jd06ro8","发放数量不能为空","lang"))):/^\d*$/.test(e)?i():i(new Error($t("uqpo699","发放数量必须为数字","lang")))},trigger:"blur"}],use_scenes:[{required:!0,validator:(t,e,i)=>{0===e.length&&i(new Error($t("us7ydna","至少选择一项使用场景","lang"))),i()},trigger:"blur"}]},inputValue:{title_length:0,title_max:9,description_length:0,description_max:300,accept_category_length:0,accept_category_max:5,reject_category_length:0,reject_category_max:15,object_use_for_length:0,object_use_for_max:15,gift_length:0,gift_max:20},wechatColor:["#63b359","#2c9f67","#509fc9","#5885cf","#9062c0","#d09a45","#e4b138","#ee903c","#f08500","#a9d92d","#dd6549","#cc463d","#cf3e36","#5E6671","#026842"],self_rcode:"0",categoryHidden:!0,categoryList:[],tagHidden:!0,tag:{list:[],form:{tag_ids:[]},currentTags:[],tags:[]},brandHidden:!0,brand:{list:[],form:{brand_ids:[]},currentBrands:[],brands:[]},showTab:!0}},mounted(){"distributor"===r.A.getters.login_type&&(this.is_distributor=!0,this.form.is_distributor=!0,this.form.use_platform="mall"),this.$route.query.chooseCardtype&&(this.form.card_type=this.$route.query.chooseCardtype),"cash"==this.form.card_type&&(this.form.useCondition=2),this.$route.query.cardId&&(this.form.card_id=this.$route.query.cardId);let t={card_id:this.form.card_id};this.form.card_id||"gift"!=this.form.card_type||(this.form.use_scenes="SELF"),this.form.card_id&&(0,d.getCardDetail)(t).then(t=>{if(this.form=Object.assign({},this.form,t.data.data),",0,"==t.data.data.distributor_id?this.form.store_self=!0:this.form.store_self=!1,"DATE_TYPE_FIX_TIME_RANGE"==this.form.date_type?(this.date_range=[1e3*this.form.begin_time,1e3*this.form.end_time],this.form.days=30):this.form.end_time<=0?this.form.end_time="":this.form.end_time=1e3*this.form.end_time,"false"===this.form.use_all_items&&(this.zdItemHidden=!1),"false"===this.form.use_all_shops&&(this.zdShopHidden=!1),"category"===this.form.use_all_items&&(this.categoryHidden=!1),"tag"===this.form.use_all_items&&(this.tagHidden=!1,this.tag.currentTags=t.data.data.tag_list||[],this.showTags()),"brand"===this.form.use_all_items&&(this.brandHidden=!1,this.brand.currentBrands=t.data.data.brand_list||[],this.showBrands()),"gift"==this.form.card_type&&"SWEEP"!=this.form.use_scenes&&"SELF"!=this.form.use_scenes&&(this.form.use_scenes="SELF"),parseInt(this.form.least_cost)?this.form.useCondition=2:this.form.useCondition=1,this.form.self_consume_code&&0!=this.form.self_consume_code?this.self_rcode="1":this.self_rcode="0",this.form.rel_shops_ids.length>0){this.shopTypeChange("false");let t={wx_shop_id:this.form.rel_shops_ids,page:1,pageSize:500,isValid:!0};(0,m.getWxShopsList)(t).then(t=>{this.relStores=t.data.data.list})}let e=t.data.data;for(var i in this.distributor_info=e.distributor_info,this.form.distributor_id=[],this.distributor_info)this.form.distributor_id.indexOf(Number(this.distributor_info[i].distributor_id))<0&&this.form.distributor_id.push(Number(this.distributor_info[i].distributor_id));this.$nextTick(()=>{this.relItems=e.itemTreeLists}),this.titleChange(this.form.title),this.descriptionChange(this.form.description)}),"new_gift"!==this.form.card_type&&(this.fetchMainCate(),this.getAllTagLists(),this.getBrandList("",!0))},methods:{getItems(t){let e=[];t.forEach(t=>{e.push(t.itemId)}),this.form.rel_item_ids=e},usePlatformChange(t){this.form.use_scenes="mall"==t?"ONLINE":"QUICK"},checkColor(t){this.form.color=t.target.dataset.color},changeDatetime(t){"DATE_TYPE_FIX_TIME_RANGE"===t?this.datetimeStatus=!0:(this.datetimeStatus=!1,this.date_range="",this.begin_time=0)},handleTypeChange(t){"gift"===t&&(this.form.use_scenes="SELF",this.form.use_platform="store"),"cash"!==t&&"discount"!==t||(this.form.useCondition=2,this.form.use_scenes="ONLINE",this.form.use_platform="mall")},shopTypeChange(t){this.zdShopHidden=!0,"false"===t?this.zdShopHidden=!1:(this.form.rel_distributor_ids=[],this.form.distributor_id=[],this.form.distributor_info=[])},itemTypeChange(t){this.zdItemHidden=!0,this.categoryHidden=!0,this.tagHidden=!0,this.brandHidden=!0,this.form.rel_item_ids=[],this.form.itemTreeLists=[],this.form.item_category=[],this.form.item_category=[],this.tag.currentTags=[],"false"===t?this.zdItemHidden=!1:"true"===t?(this.form.rel_item_ids=[],this.form.itemTreeLists=[],this.form.item_category=[]):"category"===t?(this.form.rel_item_ids=[],this.form.itemTreeLists=[],this.categoryHidden=!1,this.form.item_category=[]):"tag"===t?(this.tagHidden=!1,this.tag.currentTags=[],this.showTags()):"brand"===t&&(this.brandHidden=!1,this.brand.currentBrands=[],this.showBrands())},cancelSubmit(){this.$router.go(-1)},submitForm(t){if(this.form.days<=0)return void this.$message.error($t("2y1xub9","有效天数必须大于0","lang"));if("number"!=typeof this.form.days)return void this.$message.error($t("fzaaxv8","请输入有效的数字","lang"));const e=this;if("DATE_TYPE_FIX_TIME_RANGE"==this.form.date_type&&this.date_range.length>0&&(this.form.begin_time=this.date_range[0],this.form.end_time=this.date_range[1]),"SELF"==this.form.use_scenes&&"1"==this.self_rcode){if(!this.form.self_consume_code)return void this.$message.error($t("7ngidij","选择自助核销并开启验证码后，验证码必填","lang"));if(this.form.self_consume_code&&4!=this.form.self_consume_code.length)return void this.$message.error($t("mu2u51a","验证码必须为4个数字","lang"));let t=/^\d*$/;if(this.form.self_consume_code&&!t.test(this.form.self_consume_code))return void this.$message.error($t("5mb5uq9","验证码必须为纯数字","lang"))}if("false"===this.form.use_all_shops&&!this.form.rel_shops_ids)return void this.$message.error($t("x66trj7","请添加适用门店","lang"));"SELF"==this.form.use_scenes&&"0"==this.self_rcode&&(this.form.self_consume_code=0);let i=JSON.parse(JSON.stringify(this.form));i.tag_list=null,i.rel_tag_ids=null,i.rel_brand_ids=null,i.brand_list=null,i.tag_ids=JSON.stringify(this.form.tag_ids),i.rel_item_ids=JSON.stringify(this.form.rel_item_ids),i.brand_ids=JSON.stringify(this.form.brand_ids),i.item_category=JSON.stringify(this.form.item_category.map(t=>t[t.length-1])),i.itemTreeLists=[],i.rel_distributor_ids=JSON.stringify(this.form.rel_distributor_ids),i.rel_shops_ids=JSON.stringify(this.form.rel_shops_ids),i.distributor_info=[],"DATE_TYPE_FIX_TIME_RANGE"==i.date_type?(i.begin_time=i.begin_time/1e3,i.end_time=i.end_time/1e3):i.end_time=i.end_time/1e3,1===i.useCondition&&(i.least_cost=0,i.most_cost=999999),this.$refs[t].validate(t=>{if(!t)return!1;this.submitDisabled=!0,this.form.card_id?(i.if_push_wechat=!1,(0,d.updateCard)(i).then(t=>{if(!t.data.data||!t.data.data.status)return this.$message.error($t("r5ge3d8","更新优惠券失败!","lang")),this.submitDisabled=!1,!1;this.$message({message:$t("deua4r4","更新成功","lang"),type:"success",duration:2e3,onClose(){e.refresh(),e.$router.go(-1)}})}).catch(()=>{this.submitDisabled=!1})):(0,d.creatCard)(i).then(t=>{if(!t.data.data.status)return this.$message.error($t("zfkbi8","添加优惠券失败!","lang")),this.submitDisabled=!1,!1;this.$message({message:$t("e7ygyc4","添加成功","lang"),type:"success",duration:2e3,onClose(){e.refresh(),e.$router.go(-1)}})}).catch(()=>{this.submitDisabled=!1})})},addStoreAction(){this.storeVisible=!0,this.setStatus=!0,this.relShopIds=this.form.rel_shops_ids},addDistributorAction(){this.distributorVisible=!0,this.setDistributorStatus=!0,this.relDistributorIds=this.form.distributor_id},chooseStoreAction(t){if(this.storeVisible=!1,this.form.rel_shops_ids=[],!(null===t||t.length<=0)){this.relStores=t;for(var e=0;e<t.length;e++)this.form.rel_shops_ids.indexOf(Number(t[e].wxShopId))<0&&this.form.rel_shops_ids.push(Number(t[e].wxShopId))}},chooseDistributorAction(t){if(this.distributorVisible=!1,!t||null===t||t.length<=0)this.distributor_info=[];else{this.distributor_info=t,this.form.distributor_id=[];for(let e=0;e<t.length;e++){const i=t[e].distributor_id;this.form.distributor_id.push(Number(i))}}},closeStoreDialogAction(){this.storeVisible=!1},closeDistributorDialogAction(){this.distributorVisible=!1},deleteRow(t){this.setStatus=!1,this.relStores.splice(t,1);let e=this.relStores;for(var i=0;i<e.length;i++)this.form.rel_shops_ids.indexOf(Number(e[i].wxShopId))<0&&this.form.rel_shops_ids.push(Number(e[i].wxShopId))},deleteDistritutorRow(t){this.distributor_info.splice(t,1);let e=this.distributor_info;this.form.distributor_id=[];for(let t=0;t<e.length;t++)this.form.distributor_id.indexOf(Number(e[t].distributor_id))<0&&this.form.distributor_id.push(Number(e[t].distributor_id));this.relDistributorIds=this.form.distributor_id},giftChange(t){this.inputValue.gift_length=this.getValueLength(t)},titleChange(t){this.inputValue.title_length=this.getValueLength(t)},descriptionChange(t){this.inputValue.description_length=this.getValueLength(t)},getValueLength(t){let e=0,i=-1,s=0;for(var a=0;a<t.length;a++)i=t.charCodeAt(a),i>=0&&i<=128?s++:e++;return s>0&&(e+=parseInt(s/2),s%2>0&&(e+=1)),e},conditionChange(t){1==t&&(this.form.least_cost=0),2==t&&"discount"===this.form.card_type&&(this.form.most_cost=999999)},async fetchMainCate(){if(this.is_distributor){const t=await this.$api.goods.getCategory({is_show:!1});return this.categoryList=t,void this.getCategoryVal()}const t=await this.$api.goods.getCategory({is_main_category:!0,ignore_none:!0});this.categoryList=t,this.getCategoryVal()},getCategoryPaths(t,e){const i={};function s(t,a){const r=[...a,t.category_id];e.includes(t.category_id)&&(i[t.category_id]=r),t.children&&t.children.length>0&&t.children.forEach(t=>s(t,r))}return t.forEach(t=>s(t,[])),e.map(t=>i[t]||[])},getCategoryVal(){this.form.card_id&&(this.form.item_category=this.getCategoryPaths(this.categoryList,this.form.item_category))},addItemTag(){this.tag.currentTags=[],this.item_id.length?(this.showTags(),this.tag.form.item_ids=this.item_id):this.$message({type:"error",message:$t("eajgmxa","请选择至少一个商品!","lang")})},showTags(){this.tag.tags=[...this.tag.list];let t=[];this.tag.tags.forEach((e,i)=>{-1==this.tag.currentTags.findIndex(t=>t.tag_id==e.tag_id)&&t.push(e)}),this.tag.tags=t},tagRemove(t){this.tag.tags.unshift(this.tag.currentTags[t]),this.tag.currentTags.splice(t,1),this.form.tag_ids=[],this.tag.currentTags.forEach(t=>{this.form.tag_ids.push(t.tag_id)})},tagAdd(t,e){-1==this.tag.currentTags.findIndex(e=>e.tag_id==t.tag_id)&&(this.tag.currentTags.push(t),this.tag.tags.splice(e,1)),this.form.tag_ids=[],this.tag.currentTags.forEach(t=>{this.form.tag_ids.push(t.tag_id)})},getAllTagLists(){(0,c.getTagList)({page:1,pageSize:500}).then(t=>{this.tag.list=t.data.data.list,this.showTags()})},getBrandList(t="",e=!1){const i=[];(0,c.getGoodsAttr)({page:1,pageSize:1e3,attribute_type:"brand",attribute_name:t,attribute_ids:e?this.form.brand_id:""}).then(t=>{for(let e of t.data.data.list)i.push({attribute_name:e.attribute_name,attribute_id:e.attribute_id});this.brand.list=i,this.showBrands()})},showBrands(){this.brand.brands=[...this.brand.list];let t=[];this.brand.brands.forEach((e,i)=>{-1==this.brand.currentBrands.findIndex(t=>t.attribute_id==e.attribute_id)&&t.push(e)}),this.brand.brands=t},brandAdd(t,e){-1==this.brand.currentBrands.findIndex(e=>e.attribute_id==t.attribute_id)&&(this.brand.currentBrands.push(t),this.brand.brands.splice(e,1)),this.form.brand_ids=[],this.brand.currentBrands.forEach(t=>{this.form.brand_ids.push(t.attribute_id)})},brandRemove(t){this.brand.brands.unshift(this.brand.currentBrands[t]),this.brand.currentBrands.splice(t,1),this.form.brand_ids=[],this.brand.currentBrands.forEach(t=>{this.form.brand_ids.push(t.attribute_id)})},uploadHandleTemplate(){let t={file_type:"marketing_goods",file_name:$t("b44ik94","商品模板","lang")};(0,u.exportUploadTemplate)(t).then(t=>{let{data:e}=t.data;if(e.file){var i=document.createElement("a");i.href=e.file,i.download=e.name,document.body.appendChild(i),i.click(),i.remove()}else this.$message({type:"error",message:$t("yndnt89","没有相关数据可导出","lang")})})},uploadHandleChange(t,e){let i={isUploadFile:!0,file_type:"marketing_goods",file:t.raw};(0,u.handleUploadFile)(i).then(t=>{this.$message({type:"success",message:$t("a6esth4","上传成功","lang")});let{data:e}=t.data;if(e.fail.length>0){let t=e.fail.map(t=>t.item_bn);setTimeout(()=>{this.$message({showClose:!0,message:`${$t("ojz3zza","以下商品编号不存在：","lang")}${t}`,type:"error",duration:5e3})},1500)}if(e.succ.length<=0)return;this.relItems=e.succ;let i=[];e.succ.forEach(t=>{t.nospec?i.push(t):i.push(Object.assign(t,{spec_items:[]}))})})},haddleShowTab(t){this.showTab=t}}},C=(0,f.A)(k,function(){var t=this,e=t._self._c;return e("div",{staticClass:"page-cardticket"},[e("el-form",{ref:"form",attrs:{rules:t.rules,model:t.form,"label-width":"110px"}},[!t.form.card_id&&t.showTab?e("div",{staticStyle:{"margin-bottom":"20px"}},[e("el-radio-group",{on:{change:t.handleTypeChange},model:{value:t.form.card_type,callback:function(e){t.$set(t.form,"card_type",e)},expression:"form.card_type"}},[e("el-radio-button",{attrs:{label:"discount"}},[t._v($t("dc2jv75"," 折扣券 ","lang"))]),e("el-radio-button",{attrs:{label:"cash"}},[t._v($t("etfamu5"," 满减券 ","lang"))]),t.VERSION_SHUYUN()?t._e():e("el-radio-button",{attrs:{label:"new_gift"}},[t._v($t("b5rlyx5"," 兑换券 ","lang"))])],1)],1):t._e(),"new_gift"===t.form.card_type?e("GiftCoupon",{on:{haddleShowTab:t.haddleShowTab}}):[e("el-card",{attrs:{shadow:"never",header:$t("blh1h04","基础信息","lang")}},["gift"===t.form.card_type?e("el-form-item",{attrs:{label:$t("rjt0vj6","兑换商品名称","lang"),prop:"gift"}},[e("el-input",{staticStyle:{width:"240px"},attrs:{maxlength:20,placeholder:$t("rjt0vj6","兑换商品名称","lang")},on:{change:t.giftChange},model:{value:t.form.gift,callback:function(e){t.$set(t.form,"gift",e)},expression:"form.gift"}}),t._v(" "),e("span",{staticClass:"frm-tips"},[t._v(t._s(t.inputValue.gift_length)+"/"+t._s(t.inputValue.gift_max))])],1):t._e(),"discount"===t.form.card_type?e("el-form-item",{attrs:{label:$t("cutmlw4","折扣额度","lang"),prop:"discount"}},[e("el-input",{staticStyle:{width:"240px"},attrs:{disabled:!!t.form.card_id,placeholder:$t("x2r0wag","只能是大于等于1,小于10的数字","lang"),max:"9.9",min:"1"},model:{value:t.form.discount,callback:function(e){t.$set(t.form,"discount",e)},expression:"form.discount"}})],1):t._e(),"cash"===t.form.card_type?e("el-form-item",{attrs:{label:$t("ao2yfe4","减免金额","lang"),prop:"reduce_cost"}},[e("el-input",{staticStyle:{width:"240px"},attrs:{type:"number",disabled:!!t.form.card_id,placeholder:$t("94lj9e9","只能是大于0的数字","lang")},model:{value:t.form.reduce_cost,callback:function(e){t.$set(t.form,"reduce_cost",e)},expression:"form.reduce_cost"}}),t._v($t("h49p3"," 元 ","lang"))],1):t._e(),e("el-form-item",{attrs:{label:$t("azwq0c4","发放数量","lang"),prop:"quantity"}},[e("el-input",{staticStyle:{width:"20%"},attrs:{min:"1",disabled:!!t.form.card_id,type:"number",oninput:"value=value.replace(/[^\\d.]/g,'')",placeholder:$t("94lj9e9","只能是大于0的数字","lang")},model:{value:t.form.quantity,callback:function(e){t.$set(t.form,"quantity",t._n(e))},expression:"form.quantity"}}),t._v($t("gqcj3"," 份 ","lang"))],1),e("el-form-item",{attrs:{label:$t("cgi4b3","券名称","lang"),prop:"title"}},[e("el-input",{staticStyle:{width:"240px"},attrs:{disabled:!!t.form.card_id,placeholder:$t("1ooe3e9","字数上限为9个汉字","lang")},on:{change:t.titleChange},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}}),t._v(" "),e("span",{staticClass:"frm-tips"},[t._v(t._s(t.inputValue.title_length)+"/"+t._s(t.inputValue.title_max))])],1),e("el-form-item",{attrs:{label:$t("aime4e4","使用条件","lang"),prop:"useCondition"}},[e("el-radio-group",{attrs:{disabled:!!t.form.card_id},on:{change:t.conditionChange},model:{value:t.form.useCondition,callback:function(e){t.$set(t.form,"useCondition",e)},expression:"form.useCondition"}},["cash"!=t.form.card_type?[e("el-radio",{attrs:{label:1}},[t._v($t("ayecq55"," 不限制 ","lang"))])]:t._e(),"gift"!==t.form.card_type?[e("el-radio",{attrs:{label:2}},[t._v($t("gt4ap4"," 满  ","lang")),e("el-input",{staticStyle:{width:"100px"},attrs:{type:"number",min:"0",disabled:!(!t.form.card_id&&1!=t.form.useCondition)},model:{value:t.form.least_cost,callback:function(e){t.$set(t.form,"least_cost",e)},expression:"form.least_cost"}}),t._v($t("2c67b88","  元可用   ","lang")),"discount"===t.form.card_type?[t._v($t("busanv6"," 最高限额 ","lang")),e("el-input",{staticStyle:{width:"100px"},attrs:{disabled:!(!t.form.card_id&&1!=t.form.useCondition)},model:{value:t.form.most_cost,callback:function(e){t.$set(t.form,"most_cost",e)},expression:"form.most_cost"}}),t._v($t("38n994","  元 ","lang"))]:t._e()],2)]:t._e()],2)],1),e("el-form-item",{attrs:{label:$t("fl3fk3","有效期","lang"),prop:"date_type"}},[e("el-radio-group",{on:{change:t.changeDatetime},model:{value:t.form.date_type,callback:function(e){t.$set(t.form,"date_type",e)},expression:"form.date_type"}},[!t.form.card_id||t.form.card_id&&"DATE_TYPE_FIX_TIME_RANGE"===t.form.date_type?e("div",{staticStyle:{"margin-bottom":"20px"}},[e("el-radio",{attrs:{disabled:""!=t.form.card_id&&"DATE_TYPE_FIX_TERM"==t.form.date_type,label:"DATE_TYPE_FIX_TIME_RANGE"}},[t._v($t("c1yuti6"," 固定日期 ","lang"))]),e("el-date-picker",{staticStyle:{width:"380px"},attrs:{type:"datetimerange","value-format":"timestamp","picker-options":t.form.card_id?"":t.pickerOptions,disabled:"DATE_TYPE_FIX_TERM"==t.form.date_type},model:{value:t.date_range,callback:function(e){t.date_range=e},expression:"date_range"}})],1):t._e(),!t.form.card_id||t.form.card_id&&"DATE_TYPE_FIX_TERM"===t.form.date_type?e("div",[e("el-radio",{attrs:{label:"DATE_TYPE_FIX_TERM",disabled:""!=t.form.card_id&&"DATE_TYPE_FIX_TIME_RANGE"==t.form.date_type}},[t._v($t("p29joy7"," 领取后,  ","lang")),e("el-select",{attrs:{disabled:""!=t.form.card_id&&"DATE_TYPE_FIX_TERM"==t.form.date_type||!!t.datetimeStatus,size:"5"},model:{value:t.form.begin_time,callback:function(e){t.$set(t.form,"begin_time",e)},expression:"form.begin_time"}},t._l(t.totalDays,function(t){return e("el-option",{key:t.value,attrs:{label:t.text,value:t.value}})}),1),t._v($t("o0e05la"," 生效，有效天数  ","lang")),e("el-input",{staticStyle:{width:"120px"},attrs:{disabled:""!=t.form.card_id&&"DATE_TYPE_FIX_TERM"==t.form.date_type||!!t.datetimeStatus},model:{value:t.form.days,callback:function(e){t.$set(t.form,"days",t._n(e))},expression:"form.days"}},[e("template",{slot:"append"},[t._v($t("ftpz3"," 天 ","lang"))])],2),t._v($t("taw6qf8"," 统一过期时间 ","lang")),e("el-date-picker",{attrs:{type:"datetime","value-format":"timestamp","picker-options":t.pickerOptions,disabled:""!=t.form.card_id&&"DATE_TYPE_FIX_TERM"==t.form.date_type||!!t.datetimeStatus},model:{value:t.form.end_time,callback:function(e){t.$set(t.form,"end_time",e)},expression:"form.end_time"}})],1)],1):t._e()])],1),e("el-form-item",{attrs:{label:$t("38ysh26","卡券使用说明","lang"),prop:"description"}},[e("el-input",{staticStyle:{width:"600px"},attrs:{required:"",type:"textarea",rows:6,resize:"none",placeholder:$t("3dn0ihe","请填写使用本优惠券的注意事项","lang")},on:{change:t.descriptionChange},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}}),t._v(" "),e("span",{staticClass:"frm-tips"},[t._v(t._s(t.inputValue.description_length)+"/"+t._s(t.inputValue.description_max))])],1)],1),e("el-card",{attrs:{shadow:"never",header:$t("inphob4","适用规则","lang")}},[e("el-form-item",{attrs:{label:$t("jrejes6","前台直接领取","lang")}},[e("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#d2d4db"},model:{value:t.form.receive,callback:function(e){t.$set(t.form,"receive",e)},expression:"form.receive"}})],1),e("el-form-item",{attrs:{label:$t("jlbdug4","领券限制","lang")}},[e("el-input",{staticStyle:{width:"120px"},attrs:{type:"number",min:"1",oninput:"value=value.replace(/[^\\d.]/g,'')"},model:{value:t.form.get_limit,callback:function(e){t.$set(t.form,"get_limit",e)},expression:"form.get_limit"}}),e("p",{staticClass:"frm-tips"},[t._v($t("jv6besj","每个用户领券上限，如不填，则默认为1。","lang"))])],1),0==t.is_distributor&&"gift"==t.form.card_type?e("el-form-item",{attrs:{label:$t("ini4sj4","适用平台","lang")}},[e("el-radio-group",{attrs:{disabled:""!=t.form.card_id},on:{change:t.usePlatformChange},model:{value:t.form.use_platform,callback:function(e){t.$set(t.form,"use_platform",e)},expression:"form.use_platform"}},[0==t.is_distributor?e("el-radio",{attrs:{label:"store"}},[t._v($t("pqektg6"," 门店专用 ","lang"))]):t._e(),"gift"!=t.form.card_type?e("el-radio",{attrs:{label:"mall"}},[t._v($t("eq6bu08"," 线上商城专用 ","lang"))]):t._e()],1)],1):t._e(),0==t.is_distributor&&"gift"==t.form.card_type?e("el-form-item",{attrs:{label:$t("drgwn14","核销场景","lang"),prop:"use_scenes"}},[e("el-radio-group",{attrs:{disabled:""!=t.form.card_id},model:{value:t.form.use_scenes,callback:function(e){t.$set(t.form,"use_scenes",e)},expression:"form.use_scenes"}},["gift"!=t.form.card_type&&"mall"==t.form.use_platform?e("el-radio",{attrs:{label:"ONLINE"}},[t._v($t("epytx88"," 线上商城使用 ","lang"))]):t._e(),"gift"!=t.form.card_type&&"store"==t.form.use_platform?e("el-radio",{attrs:{label:"QUICK"}},[t._v($t("cyxj528"," 快捷买单使用 ","lang"))]):t._e(),"store"==t.form.use_platform?e("el-radio",{attrs:{label:"SELF"}},[t._v($t("1rdva0c"," 自助核销（到店使用） ","lang"))]):t._e()],1)],1):t._e(),"SELF"==t.form.use_scenes?e("el-form-item",{attrs:{label:$t("nbcoc3","验证码","lang")}},[e("el-radio-group",{attrs:{disabled:""!=t.form.card_id},model:{value:t.self_rcode,callback:function(e){t.self_rcode=e},expression:"self_rcode"}},[e("el-radio",{attrs:{label:"1"}},[t._v($t("6d2hf7"," 启用验证码 ","lang"))]),e("el-radio",{attrs:{label:"0"}},[t._v($t("ek662i8"," 不启用验证码 ","lang"))])],1),e("br"),"1"===t.self_rcode?e("el-input",{staticStyle:{width:"220px"},attrs:{placeholder:$t("7b32n16","请输入验证码","lang"),maxlength:"4",minlength:"4"},model:{value:t.form.self_consume_code,callback:function(e){t.$set(t.form,"self_consume_code",e)},expression:"form.self_consume_code"}}):t._e()],1):t._e()],1),"mall"==t.form.use_platform&&"gift"!=t.form.card_type&&0==t.form.store_self?e("el-card",{attrs:{header:$t("eywr2","商品","lang"),shadow:"naver"}},[e("el-form-item",{attrs:{label:$t("ingkrl4","适用商品","lang")}},[e("el-radio-group",{on:{change:t.itemTypeChange},model:{value:t.form.use_all_items,callback:function(e){t.$set(t.form,"use_all_items",e)},expression:"form.use_all_items"}},[e("el-radio",{attrs:{label:"true"}},[t._v($t("vrwg5b8"," 全部商品适用 ","lang"))]),e("el-radio",{attrs:{label:"false"}},[t._v($t("q7xfmc8"," 指定商品适用 ","lang"))]),e("el-radio",{attrs:{label:"category"}},[t._v(" "+t._s(t.is_distributor?$t("cos1n26","指定分类适用","lang"):$t("6486tv8","指定管理分类适用","lang"))+" ")]),e("el-radio",{attrs:{label:"tag"}},[t._v($t("5ghnxxa"," 指定商品标签适用 ","lang"))]),e("el-radio",{attrs:{label:"brand"}},[t._v($t("oiwwqs8"," 指定品牌适用 ","lang"))])],1)],1),t.zdItemHidden?t._e():e("div",{staticStyle:{position:"relative"}},[e("SkuSelector",{attrs:{data:t.relItems},on:{change:t.getItems}}),e("div",{staticStyle:{position:"absolute",bottom:"0px",left:"112px"}},[e("el-upload",{staticStyle:{display:"inline-block",height:"0"},attrs:{action:"","on-change":t.uploadHandleChange,"auto-upload":!1,"show-file-list":!1}},[e("el-button",{attrs:{type:"primary"}},[t._v($t("7afr9o6"," 批量上传 ","lang"))])],1),e("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:function(e){return t.uploadHandleTemplate()}}},[t._v($t("gbapcg6"," 下载模板 ","lang"))])],1)],1),e("el-col",{attrs:{xs:12,sm:12,md:12}},[t.categoryHidden?t._e():e("div",{staticClass:"custom_tree",staticStyle:{height:"350px"}},[e("el-cascader",{staticStyle:{width:"500px"},attrs:{placeholder:$t("l72nr3","请选择","lang"),clearable:"",options:t.categoryList,props:{value:"category_id",label:"category_name",checkStrictly:!1,multiple:!0}},model:{value:t.form.item_category,callback:function(e){t.$set(t.form,"item_category",e)},expression:"form.item_category"}})],1)]),t.tagHidden?t._e():[e("div",{staticClass:"selected-tags view-flex"},[e("div",{staticClass:"label"},[t._v($t("rbsw8d6","已选中标签：","lang"))]),e("div",{staticClass:"view-flex-item"},t._l(t.tag.currentTags,function(i,s){return e("el-tag",{key:s,attrs:{closable:"",size:"small","disable-transitions":!1},on:{close:function(e){return t.tagRemove(s)}}},[t._v(" "+t._s(i.tag_name)+" ")])}),1)]),e("div",t._l(t.tag.tags,function(i,s){return e("el-tag",{key:s,staticClass:"tag-item",attrs:{size:"medium",color:"#ffffff","disable-transitions":!1},nativeOn:{click:function(e){return t.tagAdd(i,s)}}},[t._v(" "+t._s(i.tag_name)+" ")])}),1)],t.brandHidden?t._e():[e("div",{staticClass:"selected-tags view-flex"},[e("div",{staticClass:"label"},[t._v($t("r8xpax6","已选中品牌：","lang"))]),e("div",{staticClass:"view-flex-item"},t._l(t.brand.currentBrands,function(i,s){return e("el-tag",{key:s,attrs:{closable:"",size:"small","disable-transitions":!1},on:{close:function(e){return t.brandRemove(s)}}},[t._v(" "+t._s(i.attribute_name)+" ")])}),1)]),e("div",t._l(t.brand.brands,function(i,s){return e("el-tag",{key:s,staticClass:"tag-item",attrs:{size:"medium",color:"#ffffff","disable-transitions":!1},nativeOn:{click:function(e){return t.brandAdd(i,s)}}},[t._v(" "+t._s(i.attribute_name)+" ")])}),1)]],2):t._e(),0==t.is_distributor&&"store"==t.form.use_platform?e("el-card",{attrs:{header:$t("q0mn2","门店","lang"),shadow:"naver"}},[e("el-form-item",{attrs:{label:$t("inrmhh4","适用门店","lang")}},[e("el-radio-group",{on:{change:t.shopTypeChange},model:{value:t.form.use_all_shops,callback:function(e){t.$set(t.form,"use_all_shops",e)},expression:"form.use_all_shops"}},[e("el-radio",{attrs:{label:"true"}},[t._v($t("1lrv0r8"," 全部门店适用 ","lang"))]),e("el-radio",{attrs:{label:"false"}},[t._v($t("en21888"," 指定门店适用 ","lang"))])],1)],1),t.zdShopHidden?t._e():e("div",[e("el-button",{attrs:{type:"primary"},on:{click:t.addStoreAction}},[t._v($t("n6bub56"," 选择门店 ","lang"))]),t.relStores.length>0?e("el-table",{staticStyle:{"line-height":"normal"},attrs:{data:t.relStores}},[e("el-table-column",{attrs:{label:"ID",prop:"wxShopId",width:"60"}}),e("el-table-column",{attrs:{label:$t("eyrn2","名称","lang"),prop:"storeName"}}),e("el-table-column",{attrs:{prop:"address",label:$t("fb4g2","地址","lang"),"show-overflow-tooltip":""}}),e("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),width:"50"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("i",{staticClass:"iconfont icon-trash-alt",on:{click:function(e){return t.deleteRow(i.$index,t.form.items)}}})]}}],null,!1,3959643360)})],1):t._e()],1)],1):t._e(),t.VERSION_STANDARD()&&0==t.is_distributor&&"mall"==t.form.use_platform?e("el-card",{attrs:{header:$t("gwn72","店铺","lang"),shadow:"naver"}},[e("el-form-item",{attrs:{label:$t("iniii14","适用店铺","lang")}},[e("el-radio-group",{on:{change:t.shopTypeChange},model:{value:t.form.use_all_shops,callback:function(e){t.$set(t.form,"use_all_shops",e)},expression:"form.use_all_shops"}},[e("el-radio",{attrs:{label:"true"}},[t._v($t("59roon8"," 全部店铺适用 ","lang"))]),e("el-radio",{attrs:{label:"false"}},[t._v($t("ib1uw48"," 指定店铺适用 ","lang"))])],1)],1),t.zdShopHidden?t._e():e("div",[e("el-button",{attrs:{type:"primary"},on:{click:t.addDistributorAction}},[t._v($t("myhesd6"," 选择店铺 ","lang"))]),t.distributor_info.length>0?e("el-table",{staticStyle:{"line-height":"normal"},attrs:{data:t.distributor_info}},[e("el-table-column",{attrs:{label:"ID",prop:"distributor_id",width:"60"}}),e("el-table-column",{attrs:{label:$t("eyrn2","名称","lang"),prop:"name"}}),e("el-table-column",{attrs:{prop:"address",label:$t("fb4g2","地址","lang"),"show-overflow-tooltip":""}}),e("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),width:"50"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("i",{staticClass:"iconfont icon-trash-alt",on:{click:function(e){return t.deleteDistritutorRow(i.$index,t.form.items)}}})]}}],null,!1,3521329561)})],1):t._e()],1)],1):t._e(),e("div",{staticClass:"content-center"},[e("el-button",{on:{click:t.cancelSubmit}},[t._v($t("dd4ni4"," 取消 ","lang"))]),e("el-button",{attrs:{type:"primary",disabled:t.submitDisabled},on:{click:function(e){return t.submitForm("form")}}},[t._v($t("fk4a44"," 提交 ","lang"))])],1)]],2),e("StoreSelect",{attrs:{"store-visible":t.storeVisible,"is-valid":!0,"rel-data-ids":t.relStores,"get-status":t.setStatus},on:{chooseStore:t.chooseStoreAction,closeStoreDialog:t.closeStoreDialogAction}}),e("DistributorSelect",{attrs:{"store-visible":t.distributorVisible,"is-valid":!0,"rel-data-ids":t.distributor_info,"get-status":t.setDistributorStatus,"return-type":"selectRow"},on:{chooseStore:t.chooseDistributorAction,closeStoreDialog:t.closeDistributorDialogAction}})],1)},[],!1,null,"496c3776",null).exports}}]);