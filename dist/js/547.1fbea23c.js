"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[547],{90547:function(t,i,e){e.r(i),e.d(i,{default:function(){return o}});e(44114);var s=e(93228),a=e(98818),l=e(50002),n={components:{imgPicker:s.default},inject:["refresh"],data(){return{imgDialog:!1,thumbDialog:!1,couponDialog:!1,isGetImage:!1,isGetThumb:!1,isGetCard:!1,id:0,isEditting:!1,articals:[{title:"",author:"",content:"",viewcontent:"",content_source_url:"",digest:"",thumb_media_id:"",thumb_url:"",show_cover_pic:0,hasLink:!1,popVisible:!1}]}},mounted(){this.$route.params.id&&(this.isEditting=!0,(0,l.getArtical)(this.$route.params.id).then(t=>{this.articals=t.data.data.news_item,this.articals[this.id].viewcontent=this.articals[this.id].content.replace(/<img data-src="(.*?)/g,'<img src="'+{NODE_ENV:"production",VUE_APP_BASE_API:"https://ecshopx82.shopex123.com/api",VUE_APP_MAP_KEY:"PSPBZ-KQ5CW-CSGRF-ON2S4-K2HQJ-XEBQG",VUE_APP_CHUZHI:"false",VUE_APP_IS_SAAS:"false",VUE_APP_PUBLIC_PATH:"/",VUE_APP_WXIMG_URL:"",VUE_APP_WXAUTHCALL_Url:"",VUE_APP_QIANKUN_ENTRY:"/newpc",VUE_APP_OSS_CDN:"false",VUE_APP_LOCAL_DELIVERY_DIRVER:"dada",VUE_APP_DEFAULT_LANG:"zhcn",BASE_URL:"/",VUE_APP_PLATFORM:"b2c"}.WXIMG_URL+'"'),setTimeout(()=>{var t=this.$refs.editor[0].$refs.content.querySelectorAll(".coupon-card");if(0!=t.length){for(var i=0;i<t.length;i++)t[i].style.display="block",t[i].parentNode.setAttribute("contenteditable",!1);this.$refs.editor[0].focus(),this.$refs.editor[0].restoreSelection()}},200)}).catch(t=>{this.$router.go(-1)}))},methods:{addImgPreview(){this.imgDialog=!0,this.isGetImage=!0},pickImg(t){if(t&&""!==t.url){this.imgDialog=!1;var i=this.$refs.editor[0].$el.id,e=this.$refs.editor[0],s=new Image;s.src=this.wximageurl+t.url,e.range?e.range.insertNode(s):(e.$refs.content.appendChild(s),e.focus(),e.restoreSelection()),this.articals[i].viewcontent=e.$refs.content.innerHTML}},closeImgDialog(){this.imgDialog=!1},addThumbPreview(){this.thumbDialog=!0,this.isGetThumb=!0},pickThumb(t){t&&""!==t.url&&(this.thumbDialog=!1,this.articals[this.id].thumb_url=t.url,this.articals[this.id].thumb_media_id=t.media_id)},closeThumbDialog(){this.thumbDialog=!1},addCouponPreview(){this.couponDialog=!0,this.isGetCard=!0},closeCouponDialog(){this.couponDialog=!1},pickCoupon(t){if(this.couponDialog=!1,t){var i={card_id:t.card_id};(0,a.getCouponHtml)(i).then(i=>{var e=this.$refs.editor[0].$el.id,s=this.$refs.editor[0],a=i.data.data.html,l=document.createElement("div"),n=document.createElement("div");n.innerHTML="&nbsp;",l.className="coupon-wrap",l.setAttribute("contenteditable",!1);var o=a+'<div class="coupon-card"><div class="card_content" style="background-color: rgb(213, 64, 54);"><img class="logo" src="https://mmbiz.qlogo.cn/mmbiz_png/MUQsdY0GdK6oqaZpqxLBE6ReLkiaRv6ia3YTIzQHzr96iaiaWAXibGjRCicBdjoenWPzOcaERniajD1ZzhK6yetlXP1Ig/0?wx_fmt=png"><div class="card_info"><h4 class="card_title">'+t.title+'</h4></div><div class="deco"></div></div><div class="store group">&nbsp;</div></div>';l.innerHTML=o,s.range?(s.range.insertNode(l),s.range.endContainer==s.$refs.content&&(s.$refs.content.appendChild(n),s.focus())):(s.$refs.content.appendChild(l),s.$refs.content.appendChild(n),s.focus(),s.restoreSelection()),this.articals[e].viewcontent=s.$refs.content.innerHTML})}},handleClick(t){if(this.id=+t,this.isEditting){this.articals[this.id].viewcontent=this.articals[this.id].content.replace(/<img data-src="(.*?)/g,'<img src="'+{NODE_ENV:"production",VUE_APP_BASE_API:"https://ecshopx82.shopex123.com/api",VUE_APP_MAP_KEY:"PSPBZ-KQ5CW-CSGRF-ON2S4-K2HQJ-XEBQG",VUE_APP_CHUZHI:"false",VUE_APP_IS_SAAS:"false",VUE_APP_PUBLIC_PATH:"/",VUE_APP_WXIMG_URL:"",VUE_APP_WXAUTHCALL_Url:"",VUE_APP_QIANKUN_ENTRY:"/newpc",VUE_APP_OSS_CDN:"false",VUE_APP_LOCAL_DELIVERY_DIRVER:"dada",VUE_APP_DEFAULT_LANG:"zhcn",BASE_URL:"/",VUE_APP_PLATFORM:"b2c"}.WXIMG_URL+'"');var i=this.$refs.editor[0].$refs.content;setTimeout(()=>{for(var t=i.querySelectorAll(".coupon-card"),e=0;e<t.length;e++)t[e].style.display="block",t[e].parentNode.setAttribute("contenteditable",!1);this.$refs.editor[0].focus(),this.$refs.editor[0].restoreSelection()},200)}},addmsg(){this.articals.push({title:"",author:"",content:"",viewcontent:"",content_source_url:"",digest:"",thumb_media_id:"",thumb_url:"",show_cover_pic:0,hasLink:!1,popVisible:!1})},sortup(t){this.articals[t-1]=this.articals.splice(t,1,this.articals[t-1])[0]},sortdown(t){this.articals[t+1]=this.articals.splice(t,1,this.articals[t+1])[0]},remove(t){this.id=+(t-1),this.articals.splice(t,1),this.popVisible=!1},updateContent(t){let i=this.$refs.editor[0].$el.id;this.articals[i].viewcontent=t},onSubmit(){for(var t=new RegExp(this.wximageurl,"g"),i=0;i<this.articals.length;i++){this.articals[i].content=this.articals[i].viewcontent?this.articals[i].viewcontent.replace(t,""):this.articals[i].content;var e=document.getElementById("submitContent");e.innerHTML=this.articals[i].content;for(var s=e.querySelectorAll(".coupon-card"),a=0;a<s.length;a++)s[a].style.display="none";this.articals[i].content=e.innerHTML}const n=this;let o={};this.$route.params.id?(o={body:n.articals,media_id:this.$route.params.id},(0,l.updateArtical)(o).then(t=>{this.$message({message:$t("90byn76","修改图文成功","lang"),type:"success",duration:2e3,onClose(){n.refresh(),n.$router.go(-1)}})})):(o={body:n.articals},(0,l.createArtical)(o).then(t=>{this.$message({message:$t("r6ja596","添加图文成功","lang"),type:"success",duration:2e3,onClose(){n.refresh(),n.$router.go(-1)}})}))}}},o=(0,e(81656).A)(n,function(){var t=this,i=t._self._c;return i("SpPage",{attrs:{title:$t("v6582q6","新增图文消息","lang")}},[i("template",{slot:"page-footer"},[i("div",{staticClass:"text-right"},[i("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v($t("cp35x4"," 保存 ","lang"))]),i("el-button",{on:{click:t.onSubmit}},[t._v($t("nk2ws4"," 预览 ","lang"))])],1)]),i("section",{staticClass:"section-white"},[i("div",{staticClass:"appmsg_preview_area"},[i("div",{staticClass:"appmsg_preview_container"},[i("div",{attrs:{id:"submitContent"}}),i("div",{staticClass:"appmsg_container_hd"},[i("h4",{staticClass:"appmsg_container_title"},[t._v($t("bea0564","图文列表","lang"))])]),i("div",{staticClass:"appmsg_container_bd"},[i("div",{staticClass:"appmsg multi has_first_cover editing"},[i("div",{staticClass:"appmsg_content",attrs:{id:"js_appmsg_preview"}},[t._l(t.articals,function(e,s){return[i("div",{key:s,staticClass:"js_appmsg_item appmsg_item_wrp",class:t.id===s?"current":"",on:{click:function(i){return t.handleClick(s)}}},0===s?[i("div",{staticClass:"first_appmsg_item",attrs:{title:$t("59hoqs5","第一篇图文","lang")}},[i("div",{staticClass:"cover_appmsg_item"},[i("h4",{staticClass:"appmsg_title"},[i("a",{staticClass:"js_appmsg_title",attrs:{href:"javascript:void(0);",onclick:"return false;"}},[""!=t.articals[0].title?[t._v(" "+t._s(t.articals[0].title)+" ")]:[t._v($t("gix7z4"," 标题 ","lang"))]],2)]),i("div",{staticClass:"appmsg_thumb_wrp",style:{backgroundImage:"url("+(e.thumb_url?t.wximageurl+e.thumb_url:"")+")"}},[e.thumb_url?t._e():i("div",{staticClass:"appmsg_thumb default"},[i("i",{staticClass:"icon_appmsg_thumb el-icon-picture"})])])]),i("div",{staticClass:"appmsg_edit_mask"},[i("a",{staticClass:"icon20_common iconfont icon-arrow-down sort_down_white",attrs:{onclick:"return false;",title:$t("dxzk2","下移","lang")},on:{click:function(i){return i.preventDefault(),t.sortdown(s)}}})])])]:[i("div",{staticClass:"appmsg_item has_cover"},[i("div",{staticClass:"appmsg_thumb_wrp",style:{backgroundImage:"url("+(e.thumb_url?t.wximageurl+e.thumb_url:"")+")"}},[e.thumb_url?t._e():i("div",{staticClass:"appmsg_thumb default"},[i("i",{staticClass:"icon_appmsg_thumb_small el-icon-picture"})])]),i("h4",{staticClass:"appmsg_title js_appmsg_title"},[""!=e.title?[t._v(" "+t._s(e.title)+" ")]:[t._v($t("gix7z4"," 标题 ","lang"))]],2),i("div",{staticClass:"appmsg_edit_mask"},[i("a",{staticClass:"icon20_common sort_up_white iconfont icon-arrow-up",attrs:{title:$t("dxyp2","上移","lang")},on:{click:function(i){return i.preventDefault(),t.sortup(s)}}}),s!==t.articals.length-1?i("a",{staticClass:"icon20_common sort_down_white icon icon-arrow-down",attrs:{title:$t("dxzk2","下移","lang")},on:{click:function(i){return i.preventDefault(),t.sortdown(s)}}}):t._e(),i("el-popover",{attrs:{placement:"bottom",width:"220",trigger:"click"},model:{value:e.popVisible,callback:function(i){t.$set(e,"popVisible",i)},expression:"item.popVisible"}},[i("p",{staticClass:"content-padded content-center",staticStyle:{"font-size":"14px"}},[t._v($t("pma37cb"," 确定删除这篇图文？ ","lang"))]),i("div",{staticClass:"content-center"},[i("el-button",{on:{click:function(t){e.popVisible=!1}}},[t._v($t("dd4ni4"," 取消 ","lang"))]),i("el-button",{attrs:{type:"primary"},on:{click:function(i){return t.remove(s)}}},[t._v($t("in1ck4"," 确定 ","lang"))])],1),t.isEditting?t._e():i("a",{staticClass:"icon20_common del_media_white el-icon-delete2",attrs:{slot:"reference",title:$t("eslg2","删除","lang")},slot:"reference"})])],1)])])]})],2)]),t.isEditting?t._e():i("div",{staticClass:"create_access_primary appmsg_add",attrs:{title:$t("q4wxxx6","添加一篇图文","lang")},on:{click:t.addmsg}},[i("i",{staticClass:"icon35_common el-icon-plus"})])])])]),i("div",{staticClass:"appmsg_input_area"},[t._l(t.articals,function(e,s){return t.id===s?[i("el-form",{key:s,ref:"item",refInFor:!0,attrs:{model:e,"label-position":"top","label-width":"80px"}},[i("div",{staticClass:"content-padded"},[i("el-form-item",{attrs:{label:$t("ij5d2","标题","lang")}},[i("el-input",{attrs:{placeholder:$t("2j7m1y5","请输入标题","lang")},model:{value:e.title,callback:function(i){t.$set(e,"title",i)},expression:"item.title"}})],1),i("el-form-item",{attrs:{label:$t("e78p2","作者","lang")}},[i("el-input",{model:{value:e.author,callback:function(i){t.$set(e,"author",i)},expression:"item.author"}})],1),i("el-form-item",[i("SpRichText",{model:{value:e.viewcontent,callback:function(i){t.$set(e,"viewcontent",i)},expression:"item.viewcontent"}})],1),i("el-form-item",[i("el-checkbox",{model:{value:e.hasLink,callback:function(i){t.$set(e,"hasLink",i)},expression:"item.hasLink"}},[t._v($t("dltwx6"," 原文链接 ","lang"))]),e.hasLink?i("el-input",{attrs:{placeholder:""},model:{value:e.content_source_url,callback:function(i){t.$set(e,"content_source_url",i)},expression:"item.content_source_url"}},[i("template",{slot:"prepend"},[t._v(" Http:// ")])],2):t._e()],1)],1),i("div",{staticClass:"content-padded appmsg_edit_highlight_area"},[i("h3",{staticClass:"header-title"},[t._v($t("rvvsqt6","发布样式编辑","lang"))]),i("div",{staticClass:"header_tips"},[t._v($t("7zd4h57"," 封面小图片 ","lang")),i("span",{staticClass:"form-text-tip"},[t._v($t("jvk7goi","建议尺寸：200像素 * 200像素","lang"))])]),i("el-form-item",[i("div",[i("el-button",{on:{click:t.addThumbPreview}},[t._v($t("rexvoc8"," 从图片库选择 ","lang"))])],1),e.thumb_url?i("div",{staticClass:"cover_preview",style:{backgroundImage:"url("+(e.thumb_url?t.wximageurl+e.thumb_url:"")+")"}}):t._e()]),i("div",{staticClass:"header_tips"},[t._v($t("fwxkn4"," 摘要 ","lang")),i("span",{staticClass:"form-text-tip"},[t._v($t("9to0rhk","选填，如果不填写会默认抓取正文前54个字","lang"))])]),i("el-form-item",[i("el-input",{attrs:{type:"textarea",autosize:{minRows:5,maxRows:8},resize:"none",maxlength:120},model:{value:e.digest,callback:function(i){t.$set(e,"digest",i)},expression:"item.digest"}}),i("div",{staticClass:"content-num"},[t._v(t._s(e.digest.length)+"/120")])],1)],1)])]:t._e()})],2),i("div",{staticClass:"appmsg_tpl_area"},[i("div",{staticClass:"appmsg_tpl_container"},[i("div",{staticClass:"appmsg_container_hd"},[i("h4",{staticClass:"appmsg_container_title"},[t._v($t("dho633","多媒体","lang"))])]),i("div",{staticClass:"appmsg_container_bd"},[i("ul",{staticClass:"tpl_list",attrs:{id:"js_media_list"}},[i("li",{staticClass:"tpl_item img",on:{click:t.addImgPreview}},[i("i",{staticClass:"iconfont icon-image"}),t._v($t("da59z3","图片 ","lang"))])]),i("imgPicker",{attrs:{"dialog-visible":t.thumbDialog,"sc-status":t.isGetThumb},on:{chooseImg:t.pickThumb,closeImgDialog:t.closeThumbDialog}}),i("imgPicker",{attrs:{"dialog-visible":t.imgDialog,"sc-status":t.isGetImage},on:{chooseImg:t.pickImg,closeImgDialog:t.closeImgDialog}})],1)])])])],2)},[],!1,null,"1994a51f",null).exports}}]);