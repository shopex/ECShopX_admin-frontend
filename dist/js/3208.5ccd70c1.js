"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[3208],{83208:function(t,e,a){a.r(e),a.d(e,{default:function(){return c}});a(44114);var i=a(95353),s=a(81193),n=a(5134),o=a(77825),l={mixins:[o.Ay,o.v8],provide(){return{refresh:this.refresh}},props:["getStatus"],data(){const t={name:void 0,status:void 0,create_time:[]};return{initialParams:t,params:{...t},loading:!1,communityVisible:!1,couponVisible:!1,goodsVisible:!1,goodsList:[],goodsCount:0,goodsPageSize:10,goodsPage:1,nowActivity:"",cursymbol:"",currency:{}}},computed:{...(0,i.L8)(["wheight"])},watch:{getStatus(t){t&&this.getActivityLists(this.params)}},mounted(){this.$route.query.status&&(this.params.status=this.$route.query.status),this.fetchList(),this.getCurrencyInfo()},methods:{overActionVisible({status:t,source_id:e}){if("it_has_ended"!=t){if(this.IS_ADMIN()&&"0"==e)return!0;if(this.IS_DISTRIBUTOR())return!0}return!1},getDistributorInfo(t){if(t.length>0)return t[0].store_name},onSearch(){this.page.pageIndex=1,this.$nextTick(()=>{this.fetchList()})},onReset(){this.params={...this.initialParams},this.onSearch()},handleGoodsCurrentChange(t){this.goodsPage=t,this.viewGoodsList(this.nowActivity)},addActivityData(){this.$router.push({path:this.matchRoutePath("editor")})},editCommunityAction(t,e){this.$router.push({path:this.matchRoutePath("editor/")+e.seckill_id})},getParams(){const t={},e=this.params.create_time;return e&&e.length>0&&(t.start_time=this.dateStrToTimeStamp(e[0]+" 00:00:00"),t.end_time=this.dateStrToTimeStamp(e[1]+" 23:59:59")),{...this.params,status:"all"===this.params.status?void 0:this.params.status,create_time:[],...t}},async fetchList(){this.loading=!0;const{pageIndex:t,pageSize:e}=this.page;let a={page:t,pageSize:e,...this.getParams()};const{list:i,total_count:s}=await this.$api.promotions.seckillActivityGetList(a);this.tableList=i,this.page.total=s,this.loading=!1},updateStatusCommunityAction(t){var e=$t("3pkh9yi","此操作将永久终止该活动, 是否继续?","lang");this.$confirm(e,$t("hn562","提示","lang"),{cancelButtonText:$t("ev022","取消","lang"),confirmButtonText:$t("kzjg2","确定","lang"),type:"warning",beforeClose:(e,a,i)=>{"confirm"===e&&(0,n.seckillActivityUpdateStatus)({seckill_id:t.seckill_id}).then(t=>{this.fetchList(),this.$message({message:$t("c6bhfy8","修改活动状态成功","lang"),type:"success",duration:5e3})}),i()}})},dateStrToTimeStamp(t){return Date.parse(new Date(t))/1e3},viewGoodsList(t){this.nowActivity=t,this.goodsVisible=!0,(0,n.getSeckillItemList)({seckill_id:t,page:this.goodsPage,pageSize:this.goodsPageSize}).then(t=>{this.goodsList=t.data.data.list,this.goodsCount=t.data.data.total_count})},viewCouponList(t){this.couponVisible=!0},handleCancel(){this.communityVisible=!1,this.couponVisible=!1,this.goodsVisible=!1},getCurrencyInfo(){(0,s.getDefaultCurrency)().then(t=>{this.currency=t.data.data,this.cursymbol=this.currency.symbol})},updateActivityData(t){updateActivityItemData(t).then(t=>{})},editItemPrice(t){let e={id:t.id,item_id:t.item_id,activity_price:t.activity_price,vip_price:t.vip_price,svip_price:t.svip_price,activity_store:t.activity_store,points:t.points};this.updateActivityData(e)},refresh(){this.fetchList(this.params),this.getCurrencyInfo()}}},r=l,c=(0,a(81656).A)(r,function(){var t=this,e=t._self._c;return e("div",[-1===t.$route.path.indexOf("editor")?[t.VERSION_SHUYUN()?t._e():e("SpPlatformTip",{attrs:{h5:"",app:"",pc:"",alipay:""}}),e("div",{staticClass:"action-container"},[e("el-button",{attrs:{type:"primary",icon:"iconfont icon-xinzengcaozuo-01"},on:{click:t.addActivityData}},[t._v($t("tv32jy6"," 添加活动 ","lang"))])],1),e("SpFilterForm",{attrs:{model:t.params},on:{onSearch:t.onSearch,onReset:t.onReset}},[e("SpFilterFormItem",{attrs:{prop:"name",label:$t("bopooa5","活动名称:","lang")}},[e("el-input",{attrs:{placeholder:$t("e4hvdc4","活动名称","lang")},model:{value:t.params.name,callback:function(e){t.$set(t.params,"name",e)},expression:"params.name"}})],1),e("SpFilterFormItem",{attrs:{prop:"status",label:$t("bt2y025","活动状态:","lang")}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:$t("e4mxzs4","活动状态","lang"),clearable:""},model:{value:t.params.status,callback:function(e){t.$set(t.params,"status",e)},expression:"params.status"}},[e("el-option",{attrs:{label:$t("en402","全部","lang"),value:"0"}}),e("el-option",{attrs:{label:$t("egbo03","待开始","lang"),value:"waiting"}}),e("el-option",{attrs:{label:$t("mvujo3","预热中","lang"),value:"in_the_notice"}}),e("el-option",{attrs:{label:$t("lq5q43","进行中","lang"),value:"in_sale"}}),e("el-option",{attrs:{label:$t("edie63","已结束","lang"),value:"it_has_ended"}})],1)],1),e("SpFilterFormItem",{attrs:{prop:"create_time",label:$t("fn58c3","时间:","lang")}},[e("el-date-picker",{staticStyle:{width:"100%","min-width":"250px"},attrs:{type:"daterange","value-format":"yyyy/MM/dd",placeholder:$t("t9q3f56","添加时间筛选","lang")},model:{value:t.params.create_time,callback:function(e){t.$set(t.params,"create_time",e)},expression:"params.create_time"}})],1)],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{border:"",data:t.tableList,height:t.wheight-150}},[e("el-table-column",{attrs:{prop:"seckill_id",label:"ID",width:"50"}}),e("el-table-column",{attrs:{label:$t("j1712","活动","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return[t._v(" "+t._s(a.row.activity_name)),e("br"),e("span",{staticClass:"text-muted"},[t._v(t._s(a.row.description))])]}}],null,!1,1839152301)}),e("el-table-column",{attrs:{label:$t("gwn72","店铺","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.getDistributorInfo(e.row.distributor_info))+" ")]}}],null,!1,1106683765)}),e("el-table-column",{attrs:{prop:"activity_release_date",label:$t("jld66c4","预告时间","lang"),width:"160"}}),e("el-table-column",{attrs:{label:$t("e4l2kr4","活动时间","lang"),width:"190"},scopedSlots:t._u([{key:"default",fn:function(a){return[t._v(" "+t._s(a.row.activity_start_date)+" "),e("span",{staticClass:"text-muted"},[t._v($t("gngr2","开始","lang"))]),t._v(" "+t._s(a.row.activity_end_date)+" "),e("span",{staticClass:"text-muted"},[t._v($t("m50s2","结束","lang"))])]}}],null,!1,3253684956)}),e("el-table-column",{attrs:{prop:"created_date",label:$t("ar84e54","创建时间","lang"),width:"160"}}),e("el-table-column",{attrs:{prop:"status",label:$t("k1e32","状态","lang"),width:"70"},scopedSlots:t._u([{key:"default",fn:function(a){return["waiting"==a.row.status?e("span",[t._v($t("egbo03","待开始","lang"))]):"in_the_notice"==a.row.status?e("span",[t._v($t("mvujo3","预热中","lang"))]):"in_sale"==a.row.status?e("span",[t._v($t("lq5q43","进行中","lang"))]):"it_has_ended"==a.row.status?e("span",[t._v($t("edie63","已结束","lang"))]):t._e()]}}],null,!1,1257739464)}),e("el-table-column",{attrs:{prop:"items",label:$t("eywr2","商品","lang"),width:"50"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("i",{staticClass:"iconfont icon-search-plus",on:{click:function(e){return t.viewGoodsList(a.row.seckill_id)}}})]}}],null,!1,2553459412)}),e("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),width:"60"},scopedSlots:t._u([{key:"default",fn:function(a){return[t.overActionVisible(a.row)?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.updateStatusCommunityAction(a.row)}}},[t._v($t("jn7om4"," 终止 ","lang"))]):t._e(),e("div",{staticClass:"operating-icons"},["waiting"==a.row.status?e("i",{staticClass:"iconfont icon-edit1",on:{click:function(e){return t.editCommunityAction(a.$index,a.row)}}}):t._e()])]}}],null,!1,819396860)})],1),t.page.total>t.page.pageSize?e("div",{staticClass:"content-center content-top-padded"},[e("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":t.page.pageIndex,"page-sizes":[10,20,50],total:t.page.total,"page-size":t.page.pageSize},on:{"update:currentPage":function(e){return t.$set(t.page,"pageIndex",e)},"update:current-page":function(e){return t.$set(t.page,"pageIndex",e)},"current-change":t.onCurrentChange,"size-change":t.onSizeChange}})],1):t._e(),e("el-dialog",{attrs:{title:$t("752fp56","活动商品列表","lang"),visible:t.goodsVisible,"before-close":t.handleCancel,width:"70%"},on:{"update:visible":function(e){t.goodsVisible=e}}},[[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.goodsList}},[e("el-table-column",{attrs:{prop:"item_id",label:"id",width:"60"}}),e("el-table-column",{attrs:{prop:"item_name",label:$t("b40v0e4","商品名称","lang")}}),e("el-table-column",{attrs:{prop:"item_spec_desc",label:$t("o06w2","规格","lang")}}),e("el-table-column",{attrs:{prop:"activity_price",label:$t("gegne3","活动价","lang"),width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.cursymbol)+t._s(e.row.activity_price/100)+" ")]}}],null,!1,869589400)}),e("el-table-column",{attrs:{prop:"activity_store",label:$t("gl5x2","库存","lang"),width:"70"}}),e("el-table-column",{attrs:{prop:"limit_num",label:$t("qcbh2","限购","lang"),width:"50"}}),e("el-table-column",{attrs:{prop:"sort",label:$t("hge52","排序","lang"),width:"60"}})],1),t.goodsCount>t.goodsPageSize?e("div",{staticClass:"content-center content-top-padded"},[e("el-pagination",{attrs:{layout:"prev, pager, next","current-page":t.goodsPage,total:t.goodsCount,"page-size":t.goodsPageSize},on:{"update:currentPage":function(e){t.goodsPage=e},"update:current-page":function(e){t.goodsPage=e},"current-change":t.handleGoodsCurrentChange}})],1):t._e()]],2)]:t._e(),e("router-view")],2)},[],!1,null,"8b767ab4",null).exports}}]);