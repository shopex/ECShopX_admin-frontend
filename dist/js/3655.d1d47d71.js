"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[3655],{13655:function(e,t,s){s.r(t),s.d(t,{default:function(){return o}});s(44114),s(50002);var a=s(2212),r=s(77944),i=s(5748),l={inject:["refresh"],components:{imgPicker:s(87378).default},data(){return{resourceName:"",storeData:[],serverList:[],serverCheckedList:[],form:{resourceLevelId:"",name:"",shopId:"",shopName:"",materialIds:[],description:"",imageUrl:""},addForm:{server_name:""},rules:{name:[{required:!0,validator:(e,t,s)=>""==t?s(new Error($t("k93toz6","名称不能为空","lang"))):t.length>10?s(new Error($t("ra7r3wb","名称不能超过10个汉字","lang"))):s(),trigger:"blur"}],shopId:[{required:!0,validator:(e,t,s)=>""==t||t<=0?s(new Error($t("yuv4d98","所属门店不能为空","lang"))):s(),trigger:"blur"}],materialIds:[{required:!0,validator:(e,t,s)=>t.length<=0?s(new Error($t("x5cznk7","请选择服务项目","lang"))):s(),trigger:"blur"}],description:[{required:!0,validator:(e,t,s)=>""==t?s(new Error($t("g5tviz6","简介不能为空","lang"))):t.length>100?s(new Error($t("wtci7wc","简介不能超过100个汉字","lang"))):s(),trigger:"blur"}]},checkAll:!1,isIndeterminate:!1,dialogVisible:!1,imgDialog:!1,isGetImage:!1}},mounted(){this.resourceId=this.$route.query.id,this.getLabelsList(),this.getResourceName(),this.getStoreList(),this.resourceId&&this.getResourceLevel()},methods:{handleCheckedCitiesChange(e){},checkAllChange(e){if(this.form.materialIds=e?this.serverList:[],e){for(var t=0;t<this.serverList.length;t++)this.serverCheckedList.push(this.serverList[t].value);this.form.materialIds=this.serverCheckedList}else this.form.materialIds=[];this.isIndeterminate=!1},handleCheckedChange(e){let t=e.length;this.checkAll=t===this.serverList.length,this.isIndeterminate=t>0&&t<this.serverList.length},saveServer(){""!=this.addForm.server_name?(this.dialogVisible=!1,this.serverList.push(this.addForm.server_name),this.addForm.server_name=""):this.$message.error($t("ca1u138","服务名称不能为空","lang"))},saveResource(){const e=this;this.$refs.form.validate(t=>{if(t){var s,r=this.storeData;for(s in r)r[s].value==this.form.shopId&&(this.form.shopName=r[s].label);this.form.resourceLevelId?(0,a.updateResourceLevel)(this.form).then(t=>{t.data.data.status&&this.$message({message:$t("deua4r4","更新成功","lang"),type:"success",duration:2e3,onClose(){e.refresh(),e.$router.go(-1)}})}):(0,a.createResourceLevel)(this.form).then(t=>{t.data.data.status&&this.$message({message:$t("e7ygyc4","添加成功","lang"),type:"success",duration:2e3,onClose(){e.refresh(),e.$router.go(-1)}})})}})},cancel(){this.$router.go(-1)},cancelAdd(){this.dialogVisible=!1},getStoreList(){(0,r.getWxShopsList)({page:1,pageSize:500,isValid:"true"}).then(e=>{for(var t=e.data.data.list,s=0;s<t.length;s++)this.storeData.push({value:t[s].wxShopId,label:t[s].storeName});this.loading=!1})},getLabelsList(){this.loading=!0;var e={page:1,pageSize:100,service_type:"timescard"};(0,i.getServiceLabelsList)(e).then(e=>{var t,s=e.data.data.list;for(t in s)this.serverList.push({value:Number(s[t].labelId),label:s[t].labelName});this.loading=!1})},getResourceLevel(){(0,a.getResourceLevel)(this.resourceId).then(e=>{this.form=e.data.data})},getResourceName(){(0,a.getSetting)().then(e=>{this.resourceName=e.data.data.resourceName})},handleImgChange(){this.imgDialog=!0,this.isGetImage=!0},pickImg(e){this.form.imageUrl=e.url,this.imgDialog=!1},closeImgDialog(){this.imgDialog=!1}}},o=(0,s(81656).A)(l,function(){var e=this,t=e._self._c;return t("div",{staticClass:"section-white content-padded"},[t("el-form",{ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"80px"}},[t("div",{staticClass:"section-header with-border"},[t("h3",[e._v(e._s(e.resourceName)+$t("j5s52","添加","lang"))])]),t("div",{staticClass:"section-body"},[t("el-form-item",{attrs:{label:$t("eyrn2","名称","lang"),prop:"name"}},[t("el-input",{staticStyle:{width:"240px"},attrs:{maxlength:10,placeholder:$t("2jb6fo5","请输入名称","lang")},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:$t("csd8i54","所属门店","lang"),prop:"shopId"}},[e.form.resourceLevelId?t("el-select",{attrs:{disabled:""},model:{value:e.form.shopId,callback:function(t){e.$set(e.form,"shopId",t)},expression:"form.shopId"}},e._l(e.storeData,function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1):t("el-select",{model:{value:e.form.shopId,callback:function(t){e.$set(e.form,"shopId",t)},expression:"form.shopId"}},e._l(e.storeData,function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),t("el-form-item",{attrs:{label:$t("dcr7bd4","服务项目","lang"),prop:"materialIds"}},[t("div",{staticClass:"server-box"},[t("div",{staticClass:"server-head clearfix"},[t("span",{staticClass:"f_l"},[e._v($t("cc9wwj5","服务目录(","lang")+e._s(e.serverList.length)+$t("pxow2","项)","lang"))]),t("div",{staticClass:"f_r"},[t("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.checkAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v($t("d66pr4"," 全选 ","lang"))])],1)]),t("el-checkbox-group",{staticClass:"server-list",on:{change:e.handleCheckedChange},model:{value:e.form.materialIds,callback:function(t){e.$set(e.form,"materialIds",t)},expression:"form.materialIds"}},[t("el-row",e._l(e.serverList,function(s,a){return t("el-col",{key:a,attrs:{span:6,title:s.label}},[t("el-checkbox",{key:s.value,attrs:{label:s.value}},[e._v(" "+e._s(s.label)+" ")])],1)}),1)],1)],1)]),t("el-form-item",{attrs:{label:$t("lft72","简介","lang"),prop:"description"}},[t("el-input",{staticStyle:{width:"50%"},attrs:{type:"textarea",rows:4,resize:"none",maxlength:100},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}}),e._v(" "),t("span",{staticClass:"frm-tips"},[e._v(e._s(e.form.description.length)+" / 100")])],1),t("el-form-item",{attrs:{label:$t("e3ymx3","展示图","lang")}},[t("div",[t("div",{staticClass:"upload-box",on:{click:e.handleImgChange}},[e.form.imageUrl?t("img",{staticClass:"avatar",attrs:{src:e.wximageurl+e.form.imageUrl}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])]),t("imgPicker",{attrs:{"dialog-visible":e.imgDialog,"sc-status":e.isGetImage},on:{chooseImg:e.pickImg,closeImgDialog:e.closeImgDialog}})],1)],1),t("div",{staticClass:"section-footer with-border content-center"},[t("el-button",{on:{click:e.cancel}},[e._v($t("dd4ni4"," 取消 ","lang"))]),t("el-button",{attrs:{type:"primary"},on:{click:e.saveResource}},[e._v($t("cp35x4"," 保存 ","lang"))])],1)])],1)},[],!1,null,"72d4d10c",null).exports}}]);