"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[5486],{65486:function(t,e,a){a.r(e),a.d(e,{default:function(){return n}});a(44114);var i=a(95353),l=a(99502),s=a(2038),o={components:{DistributorSelect:l.default},filters:{sendingState(t){return 1==t?$t("fj1163","未发送","lang"):2==t?$t("equn64"," 已发送","lang"):$t("e8yss3","已撤回","lang")}},provide(){return{refresh:this.fetchList}},data(){return{loadingTable:!1,loading:!1,stateOptions:[{value:"0",label:$t("en402","全部","lang")},{value:"1",label:$t("e6f2a3","已发送","lang")},{value:"2",label:$t("fj1163","未发送","lang")},{value:"3",label:$t("e8yss3","已撤回","lang")}],searchData:{status:"0",title:""},tableData:[],paging:{page:1,page_size:10,total_count:0},showSeeModule:!1,seeDataForm:{radio:"1",shop:""},showSendModule:!1,sendDataForm:{radio:"1"},distributorVisible:!1,setDistributorStatus:!1,distributor_info:[],distributor_id:[],temporary:null}},watch:{showSeeModule(t){t&&this._getSalespersonoticeDetail()}},computed:{...(0,i.L8)(["wheight"])},mounted(){this.handelClickSearch()},methods:{resetPage(){this.paging={page:1,page_size:10,total_count:0}},fetchList(){this.resetPage(),this.handelClickSearch()},async handelClickSearch(){let{page:t,page_size:e}=this.paging,{title:a,status:i}=this.searchData,l={page:t,page_size:e,title:a,status:i};this.loadingTable=!0;let{data:o}=await(0,s.getSalespersonoticeList)(l);this.tableData=o.data.list,this.paging.total_count=o.data.total_count,this.loadingTable=!1},handleCurrentChange(t){this.paging.page=t,this.handelClickSearch()},timestampToTime(t){var e=new Date(1e3*t);return e.getFullYear()+"-"+((e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-")+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+((e.getHours()<10?"0"+e.getHours():e.getHours())+":")+((e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":")+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())},handelClickAdd(t){this.$router.push({path:this.matchRoutePath("editor")})},handelClickRevoke(t){let e=t.notice_id;this.checkWithdrawnotice(async()=>{await(0,s.delSalespersonoticeWithdrawnotice)({notice_id:e});this.resetPage(),this.handelClickSearch(),this.$message({type:"success",message:$t("lbed8o5","撤回成功!","lang")})})},checkWithdrawnotice(t){this.$confirm($t("iq7zntl","撤回后，对应店铺的导购将无法再看到次通知?","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(()=>{t()})},handelClickDistributor(t){if(this.distributorVisible=!1,null===t||t.length<=0)return;this.distributor_info=t;let e=[];for(var a=0;a<t.length;a++)e.indexOf(Number(t[a].distributor_id))<0&&e.push(Number(t[a].distributor_id));this.distributor_id=e},async handelClickSendOut(){let t={notice_id:this.temporary.notice_id,distributor_id:"1"==this.sendDataForm.radio?"all":JSON.parse(JSON.stringify(this.distributor_id))};if(this.loading=!0,"all"!==t.distributor_id&&0===this.distributor_id.length)return void this.$message.error($t("2elj5y5","请选择店铺","lang"));this.loading=!1,this.showSendModule=!1;let{data:e}=await(0,s.setSalespersonoticeSendnotice)(t);this.$message({message:$t("b65a734","发送成功","lang"),type:"success"}),this.distributor_id=[],this.sendDataForm.radio="1",this.handelClickSearch()},async _getSalespersonoticeDetail(){this.loading=!0;let{data:t}=await(0,s.getSalespersonoticeDetail)({notice_id:this.temporary.notice_id,with_log:1});this.seeDataForm=t.data,this.loading=!1},handleSizeChange(t){this.paging.page=1,this.paging.page_size=t,this.handelClickSearch()}}},n=(0,a(81656).A)(o,function(){var t=this,e=t._self._c;return e("div",[-1===t.$route.path.indexOf("editor")?e("div",{staticClass:"shoppingguidenotification"},[e("el-row",[e("el-col",[e("el-select",{attrs:{placeholder:$t("l72nr3","请选择","lang")},model:{value:t.searchData.status,callback:function(e){t.$set(t.searchData,"status",e)},expression:"searchData.status"}},t._l(t.stateOptions,function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1),e("el-input",{staticClass:"input-b",attrs:{placeholder:$t("eusoqx7","请输入通知名称","lang")},model:{value:t.searchData.title,callback:function(e){t.$set(t.searchData,"title",e)},expression:"searchData.title"}},[e("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.handelClickSearch},slot:"append"})],1),e("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:t.handelClickAdd}},[t._v($t("1nqfrt6"," 新增通知 ","lang"))])],1)],1),e("el-card",[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingTable,expression:"loadingTable"}],staticStyle:{width:"100%"},attrs:{data:t.tableData}},[e("el-table-column",{attrs:{prop:"title",label:$t("iodwho4","通知标题","lang")}}),e("el-table-column",{attrs:{prop:"created",label:$t("ar84e54","创建时间","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.timestampToTime(e.row.created))+" ")]}}],null,!1,3483905404)}),e("el-table-column",{attrs:{prop:"updated",label:$t("dldanx8","最后一次发送时间","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.timestampToTime(e.row.last_sent_time))+" ")]}}],null,!1,1907249327)}),e("el-table-column",{attrs:{prop:"withdraw",label:$t("b686sb4","发送状态","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("sendingState")(e.row.status))+" ")]}}],null,!1,2684121211)}),e("el-table-column",{attrs:{fixed:"right",label:$t("hkxb2","操作","lang"),width:"200"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{type:"text"},on:{click:()=>t.$router.push({path:t.matchRoutePath("editor"),query:{id:a.row.notice_id}})}},[t._v($t("juz394"," 编辑 ","lang"))]),1!=a.row.status?e("el-button",{attrs:{type:"text"},on:{click:()=>{t.temporary=a.row,t.showSeeModule=!0}}},[t._v($t("gcika4"," 查看 ","lang"))]):t._e(),2!=a.row.status?e("el-button",{attrs:{type:"text"},on:{click:()=>{t.temporary=a.row,t.showSendModule=!0}}},[t._v($t("diw1c4"," 发送 ","lang"))]):t._e(),2==a.row.status?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.handelClickRevoke(a.row)}}},[t._v($t("67r51m6"," 撤回发送 ","lang"))]):t._e()]}}],null,!1,2333702449)})],1),e("div",{staticClass:"mt-4 text-right"},[e("el-pagination",{attrs:{background:"","current-page":t.paging.page,"page-sizes":[10,20,50,100],"page-size":t.paging.page_size,layout:"total, sizes, prev, pager, next, jumper",total:t.paging.total_count},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1),e("el-dialog",{attrs:{title:$t("xjykh88","查看通知发送状态","lang"),visible:t.showSeeModule,width:"700","before-close":()=>{t.showSeeModule=!1}},on:{"update:visible":function(e){t.showSeeModule=e}}},[e("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{model:t.seeDataForm,"label-width":"100px"}},[e("el-form-item",{attrs:{label:$t("aqsldd5","通知时间：","lang")}},[t._v(" "+t._s(t._f("formatDataTime")(t.seeDataForm.last_sent_time))+" "+t._s(t._f("sendingState")(t.seeDataForm.status))+" ")]),1==t.seeDataForm.all_distributor?e("el-form-item",{attrs:{label:$t("appk5o5","通知店铺：","lang")}},[t._v($t("d6c1s4"," 全部 ","lang"))]):t._e(),0==t.seeDataForm.all_distributor?e("el-form-item",{attrs:{label:$t("appk5o5","通知店铺：","lang")}},t._l(t.seeDataForm.distributors,function(a,i){return e("el-tag",{key:i,attrs:{size:"size"}},[t._v(" "+t._s(a.name)+" ")])}),1):t._e()],1)],1),e("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{title:$t("b6dbh74","发送通知","lang"),visible:t.showSendModule,width:"700","before-close":()=>{t.showSendModule=!1}},on:{"update:visible":function(e){t.showSendModule=e}}},[e("div",{staticClass:"flex"},[e("div",{staticClass:"label"},[t._v($t("lglu8w7","选择通知门店：","lang"))]),e("div",[e("el-radio",{attrs:{label:"1"},model:{value:t.sendDataForm.radio,callback:function(e){t.$set(t.sendDataForm,"radio",e)},expression:"sendDataForm.radio"}},[t._v($t("2t2qmn6"," 全部门店 ","lang"))]),e("el-radio",{attrs:{label:"2"},model:{value:t.sendDataForm.radio,callback:function(e){t.$set(t.sendDataForm,"radio",e)},expression:"sendDataForm.radio"}},[t._v($t("n6bub56"," 选择门店 ","lang"))])],1)]),e("div",{staticClass:"flex ma-t"},[e("div",{staticClass:"label"},[t._v($t("axjzog5","通知门店：","lang"))]),1==t.sendDataForm.radio?e("div",[t._v($t("en402","全部","lang"))]):t._e(),2==t.sendDataForm.radio?e("div",[e("div",[e("ul",{staticClass:"flex"},t._l(t.distributor_info,function(a){return e("li",{key:a.distributor_id,staticClass:"ma-r"},[e("el-tag",[t._v(t._s(a.name))])],1)}),0)]),e("el-button",{staticClass:"ma-t",attrs:{type:"primary"},on:{click:()=>{t.distributorVisible=!0,t.setDistributorStatus=!0}}},[t._v($t("myhesd6"," 选择店铺 ","lang"))])],1):t._e()]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.showSendModule=!1}}},[t._v($t("caoqm3","取 消","lang"))]),e("el-button",{attrs:{type:"primary"},on:{click:t.handelClickSendOut}},[t._v($t("hnjoo3","确 定","lang"))])],1)]),e("DistributorSelect",{attrs:{"store-visible":t.distributorVisible,"is-valid":!0,"get-status":t.setDistributorStatus},on:{chooseStore:t.handelClickDistributor,closeStoreDialog:function(e){t.distributorVisible=!1}}})],1):t._e(),e("router-view")],1)},[],!1,null,"3e603f2a",null).exports}}]);