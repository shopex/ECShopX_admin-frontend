"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[2086],{62086:function(t,e,a){a.r(e),a.d(e,{default:function(){return r}});a(44114),a(17642),a(58004),a(33853),a(45876),a(32475),a(15024),a(31698);var o=a(95353),s=a(98818),n={props:{dialogVisible:{type:Boolean,default:!1},scStatus:{type:Boolean,default:!1}},data(){return{listLoading:!0,editNumberVisible:!0,currentPage:1,selectedItem:"",tableData:[],selectItem:[],total_count:0,pageSize:10,showDialog:!1}},watch:{scStatus(t){if(t){let t={page_no:1,page_size:this.pageSize};this.getCardList(t)}},dialogVisible(t,e){this.showDialog=t}},methods:{handleCurrentChange(t){var e={page_no:t,page_size:this.pageSize};this.getCardList(e)},handleSelectionChange(t){this.selectItem=t},cancelAction(){this.$emit("closeKQDialog")},saveAction(){this.$emit("chooseKQ",this.selectItem)},getCardList(t){this.listLoading=!0,this.scStatus&&(0,s.getEffectiveCardList)(t).then(t=>{this.listLoading=!1,this.tableData=t.data.data.list,this.total_count=t.data.data.total_count})}}},l=a(81656),i={components:{couponSelect:(0,l.A)(n,function(){var t=this,e=t._self._c;return e("div",[e("el-dialog",{staticClass:"img_dialog",attrs:{title:$t("ikwhyv4","选择卡券","lang"),visible:t.showDialog,"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":t.cancelAction}},[e("el-table",{directives:[{name:"loading",rawName:"v-loading.body",value:t.listLoading,expression:"listLoading",modifiers:{body:!0}}],attrs:{data:t.tableData},on:{"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{type:"selection",width:"55"}}),e("el-table-column",{attrs:{label:$t("av8hwn4","卡券类型","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("formatCardStr")(e.row.card_type))+" ")]}}])}),e("el-table-column",{attrs:{prop:"title",label:$t("av9kl34","全部卡券","lang")}}),e("el-table-column",{attrs:{label:$t("icb16f5","卡券有效期","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return[e("i",{staticClass:"el-icon-time"}),a.row.takeEffect?[t._v(" "+t._s(a.row.takeEffect)+" ")]:[t._v(" "+t._s(t._f("datetime")(a.row.begin_time))+" "),a.row.end_time?[t._v(" ~ ")]:t._e(),t._v(" "+t._s(t._f("datetime")(a.row.end_time))+" "+t._s(Date.parse(new Date)>1e3*a.row.end_time?$t("ege5m3","已过期","lang"):"")+" ")]]}}])})],1),e("div",{staticClass:"clearfix",staticStyle:{"margin-top":"20px"}},[t.total_count>t.pageSize?e("div",{staticClass:"tc"},[e("el-pagination",{attrs:{layout:"prev, pager, next",total:t.total_count,"page-size":t.pageSize},on:{"current-change":t.handleCurrentChange}})],1):t._e()]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.cancelAction}},[t._v($t("caoqm3","取 消","lang"))]),e("el-button",{attrs:{type:"primary"},on:{click:t.saveAction}},[t._v($t("hnjoo3","确 定","lang"))])],1)],1)],1)},[],!1,null,"00fb4532",null).exports},data(){return{coupons:[],form_setting:{limit_cycle:"month",grant_per_user_total:"",grant_total:"",coupons:[]},params:{page:1,page_size:1e3},loading:!0,coupon_list:[],total_count:0,coupon_dialog_visible:!1,coupon_sc_status:!1}},mounted(){this.getList()},computed:{...(0,o.L8)(["wheight"])},methods:{getList(){this.loading=!0,(0,s.getSalepersonCouponList)(this.params).then(t=>{for(var e in this.total_count=t.data.data.total_count,this.form_setting=t.data.data.coupon_setting,this.coupon_list=t.data.data.list,this.form_setting.coupons=[],this.coupon_list){let t={coupon_id:this.coupon_list[e].card_id,send_num:this.coupon_list[e].send_num};this.form_setting.coupons.push(t)}this.loading=!1})},saveCouponGrantSet(){(0,s.createSalepersonCoupon)(this.form_setting).then(t=>{t.data.data.status?this.$message({message:$t("aghf564","保存成功","lang"),type:"success",duration:5e3}):this.$message({message:$t("agg8dr4","保存失败","lang"),type:"error",duration:5e3}),this.getList()})},addCoupon(){this.coupon_dialog_visible=!0,this.coupon_sc_status=!0},deleteCoupon(t){let e=this;this.$confirm($t("3gab16h","是否移除可发放优惠券, 是否继续?","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(()=>{(0,s.deleteSalepersonCoupon)(t.id).then(t=>{e.$message({type:"success",message:$t("pc5qj0a","移除可发放优惠券成功","lang")}),e.getList()}).catch(()=>{e.$message({type:"info",message:$t("pc4jrla","移除可发放优惠券失败","lang")})})})},changeCouponSendNum(){for(var t in this.form_setting.coupons=[],this.coupon_list){let e={coupon_id:this.coupon_list[t].card_id,send_num:this.coupon_list[t].send_num};this.form_setting.coupons.push(e)}},handleChooseKQ(t){let e=JSON.parse(JSON.stringify(t));for(var a in this.coupon_list=Array.from(new Set(this.coupon_list.concat(e))),this.form_setting.coupons=[],this.coupon_list){let t={coupon_id:this.coupon_list[a].card_id,send_num:1};this.form_setting.coupons.push(t)}this.coupon_dialog_visible=!1},handleCloseKQDialog(){this.coupon_dialog_visible=!1}}},r=(0,l.A)(i,function(){var t=this,e=t._self._c;return e("div",[e("el-form",{ref:"form",attrs:{"label-width":"250px"},model:{value:t.form_setting,callback:function(e){t.form_setting=e},expression:"form_setting"}},[e("el-form-item",{attrs:{label:$t("jayucd4","限制周期","lang")}},[e("el-radio-group",{model:{value:t.form_setting.limit_cycle,callback:function(e){t.$set(t.form_setting,"limit_cycle",e)},expression:"form_setting.limit_cycle"}},[e("el-radio-button",{key:"month",attrs:{label:"month"}},[t._v($t("i6ns3"," 月 ","lang"))]),e("el-radio-button",{key:"week",attrs:{label:"week"}},[t._v($t("f0m03"," 周 ","lang"))])],1)],1),e("el-form-item",{attrs:{label:$t("vk5lkqa","导购可发放优惠券总数","lang")}},[e("el-input",{staticClass:"formInput",model:{value:t.form_setting.grant_total,callback:function(e){t.$set(t.form_setting,"grant_total",e)},expression:"form_setting.grant_total"}})],1),e("el-form-item",{attrs:{label:$t("z9h6ssf","导购可发放给单个客户的优惠券数","lang")}},[e("el-input",{staticClass:"formInput",model:{value:t.form_setting.grant_per_user_total,callback:function(e){t.$set(t.form_setting,"grant_per_user_total",e)},expression:"form_setting.grant_per_user_total"}})],1)],1),e("div",[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{md:4,lg:8}},[e("el-button",{attrs:{type:"primary",icon:"plus"},on:{click:t.addCoupon}},[t._v($t("1d6sh77"," 添加优惠券 ","lang"))])],1)],1),e("el-table",{attrs:{data:t.coupon_list}},[e("el-table-column",{attrs:{prop:"title",label:$t("av1t4q4","卡券名称","lang")}}),e("el-table-column",{attrs:{label:$t("av8hwn4","卡券类型","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("formatCardStr")(e.row.card_type))+" ")]}}])}),e("el-table-column",{attrs:{label:$t("hkxb2","操作","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.deleteCoupon(a.row)}}},[t._v($t("j57pz4"," 移除 ","lang"))])]}}])})],1),e("couponSelect",{attrs:{"dialog-visible":t.coupon_dialog_visible,"sc-status":t.coupon_sc_status},on:{chooseKQ:t.handleChooseKQ,closeKQDialog:t.handleCloseKQDialog}})],1),e("div",{staticStyle:{"text-align":"center"}},[e("el-button",{attrs:{type:"primary"},on:{click:t.saveCouponGrantSet}},[t._v($t("fvorza6"," 保存修改 ","lang"))])],1)],1)},[],!1,null,null,null).exports}}]);