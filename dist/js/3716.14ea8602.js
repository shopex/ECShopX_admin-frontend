"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[3716],{43716:function(t,e,i){i.r(e),i.d(e,{default:function(){return o}});i(44114),i(18111),i(22489),i(7588),i(61701);var a=i(17659),s={name:"",data(){return{formBase:{value:"1"},formBaseList:[{label:$t("b42heo4","商品库存","lang"),key:"value",type:"radio",disabled:()=>this.IS_ADMIN()&&"0"!=this.distributor_id,options:[{name:$t("wr1qdj6","共享商城库存","lang"),label:"1"},{name:$t("b1baj56","活动独立库存","lang"),label:"2"}],onChange:async()=>{const{id:t}=this.$route.params;await this.$api.marketing.setActivityShareStore({activity_id:t,if_share_store:"1"==this.formBase.value?1:0}),this.$message.success($t("d1spvi4","操作成功","lang"))}}],distributor_id:null,patchDialog:!1,patchForm:{item_id:[],activity_price:0,activity_store:0,sort:0,limit_num:0,limit_fee:0},patchFormList:[{label:$t("e4gwqa4","活动价格","lang"),key:"activity_price",type:"input"},{label:$t("e4jhrm4","活动库存","lang"),key:"activity_store",type:"input"},{label:$t("hge52","排序","lang"),key:"sort",type:"input"},{label:$t("dxs3qg4","每人限购","lang"),key:"limit_num",type:"input"},{label:$t("dxs5zs4","每人限额","lang"),key:"limit_fee",type:"input"}],queryForm:{main_cat_id:[],cat_id:[],item_name:"",item_bn:""},categoryList:[],salesCategoryList:[],tableData:[],page:1,pageSize:20,total:0,loading:!1,tempModify:{activity_price:0,activity_store:0,sort:0,limit_num:0,limit_fee:0}}},computed:{adminDisabled(){return this.IS_ADMIN()&&"0"!=this.distributor_id}},async created(){this.getActivityItemDetail();const t=await this.$api.goods.getCategory({is_main_category:!0}),e=await this.$api.goods.getCategory();this.categoryList=t,this.salesCategoryList=e,this.distributor_id=this.$route.query.distributor_id||"0",this.pagesQuery=new a.A({pageSize:this.pageSize,fetch:this.getActivityItems}).nextPage()},methods:{handleImport(){let t;t=this.IS_DISTRIBUTOR()?"/shopadmin/products/store-product-manage/physicalupload?file_type=employee_purchase_activity_items":"/products/product-manage/self-products/product-import?file_type=employee_purchase_activity_items",this.$router.push({path:t})},handlePatchAction(){const t=this.tableData.filter(t=>!!t.checked);if(t.length>0){let e=[];t.forEach(t=>{"true"==t.nospec?e.push(t.item_id):void 0!==t.spec_items&&t.spec_items.forEach(t=>{e.push(t.item_id)})}),this.patchForm.item_id=e,this.patchDialog=!0}else this.$message.error($t("2engwe5","请选择商品","lang"))},async onPatchChangeSubmit(){const{id:t}=this.$route.params,{item_id:e,activity_price:i,activity_store:a,sort:s,limit_num:o,limit_fee:r}=this.patchForm;let l={activity_id:t,item_id:e,activity_price:100*i,activity_store:a,sort:s,limit_num:o,limit_fee:100*r};await this.$api.marketing.updateActivityItem(l),this.patchDialog=!1,this.pagesQuery.refresh()},onSelectAll(t){t.length>0?this.tableData.forEach(t=>{t.checked=!0}):this.tableData.forEach(t=>{t.checked=!1})},onSearch(){this.pagesQuery.reset()},async getActivityItemDetail(){const{id:t}=this.$route.params,{if_share_store:e}=await this.$api.marketing.getActivityItemDetail(t);this.formBase.value=e?"1":"2"},async onSelectGoods(){const{data:{type:t,value:e}}=await this.$picker.goodsList({distributor_id:this.distributor_id}),{id:i}=this.$route.params;let a={activity_id:i};if("goods"==t)a={...a,item_id:e.map(t=>t.itemId)};else if("category"==t){const t=e.map(t=>t[t.length-1]);a={...a,main_cat_id:t}}else if("salesCategory"==t){const t=e[e.length-1];a={...a,cat_id:t}}await this.$api.marketing.addGoodsInActivity(a),this.pagesQuery.reset()},async getActivityItems({page:t,pageSize:e}){const{id:i}=this.$route.params;this.loading=!0;const{list:a,total_count:s}=await this.$api.marketing.getActivityItems({activity_id:i,page:t,pageSize:e,...this.queryForm});this.loading=!1;let o=0;a.forEach(t=>{t.is_sku=!1,t.activity_price=t.activity_price/100,t.limit_fee=t.limit_fee/100,t.tid=++o,t.checked=!1,void 0!==t.spec_items&&t.spec_items.forEach(t=>{t.is_sku=!0,t.activity_price=t.activity_price/100,t.limit_fee=t.limit_fee/100,t.tid=++o})}),this.tableData=a,this.page=t,this.total=s,this.pagesQuery.setTotal(s)},async onSelectSku({goods_id:t,item_id:e,default_item_id:i,item_name:a,item_bn:s,spec_items:o=[]}){const{data:r}=await this.$picker.goodsSku({data:o.map(t=>t.item_id),itemId:i,itemName:a,itemBn:s}),{id:l}=this.$route.params;await this.$api.marketing.selectSkuOfItems({activity_id:l,goods_id:t,item_id:r.map(t=>t.itemId)}),this.pagesQuery.reset()},async removeActivityItem({item_id:t,is_sku:e}){const{id:i}=this.$route.params;await this.$confirm(`${$t("8ddcgr5","确认删除？","lang")}`,$t("hn562","提示","lang"));let a={};e||(a.all=1),await this.$api.marketing.deleteActivityItem(i,t,a),this.pagesQuery.reset()},async onModifyActivityItem(t,e){const{id:i}=this.$route.params;let a={activity_id:i,item_id:t.item_id};a[e]="activity_price"==e||"limit_fee"==e?100*this.tempModify[e]:this.tempModify[e],await this.$api.marketing.updateActivityItem(a),this.pagesQuery.refresh()},handleSizeChange(t){this.pagesQuery.setPageSize(t),this.pagesQuery.refresh()},handleCurrentChange(t){this.pagesQuery.setPage(t),this.pagesQuery.refresh()}}},o=(0,i(81656).A)(s,function(){var t=this,e=t._self._c;return e("SpPage",{attrs:{title:$t("twoqbx6","添加活动商品","lang")}},[e("div",{staticClass:"marketing-employee-addgoods"},[e("el-card",{staticClass:"el-card--normal",attrs:{header:$t("e4hvig4","活动商品","lang")}},[e("SpForm",{ref:"formBase",staticClass:"base-form",attrs:{"label-width":"80px","form-list":t.formBaseList,submit:!1},model:{value:t.formBase,callback:function(e){t.formBase=e},expression:"formBase"}}),e("SpFilterForm",{attrs:{model:t.queryForm},on:{onSearch:t.onSearch,onReset:t.onSearch}},[e("SpFilterFormItem",{attrs:{prop:"main_cat_id",label:$t("15jaio5","管理分类:","lang")}},[e("el-cascader",{attrs:{options:t.categoryList,props:{checkStrictly:!0,label:"category_name",value:"category_id"},clearable:""},model:{value:t.queryForm.main_cat_id,callback:function(e){t.$set(t.queryForm,"main_cat_id",e)},expression:"queryForm.main_cat_id"}})],1),e("SpFilterFormItem",{attrs:{prop:"cat_id",label:$t("pfl60n5","销售分类:","lang")}},[e("el-cascader",{attrs:{options:t.salesCategoryList,props:{checkStrictly:!0,label:"category_name",value:"category_id"},clearable:""},model:{value:t.queryForm.cat_id,callback:function(e){t.$set(t.queryForm,"cat_id",e)},expression:"queryForm.cat_id"}})],1),e("SpFilterFormItem",{attrs:{prop:"item_name",label:$t("aotkhw5","商品名称:","lang")}},[e("el-input",{attrs:{placeholder:$t("mf25uh7","请输入商品名称","lang")},model:{value:t.queryForm.item_name,callback:function(e){t.$set(t.queryForm,"item_name",e)},expression:"queryForm.item_name"}})],1),e("SpFilterFormItem",{attrs:{prop:"item_bn",label:$t("l2kqy3","货号:","lang")}},[e("el-input",{attrs:{placeholder:$t("2j1o9z5","请输入货号","lang")},model:{value:t.queryForm.item_bn,callback:function(e){t.$set(t.queryForm,"item_bn",e)},expression:"queryForm.item_bn"}})],1)],1),e("div",{staticClass:"action-container"},[e("el-button",{attrs:{type:"primary",disabled:t.adminDisabled,plain:""},on:{click:t.handleImport}},[t._v($t("u9zv6k6"," 导入商品 ","lang"))]),e("el-button",{attrs:{type:"primary",disabled:t.adminDisabled,plain:""},on:{click:t.onSelectGoods}},[t._v($t("mwtd0l6"," 选择商品 ","lang"))]),e("el-button",{attrs:{type:"primary",disabled:t.adminDisabled,plain:""},on:{click:t.handlePatchAction}},[t._v($t("7166jq6"," 批量设置 ","lang"))])],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"goods-table",attrs:{data:t.tableData,"row-key":"tid",border:"","default-expand-all":"","tree-props":{children:"spec_items"}},on:{"select-all":t.onSelectAll}},[e("el-table-column",{attrs:{type:"selection",width:"55"},scopedSlots:t._u([{key:"default",fn:function(i){return[i.row.is_sku?t._e():e("el-checkbox",{model:{value:i.row.checked,callback:function(e){t.$set(i.row,"checked",e)},expression:"scope.row.checked"}})]}}])}),e("el-table-column",{attrs:{prop:"item_name",label:$t("b44fe44","商品标题","lang"),width:"380"},scopedSlots:t._u([{key:"default",fn:function(i){return[i.row.is_sku?e("div",[e("div",{staticClass:"item-spec"},[t._v(t._s(i.row.item_spec_desc))])]):e("div",{staticClass:"item-info"},[e("div",[e("el-image",{staticClass:"item-image",attrs:{src:i.row.pics[0],fit:"cover"}})],1),e("div",[e("div",{staticClass:"item-name"},[t._v(t._s(i.row.item_name))]),e("div",{staticClass:"item-bn"},[t._v($t("loeoa4"," 货号：","lang")+t._s(i.row.item_bn)+" "),"true"==i.row.nospec||t.adminDisabled?t._e():e("el-button",{staticStyle:{"margin-left":"4px"},attrs:{type:"text"},on:{click:function(e){return t.onSelectSku(i.row)}}},[t._v($t("n4lgqw6"," 选择规格 ","lang"))])],1)])])]}}])}),e("el-table-column",{attrs:{prop:"store",label:$t("b4ikj14","商城库存","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return"false"==e.row.nospec&&e.row.is_sku||"true"==e.row.nospec?[t._v(" "+t._s(e.row.store)+" ")]:void 0}}],null,!0)}),e("el-table-column",{attrs:{prop:"price",label:$t("78n6rp6","销售价（元）","lang"),width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.price/100)+" ")]}}])}),e("el-table-column",{attrs:{prop:"price",label:$t("kg38o17","商城价格（元）","lang"),width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return"false"==e.row.nospec&&e.row.is_sku||"true"==e.row.nospec?[t._v(" "+t._s(e.row.price/100)+" ")]:void 0}}],null,!0)}),e("el-table-column",{attrs:{prop:"activity_price",label:$t("d8o4as7","活动价格（元）","lang"),width:"120"},scopedSlots:t._u([{key:"default",fn:function(i){return"false"==i.row.nospec&&i.row.is_sku||"true"==i.row.nospec?[e("span",[t._v(t._s(i.row.activity_price))]),t.adminDisabled?t._e():e("el-popover",{attrs:{placement:"top",trigger:"click"},on:{show:()=>{t.tempModify.activity_price=i.row.activity_price}}},[e("div",{staticClass:"popover-edit popover-table-edit"},[e("el-input",{staticClass:"edit-input",model:{value:t.tempModify.activity_price,callback:function(e){t.$set(t.tempModify,"activity_price",e)},expression:"tempModify.activity_price"}}),e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.onModifyActivityItem(i.row,"activity_price")}}},[t._v($t("in1ck4"," 确定 ","lang"))])],1),e("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e("i",{staticClass:"el-icon-edit"})])],1)]:void 0}}],null,!0)}),e("el-table-column",{attrs:{prop:"activity_store",label:$t("e4jhrm4","活动库存","lang")},scopedSlots:t._u([{key:"default",fn:function(i){return"false"==i.row.nospec&&i.row.is_sku||"true"==i.row.nospec?[e("span",[t._v(t._s("1"==t.formBase.value?0:i.row.activity_store))]),t.adminDisabled?t._e():e("el-popover",{attrs:{placement:"top",trigger:"click"},on:{show:()=>{t.tempModify.activity_store=i.row.activity_store}}},[e("div",{staticClass:"popover-edit popover-table-edit"},[e("el-input",{staticClass:"edit-input",model:{value:t.tempModify.activity_store,callback:function(e){t.$set(t.tempModify,"activity_store",e)},expression:"tempModify.activity_store"}}),e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.onModifyActivityItem(i.row,"activity_store")}}},[t._v($t("in1ck4"," 确定 ","lang"))])],1),e("el-button",{attrs:{slot:"reference",disabled:"1"==t.formBase.value,type:"text"},slot:"reference"},[e("i",{staticClass:"el-icon-edit"})])],1)]:void 0}}],null,!0)}),e("el-table-column",{attrs:{prop:"sort",label:$t("hge52","排序","lang")},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v(t._s(i.row.sort))]),t.adminDisabled?t._e():e("el-popover",{attrs:{placement:"top",trigger:"click"},on:{show:()=>{t.tempModify.sort=i.row.sort}}},[e("div",{staticClass:"popover-edit popover-table-edit"},[e("el-input",{staticClass:"edit-input",model:{value:t.tempModify.sort,callback:function(e){t.$set(t.tempModify,"sort",e)},expression:"tempModify.sort"}}),e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.onModifyActivityItem(i.row,"sort")}}},[t._v($t("in1ck4"," 确定 ","lang"))])],1),e("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e("i",{staticClass:"el-icon-edit"})])],1)]}}])}),e("el-table-column",{attrs:{prop:"limit_num",label:$t("872pe57","每人限购（件）","lang"),width:"120"},scopedSlots:t._u([{key:"default",fn:function(i){return"false"==i.row.nospec&&i.row.is_sku||"true"==i.row.nospec?[e("span",[t._v(t._s(i.row.limit_num))]),t.adminDisabled?t._e():e("el-popover",{attrs:{placement:"top",trigger:"click"},on:{show:()=>{t.tempModify.limit_num=i.row.limit_num}}},[e("div",{staticClass:"popover-edit popover-table-edit"},[e("el-input",{staticClass:"edit-input",model:{value:t.tempModify.limit_num,callback:function(e){t.$set(t.tempModify,"limit_num",e)},expression:"tempModify.limit_num"}}),e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.onModifyActivityItem(i.row,"limit_num")}}},[t._v($t("in1ck4"," 确定 ","lang"))])],1),e("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e("i",{staticClass:"el-icon-edit"})])],1)]:void 0}}],null,!0)}),e("el-table-column",{attrs:{prop:"limit_fee",label:$t("6r4ppm7","每人限额（元）","lang"),width:"120"},scopedSlots:t._u([{key:"default",fn:function(i){return"false"==i.row.nospec&&i.row.is_sku||"true"==i.row.nospec?[e("span",[t._v(t._s(i.row.limit_fee))]),t.adminDisabled?t._e():e("el-popover",{attrs:{placement:"top",trigger:"click"},on:{show:()=>{t.tempModify.limit_fee=i.row.limit_fee}}},[e("div",{staticClass:"popover-edit popover-table-edit"},[e("el-input",{staticClass:"edit-input",model:{value:t.tempModify.limit_fee,callback:function(e){t.$set(t.tempModify,"limit_fee",e)},expression:"tempModify.limit_fee"}}),e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.onModifyActivityItem(i.row,"limit_fee")}}},[t._v($t("in1ck4"," 确定 ","lang"))])],1),e("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e("i",{staticClass:"el-icon-edit"})])],1)]:void 0}}],null,!0)}),e("el-table-column",{attrs:{fixed:"right",label:$t("hkxb2","操作","lang"),width:"120px"},scopedSlots:t._u([{key:"default",fn:function(i){return[t.adminDisabled?t._e():e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.removeActivityItem(i.row)}}},[t._v($t("j57pz4"," 移除 ","lang"))])]}}])})],1),e("el-pagination",{staticStyle:{"text-align":"center","margin-top":"10px"},attrs:{background:"","current-page":t.page,"page-sizes":[20,30,40],"page-size":100,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),e("SpDialog",{ref:"patchDialogRef",attrs:{title:`${$t("d15vmu4","批量设置","lang")}`,form:t.patchForm,"form-list":t.patchFormList},on:{onSubmit:t.onPatchChangeSubmit},model:{value:t.patchDialog,callback:function(e){t.patchDialog=e},expression:"patchDialog"}})],1)])},[],!1,null,null,null).exports}}]);