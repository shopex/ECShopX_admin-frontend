"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[4902],{4902:function(e,t,i){i.r(t),i.d(t,{default:function(){return r}});i(18111),i(22489),i(61701);var a=i(26456),l=i(95093),s=i.n(l);const n={name:"ActionsButton",props:{disabled:{type:Boolean,default:!1}},methods:{onCancel(){this.$router.go(-1)}},render(){const e=arguments[0];return e("div",[e("el-button",{on:{click:this.onCancel}},[$t("ev022","取消","lang")]),e("el-button",{attrs:{type:"primary",disabled:this.disabled},on:{click:()=>{this.$emit("save")}}},[$t("e32z2","保存","lang")])])}};var c={components:{ActionsButton:n},data(){const e=this.$createElement,t=[{name:$t("m8lft3","销售价","lang"),label:"sale_price",disabled:!0},{name:$t("gegne3","活动价","lang"),label:"activity_price"}];return{formBase:{name:"",title:"",linkHome:null,share_pic:"",pic:""},formBaseList:[{label:$t("e4hvdc4","活动名称","lang"),className:"activity-name",key:"name",type:"input",required:!0,maxlength:30,disabled:!1,placeholder:$t("o38y6tp","活动名称，管理活动用，不对消费者展示，最多30个字","lang"),message:$t("v23s2o8","活动名称不能为空","lang")},{label:$t("e4lfr24","活动标题","lang"),className:"activity-title",key:"title",type:"input",required:!0,maxlength:16,disabled:!1,placeholder:$t("phydoqj","活动标题，再活动列表展示，最多16个字","lang"),message:$t("o2ivwu8","活动标题不能为空","lang"),tip:$t("plsbgus","活动标题在活动列表展示，也会作为分享小程序的卡片标题使用","lang")},{label:$t("e4tv704","活动首页","lang"),key:"linkHome",component:({disabled:t})=>e("div",[e("span",{class:"link-home"},[this.formBase?.linkHome&&this.formBase.linkHome.template_title]),e("el-button",{attrs:{type:"text",disabled:t},on:{click:this.onPickerTemp}},[$t("il8tr34","选择首页","lang")])]),disabled:!1,validator:(e,t,i)=>{this.formBase.linkHome?i():i(new Error($t("xxfnj77","请选择活动首页","lang")))}},{label:$t("aohl2q4","分享活动","lang"),key:"share_pic",component:()=>e("div",{class:"activity-pic-field"},[e("div",{class:"form-item-tip"},[$t("9g0dve1h","员工通过小程序卡片分享活动时展示，建议尺寸300*240，支持 png、jpg 格式，文件大小为 2M 内","lang")]),e("SpImagePicker",{model:{value:this.formBase.share_pic,callback:e=>{this.$set(this.formBase,"share_pic",e)}}})]),validator:(e,t,i)=>{(0,a.Im)(this.formBase.share_pic)?i(new Error($t("xx447h7","请选择活动图片","lang"))):i()}},{label:$t("e4m2e34","活动海报","lang"),key:"pic",component:()=>e("SpImagePicker",{model:{value:this.formBase.pic,callback:e=>{this.$set(this.formBase,"pic",e)}}}),tip:$t("1zp8ayk","建议尺寸:（宽度640px，高度自适应）","lang"),validator:(e,t,i)=>{(0,a.Im)(this.formBase.pic)?i(new Error($t("xx7uqa7","请选择活动海报","lang"))):i()}}],activityRule:{companyList:[],preheatTime:"",employee:{datetime:[],quota:""},relatives:{join:!1,num:"",datetime:[],type:"1",shareLimit:""},orderMiniAmount:"",modifyReceiveAddress:"",items_page:["sale_price","activity_price"],cart_page:["sale_price","activity_price"],order_detail_page:["sale_price","activity_price"],checkout_page:["sale_price","activity_price"],is_discount_description_enabled:!1,discount_description:""},activityRuleList:[{label:$t("aw4oud4","参与企业","lang"),key:"companyList",type:"input",component:({disabled:t})=>e("div",{class:"company-list"},[this.activityRule.companyList.map((t,i)=>e("el-tag",{attrs:{closable:!0,"disable-transitions":!0,type:t.id},key:t.id,on:{close:this.closeCompany.bind(this,i)}},[t.name])),e("el-button",{attrs:{type:"text",disabled:t},on:{click:this.onPickerCompany}},[$t("ikvqd54","选择企业","lang")])]),disabled:!1,validator:(e,t,i)=>{0==this.activityRule.companyList.length?i(new Error($t("uoqh6k7","请选择参与企业","lang"))):i()}},{label:$t("cd8yd04","开始预热","lang"),key:"preheatTime",component:({disabled:t})=>e("div",{class:"preheat-time"},[$t("fke1","从","lang"),e("el-date-picker",{attrs:{disabled:t,type:"datetime",placeholder:$t("tnwvfc6","选择日期时间","lang")},model:{value:this.activityRule.preheatTime,callback:e=>{this.$set(this.activityRule,"preheatTime",e)}}}),$t("dba5bhc","开始活动将展示在活动列表","lang")]),disabled:!1,validator:(e,t,i)=>{0==this.activityRule.preheatTime.length?i(new Error($t("220s6j9","请选择活动预热时间","lang"))):i()}},{label:$t("ev0t2","员工","lang"),key:"employee",component:({disabled:{datetime:t,quota:i}})=>e("div",{class:"activity-employee-field"},[e("div",{class:"form-item-content"},[e("div",{class:"content-item"},[e("label",[$t("i50ogx4","购买时间","lang")]),e("el-date-picker",{attrs:{disabled:t,type:"daterange","range-separator":$t("po31","至","lang"),"start-placeholder":$t("cd0k3t4","开始时间","lang"),"end-placeholder":$t("gfi7qi4","结束时间","lang")},model:{value:this.activityRule.employee.datetime,callback:e=>{this.$set(this.activityRule.employee,"datetime",e)}}})]),e("div",{class:"form-item-tip"},[$t("9glw5nd","活动人员在该段内可购买商品","lang")])]),e("div",{class:"form-item-content"},[e("div",{class:"content-item"},[e("label",[$t("i58zpo4","购买额度","lang")]),e("SpInput",{attrs:{width:"120px",disabled:i,placeholder:$t("wxrrfb6","大于0的整数","lang"),prefix:$t("92mfqu9","每人最多可购买额度","lang"),suffix:$t("g1v1","元","lang")},model:{value:this.activityRule.employee.quota,callback:e=>{this.$set(this.activityRule.employee,"quota",e)}}})])])]),disabled:{datetime:!1,quota:!1},validator:(e,t,i)=>{0==this.activityRule.employee.datetime.length?i(new Error($t("hhag59","请选择活动购买时间","lang"))):this.activityRule.employee.quota?i():i(new Error($t("v9e7ge9","请输入活动购买额度","lang")))}},{label:$t("duft2","亲友","lang"),key:"relatives",component:({disabled:{join:t,num:i,datetime:a,type:l,shareLimit:s}})=>e("div",{class:"activity-relatives-field"},[e("div",{class:"form-item-content"},[e("div",{class:"content-item"},[e("el-switch",{attrs:{disabled:t},model:{value:this.activityRule.relatives.join,callback:e=>{this.$set(this.activityRule.relatives,"join",e)}}}),e("span",{class:"form-item-tip"},[$t("5dlvakd","亲友参与活/亲友不参与活动","lang")])])]),this.activityRule.relatives.join?e("div",[e("div",{class:"form-item-content"},[e("div",{class:"content-item"},[e("label",[$t("it06c04","邀请亲友","lang")]),e("SpInput",{attrs:{width:"120px",disabled:i,placeholder:$t("wxrrfb6","大于0的整数","lang"),prefix:$t("v4r6rl9","每名员工最多可邀请","lang"),suffix:$t("cp1k63","名亲友","lang")},model:{value:this.activityRule.relatives.num,callback:e=>{this.$set(this.activityRule.relatives,"num",e)}}})])]),e("div",{class:"form-item-content"},[e("div",{class:"content-item"},[e("label",[$t("i50ogx4","购买时间","lang")]),e("el-date-picker",{attrs:{disabled:a,type:"daterange","range-separator":$t("po31","至","lang"),"start-placeholder":$t("cd0k3t4","开始时间","lang"),"end-placeholder":$t("gfi7qi4","结束时间","lang")},model:{value:this.activityRule.relatives.datetime,callback:e=>{this.$set(this.activityRule.relatives,"datetime",e)}}})])]),e("div",{class:"form-item-content"},[e("div",{class:"content-item"},[e("label",[$t("i58zpo4","购买额度","lang")]),e("div",{class:"content-item-field"},[e("div",{class:"item-wrap"},[e("el-radio",{attrs:{disabled:l,label:"1"},on:{change:this.onRadioChange},model:{value:this.activityRule.relatives.type,callback:e=>{this.$set(this.activityRule.relatives,"type",e)}}},[e("SpInput",{attrs:{width:"120px",disabled:s,placeholder:$t("wxrrfb6","大于0的整数","lang"),prefix:$t("92mfqu9","每人最多可购买额度","lang"),suffix:$t("g1v1","元","lang")},model:{value:this.activityRule.relatives.shareLimit,callback:e=>{this.$set(this.activityRule.relatives,"shareLimit",e)}}})])]),e("div",{class:"item-wrap"},[e("el-radio",{attrs:{disabled:l,label:"2"},on:{change:this.onRadioChange},model:{value:this.activityRule.relatives.type,callback:e=>{this.$set(this.activityRule.relatives,"type",e)}}},[$t("wnzrkg6","共享员工额度","lang")])])])])])]):""]),disabled:{join:!1,num:!1,datetime:!1,type:!1,shareLimit:!1},message:$t("v23s2o8","活动名称不能为空","lang")},{label:$t("3g0bvx6","订单最低金额","lang"),key:"orderMiniAmount",component:({disabled:t})=>e("SpInput",{attrs:{disabled:t,width:"120px",placeholder:$t("wxrrfb6","大于0的整数","lang"),prefix:$t("55uvi37","单笔订单不低于","lang"),suffix:$t("g1v1","元","lang")},model:{value:this.activityRule.orderMiniAmount,callback:e=>{this.$set(this.activityRule,"orderMiniAmount",e)}}}),disabled:!1},{label:$t("aynb4c6","修改收货地址","lang"),key:"modifyReceiveAddress",component:({disabled:t})=>e("SpInput",{attrs:{disabled:t,width:"140px",placeholder:$t("lyqu2k8","大于等于0的整数","lang"),prefix:$t("fqxcnnv","活动进行中所有买家（员工和亲友）都可以修改收货地址，活动结束后","lang"),suffix:$t("odzet2r","小时内买家可修改收货地址，已发货订单不允许修改收货地址","lang")},model:{value:this.activityRule.modifyReceiveAddress,callback:e=>{this.$set(this.activityRule,"modifyReceiveAddress",e)}}}),disabled:!1,tip:$t("d6vvz522","请输入大于等于0的整数，从活动结束时间开始开始计算，例如24代表活动结束后24个小时(1天)内买家都可以修改收货地址；活动进行过程中允许买家修改地址","lang")},{label:$t("6fbliv6","活动价格展示","lang"),type:"group"},{label:$t("70aa349","商品列表/商详页面","lang"),key:"items_page",type:"checkbox",options:t},{label:$t("l8nwq3","购物车","lang"),key:"cart_page",type:"checkbox",options:t},{label:$t("j6lld3","结算页","lang"),key:"checkout_page",type:"checkbox",options:t},{label:$t("ae012a4","优惠说明","lang"),key:"is_discount_description_enabled",type:"switch",tip:$t("i4vqsri","开启优惠说明展示在结算页，关闭不展示","lang")},{label:$t("a3jfu09","结算页价格优惠说明","lang"),key:"discount_description",type:"input",maxlength:50}],activityStatus:""}},created(){const{id:e}=this.$route.params;e&&this.getActivityItemDetail(e)},methods:{async getActivityItemDetail(e){const t=await this.$api.marketing.getActivityItemDetail(e),i=await this.$api.template.getPagesTemplateDetail({pages_template_id:t.pages_template_id});this.formBase={name:t.name,title:t.title,linkHome:i,share_pic:t.share_pic,pic:t.pic},"ongoing"==t.status||"pending"==t.status?(this.activityRuleList[2].disabled={datetime:!1,quota:!0},this.activityRuleList[3].disabled={join:!1,num:!0,datetime:!1,type:!1,shareLimit:!0}):"cancel"!=t.status&&"over"!=t.status||(this.formBaseList[0].disabled=!0,this.formBaseList[1].disabled=!0,this.formBaseList[2].disabled=!0,this.activityRuleList[0].disabled=!0,this.activityRuleList[1].disabled=!0,this.activityRuleList[2].disabled={datetime:!0,quota:!0},this.activityRuleList[3].disabled={join:!0,num:!0,datetime:!0,type:!0,shareLimit:!0},this.activityRuleList[4].disabled=!0,this.activityRuleList[5].disabled=!0),this.activityStatus=t.status;const{list:a}=await this.$api.member.getPurchaseCompanyList({page:1,pageSize:100,enterprise_id:t.enterprise_id}),l=this.priceShowData(t.price_display_config,"detail");this.activityRule={companyList:a,preheatTime:1e3*t.display_time,employee:{datetime:[1e3*t.employee_begin_time,1e3*t.employee_end_time],quota:t.employee_limitfee/100},relatives:{join:1==t.if_relative_join,num:t.invite_limit,datetime:[t.relative_begin_time?1e3*t.relative_begin_time:"",t.relative_end_time?1e3*t.relative_end_time:""],type:t.if_share_limitfee?"2":"1",shareLimit:t.relative_limitfee/100},orderMiniAmount:t.minimum_amount/100,modifyReceiveAddress:t.close_modify_hours_after_activity,...l,is_discount_description_enabled:"true"==t.is_discount_description_enabled,discount_description:t.discount_description},this.onRadioChange(t.if_share_limitfee?"2":"1")},async onPickerTemp(){const{data:e}=await this.$picker.template({data:this.formBase.linkHome?.pages_template_id||[],multiple:!1});this.formBase.linkHome=e?e[0]:null},async onPickerCompany(){const e={data:this.activityRule.companyList.map(e=>e.id)};this.IS_ADMIN()&&(e.distributor_id=0);const{data:t}=await this.$picker.company(e);this.activityRule.companyList=t},closeCompany(e){this.activityRule.companyList.splice(e,1)},priceShowData(e,t){let i=["items_page","cart_page","order_detail_page","checkout_page"],a=["sale_price","market_price","activity_price"];return t?i.reduce((t,i)=>{let l=[];return a.forEach(t=>{l=Object.keys(e[i]).filter(t=>"true"==e[i][t])}),t[i]=l,t},{}):i.reduce((t,i)=>{let l={};return a.forEach(t=>{l[t]=e[i].includes(t)+""}),t[i]=l,t},{})},async onSubmitForm(){await this.$refs.formBase.handleSubmit(),await this.$refs.activityRule.handleSubmit();const{name:e,title:t,linkHome:{pages_template_id:i},share_pic:a,pic:l}=this.formBase,{companyList:n,preheatTime:c,employee:{datetime:r,quota:o},relatives:{join:d,num:m,datetime:p,type:h,shareLimit:u},orderMiniAmount:v,modifyReceiveAddress:y,is_discount_description_enabled:g,discount_description:b}=this.activityRule;let _={name:e,title:t,pages_template_id:i,share_pic:a,pic:l,enterprise_id:n.map(e=>e.id),display_time:s()(c).unix(),employee_begin_time:s()(r[0]).unix(),employee_end_time:s()(r[1]).unix(),employee_limitfee:100*o,if_relative_join:d?1:0,invite_limit:m,if_share_limitfee:"2"==h,relative_limitfee:100*u,minimum_amount:100*v,close_modify_hours_after_activity:y,price_display_config:JSON.stringify(this.priceShowData(this.activityRule)),is_discount_description_enabled:g,discount_description:b};p[0]&&(_={..._,relative_begin_time:s()(p[0]).unix()}),p[1]&&(_={..._,relative_end_time:s()(p[1]).unix()});const{id:f}=this.$route.params,$=this.$route.path.split("create")[0]+"result/";if(f)await this.$api.marketing.updatePurchaseActivity(f,_),this.$router.replace({path:$+f});else{const{id:e}=await this.$api.marketing.createPurchaseActivity(_);this.$router.replace({path:$+e})}},onRadioChange(e){"1"==e?this.activityRuleList[3].disabled={shareLimit:!1}:(this.activityRule.relatives.shareLimit=0,this.activityRuleList[3].disabled={shareLimit:!0})}}},r=(0,i(81656).A)(c,function(){var e=this,t=e._self._c;return t("SpPage",{attrs:{title:$t("ownlkt6","员工购买活动","lang")}},[t("template",{slot:"page-footer"},[t("ActionsButton",{staticClass:"text-center",attrs:{disabled:"cancel"==e.activityStatus||"over"==e.activityStatus},on:{save:e.onSubmitForm}})],1),t("div",{staticClass:"marketing-employee-purchase"},[t("el-card",{staticClass:"el-card--normal",attrs:{header:$t("blh1h04","基础信息","lang")}},[t("SpForm",{ref:"formBase",staticClass:"base-form",attrs:{"show-message":"","form-list":e.formBaseList,submit:!1},model:{value:e.formBase,callback:function(t){e.formBase=t},expression:"formBase"}})],1),t("el-card",{staticClass:"el-card--normal",attrs:{header:$t("e4qsf64","活动规则","lang")}},[t("SpForm",{ref:"activityRule",staticClass:"base-form",attrs:{"show-message":"","form-list":e.activityRuleList,submit:!1},model:{value:e.activityRule,callback:function(t){e.activityRule=t},expression:"activityRule"}})],1)],1)],2)},[],!1,null,null,null).exports}}]);