"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[3358],{83358:function(t,e,a){a.r(e),a.d(e,{default:function(){return n}});a(44114),a(18111),a(22489),a(7588),a(61701);var i=a(95353),l=a(6919),r=a(59025),s=a(77825),o={mixins:[s.Ay,s.v8],provide(){return{refresh:this.fetchList}},data(){const t={activity_id:void 0,mobile:void 0,status:"all",create_time:[],true_name:void 0,distributor_id:"",distributor:{name:void 0,id:void 0},is_white_list:""};return{initialParams:t,params:{...t},tabList:[{label:$t("en402","全部","lang"),name:"all"},{label:$t("eftvg3","待审核","lang"),name:"pending"},{label:$t("e8m0q3","已报名","lang"),name:"passed"},{label:$t("e8vjx3","已拒绝","lang"),name:"rejected"},{label:$t("e9wze3","已核销","lang"),name:"verified"},{label:$t("e68dg3","已取消","lang"),name:"canceled"}],activityParams:{page:1,pageSize:10},loading:!1,activity_options:[],shopList:[],whiteOptions:[{label:$t("en402","全部","lang"),value:""},{label:$t("k6n1","是","lang"),value:1},{label:$t("gme1","否","lang"),value:2}],dialogVisible:!1,dialogForm:{record_id:"",verify_code:""},dialogFormList:[{label:$t("faz623","提货码","lang"),key:"verify_code",type:"input",placeholder:$t("7j3g5b6","请输入提货码","lang"),required:!0,message:$t("adohlc4","不能为空","lang")}]}},mounted(){this.$route.query.id&&(this.params.activity_id=this.$route.query.id),this.regActivityEasylists(),this.fetchList(),this.getStoreList()},methods:{onSearch(){this.page.pageIndex=1,this.$nextTick(()=>{this.fetchList()})},onReset(){this.params={...this.initialParams},this.params={...this.params,distributor:{id:void 0,name:void 0}},this.onSearch()},getParams(){const t={},e=this.params.create_time;e.length&&(t.start_time=this.dateStrToTimeStamp(e[0]+" 00:00:00"),t.end_time=this.dateStrToTimeStamp(e[1]+" 00:00:00"));let a={...this.params,create_time:[],status:"all"===this.params.status?"":this.params.status,...t};return delete a.distributor,a},async fetchList(){this.loading=!0;const{pageIndex:t,pageSize:e}=this.page;let a={page:t,pageSize:e,...this.getParams()};const{list:i,total_count:l}=await this.$api.selfhelpform.regActivityRecordlist(a);this.tableList=i,this.page.total=l,this.loading=!1},async hanldeRemarkBlur({record_id:t,remark:e}){await this.$api.marketing.updateRegistrationRecord({record_id:t,remark:e}),this.fetchList()},handleClick(t,e){this.params.status="all"==t.name?"":t.name,this.onSearch()},regActivityEasylists(){this.loading=!0,(0,l.regActivityEasylist)(this.activityParams).then(t=>{t.data.data.list.map(t=>{this.activity_options.push({label:t.activity_name,value:t.activity_id})}),this.total_count=t.data.data.total_count,this.loading=!1})},dateStrToTimeStamp(t){return Date.parse(new Date(t))/1e3},uploadHandleTemplate(){let t={file_type:"selform_registration_record",file_name:$t("9y754l6","报名批量审核","lang")};(0,r.exportUploadTemplate)(t).then(t=>{if(t.data.data.file){var e=document.createElement("a");e.href=t.data.data.file,e.download=t.data.data.name,document.body.appendChild(e),e.click(),e.remove()}else this.$message({type:"error",message:$t("yndnt89","没有相关数据可导出","lang")})})},uploadHandleChange(t,e){let a={isUploadFile:!0,file_type:"selform_registration_record",file:t.raw};(0,r.handleUploadFile)(a).then(t=>{this.$message({type:"success",message:$t("dn5eu39","上传成功，等待处理","lang")}),this.$router.push({path:this.matchRoutePath("editor")})})},editorLog(){this.$router.push({path:this.matchRoutePath("editor")})},exportData(){this.currentPage=1,(0,l.recordExport)(this.params).then(t=>{if(t.data.data.status)return this.$message({type:"success",message:$t("xdh90kk","已加入执行队列，请在设置-导出列表中下载","lang")}),void this.$export_open("selform_registration_record");t.data.data.url?(this.downloadUrl=t.data.data.url,this.downloadName=t.data.data.filename,this.downloadView=!0):this.$message({type:"error",message:$t("d17rj2j","无内容可导出 或 执行失败，请检查重试","lang")})})},async getStoreList(){const{list:t}=await this.$api.marketing.getDistributorList({page:1,pageSize:500});t&&t.forEach(t=>{this.shopList.push({value:t.name,distributor_id:t.distributor_id})})},queryStoreSearch(t,e){var a=this.shopList;e(t?a.filter(this.createFilter(t)):a)},handleSelectStore(t){this.params.distributor_id=t.distributor_id,this.params.distributor.id=t.distributor_id},createFilter(t){return e=>0===e.value.toLowerCase().indexOf(t.toLowerCase())},async onDialogFormSubmit(){await this.$api.selfhelpform.registrationVerify(this.dialogForm),this.dialogVisible=!1,this.dialogForm={},this.fetchList()},onShowChange(t){this.dialogForm.record_id=t.record_id,this.dialogVisible=!0},onLinkChange(t){this.$router.push({path:this.matchRoutePath("detail"),query:{id:t.record_id,activity_id:t.activity_id}})}},computed:{...(0,i.L8)(["wheight"])}},n=(0,a(81656).A)(o,function(){var t=this,e=t._self._c;return e("SpRouterView",[e("SpPage",[e("SpFilterForm",{attrs:{model:t.params},on:{onSearch:t.onSearch,onReset:t.onReset}},[e("SpFilterFormItem",{attrs:{prop:"activity_id",label:$t("ge13h3","活动:","lang")}},[e("el-select",{attrs:{placeholder:$t("2ejem45","请选择活动","lang")},model:{value:t.params.activity_id,callback:function(e){t.$set(t.params,"activity_id",e)},expression:"params.activity_id"}},t._l(t.activity_options,function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),e("SpFilterFormItem",{attrs:{prop:"mobile",label:$t("cttsc24","手机号:","lang")}},[e("el-input",{attrs:{placeholder:$t("ewbd43","手机号","lang")},model:{value:t.params.mobile,callback:function(e){t.$set(t.params,"mobile",e)},expression:"params.mobile"}})],1),e("SpFilterFormItem",{attrs:{prop:"create_time",label:$t("fn58c3","时间:","lang")}},[e("el-date-picker",{attrs:{type:"daterange","value-format":"yyyy/MM/dd",placeholder:$t("fcdtwa8","根据添加时间筛选","lang")},model:{value:t.params.create_time,callback:function(e){t.$set(t.params,"create_time",e)},expression:"params.create_time"}})],1),e("SpFilterFormItem",{attrs:{prop:"is_white_list",label:$t("9isikw5","进白名单:","lang")}},[e("el-select",{attrs:{placeholder:$t("3g80oi6","请选择白名单","lang")},model:{value:t.params.is_white_list,callback:function(e){t.$set(t.params,"is_white_list",e)},expression:"params.is_white_list"}},t._l(t.whiteOptions,function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),e("SpFilterFormItem",{attrs:{prop:"distributor",label:$t("ek40n3","店铺:","lang")}},[e("el-autocomplete",{attrs:{"fetch-suggestions":t.queryStoreSearch,placeholder:$t("kzcmxd7","请输入店铺名称","lang")},on:{select:t.handleSelectStore},model:{value:t.params.distributor.name,callback:function(e){t.$set(t.params.distributor,"name",e)},expression:"params.distributor.name"}})],1),e("SpFilterFormItem",{attrs:{prop:"true_name",label:$t("djxsw3","姓名:","lang")}},[e("el-input",{attrs:{placeholder:$t("fqmy2","姓名","lang")},model:{value:t.params.true_name,callback:function(e){t.$set(t.params,"true_name",e)},expression:"params.true_name"}})],1)],1),e("div",{staticClass:"action-container"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.editorLog()}}},[t._v($t("ogr3hk6"," 上传日志 ","lang"))]),e("el-button",{attrs:{type:"primary"},on:{click:t.exportData}},[t._v($t("efepu4"," 导出 ","lang"))])],1),e("el-tabs",{attrs:{type:"card"},on:{"tab-click":t.onSearch},model:{value:t.params.status,callback:function(e){t.$set(t.params,"status",e)},expression:"params.status"}},t._l(t.tabList,function(a,i){return e("el-tab-pane",{key:i,attrs:{label:a.label,name:a.name}},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{border:"",data:t.tableList,"element-loading-text":$t("go5gpa5","数据加载中","lang")}},[e("el-table-column",{attrs:{prop:"status",label:$t("hkxb2","操作","lang"),width:"150"},scopedSlots:t._u([{key:"default",fn:function(a){return["pending"!=a.row.status||t.IS_DISTRIBUTOR()?t._e():e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.onLinkChange(a.row)}}},[t._v($t("ehbft4"," 审核 ","lang"))]),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.onLinkChange(a.row)}}},[t._v($t("obrz2","详情","lang"))]),"passed"==a.row.status?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.onShowChange(a.row)}}},[t._v($t("gjbjs4"," 核销 ","lang"))]):t._e()]}}],null,!0)}),e("el-table-column",{attrs:{prop:"record_no",label:$t("cstxnt4","报名编号","lang")}}),e("el-table-column",{attrs:{prop:"group_no",width:"140",label:$t("cnsrke6","活动群组编号","lang")}}),e("el-table-column",{attrs:{prop:"activity_name",label:$t("e4hvdc4","活动名称","lang")}}),e("el-table-column",{attrs:{prop:"tem_name",label:$t("csvilx4","报名表单","lang")}}),e("el-table-column",{attrs:{prop:"mobile",label:$t("ewbd43","手机号","lang")}}),e("el-table-column",{attrs:{prop:"get_points",label:$t("gyxnw64","获取积分","lang")}}),e("el-table-column",{attrs:{label:$t("imyhd64","进白名单","lang"),width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(1==e.row.is_white_list?$t("k6n1","是","lang"):$t("gme1","否","lang"))+" ")]}}],null,!0)}),e("el-table-column",{attrs:{label:$t("fqo12","备注","lang"),width:"180"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-input",{on:{blur:()=>t.hanldeRemarkBlur(a.row)},model:{value:a.row.remark,callback:function(e){t.$set(a.row,"remark",e)},expression:"scope.row.remark"}})]}}],null,!0)}),e("el-table-column",{attrs:{prop:"create_date",label:$t("fd5ujm4","申请时间","lang")}}),e("el-table-column",{attrs:{prop:"status_name",label:$t("k1e32","状态","lang")}})],1),e("div",{staticClass:"mt-4 text-right"},[e("el-pagination",{attrs:{layout:"total, sizes, prev, pager, next, jumper","current-page":t.page.pageIndex,"page-sizes":[10,20,50],total:t.page.total,"page-size":t.page.pageSize},on:{"update:currentPage":function(e){return t.$set(t.page,"pageIndex",e)},"update:current-page":function(e){return t.$set(t.page,"pageIndex",e)},"current-change":t.onCurrentChange,"size-change":t.onSizeChange}})],1)],1)}),1),e("SpDialog",{ref:"dialogRef",attrs:{title:$t("csqehc4","报名核销","lang"),modal:!1,width:"500px",form:t.dialogForm,"form-list":t.dialogFormList},on:{onSubmit:t.onDialogFormSubmit},model:{value:t.dialogVisible,callback:function(e){t.dialogVisible=e},expression:"dialogVisible"}})],1)],1)},[],!1,null,"8ed43734",null).exports}}]);