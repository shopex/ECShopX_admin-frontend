"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[3229],{13229:function(t,e,a){a.r(e),a.d(e,{default:function(){return r}});a(44114),a(18111),a(7588);var i=a(9108),s={components:{imgPicker:a(87378).default},data(){return{loading:!1,spaceInput:!1,categoryList:[],total_count:0,params:{category_type:"bring"},imgDialog:!1,isGetImage:!1,current:""}},mounted(){this.getArticleCategory()},methods:{onCopy(){this.$notify.success({message:$t("bkv2mw4","复制成功","lang"),showClose:!0})},getArticleCategory(){this.loading=!0,(0,i.getArticleCategoryList)(this.params).then(t=>{let e=t.data.data;e.forEach((t,a)=>{let i=`/pages/recommend/list?id=${t.category_id}&name=${t.category_name}`;e[a]={...t,link:i}}),this.categoryList=e,this.loading=!1})},updateCategory(){for(var t=0;t<this.categoryList.length;t++){for(var e=0;e<this.categoryList.length-1-t;e++)if(this.categoryList[e].category_name==this.categoryList[e+1].category_name)return this.$message({type:"error",message:$t("7dz2o1a","同级栏目名称不能相同","lang")}),!1;if(!this.catNameCheck(this.categoryList[t].category_name))return!1;for(var a=0;a<this.categoryList[t].children.length;a++){for(var s=0;s<this.categoryList[t].children.length-1-a;s++)if(this.categoryList[t].children[s].category_name==this.categoryList[t].children[s+1].category_name)return this.$message({type:"error",message:$t("7dz2o1a","同级栏目名称不能相同","lang")}),!1;if(!this.catNameCheck(this.categoryList[t].children[a].category_name))return!1}}let r=JSON.stringify(this.categoryList);(0,i.saveArticleCategory)({form:r}).then(t=>{this.$message({type:"success",message:$t("zfxtjr6","保存栏目成功","lang")}),this.getArticleCategory()})},deleteCategory(t,e){this.$confirm($t("svdg9tg","此操作将删除该栏目, 是否继续?","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(()=>{if(void 0!==e.category_id)(0,i.deleteArticleCategoryInfo)(e.category_id).then(t=>{this.$message({type:"success",message:$t("rn8zse6","删除栏目成功","lang")}),this.getArticleCategory()});else{const a=t.parent,i=a.data.children||a.data,s=i.findIndex(t=>t.id===e.id);i.splice(s,1)}}).catch(()=>{this.$message({type:"info",message:$t("e68dg3","已取消","lang")})})},append(t,e=0){const a={category_name:"",sort:0,level:e,children:[],created:0,image_url:"",category_type:"bring"};t.push(a)},catNameCheck(t){let e=0;if(t){for(var a=0;a<t.length;a++)t.charCodeAt(a)>255?e+=2:e++;return!(e>12)||(this.$message({type:"error",message:$t("832f5li","栏目名称长度最多6个汉字或12个字符","lang")}),!1)}return this.$message({type:"error",message:$t("ikol736","栏目不能为空","lang")}),!1},handleImgChange(t){this.imgDialog=!0,this.isGetImage=!0,this.current=t},pickImg(t){if(this.current.parent_id&&0!=this.current.parent_id){const e=this.categoryList.findIndex(t=>t.id===this.current.parent_id),a=this.categoryList[e].children.findIndex(t=>t.id===this.current.id);this.categoryList[e].children[a].image_url=t.url}else{const e=this.categoryList.findIndex(t=>t.id===this.current.id);this.categoryList[e].image_url=t.url}this.imgDialog=!1},closeImgDialog(){this.imgDialog=!1}}},r=(0,a(81656).A)(s,function(){var t=this,e=t._self._c;return e("SpPage",[e("div",{staticClass:"custom-tree-container"},[e("div",{staticClass:"action-container"},[e("el-button",{attrs:{type:"primary",icon:"plus"},on:{click:t.updateCategory}},[t._v($t("fs2j8a6"," 保存栏目 ","lang"))])],1),e("div",{staticClass:"block"},[e("ul",{staticClass:"custom-tree-node-title"},[e("li",[t._v($t("dmbqf64","栏目名称","lang"))]),e("li",[t._v($t("dme81o4","栏目排序","lang"))]),e("li",[t._v($t("bl3tv44","复制链接","lang"))]),e("li",[t._v($t("ar84e54","创建时间","lang"))]),e("li",[t._v($t("hkxb2","操作","lang"))])])]),e("div",{staticClass:"tree-background block"},[e("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.categoryList,"default-expand-all":"","expand-on-click-node":!1},scopedSlots:t._u([{key:"default",fn:function({node:a,data:i}){return e("ul",{staticClass:"custom-tree-node"},[e("li",[0==i.level?e("i"):e("i",[t._v("　├─")]),e("input",{directives:[{name:"model",rawName:"v-model",value:i.category_name,expression:"data.category_name"}],attrs:{placeholder:$t("dmbqf64","栏目名称","lang")},domProps:{value:i.category_name},on:{input:function(e){e.target.composing||t.$set(i,"category_name",e.target.value)}}})]),e("li",[e("input",{directives:[{name:"model",rawName:"v-model",value:i.sort,expression:"data.sort"}],attrs:{placeholder:$t("dme81o4","栏目排序","lang")},domProps:{value:i.sort},on:{input:function(e){e.target.composing||t.$set(i,"sort",e.target.value)}}})]),e("li",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:i.link,expression:"data.link",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:t.onCopy,expression:"onCopy",arg:"success"}]},[e("input",{directives:[{name:"model",rawName:"v-model",value:i.link,expression:"data.link"}],staticClass:"copy-link",attrs:{type:"text"},domProps:{value:i.link},on:{input:function(e){e.target.composing||t.$set(i,"link",e.target.value)}}}),e("i",{staticClass:"iconfont icon-copy"}),t._v($t("3pfzrj8"," 复制栏目链接 ","lang"))]),i.created?e("li",[t._v(" "+t._s(t._f("datetime")(i.created))+" ")]):e("li"),e("li",[e("span",{staticClass:"remove-category",on:{click:function(e){return t.deleteCategory(a,i)}}},[e("i",{staticClass:"iconfont icon-trash-alt"})])])])}}])}),e("div",{staticClass:"add-category"},[e("span",{on:{click:function(e){return t.append(t.categoryList)}}},[e("i",{staticClass:"el-icon-plus"}),t._v($t("bizlkx4","增加栏目","lang"))])])],1),e("imgPicker",{attrs:{"dialog-visible":t.imgDialog,"sc-status":t.isGetImage},on:{chooseImg:t.pickImg,closeImgDialog:t.closeImgDialog}})],1)])},[],!1,null,"0ce0d2db",null).exports}}]);