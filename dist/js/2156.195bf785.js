"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[2156],{12156:function(t,s,e){e.r(s),e.d(s,{default:function(){return p}});e(18111),e(7588),e(61701);var a=[function(){var t=this,s=t._self._c;return s("div",{staticClass:"ml-4"},[s("div",[t._v($t("nrbtvd7","LBS就近进店","lang"))]),s("div",{staticClass:"text-sm text-[#999] mt-2"},[s("p",[t._v($t("c8q1uig","根据用户LBS定位，进入附近店铺","lang"))])])])}],l=e(432),i={components:{draggable:e.n(l)()},props:{value:{type:Object,default:()=>({})}},data(){return{list:this.value.list,shop_lbs:this.value.shop_lbs}},watch:{list:{handler(t){this.$emit("change",{list:t,shop_lbs:this.shop_lbs})},deep:!0},shop_lbs:{handler(t){this.$emit("change",{list:this.list,shop_lbs:t})}},value:{handler(t){this.list=t.list,this.shop_lbs=t.shop_lbs},deep:!0}}},n=e(81656),o=(0,n.A)(i,function(){var t=this,s=t._self._c;return s("div",[s("el-alert",{staticClass:"leading-normal !mb-[10px]",attrs:{title:$t("th98enl","从上到下权重由大到小，拖拽可进行优先级排序","lang"),type:"warning","show-icon":"",closable:!1}}),s("draggable",{staticClass:"rules-list",attrs:{list:t.list,group:"easyview"}},t._l(t.list,function(e,a){return s("div",{key:`wgt-render-item__${a}`,staticClass:"rule-item"},[s("div",{staticClass:"h-full bg-primary-foreground flex items-center justify-center w-[24px]"},[s("SpIcon",{staticClass:"cursor-pointer",attrs:{name:"align-text-both",size:14}})],1),"distributor_code"===e.key?[s("div",{staticClass:"flex leading-normal p-3"},[s("el-switch",{model:{value:e.status,callback:function(s){t.$set(e,"status",s)},expression:"item.status"}}),s("div",{staticClass:"ml-4"},[s("div",[t._v($t("xzjjqy5","店铺码进店","lang"))]),s("div",{staticClass:"text-sm text-[#999] mt-2"},[s("p",[t._v($t("myo0g6i","通过带门店参小程序码扫码进入对应店铺","lang"))]),s("p",[t._v($t("81c7ldf","通过分享小程序卡片进入对应店铺","lang"))])])])],1)]:t._e(),"shop_assistant"===e.key?[s("div",{staticClass:"flex leading-normal p-3"},[s("el-switch",{attrs:{disabled:""},model:{value:e.status,callback:function(s){t.$set(e,"status",s)},expression:"item.status"}}),s("div",{staticClass:"ml-4"},[s("div",[t._v($t("qso623f","导购物料进店（需开通导购应用）","lang"))]),s("div",{staticClass:"text-sm text-[#999] mt-2"},[s("p",[t._v($t("h45zw7r","通过扫企微码添加导购加好友的欢迎语推送的小程序卡片进店","lang"))]),s("p",[t._v($t("5csio4m","通过导购商城分享的小程序海报、小程序卡片进店","lang"))])]),s("div",{staticClass:"flex items-center text-md flex-nowrap mt-2.5"},[t._v($t("x1pwp0a"," 导购参数保留时长 ","lang")),s("el-input-number",{staticStyle:{width:"100px",margin:"0 8px"},attrs:{size:"small","controls-position":"right",min:0},model:{value:e.express_time,callback:function(s){t.$set(e,"express_time",s)},expression:"item.express_time"}}),t._v($t("4ev2ow7"," ×24小时 ","lang"))],1)])],1)]:t._e(),"shop_white"===e.key?[s("div",{staticClass:"flex leading-normal p-3"},[s("el-switch",{model:{value:e.status,callback:function(s){t.$set(e,"status",s)},expression:"item.status"}}),s("div",{staticClass:"ml-4"},[s("div",[t._v($t("b2qlnwh","进入白名单店铺（需开启店铺白名单）","lang"))]),s("div",{staticClass:"text-sm text-[#999] mt-2"},[s("p",[t._v($t("1lm9r0c","进入用户绑定白名单的店铺","lang"))])])])],1)]:t._e(),"shop_assistant_pro"===e.key?[s("div",{staticClass:"flex leading-normal p-3"},[s("el-switch",{attrs:{disabled:""},model:{value:e.status,callback:function(s){t.$set(e,"status",s)},expression:"item.status"}}),s("div",{staticClass:"ml-4"},[s("div",[t._v($t("ph8ugxi","进入专属导购所属店（需开通导购应用）","lang"))]),s("div",{staticClass:"text-sm text-[#999] mt-2"},[s("p",[t._v($t("l2ymjid","进入用户专属导购的归属店铺","lang"))])])])],1)]:t._e()],2)}),0),s("div",{staticClass:"rule-item"},[s("div",{staticClass:"holder"}),s("div",{staticClass:"flex leading-normal p-3"},[s("el-switch",{model:{value:t.shop_lbs,callback:function(s){t.shop_lbs=s},expression:"shop_lbs"}}),t._m(0)],1)])],1)},a,!1,null,"5cc6dfeb",null).exports,r={data(){this.$createElement;return{formData:{ruleList:{list:[{key:"distributor_code",status:!1},{key:"shop_assistant",status:!1,express_time:0},{key:"shop_white",status:!1},{key:"shop_assistant_pro",status:!1}],shop_lbs:!1},safetyStrategy:{type:"1",template_id:"",template_name:""}},formItems:[{label:$t("hq9snq4","规则配置","lang"),component:"group"},{component:({h:t,value:s,onInput:e})=>t(o,{attrs:{value:s},on:{change:e}}),fieldName:"ruleList"},{label:$t("q9dc9iq","兜底策略（店铺失效、导购离职、关闭LBS时落地场景）","lang"),component:"group"},{fieldName:"safetyStrategy",label:"",component:({h:t,value:s,onInput:e,formData:a})=>t("div",[t("el-radio-group",{on:{input:t=>{e({...s,type:t})}},model:{value:s.type,callback:t=>{this.$set(s,"type",t)}}},[t("el-radio-button",{attrs:{label:"1"}},[$t("k5roy3","虚拟店","lang")]),t("el-radio-button",{attrs:{label:"2"}},[$t("c5vmb3","介绍页","lang")])]),2==s.type&&t("div",{class:"mt-2 flex items-center"},[t("el-button",{on:{click:()=>this.onSelectPage(a)}},[s.template_id?`${$t("t4d0nr6","引导页名称：","lang")}${s.template_name}`:$t("il8mml4","选择页面","lang")]),t("el-button",{attrs:{type:"text"},on:{click:()=>{e({...s,template_id:"",template_name:""})}}},[$t("eslg2","删除","lang")])])]),rules:[{validator:(t,s,e)=>{2!=s.type||s.template_id?e():e(new Error($t("3jlpl56","请选择引导页","lang")))}}]}]}},async mounted(){const t=await this.$api.store.fetchEntryStoreRules();if(0==t?.length)return;const{distributor_code:s,shop_assistant:e,shop_white:a,shop_assistant_pro:l}=t;if(this.formData.ruleList={list:Object.entries({distributor_code:s,shop_assistant:e,shop_white:a,shop_assistant_pro:l}).map(([t,s])=>({key:t,...s})).sort((t,s)=>t.sort-s.sort),shop_lbs:t.shop_lbs},this.formData.safetyStrategy={type:t.radio_type,template_id:t.intro_page,template_name:""},t.intro_page){const{page_name:s}=await this.$api.decortaion.fetchCustomPageInfo(t.intro_page);this.formData.safetyStrategy.template_name=s}},methods:{async onSelectPage(t){const{data:[s]}=await this.$picker.pages({multiple:!1,data:[t.safetyStrategy.template_id]});t.safetyStrategy.template_id=s.id,t.safetyStrategy.template_name=s.page_name},async handleSubmit(t){const s={distributor_code:{status:!1,sort:0},shop_assistant:{status:!1,sort:0,express_time:0},shop_white:{status:!1,sort:0},shop_assistant_pro:{status:!1,sort:0}};t.ruleList.list.forEach((t,e)=>{s[t.key].status=t.status,s[t.key].sort=e+1,"shop_assistant"===t.key&&(s[t.key].express_time=t.express_time)}),s.shop_lbs=t.ruleList.shop_lbs,s.radio_type=t.safetyStrategy.type,s.intro_page=t.safetyStrategy.template_id;try{await this.$api.store.saveEntryStoreRules(s),this.$message.success($t("aghf564","保存成功","lang"))}catch(t){this.$message.error($t("agg8dr4","保存失败","lang"))}}}},p=(0,n.A)(r,function(){var t=this,s=t._self._c;return s("SpPage",{attrs:{title:$t("ijplgx4","进店规则","lang")}},[s("SpFormPlus",{ref:"storeRulesForm",attrs:{"form-type":"normalForm","form-items":t.formItems,"label-width":"60px"},on:{submit:t.handleSubmit},model:{value:t.formData,callback:function(s){t.formData=s},expression:"formData"}})],1)},[],!1,null,"4390555e",null).exports}}]);