"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[7823],{7823:function(t,e,i){i.r(e),i.d(e,{default:function(){return r}});i(18111),i(22489);var a=i(95353),s=(i(57270),i(91142)),l=i(81193),n={props:{status:{type:Boolean,default:!1}},data(){return{isValid:!0,isEdit:!1,editVisible:!1,editTitle:"",editTipsVisible:!1,form:{mobile:"",name:"",tips:"",enterprise_sn:"",account:"",password:""},mobile:"",account:"",editMobile:"",editName:"",whitelistList:[],detailData:{},loading:!1,total_count:0,params:{page:1,pageSize:20},whitelist_id:"",datapass_block:1,enterpriseList:[],login_type:"",enterprise_sn_data:"",formData:{mobile:"",account:""}}},computed:{...(0,a.L8)(["wheight"])},watch:{status(t){t&&this.getListData()}},mounted(){this.getListData(),this.fetchList()},methods:{selectChange(t){const[e,i]=t.split("-");this.login_type=i,this.form.enterprise_sn=e},handleClose(t){this.relDistributors.splice(t,1),this.form.distributor_ids.splice(t,1)},handleCancel(){this.editVisible=!1,this.whitelist_id="",this.editMobile="",this.form.mobile="",this.form.name="",this.form.account="",this.form.password="",this.form.enterprise_sn="",this.enterprise_sn_data="",this.login_type=""},handleCurrentChange(t){this.params.page=t,this.getListData()},addData(){this.handleCancel(),this.editTitle=$t("er0oao5","添加白名单","lang"),this.editVisible=!0,this.isEdit=!1},fetchList(){(0,s.getEnterpriseList)({page:1,pageSize:200}).then(t=>{this.enterpriseList=t.data.data.list})},editAction(t,e){this.handleCancel();const i=this.enterpriseList.filter(t=>t.enterprise_sn==e.enterprise_sn),a=i.length>0?i[0].login_type:this.enterpriseList[0].login_type,s=e.enterprise_sn||i.length>0?i[0].enterprise_sn:this.enterpriseList[0].enterprise_sn;this.editTitle=$t("u6rqk87","编辑白名单信息","lang"),this.editVisible=!0,this.isEdit=!0,this.editMobile=e.mobile,this.form.mobile=e.mobile,this.form.name=e.name,this.whitelist_id=e.whitelist_id,this.form.enterprise_sn=e.enterprise_sn,this.form.password=e.password,this.form.account=e.account,this.enterprise_sn_data=s+"-"+a,this.login_type=a},submitAction(){let t=this.form;"account"==this.login_type?delete t.mobile:"mobile"==this.login_type&&(delete t.password,delete t.account),this.whitelist_id?(0,s.updateMembersWhitelist)(this.whitelist_id,t).then(t=>{this.detailData=t.data.data,this.editVisible=!1,this.getListData()}):(0,s.createMembersWhitelist)(t).then(t=>{this.detailData=t.data.data,this.editVisible=!1,this.getListData(),this.handleCancel()})},dataSearch(){this.params.account=this.formData.account,this.params.mobile=this.formData.mobile,this.params.page=1,this.getListData()},getListData(){this.loading=!0,(0,s.getMembersWhitelistList)(this.params).then(t=>{this.whitelistList=t.data.data.list,this.total_count=t.data.data.total_count,this.datapass_block=t.data.data.datapass_block,this.loading=!1})},deleteAction(t,e){this.$confirm($t("4o0g7rh","此操作将删除该白名单, 是否继续?","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(()=>{(0,s.deleteMembersWhitelist)(e.whitelist_id).then(e=>{this.whitelistList.splice(t,1),this.$message({message:$t("azeh8z4","删除成功","lang"),type:"success",duration:5e3})}).catch(()=>{this.$message({type:"error",message:$t("azdahk4","删除失败","lang")})})}).catch(()=>{this.$message({type:"info",message:$t("e68dg3","已取消","lang")})})},setTips(t){this.handleCancel(),this.handleCancelTips(),this.editTitle=$t("mz4wq95","白名单提示","lang"),this.editTipsVisible=!0,(0,l.getWhitelistSetting)().then(t=>{this.form.tips=t.data.data.whitelist_tips})},handleCancelTips(){this.editTipsVisible=!1,this.form.tips=""},submitTipsAction(){const t={whitelist_tips:this.form.tips};(0,l.setWhitelistSetting)(t).then(t=>{this.editTipsVisible=!1,this.handleTipsCancel()})}}},o=(0,i(81656).A)(n,function(){var t=this,e=t._self._c;return e("SpPage",[e("SpFilterForm",{attrs:{model:t.formData},on:{onSearch:t.dataSearch,onReset:t.dataSearch}},[e("SpFilterFormItem",{attrs:{prop:"mobile",label:$t("cttsc24","手机号:","lang")}},[e("el-input",{attrs:{placeholder:$t("7ji3y96","请输入手机号","lang")},model:{value:t.formData.mobile,callback:function(e){t.$set(t.formData,"mobile",e)},expression:"formData.mobile"}})],1),e("SpFilterFormItem",{attrs:{prop:"account",label:$t("l2k093","账号:","lang")}},[e("el-input",{attrs:{placeholder:$t("2j1oau5","请输入账号","lang")},model:{value:t.formData.account,callback:function(e){t.$set(t.formData,"account",e)},expression:"formData.account"}})],1)],1),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-button",{attrs:{type:"primary",icon:"plus"},on:{click:t.addData}},[t._v($t("3jtao07"," 添加白名单 ","lang"))]),t.VERSION_IN_PURCHASE()?t._e():e("el-button",{attrs:{type:"primary",icon:"plus"},on:{click:t.setTips}},[t._v($t("th6xin7"," 白名单提示 ","lang"))])],1)],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.whitelistList,height:t.wheight-160}},[e("el-table-column",{attrs:{prop:"mobile",label:$t("ewbd43","手机号","lang")}}),e("el-table-column",{attrs:{prop:"name",label:$t("fqmy2","姓名","lang")}}),e("el-table-column",{attrs:{prop:"account",label:$t("ogwh2","账号","lang")}}),e("el-table-column",{attrs:{prop:"password",label:$t("dappmc4","明文密码","lang")}}),e("el-table-column",{attrs:{prop:"enterprise_sn",label:$t("aas9es4","企业编码","lang")}}),e("el-table-column",{attrs:{label:$t("hkxb2","操作","lang")},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.editAction(i.$index,i.row)}}},[t._v($t("juz394"," 编辑 ","lang"))]),e("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.deleteAction(i.$index,i.row)}}},[t._v($t("db22k4"," 删除 ","lang"))])]}}])})],1),t.total_count>t.params.pageSize?e("div",{staticClass:"content-center content-top-padded"},[e("el-pagination",{attrs:{layout:"prev, pager, next","current-page":t.params.page,total:t.total_count,"page-size":t.params.pageSize},on:{"update:currentPage":function(e){return t.$set(t.params,"page",e)},"update:current-page":function(e){return t.$set(t.params,"page",e)},"current-change":t.handleCurrentChange}})],1):t._e(),e("el-dialog",{attrs:{title:t.editTitle,visible:t.editVisible,"before-close":t.handleCancel},on:{"update:visible":function(e){t.editVisible=e}}},[[e("el-form",{ref:"form",staticClass:"demo-ruleForm",attrs:{model:t.form,"label-width":"120px"}},[e("el-form-item",{attrs:{"el-form-item":"",label:$t("ikvqd54","选择企业","lang")}},[e("el-col",{attrs:{span:10}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:$t("wnmj9s7","请选择选择企业","lang"),disabled:!!t.whitelist_id},on:{change:t.selectChange},model:{value:t.enterprise_sn_data,callback:function(e){t.enterprise_sn_data=e},expression:"enterprise_sn_data"}},t._l(t.enterpriseList,function(t,i){return e("el-option",{key:`${t.enterprise_id}${i}`,attrs:{label:t.enterprise_name,value:`${t.enterprise_sn}-${t.login_type}`}})}),1)],1)],1),t.login_type?e("el-form-item",{attrs:{label:$t("fqmy2","姓名","lang")}},[e("el-col",{attrs:{span:10}},[e("el-input",{attrs:{required:"",placeholder:$t("9hq2ns5","请填写名称","lang"),disabled:1==t.datapass_block&&t.isEdit},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1):t._e(),"mobile"==t.login_type?e("el-form-item",{attrs:{label:$t("ewbd43","手机号","lang")}},[e("el-col",{attrs:{span:10}},[t.isEdit?e("el-input",{attrs:{disabled:!0},model:{value:t.editMobile,callback:function(e){t.editMobile=e},expression:"editMobile"}}):e("el-input",{attrs:{maxlength:11,placeholder:$t("b2kmjg9","请输入11位手机号","lang")},model:{value:t.form.mobile,callback:function(e){t.$set(t.form,"mobile",e)},expression:"form.mobile"}})],1)],1):t._e(),"account"==t.login_type?e("el-form-item",{attrs:{label:$t("ogwh2","账号","lang"),prop:"account"}},[e("el-col",{attrs:{span:10}},[e("el-input",{attrs:{disabled:t.isEdit,placeholder:$t("2j9omo5","请输入帐号","lang")},model:{value:t.form.account,callback:function(e){t.$set(t.form,"account",e)},expression:"form.account"}})],1)],1):t._e(),"account"==t.login_type?e("el-form-item",{attrs:{label:$t("g9ob2","密码","lang"),prop:"password"}},[e("el-col",{attrs:{span:10}},[e("el-input",{attrs:{type:"password","show-password":"",placeholder:$t("2j9vj05","请输入密码","lang")},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1)],1):t._e()],1)],e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{nativeOn:{click:function(e){return t.handleCancel.apply(null,arguments)}}},[t._v($t("dd4ni4"," 取消 ","lang"))]),e("el-button",{attrs:{type:"primary"},on:{click:t.submitAction}},[t._v($t("cp35x4"," 保存 ","lang"))])],1)],2),e("el-dialog",{attrs:{title:t.editTitle,visible:t.editTipsVisible,"before-close":t.handleCancelTips},on:{"update:visible":function(e){t.editTipsVisible=e}}},[[e("el-form",{ref:"form",staticClass:"demo-ruleForm",attrs:{model:t.form,"label-width":"120px"}},[e("el-form-item",{attrs:{label:$t("hn562","提示","lang")}},[e("el-col",{attrs:{span:20}},[e("el-input",{attrs:{required:"",placeholder:$t("9hnea95","请填写提示","lang")},model:{value:t.form.tips,callback:function(e){t.$set(t.form,"tips",e)},expression:"form.tips"}})],1)],1)],1)],e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{nativeOn:{click:function(e){return t.handleCancelTips.apply(null,arguments)}}},[t._v($t("dd4ni4"," 取消 ","lang"))]),e("el-button",{attrs:{type:"primary"},on:{click:t.submitTipsAction}},[t._v($t("cp35x4"," 保存 ","lang"))])],1)],2)],1)},[],!1,null,"7b904a8d",null),r=o.exports}}]);