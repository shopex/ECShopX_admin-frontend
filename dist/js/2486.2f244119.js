"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[2486],{2486:function(t,e,a){a.r(e),a.d(e,{default:function(){return o}});a(44114),a(18111),a(7588),a(61701);var i=a(95564),r=a(26456),s={name:"",components:{DistributorSelect:i.A},mixins:[],props:{},data(){const t=this.$createElement;return{deliveryman:!1,DistributorVisible:!1,DistributorStatus:!1,distributionType:"0",isSingle:!1,isValid:!0,oldData:[],relDistributors:[],operator_id:"",editTitle:$t("ev89cv5","添加配送员","lang"),params:{operator_type:"self_delivery_staff",username:"",mobile:"",payment_method:""},options:[{value:"order",label:$t("rxhm1x5","按单笔订单","lang")},{value:"amount",label:$t("1ncyxr7","按订单金额比例","lang")}],setting:{columns:[{name:$t("w11eq35","业务员姓名","lang"),key:"username",width:110},{name:$t("iecoit5","配送员编号","lang"),key:"staff_no",width:110},{name:$t("1zwl8k6","配送员手机号","lang"),key:"mobile",width:150},{name:$t("ie6ubx5","配送员属性","lang"),width:110,key:"staff_attribute",render:(t,{row:e})=>t("span",["full_time"===e.staff_attribute?$t("ejtw2","全职","lang"):$t("ekb42","兼职","lang")])},{name:$t("7ghqlq6","配送结算方式","lang"),width:150,key:"payment_method",render:(t,{row:e})=>t("span",["order"===e.payment_method?$t("rxhm1x5","按单笔订单","lang"):$t("1ncyxr7","按订单金额比例","lang")])},{name:$t("ginbqr4","结算费用","lang"),key:"payment_fee",width:150,render:(t,{row:e})=>t("span",[" ",e.payment_fee/100," （","order"==e.payment_method?$t("g1v1","元","lang"):"%",$t("gjib3","/单）","lang")," "])},{name:$t("cs44ip4","所属店铺","lang"),key:"distributor_ids",width:300,render:(t,{row:e})=>t("div",[e?.distributor_ids?.map(e=>t("el-tag",{key:e.distributor_ids,attrs:{size:"mini"}},[e.name]))])},{name:$t("lb5z2","禁用","lang"),key:"is_disable",render:(t,{row:e})=>t("el-switch",{on:{change:this.acitonDisabled.bind(this,e)},attrs:{"active-color":"#ff4949","inactive-color":"#ccc"},model:{value:e.is_disable,callback:t=>{this.$set(e,"is_disable",t)}}})}],actions:[{name:$t("mekb2","编辑","lang"),key:"detail",type:"button",buttonType:"text",action:{handler:([t])=>{this.operator_id=t.operator_id,this.relDistributors=[],this.editTitle=$t("iekw2x5","编辑配送员","lang"),this.deliveryman=!0,this.addForm={username:t.username,operator_type:t.operator_type,distributor_name:t.distributor_name,staff_type:t.staff_type,staff_no:t.staff_no,staff_attribute:t.staff_attribute,payment_method:t.payment_method,payment_fee:"order"==t.payment_method?Number(t.payment_fee)/100:.01,payment_fee1:"order"==t.payment_method?1:Number(t.payment_fee)/100,mobile:t.mobile,distributor_ids:[],password:""},this.relDistributors="distributor"==t.staff_type?t.distributor_ids:[]}}}]},addForm:{operator_type:"self_delivery_staff",distributor_name:"",staff_type:"platform",staff_no:"",staff_attribute:"part_time",payment_method:"order",payment_fee:.01,payment_fee1:1,mobile:"",password:"",distributor_ids:[]},addFormList:[{label:$t("iec99w5","配送员类型","lang"),key:"staff_type",type:"radio",options:[{label:"platform",name:$t("pc4vpj5","平台配送员","lang")},{label:"distributor",name:$t("y38wo15","店铺配送员","lang")}]},{label:$t("iecvn35","配送员编码","lang"),key:"staff_no",placeholder:$t("qlo3a28","请输入配送员编码","lang"),type:"input"},{label:$t("ie6ubx5","配送员属性","lang"),key:"staff_attribute",type:"radio",options:[{label:"part_time",name:$t("ekb42","兼职","lang")},{label:"full_time",name:$t("ejtw2","全职","lang")}]},{label:$t("7ghqlq6","配送结算方式","lang"),key:"payment_method",type:"radio",options:[{label:"order",name:$t("rxhm1x5","按单笔订单","lang")},{label:"amount",name:$t("1ncyxr7","按订单金额比例","lang")}]},{label:$t("ginbqr4","结算费用","lang"),key:"payment_fee",isShow:()=>"order"==this.addForm.payment_method,component:({key:e},a)=>t("div",{class:"flex-box"},[t("el-input-number",{attrs:{"controls-position":"right",precision:"3",step:"0.001"},model:{value:a[e],callback:t=>{this.$set(a,e,t)}}})," ",t("span",[$t("u0r6j6c","元，每单（费用包含运费）","lang")])]),validator:(t,e,a)=>{const{payment_fee:i}=this.addForm;if(i){/^(0|[1-9]\d*)(.\d{1,3})?$/.test(i)?a():a(new Error($t("7eibic8","结算费用格式错误","lang")))}else a(new Error($t("adohlc4","不能为空","lang")))}},{label:$t("ginbqr4","结算费用","lang"),key:"payment_fee1",isShow:()=>"amount"==this.addForm.payment_method,component:({key:e},a)=>t("div",{class:"flex-box"},[t("el-input-number",{attrs:{"controls-position":"right",precision:"3",step:"0.001"},model:{value:a[e],callback:t=>{this.$set(a,e,t)}}})," ",t("span",[$t("m7nd80c","%，每单（费用包含运费）","lang")])]),validator:(t,e,a)=>{const{payment_fee1:i}=this.addForm;if(i){/^(0|[1-9]\d*)(.\d{1,3})?$/.test(i)?a():a(new Error($t("7eibic8","结算费用格式错误","lang")))}else a(new Error($t("adohlc4","不能为空","lang")))}},{label:$t("1zwl8k6","配送员手机号","lang"),key:"mobile",type:"input",placeholder:$t("rlbm7h9","请输入配送员手机号","lang"),validator:(t,e,a)=>{const{mobile:i}=this.addForm;if(i){/^1[3-9]\d{9}$/.test(i)?a():a(new Error($t("srjmr37","手机号格式错误","lang")))}else a(new Error($t("adohlc4","不能为空","lang")))}},{label:$t("ie6cda5","配送员姓名","lang"),key:"username",placeholder:$t("qlumjv8","请输入配送员姓名","lang"),type:"input",required:!0,message:$t("ej2e5q9","配送员姓名不能为空","lang")},{label:$t("fce1f94","登录密码","lang"),key:"password",type:"input"},{label:$t("cs44ip4","所属店铺","lang"),key:"distributor_name",isShow:()=>"distributor"==this.addForm.staff_type,component:({key:e},a)=>t("div",[this.relDistributors.map((e,a)=>t("el-tag",{key:e.distributor_id,class:"new-tag",attrs:{closable:!0,"disable-transitions":!1},on:{close:this.DistributoreHandleClose.bind(this,a)}},[e.name])),t("el-button",{attrs:{size:"medium"},class:"button-new-tag",on:{click:this.addDistributoreAction.bind(this)}},[$t("7yq79c8","+ 点击搜索店铺","lang")])])}]}},computed:{},watch:{},mounted(){((0,r.JR)()||(0,r.Ys)())&&(this.addForm.staff_type="distributor",this.addFormList[0].options=[{label:"distributor",name:$t("y38wo15","店铺配送员","lang")}])},methods:{onSearch(){this.$refs.finder.refresh()},beforeSearch(t){return{...t,...this.params}},addDeliveryman(){this.deliveryman=!0,this.editTitle=$t("ev89cv5","添加配送员","lang"),this.addForm={operator_type:"self_delivery_staff",distributor_name:"",staff_type:(0,r.JR)()||(0,r.Ys)()?"distributor":"platform",staff_no:"",staff_attribute:"part_time",payment_method:"order",payment_fee:.001,payment_fee1:.001,mobile:"",password:"",distributor_ids:[]},this.operator_id="",this.relDistributors=[]},onAddCancel(){this.deliveryman=!1},async onAddSubmit(){let t=/^(?=.*[a-zA-Z0-9!@#$%^&*()-_+=])[a-zA-Z0-9!@#$%^&*()-_+=]{6,20}$/.test(this.addForm.password);if(this.operator_id){if(this.addForm.password&&!t)return void this.$message({type:"error",message:$t("rj0fjbd","密码不能是文字并且至少6位","lang")})}else{if(!this.addForm.password)return void this.$message({type:"error",message:$t("2j9vj05","请输入密码","lang")});if(!t)return void this.$message({type:"error",message:$t("rj0fjbd","密码不能是文字并且至少6位","lang")})}if("distributor"==this.addForm.staff_type&&0==this.relDistributors.length)return this.$message({type:"error",message:$t("45djnpb","店铺配送员必须关联店铺","lang")}),!1;this.relDistributors.length>0&&(this.addForm.distributor_ids=[],this.relDistributors.forEach(t=>{this.addForm.distributor_ids.push({name:t.name,distributor_id:t.distributor_id})})),"platform"==this.addForm.staff_type&&(this.addForm.distributor_ids=[]);let e={...this.addForm,payment_fee:"order"==this.addForm.payment_method?this.addForm.payment_fee:this.addForm.payment_fee1};this.operator_id?(await this.$api.company.updateAccountInfo(this.operator_id,e),this.$message.success($t("gmjwui4","编辑成功","lang")),this.deliveryman=!1,this.onSearch()):(await this.$api.company.createAccount(this.addForm),this.$message.success($t("aghf564","保存成功","lang")),this.deliveryman=!1,this.onSearch())},async addDistributoreAction(){const{data:t}=await this.$picker.shop();let e=[...this.relDistributors,...t];for(let t=0;t<e.length;t++)for(let a=t+1;a<e.length;a++)e[t].distributor_id==e[a].distributor_id&&(e.splice(a,1),a--);this.relDistributors=e,this.DistributorStatus=!0,this.DistributorVisible=!0},DistributoreHandleClose(t){this.DistributorVisible=!1,this.relDistributors.splice(t,1)},async acitonDisabled(t){if(t.is_disable)await this.$confirm($t("t4bum3f","此操作将开启禁用, 是否继续?","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(async()=>{let e={operator_id:t.operator_id,is_disable:t.is_disable?1:0};await this.$api.login.changeOperatorStatus(e),this.onSearch(),this.$message({type:"success",message:$t("rbk3xf5","开启成功!","lang")})}).catch(()=>{t.is_disable=!t.is_disable});else{let e={operator_id:t.operator_id,is_disable:t.is_disable?1:0};await this.$api.login.changeOperatorStatus(e),this.onSearch(),this.$message({type:"success",message:$t("hdbt7s5","关闭成功!","lang")})}}}},o=(0,a(81656).A)(s,function(){var t=this,e=t._self._c;return e("SpPage",[e("SpFilterForm",{attrs:{model:t.params,size:"small"},on:{onSearch:t.onSearch,onReset:t.onSearch}},[e("SpFilterFormItem",{attrs:{prop:"username",label:$t("1yk7oc6","配送员姓名:","lang")}},[e("el-input",{attrs:{placeholder:$t("qlumjv8","请输入配送员姓名","lang")},model:{value:t.params.username,callback:function(e){t.$set(t.params,"username",e)},expression:"params.username"}})],1),e("SpFilterFormItem",{attrs:{prop:"mobile",label:$t("941rka7","配送员手机号:","lang")}},[e("el-input",{attrs:{placeholder:$t("rlbm7h9","请输入配送员手机号","lang")},model:{value:t.params.mobile,callback:function(e){t.$set(t.params,"mobile",e)},expression:"params.mobile"}})],1),e("SpFilterFormItem",{attrs:{prop:"payment_method",label:$t("i3xqto7","配送结算方式:","lang")}},[e("el-select",{attrs:{placeholder:$t("l72nr3","请选择","lang")},model:{value:t.params.payment_method,callback:function(e){t.$set(t.params,"payment_method",e)},expression:"params.payment_method"}},t._l(t.options,function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1)],1),e("div",{staticClass:"action-container"},[e("el-button",{attrs:{type:"primary"},on:{click:t.addDeliveryman}},[t._v($t("ev89cv5","添加配送员","lang"))])],1),e("SpFinder",{ref:"finder",attrs:{url:"/account/management","no-selection":"",setting:t.setting,hooks:{beforeSearch:t.beforeSearch}}}),e("SpDialog",{ref:"addDialogRef",attrs:{title:t.editTitle,form:t.addForm,"form-list":t.addFormList},on:{onSubmit:t.onAddSubmit},model:{value:t.deliveryman,callback:function(e){t.deliveryman=e},expression:"deliveryman"}})],1)},[],!1,null,"32c35a0e",null).exports}}]);