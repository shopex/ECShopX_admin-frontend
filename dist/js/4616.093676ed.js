"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[4616],{64616:function(t,e,a){a.r(e),a.d(e,{default:function(){return c}});a(50002);var s=a(5748),r=a(81193),o=a(5134),i=a(87378),l=a(43224),n={inject:["refresh"],components:{imgPicker:i.default,imgBox:l.A},data(){return{show:!0,itemsLoading:!1,groups_activity_id:"",form:{pics:"",goods_id:"",act_name:"",date:"",store:"",act_price:"",person_num:"",limit_time:"",limit_buy_num:"",robot:"1",rig_up:"1",free_post:"1",share_desc:""},goods:{},itemsList:[],itemsParams:{page:1,pageSize:20,item_type:"normal",nospec:!0,keywords:""},itemsTotalCount:0,logo_url:"",dialogVisible:!1,dialogImageUrl:"",goodsDialogVisible:!1,rules:{act_name:[{required:!0,message:$t("hvmdjz9","请输入拼团活动名称","lang")}],date:[{required:!0,message:$t("jehya47","请输入活动时间","lang")}],store:[{required:!0,message:$t("kog3d87","请输入拼团库存","lang")},{pattern:/^[1-9]\d{0,4}$/,message:$t("eokjswe","库存最少为1，最多99999","lang")}],act_price:[{required:!0,message:$t("koioek7","请输入拼团价格","lang")},{pattern:/^(?=.*[1-9])\d+(\.\d{1,2})?$/,message:"拼团价格最少0.01"}],person_num:[{required:!0,message:$t("kspfbj7","请输入成团人数","lang")},{pattern:/^([2-9]|[1-9]\d{1})$/,message:$t("o2g13le","最少2人成团,最多99人成团","lang")}],limit_time:[{required:!0,message:$t("kslh2r7","请输入成团时效","lang")},{pattern:/^[1-9]\d{0,1}$/,message:$t("q9rcfrg","成团时效至少1小时，最多99小时","lang")}],limit_buy_num:[{required:!0,message:$t("dze4nv7","请输入限购数量","lang")},{pattern:/^\d{0,2}$/,message:$t("dcqhfe4","最多99","lang")}],share_desc:[{required:!0,message:$t("mumpdd7","请输入分享描述","lang")}]},imgDialog:!1,isGetImage:!1,currency:{},cursymbol:"￥",goodsTypeTitle:$t("cbhw3i5","服务类商品","lang")}},mounted(){this.$route.query.show&&(this.show=!1),this.$route.params.groups_id&&(this.groups_activity_id=this.$route.params.groups_id,this.getGroupsInfo()),this.getCurrencyInfo()},methods:{submitItemsAction(t){const e=this;this.$refs[t].validate(t=>!!t&&(this.form.pics?this.form.goods_id?void(this.groups_activity_id?(0,o.updateGroupActivity)(this.groups_activity_id,this.form).then(t=>{t.data.data&&this.$message({message:$t("deua4r4","更新成功","lang"),type:"success",duration:2e3,onClose(){e.refresh(),e.$router.go(-1)}})}):(0,o.createGroupActivity)(this.form).then(t=>{t.data.data&&this.$message({message:$t("e7ygyc4","添加成功","lang"),type:"success",duration:2e3,onClose(){e.refresh(),e.$router.go(-1)}})})):(this.$message.error($t("2engwe5","请选择商品","lang")),!1):(this.$message.error($t("gabbhh7","请上传活动封面","lang")),!1)))},handleCancel(){this.$router.go(-1)},changeItem(){this.show&&(this.goodsDialogVisible=!0,this.getGoodsList())},chooseItem(t){this.goodsDialogVisible=!1,this.goods=t,this.goods.price=this.goods.price/100,this.form.goods_id=t.itemId},goodsHandleCurrentChange(t){this.itemsParams.page=t,this.getGoodsList()},goodsSearch(){this.getGoodsList()},getGoodsList(){this.itemsLoading=!0;let t=this.itemsParams;t.approve_status=["onsale","offline_sale"],t.is_gift=!1,(0,s.getItemsList)(t).then(t=>{this.itemsLoading=!1,this.itemsList=t.data.data.list,this.itemsTotalCount=t.data.data.total_count}).catch(t=>{this.itemsLoading=!1,this.$message({type:"error",message:$t("up12y1c","获取商品列表列表信息出错","lang")})})},getGroupsInfo(){(0,o.getGroupsInfo)(this.groups_activity_id).then(t=>{this.form=t.data.data,this.form.act_price=this.form.act_price/100,this.form.goods.price=this.form.goods.price/100,this.form.goods.market_price=this.form.goods.market_price/100,this.form.date=[new Date(1e3*t.data.data.begin_time),new Date(1e3*t.data.data.end_time)],this.form.robot=1==t.data.data.robot?"1":"0",this.form.rig_up=1==t.data.data.rig_up?"1":"0",this.form.free_post=1==t.data.data.free_post?"1":"0",this.logo_url=this.wximageurl+t.data.data.pics,this.goods=t.data.data.goods}).catch(t=>{this.$message({type:"error",message:$t("2l312da","获取拼团活动详情失败","lang")})})},priceformatter(t,e){return this.cursymbol+t.price/100},getCurrencyInfo(){(0,r.getDefaultCurrency)().then(t=>{this.currency=t.data.data,this.cursymbol=this.currency.symbol})},handleImgChange(){this.imgDialog=!0,this.isGetImage=!0},pickImg(t){this.form.pics=t.url,this.imgDialog=!1},closeImgDialog(){this.imgDialog=!1},changeGoods(t){switch(t){case"every":this.$set(this.itemsParams,"consume_type","every"),this.$delete(this.itemsParams,"item_type"),this.goodsTypeTitle=$t("cbhw3i5","服务类商品","lang");break;case"normal":this.$set(this.itemsParams,"item_type","normal"),this.$delete(this.itemsParams,"consume_type"),this.goodsTypeTitle=$t("dl86755","实体类商品","lang")}this.getGoodsList()}}},m=(0,a(81656).A)(n,function(){var t=this,e=t._self._c;return e("el-form",{ref:"form",staticClass:"box-set",attrs:{model:t.form,"label-width":"100px"}},[e("el-card",{attrs:{header:$t("751u9i6","活动商品信息","lang"),shadow:"never"}},[e("el-form-item",{attrs:{label:$t("e4jdvy4","活动封面","lang")}},[e("div",{staticClass:"frm-tips"},[t._v($t("8l4fa51j"," 文件格式为bmp、png、jpeg、jpg或gif，大小不超过2M（建议尺寸：500px * 500px） ","lang"))]),e("div",[e("imgBox",{attrs:{"img-url":t.wximageurl+t.form.pics},on:{click:t.handleImgChange}})],1),e("imgPicker",{attrs:{"dialog-visible":t.imgDialog,"sc-status":t.isGetImage},on:{chooseImg:t.pickImg,closeImgDialog:t.closeImgDialog}})],1),e("el-form-item",{attrs:{label:$t("culb8h4","拼团商品","lang")}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:20}},[e("p",{staticClass:"frm-tips"}),e("div",{staticClass:"logo-box",on:{click:t.changeItem}},[e("div",{staticClass:"bran-img"},[t.goods.pics?e("div",{staticClass:"groups-addgoods"},[e("img",{staticClass:"groups-goodspic",attrs:{src:t.wximageurl+t.goods.pics[0]}}),e("div",{staticClass:"gooups-goodsmsg"},[e("div",[t._v(t._s(t.goods.itemName))]),e("div",[t._v($t("cnrhe3","原价：","lang")+t._s(t.goods.price))]),"normal"==t.goods.item_type?e("div",[t._v($t("ebmhh3","库存：","lang")+t._s(t.goods.store))]):t._e()])]):e("div",{staticClass:"el-upload el-upload--picture-card",attrs:{tabindex:"0"}},[e("i",{staticClass:"el-icon-plus"})])])])])],1)],1),e("el-form-item",{attrs:{label:$t("e4hvdc4","活动名称","lang"),prop:"act_name",rules:t.rules.act_name}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-input",{attrs:{maxlength:30,placeholder:$t("7psney6","拼团活动名称","lang")},model:{value:t.form.act_name,callback:function(e){t.$set(t.form,"act_name",e)},expression:"form.act_name"}})],1)],1)],1),e("el-form-item",{attrs:{label:$t("e4l2kr4","活动时间","lang"),prop:"date",rules:t.rules.date}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-date-picker",{attrs:{type:"datetimerange","range-separator":$t("po31","至","lang"),"start-placeholder":$t("f753lz4","生效时间","lang"),"end-placeholder":$t("ikg3cm4","过期时间","lang"),"value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"]},model:{value:t.form.date,callback:function(e){t.$set(t.form,"date",e)},expression:"form.date"}})],1)],1)],1),e("el-form-item",{attrs:{label:$t("cumxhn4","拼团库存","lang"),prop:"store",rules:t.rules.store}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-input",{attrs:{placeholder:""},model:{value:t.form.store,callback:function(e){t.$set(t.form,"store",e)},expression:"form.store"}})],1),e("el-col",{attrs:{span:2}},[t._v($t("e39m3"," 件 ","lang"))])],1)],1),e("el-form-item",{attrs:{label:$t("cukcgb4","拼团价格","lang"),prop:"act_price",rules:t.rules.act_price}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-input",{attrs:{placeholder:""},model:{value:t.form.act_price,callback:function(e){t.$set(t.form,"act_price",e)},expression:"form.act_price"}},[t._v($t("ehct3"," 元 ","lang"))])],1),e("el-col",{attrs:{span:2}},[t._v($t("ehct3"," 元 ","lang"))])],1)],1),e("el-form-item",{attrs:{label:$t("cqdljc4","成团人数","lang"),prop:"person_num",rules:t.rules.person_num}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-input",{attrs:{placeholder:""},model:{value:t.form.person_num,callback:function(e){t.$set(t.form,"person_num",e)},expression:"form.person_num"}},[t._v($t("e1ty3"," 人 ","lang"))])],1)],1)],1),e("el-form-item",{attrs:{label:$t("cqhjs44","成团时效","lang"),prop:"limit_time",rules:t.rules.limit_time}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-input",{attrs:{placeholder:$t("g7uv2","小时","lang")},model:{value:t.form.limit_time,callback:function(e){t.$set(t.form,"limit_time",e)},expression:"form.limit_time"}})],1),e("el-col",{attrs:{span:2}},[t._v($t("ej76h4"," 小时 ","lang"))])],1)],1),e("el-form-item",{attrs:{label:$t("cuwczw4","拼团限制","lang"),prop:"limit_buy_num",rules:t.rules.limit_buy_num}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-input",{attrs:{placeholder:""},model:{value:t.form.limit_buy_num,callback:function(e){t.$set(t.form,"limit_buy_num",e)},expression:"form.limit_buy_num"}}),e("p",{staticClass:"frm-tips"},[t._v($t("9lxcy0m","(限制一人只能参加X次活动，为0表示无限制)","lang"))])],1)],1)],1),e("el-form-item",{attrs:{label:$t("vdfpxi5","成团机器人","lang")}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:t.form.robot,callback:function(e){t.$set(t.form,"robot",e)},expression:"form.robot"}}),e("p",{staticClass:"frm-tips"},[t._v($t("6o0jvp1p"," (开启成团机器人后，成团时效内人数未满的团，系统将会使用机器人凑满人数，使该团成团。商家只需对真实订单进行发货处理。) ","lang"))])],1)],1)],1),e("el-form-item",{attrs:{label:$t("ee5t2","凑团","lang")}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:t.form.rig_up,callback:function(e){t.$set(t.form,"rig_up",e)},expression:"form.rig_up"}}),e("p",{staticClass:"frm-tips"},[t._v($t("vuv2l1g"," (开启凑团后，消费者可以在拼团商品详情页看到未成团的团列表，可选择其中一个参团。有效提高成团成功率) ","lang"))])],1)],1)],1),"normal"==t.goods.item_type?e("el-form-item",{attrs:{label:$t("ewy12","包邮","lang")}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:t.form.free_post,callback:function(e){t.$set(t.form,"free_post",e)},expression:"form.free_post"}}),e("p",{staticClass:"frm-tips"},[t._v($t("i4v6uer","(如果不开启包邮，那么运费按照商品的运费模版计算运费)","lang"))])],1)],1)],1):t._e(),e("el-form-item",{attrs:{label:$t("aogbhi4","分享描述","lang"),prop:"share_desc",rules:t.rules.share_desc}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-input",{attrs:{maxlength:25,placeholder:$t("8rz827b","请输入拼团活动分享文字","lang")},model:{value:t.form.share_desc,callback:function(e){t.$set(t.form,"share_desc",e)},expression:"form.share_desc"}},[t._v($t("blyvdja"," （最多25个字） ","lang"))])],1)],1)],1)],1),e("div",{staticStyle:{"margin-top":"10px"}},[e("el-button",{nativeOn:{click:function(e){return t.handleCancel.apply(null,arguments)}}},[t._v($t("m1m0m4"," 返回 ","lang"))]),1==t.show?e("el-button",{attrs:{type:"primary"},on:{click:function(e){return e.preventDefault(),t.submitItemsAction("form")}}},[t._v($t("cp35x4"," 保存 ","lang"))]):t._e()],1),e("el-dialog",{attrs:{title:$t("ikwu2j4","选择商品","lang"),visible:t.goodsDialogVisible,center:""},on:{"update:visible":function(e){t.goodsDialogVisible=e}}},[e("el-row",{staticClass:"content-bottom-padded",attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-input",{attrs:{placeholder:$t("b40v0e4","商品名称","lang")},model:{value:t.itemsParams.keywords,callback:function(e){t.$set(t.itemsParams,"keywords",e)},expression:"itemsParams.keywords"}},[e("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.goodsSearch},slot:"append"})],1)],1)],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.itemsLoading,expression:"itemsLoading"}],staticStyle:{width:"100%"},attrs:{data:t.itemsList,border:"",height:"500"}},[e("el-table-column",{attrs:{prop:"itemName",label:$t("b40v0e4","商品名称","lang")}}),e("el-table-column",{attrs:{label:$t("j6yhu3","缩略图","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return[e("img",{attrs:{width:"20",src:t.wximageurl+a.row.pics[0]}})]}}])}),e("el-table-column",{attrs:{prop:"price",label:$t("m8lft3","销售价","lang"),formatter:t.priceformatter}}),e("el-table-column",{attrs:{prop:"itemName",label:$t("k1e32","状态","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return[t.form.goods_id!=a.row.itemId?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.chooseItem(a.row)}}},[t._v($t("m4r284"," 选择 ","lang"))]):e("span",[t._v($t("egewi3","已选择","lang"))])]}}])})],1),t.itemsTotalCount>t.itemsParams.pageSize?e("div",{staticClass:"content-center content-top-padded"},[e("el-pagination",{attrs:{layout:"prev, pager, next","current-page":t.itemsParams.page,total:t.itemsTotalCount,"page-size":t.itemsParams.pageSize},on:{"update:currentPage":function(e){return t.$set(t.itemsParams,"page",e)},"update:current-page":function(e){return t.$set(t.itemsParams,"page",e)},"current-change":t.goodsHandleCurrentChange}})],1):t._e(),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.goodsDialogVisible=!1}}},[t._v($t("bybnk3","关 闭","lang"))]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.goodsDialogVisible=!1}}},[t._v($t("hnjoo3","确 定","lang"))])],1)],1)],1)},[],!1,null,"6ddac940",null),c=m.exports}}]);