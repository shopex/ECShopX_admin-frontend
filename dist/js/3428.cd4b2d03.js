"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[3428],{63428:function(e,t,s){s.r(t),s.d(t,{default:function(){return c}});var a=s(50709),i=s(78069),n=s(17659),l=s(85135),r={components:{tips:a.default},data(){return{smsScenarioList:[],query:{scene_name:""},count:24,loading:!1,serchNameList:[],visible:!1,form:{scene_id:"",sign_id:"",template_id:""},SmsSignatureList:[],SmsTemplateList:[],activeScene_name:"",rules:{sign_id:[(0,i.XU)($t("lgsv2","签名","lang"),"change")],template_id:[(0,i.XU)($t("imbi2","模板","lang"),"change")]},templateList:[]}},created(){this.querySearch(),this.pagesSmsSignatureQuery=new n.A({pageSize:10,fetch:this.getSMSSignatureList}).nextPage(),this.pagesSmsTemplateQuery=new n.A({pageSize:10,fetch:this.getSMSTemplateList}).nextPage()},mounted(){this.getScenarioList()},methods:{async getScenarioList(){this.loading=!0;let e={pageSize:100,page:1};this.query.scene_name&&(e.scene_name=this.query.scene_name);const{list:t}=await this.$api.sms.getScenarioList(this.query);this.loading=!1,this.smsScenarioList=t},async fnAddSms(e,t){this.visible=!0,this.activeScene_name=t,this.form.scene_id=e},async getSMSTemplateList({page:e,pageSize:t}){const{list:s,total_count:a}=await this.$api.sms.getSmsTemplateList({params:{status:"1",scene_id:this.form.scene_id},page:e,pageSize:t});this.pagesSmsSignatureQuery.setTotal(a),this.SmsTemplateList=this.SmsTemplateList.concat(s)},async getSMSSignatureList({page:e,pageSize:t}){const{list:s,total_count:a}=await this.$api.sms.getSmsSignatureList({params:{status:"1"},page:e,pageSize:t});this.pagesSmsSignatureQuery.setTotal(a),this.SmsSignatureList=this.SmsSignatureList.concat(s)},fnPass(e){this.$refs[e].validate(async e=>{e&&(await(0,l.addSceneItem)(this.form),this.$message.success($t("e7ygyc4","添加成功","lang")),this.activeScene_name="",this.handleClose(),this.getScenarioList())})},handleClose(){this.visible=!1,this.$refs.form.resetFields()},fnDisablingSms(e,t,s){const a=t?$t("pjryd6w","每个场景仅可启用一条短信。启用后，该短信将作为当前场景短信使用。","lang"):$t("9wrxd1z","停用后当前场景将不会触发短信；您仍可启用其他短信作为当前场景短信使用。","lang");this.$confirm(a,"",{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(async()=>{t?(await(0,l.onDisablingSms)({id:e}),this.$message.success($t("e6c0b3","已启用","lang")),this.getScenarioList()):(await(0,l.offDisablingSms)({id:e}),this.$message.success($t("e5ola3","已停用","lang")),this.getScenarioList())})},async deteleSms(e,t){const s=$t("rxloz217","移除后，该短信将不在当前场景。如果移除的是已启用的短信，移除后当前场景可不会触发短信。","lang");this.$confirm(s,"",{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(async()=>{await(0,l.deletedDisablingSms)(e),this.getScenarioList(),this.$message.success($t("azeh8z4","删除成功","lang"))})},onChangeSceneList(){this.getScenarioList()},async querySearch(){const{list:e}=await this.$api.sms.getScenarioList({pageSize:100,page:1});this.templateList=e}}},c=(0,s(81656).A)(r,function(){var e=this,t=e._self._c;return t("div",{staticClass:"alisms_sendSms"},[t("tips",[t("ul",[e._v($t("uzu0rw1k"," 根据场景配置好短信，用户进入对应场景时即可触发系统发送对应给用户，支持短信验证码，订单通知，快递提醒等场景。 ","lang")),t("li",[e._v($t("bsl78ik","· 一条完整的短信由「签名+模板」组成。","lang"))]),t("li",[e._v($t("rcbxgyg","· 每一个场景只能启用一条模板。","lang"))])])]),t("div",{staticClass:"list"},[t("div",{staticClass:"serch"},[t("el-select",{attrs:{clearable:"",filterable:"",placeholder:$t("l72nr3","请选择","lang")},on:{change:e.onChangeSceneList},model:{value:e.query.scene_name,callback:function(t){e.$set(e.query,"scene_name",t)},expression:"query.scene_name"}},e._l(e.templateList,function(e,s){return t("el-option",{key:`template-item__${s}`,attrs:{label:e.scene_name,value:e.scene_name}})}),1)],1),e._l(e.smsScenarioList,function(s){return t("section",{key:s.id,staticClass:"card"},[t("nav",[t("h4",[e._v($t("hv4ukv5","短信场景：","lang")+e._s(s.scene_name))]),t("div",{staticClass:"type"},[e._v($t("hpqxyi5","短信类型：","lang")+e._s(s.template_type))]),t("div",{staticClass:"btn"},[s.itemList.length<3?t("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.fnAddSms(s.id,s.scene_name)}}},[e._v($t("twmzt36"," 添加短信 ","lang"))]):e._e()],1)]),t("el-table",{staticStyle:{width:"100%"},attrs:{data:s.itemList,border:""}},[t("el-table-column",{attrs:{prop:"sign_name",label:$t("lgsv2","签名","lang"),width:"240"}}),t("el-table-column",{attrs:{prop:"template_content",label:$t("imbi2","模板","lang")}}),t("el-table-column",{attrs:{prop:"status",label:$t("k1e32","状态","lang"),width:"180"},scopedSlots:e._u([{key:"default",fn:function(s){return["0"==s.row.status?t("div",{staticClass:"fail"},[e._v($t("fixz73","未启用","lang"))]):e._e(),"1"==s.row.status?t("div",{staticClass:"success"},[e._v($t("e6c0b3","已启用","lang"))]):e._e()]}}],null,!0)}),t("el-table-column",{attrs:{prop:"sign_name",label:$t("hkxb2","操作","lang"),width:"140"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.deteleSms(a.row.id,s.scene_name)}}},[e._v($t("j57pz4"," 移除 ","lang"))]),t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.fnDisablingSms(a.row.id,"0"==a.row.status,s.scene_name)}}},[e._v(" "+e._s("0"==a.row.status?$t("eymx2","启用","lang"):$t("eb7w2","停用","lang"))+" ")])]}}],null,!0)})],1)],1)})],2),t("el-dialog",{attrs:{title:$t("e826ah4","添加短信","lang"),visible:e.visible,width:"30%","before-close":e.handleClose}},[t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"60px"}},[t("el-form-item",{attrs:{label:$t("lgsv2","签名","lang"),prop:"sign_id"}},[t("el-select",{directives:[{name:"scroll",rawName:"v-scroll",value:()=>e.pagesSmsSignatureQuery.nextPage(),expression:"() => pagesSmsSignatureQuery.nextPage()"}],staticStyle:{width:"95%"},attrs:{filterable:"","reserve-keyword":"",placeholder:$t("nzxq2e8","输入签名名称搜索","lang")},model:{value:e.form.sign_id,callback:function(t){e.$set(e.form,"sign_id",t)},expression:"form.sign_id"}},e._l(e.SmsSignatureList,function(e){return t("el-option",{key:`signa-item__${e.id}`,attrs:{label:e.sign_name,value:e.id}})}),1)],1),t("el-form-item",{attrs:{label:$t("imbi2","模板","lang"),prop:"template_id"}},[t("el-select",{directives:[{name:"scroll",rawName:"v-scroll",value:()=>e.pagesSmsTemplateQuery.nextPage(),expression:"() => pagesSmsTemplateQuery.nextPage()"}],staticStyle:{width:"95%"},attrs:{filterable:"",remote:"","reserve-keyword":"",placeholder:$t("7c5md58","输入模板名称搜索","lang")},model:{value:e.form.template_id,callback:function(t){e.$set(e.form,"template_id",t)},expression:"form.template_id"}},e._l(e.SmsTemplateList,function(e){return t("el-option",{key:`template-item__${e.id}`,attrs:{label:e.template_name,value:e.id}})}),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v($t("caoqm3","取 消","lang"))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.fnPass("form")}}},[e._v($t("hnjoo3","确 定","lang"))])],1)],1)],1)},[],!1,null,"22f5ad51",null).exports}}]);