"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[3592],{33592:function(t,i,e){e.r(i),e.d(i,{default:function(){return c}});e(44114),e(18111),e(7588),e(57270);var s=e(50709),a=e(81193),r=e(77825),o=e(2038),l=e(78571),n={components:{DistributorSelect:e(95564).A,tips:s.default},mixins:[r.v8],props:{status:{type:Boolean,default:!1}},data(){return{isSingle:!1,oldData:[],isValid:!0,relDistributors:[],DistributorVisible:!1,DistributorStatus:!1,login_type:"default",isEdit:!1,editVisible:!1,origin:"",editTitle:"",distributionType:"0",form:{operator_type:"distributor",mobile:"",login_name:"",username:"",distributor_ids:[],password:"",role_id:[],isHead:!1,subDistrict:[]},activeName:"distributor",subDistrictList:[],editLoginName:"",accountsList:[],detailData:{},loading:!1,total_count:0,params:{mobile:"",operator_type:"distributor"},operator_id:0,rolesListData:[],datapass_block:0,isHead:!1,is_distributor_main:!1,loginType:this.$store.getters.login_type}},watch:{status(t){t&&this.fetchList()}},mounted(){this.origin=window.location.origin,this.login_type=this.$store.getters.login_type,this.fetchList(),this.getRolesListData(),this.getSubDistrictList()},methods:{async getSubDistrictList(){const t=await this.$api.subdistrict.getSubDistrictList();this.subDistrictList=t},DistributoreHandleClose(t){this.DistributorVisible=!1,this.relDistributors.splice(t,1)},addDistributoreAction(){this.DistributorStatus=!0,this.DistributorVisible=!0},getDistributor(t){let i={distributor_id:t};(0,o.getDistributorList)(i).then(t=>{this.relDistributors=t.data.data.list,this.oldData=[...t.data.data.list]})},handleCancel(){this.editVisible=!1,this.form.operator_type="distributor",this.operator_id="",this.form.login_name="",this.form.mobile="",this.form.username="",this.form.password="",this.form.role_id=[],this.form.distributor_ids=[],this.form.shop_ids=[],this.relDistributors=[]},addLabels(){this.handleCancel(),this.editTitle=$t("sbx5056","添加店铺员工","lang"),this.editVisible=!0,this.isEdit=!1,this.form.username="",this.form.login_name="",this.editLoginName="",this.operator_id="",this.form.password="",this.form.role_id=[]},editAction(t,i){if(this.handleCancel(),this.editTitle=$t("42feid6","编辑店铺员工","lang"),this.editVisible=!0,this.isEdit=!0,this.form.username=i.username,this.form.login_name=i.login_name,this.form.mobile=i.mobile,this.editLoginName=i.login_name,this.operator_id=i.operator_id,this.is_distributor_main=i.is_distributor_main,this.form.password="",i.role_data.forEach(t=>{this.form.role_id.push(t.role_id)}),i.distributor_ids&&i.distributor_ids.length>0){let t=[];i.distributor_ids.forEach(i=>{t.push(i.distributor_id)}),this.getDistributor(t)}},submitAction(){return this.form.shop_ids=[],this.form.distributor_ids=[],this.relDistributors.length>0?(this.relDistributors.forEach(t=>{this.form.distributor_ids.push({name:t.name,distributor_id:t.distributor_id})}),"distributor"===this.loginType&&this.form.role_id.length<=0?(this.$message({type:"error",message:$t("y7088n8","至少关联一个角色","lang")}),!1):void(this.operator_id?(0,a.updateAccountInfo)(this.operator_id,this.form).then(t=>{this.$message.success($t("aghf564","保存成功","lang")),this.detailData=t.data.data,this.editVisible=!1,this.fetchList()}):(0,a.createAccount)(this.form).then(t=>{this.$message.success($t("aghf564","保存成功","lang")),this.detailData=t.data.data,this.editVisible=!1,this.fetchList(),this.handleCancel()}))):(this.$message({type:"error",message:$t("25kwo66","必须关联店铺","lang")}),!1)},fetchList(){this.loading=!0;const{pageIndex:t,pageSize:i}=this.page;let e={page:t,pageSize:i,...this.params};(0,a.getAccountList)(e).then(t=>{let i=t.data.data.list;i.forEach(t=>{1==t.is_disable?t.is_disable="1":t.is_disable="0"}),this.accountsList=i,this.total_count=t.data.data.total_count,this.datapass_block=t.data.data.datapass_block,this.loading=!1})},deleteAccountAction(t,i){this.$confirm($t("yevseng","此操作将删除该账号, 是否继续?","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(()=>{(0,a.deleteAccountInfo)(i.operator_id).then(i=>{this.accountsList.splice(t,1),this.$message({message:$t("azeh8z4","删除成功","lang"),type:"success",duration:5e3})}).catch(()=>{this.$message({type:"error",message:$t("azdahk4","删除失败","lang")})})}).catch(()=>{this.$message({type:"info",message:$t("e68dg3","已取消","lang")})})},acitonDisabled(t,i){if(!0===i.is_disabled){var e=$t("taozdqg","此操作将会禁用该账号，是否继续?","lang");this.$confirm(e,$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(()=>{let t={operator_id:i.operator_id,is_disable:i.is_disable};(0,l.changeOperatorStatus)(t).then(t=>{})})}else{let t={operator_id:i.operator_id,is_disable:i.is_disable};(0,l.changeOperatorStatus)(t).then(t=>{})}},getRolesListData(){(0,a.getRolesList)({page:1,pageSize:100,role_source:"distributor"}).then(t=>{this.rolesListData=t.data.data.list})},DistributorChooseAction(t){this.DistributorVisible=!1,null===t||t.length<=0||(this.relDistributors=t,this.oldData=t)},closeDialogAction(){this.DistributorVisible=!1,this.relDistributors=this.oldData,this.DistributorStatus=!1}}},d=(0,e(81656).A)(n,function(){var t=this,i=t._self._c;return i("SpPage",[i("div",{staticClass:"action-container"},[i("el-button",{attrs:{type:"primary",icon:"plus"},on:{click:t.addLabels}},[t._v($t("otp3pn8"," 添加店铺员工 ","lang"))])],1),i("tips",{staticClass:"action-container"},[i("ul",[t.VERSION_PLATFORM()?i("li",[t._v($t("vgb3he1w"," 平台管理后台仅可给平台自营店铺添加超级管理员，如需给入驻商户的店铺添加超级管理员，请使用商户超级管理员账号登录商户管理后台操作。前往：","lang")),i("el-link",{attrs:{href:t.origin+"/merchant/login",target:"_blank",type:"primary"}},[t._v($t("65k8y56"," 商户后台 ","lang"))]),t._v("。 ")],1):t._e(),i("li",[t._v($t("fp3ww813","每个店铺仅可设置一个超级管理员账号，但一个账号可以同时是多个店铺的超级管理员。","lang"))]),i("li",[t._v($t("3r3dnx1h"," 店铺超级管理员拥有店铺所有权限，可登录店铺管理后台为店铺添加子账号，并通过角色控制子账号权限范围。前往：","lang")),i("el-link",{attrs:{href:t.origin+"/shopadmin/login",target:"_blank",type:"primary"}},[t._v($t("m1ovb96"," 店铺后台 ","lang"))]),t._v("。 ")],1)])]),i("SpFilterForm",{attrs:{model:t.params},on:{onSearch:t.onSearch,onReset:t.onSearch}},[i("SpFilterFormItem",{attrs:{prop:"login_name",label:$t("lcmxm95","登录账号:","lang")}},[i("el-input",{attrs:{placeholder:$t("7dber16","请输入账号名","lang")},model:{value:t.params.login_name,callback:function(i){t.$set(t.params,"login_name",i)},expression:"params.login_name"}})],1),i("SpFilterFormItem",{attrs:{prop:"mobile",label:$t("cttsc24","手机号:","lang")}},[i("el-input",{attrs:{placeholder:$t("7ji3y96","请输入手机号","lang")},model:{value:t.params.mobile,callback:function(i){t.$set(t.params,"mobile",i)},expression:"params.mobile"}})],1),i("SpFilterFormItem",{attrs:{prop:"username",label:$t("djxsw3","姓名:","lang")}},[i("el-input",{attrs:{placeholder:$t("2jaekd5","请输入姓名","lang")},model:{value:t.params.username,callback:function(i){t.$set(t.params,"username",i)},expression:"params.username"}})],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{border:"",data:t.accountsList}},[i("el-table-column",{attrs:{prop:"login_name",label:$t("fcm8nf4","登录账号","lang")}}),i("el-table-column",{attrs:{prop:"mobile",label:$t("ewbd43","手机号","lang")}}),i("el-table-column",{attrs:{prop:"username",label:$t("fqmy2","姓名","lang")}}),i("el-table-column",{attrs:{label:$t("cjqdxi4","店铺名称","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.distributor_ids,function(e){return i("el-tag",{key:e.distributor_id,attrs:{size:"mini"}},[t._v(" "+t._s(e.name)+" ")])})}}])}),"distributor"==t.login_type?i("el-table-column",{attrs:{prop:"roles",label:$t("o5pc2","角色","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.is_distributor_main?i("el-tag",{attrs:{size:"mini",type:"danger"}},[t._v($t("gkc7ql5"," 管理员 ","lang"))]):t._l(e.row.role_data,function(e){return i("el-tag",{key:e.role_id,attrs:{size:"mini",type:"warning"}},[t._v(" "+t._s(e.role_name)+" ")])})]}}],null,!1,794255394)}):t._e(),i("el-table-column",{attrs:{prop:"is_disable",label:$t("lb5z2","禁用","lang"),width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return"distributor"!=t.login_type||0==e.row.is_distributor_main?[i("el-switch",{attrs:{"active-value":"1","inactive-value":"0","active-color":"#ff4949","inactive-color":"#ccc"},on:{change:function(i){return t.acitonDisabled(e.$index,e.row)}},model:{value:e.row.is_disable,callback:function(i){t.$set(e.row,"is_disable",i)},expression:"scope.row.is_disable"}})]:void 0}}],null,!0)}),i("el-table-column",{attrs:{label:$t("hkxb2","操作","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{size:"mini"},on:{click:function(i){return t.editAction(e.$index,e.row)}}},[t._v($t("juz394"," 编辑 ","lang"))])]}}])})],1),i("div",{staticClass:"content-center content-top-padded"},[i("el-pagination",{attrs:{layout:"prev, pager, next","current-page":t.page.pageIndex,total:t.total_count,"page-size":t.page.pageSize},on:{"update:currentPage":function(i){return t.$set(t.page,"pageIndex",i)},"update:current-page":function(i){return t.$set(t.page,"pageIndex",i)},"current-change":t.onCurrentChange}})],1),i("el-dialog",{attrs:{title:t.editTitle,visible:t.editVisible,"before-close":t.handleCancel},on:{"update:visible":function(i){t.editVisible=i}}},[[i("el-form",{ref:"form",staticClass:"demo-ruleForm",attrs:{model:t.form,"label-width":"120px"}},[i("el-form-item",{attrs:{label:$t("fcm8nf4","登录账号","lang")}},[i("el-col",{attrs:{span:10}},[t.editLoginName?i("el-input",{attrs:{disabled:!0},model:{value:t.form.login_name,callback:function(i){t.$set(t.form,"login_name",i)},expression:"form.login_name"}}):i("el-input",{attrs:{minlength:4,maxlength:16,placeholder:$t("nbgqgv9","请输入员工登录账号","lang")},model:{value:t.form.login_name,callback:function(i){t.$set(t.form,"login_name",i)},expression:"form.login_name"}})],1),i("p",{staticClass:"frm-tips"},[t._v($t("2iy7hxw","账号名称4-16位，名称使用字母开头，字符有有字母，数字，下划线","lang"))])],1),i("el-form-item",{attrs:{label:$t("ewbd43","手机号","lang")}},[i("el-col",{attrs:{span:10}},[i("el-input",{attrs:{maxlength:11,placeholder:$t("b2kmjg9","请输入11位手机号","lang")},model:{value:t.form.mobile,callback:function(i){t.$set(t.form,"mobile",i)},expression:"form.mobile"}})],1)],1),i("el-form-item",{attrs:{label:$t("fqmy2","姓名","lang")}},[i("el-col",{attrs:{span:10}},[i("el-input",{attrs:{required:"",placeholder:$t("9hpash5","请填写姓名","lang")},model:{value:t.form.username,callback:function(i){t.$set(t.form,"username",i)},expression:"form.username"}})],1)],1),i("el-form-item",{attrs:{label:$t("fce1f94","登录密码","lang")}},[i("el-col",{attrs:{span:10}},[i("el-input",{attrs:{maxlength:255},model:{value:t.form.password,callback:function(i){t.$set(t.form,"password",i)},expression:"form.password"}})],1)],1),i("el-form-item",{attrs:{label:$t("cs44ip4","所属店铺","lang")}},[t._l(t.relDistributors,function(e,s){return i("el-tag",{key:e.distributor_id,staticClass:"new-tag",attrs:{closable:"","disable-transitions":!1},on:{close:function(i){return t.DistributoreHandleClose(s)}}},[t._v(" "+t._s(e.name)+" ")])}),i("el-button",{staticClass:"button-new-tag",attrs:{size:"medium"},on:{click:t.addDistributoreAction}},[t._v($t("ud7swa"," + 点击搜索店铺 ","lang"))]),i("p",{staticClass:"frm-tips"},[t._v($t("ngnezme","一个店铺只能有一个超级管理员","lang"))])],2),"distributor"==t.login_type&&1!=t.is_distributor_main?i("el-form-item",{attrs:{label:$t("o5pc2","角色","lang")}},[i("el-checkbox-group",{model:{value:t.form.role_id,callback:function(i){t.$set(t.form,"role_id",i)},expression:"form.role_id"}},t._l(t.rolesListData,function(e){return i("el-checkbox",{key:e.role_id,attrs:{label:e.role_id,value:e.role_id}},[t._v(" "+t._s(e.role_name)+" ")])}),1)],1):t._e()],1)],i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{nativeOn:{click:function(i){return t.handleCancel.apply(null,arguments)}}},[t._v($t("dd4ni4"," 取消 ","lang"))]),i("el-button",{attrs:{type:"primary"},on:{click:t.submitAction}},[t._v($t("cp35x4"," 保存 ","lang"))])],1)],2),t.DistributorVisible?[i("DistributorSelect",{attrs:{"store-visible":t.DistributorVisible,"is-valid":t.isValid,"get-status":t.DistributorStatus,"rel-data-ids":t.relDistributors,"old-data":t.oldData,"is-single":t.isSingle,distribution_type:t.distributionType},on:{chooseStore:t.DistributorChooseAction,closeStoreDialog:t.closeDialogAction}})]:t._e()],2)},[],!1,null,"d0dcec56",null),c=d.exports}}]);