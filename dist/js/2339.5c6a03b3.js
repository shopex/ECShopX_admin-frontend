"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[2339],{92339:function(e,t,a){a.r(t),a.d(t,{default:function(){return s}});a(44114),a(18111),a(20116),a(61701);var n=a(95093),i=a.n(n),o=a(33318),r={name:"",mixins:[],props:{},data(){const e=this.$createElement;return{deliveryman:!1,editTitle:"",isLook:!1,confirmStatus:!1,params:{create_time:[],user_mobile:"",order_id:"",check_status:"",pay_account_no:"",pay_account_bank:"",bank_account_name:"",bank_name:""},bankList:[],downloadView:!1,downloadUrl:"",downloadName:"",itemInfo:{},payStatusMap:{SUCCESS:$t("d3gkpk4","支付成功","lang"),NOTPAY:$t("flmib3","未支付","lang"),CLOSED:$t("e61qk3","已关闭","lang"),REVOKED:$t("e9b2m3","已撤销","lang"),PAYERROR:$t("d3fdy54","支付失败","lang"),REFUND_PROCESS:$t("8oyrcd5","退款处理中","lang"),REFUND_SUCCESS:$t("im16q54","退款成功","lang"),REFUND_FAIL:$t("ilzzyq4","退款失败","lang")},checkStatusOptions:[{value:"0",label:$t("efg7b3","待处理","lang")},{value:"1",label:$t("e7j1l3","已审核","lang")},{value:"2",label:$t("e8vjx3","已拒绝","lang")},{value:"9",label:$t("e68dg3","已取消","lang")}],goodSetting:{columns:[{name:$t("1bmu7c5","SKU编码","lang"),key:"item_bn",width:110},{name:$t("b40v0e4","商品名称","lang"),key:"item_name",width:110},{name:$t("elvm2","单价","lang"),key:"price",width:110,render:(e,{row:t})=>e("span",["¥",(t.price/100).toFixed(2)])},{name:$t("i1y72","数量","lang"),key:"num",width:100},{name:$t("nfxe8q5","小计（¥）","lang"),width:110,key:"item_fee",render:(e,{row:t})=>e("span",["¥",(t.item_fee/100).toFixed(2)])},{name:$t("efdok97","积分抵扣（¥）","lang"),width:110,key:"point_fee",render:(e,{row:t})=>e("span",["¥",(t.point_fee/100).toFixed(2)])},{name:$t("fkexus8","总支付金额（¥）","lang"),width:110,key:"total_fee",render:(e,{row:t})=>e("span",["¥",(t.total_fee/100).toFixed(2)])},{name:$t("holv6f6","总优惠（¥）","lang"),width:110,key:"discount_fee",render:(e,{row:t})=>e("span",["¥",(t.discount_fee/100).toFixed(2)])}]},setting:{columns:[{name:$t("gc7k305","收款账户名","lang"),key:"bank_account_name",width:110},{name:$t("85ndwf6","收款银行名称","lang"),key:"bank_name",width:110},{name:$t("85dvrl6","收款银行账号","lang"),key:"bank_account_no",width:110},{name:$t("bd44185","订单总金额","lang"),width:110,key:"total_fee",render:(e,{row:t})=>e("span",["¥",(t.total_fee/100).toFixed(2)])},{name:$t("hyu6l04","订单编号","lang"),key:"order_id",width:150},{name:$t("bzsoeh4","审核意见","lang"),width:150,key:"remark"},{name:$t("bz15hf4","审批状态","lang"),width:150,key:"check_status",render:(e,{row:t})=>e("span",[this.getCheckStatusLabel(t.check_status)])},{name:$t("ar84e54","创建时间","lang"),width:150,key:"create_time",render:(e,{row:t})=>e("span",[i()(1e3*t.create_time).format("YYYY-MM-DD HH:mm:ss")])},{name:$t("bztktx4","审核时间","lang"),width:150,key:"update_time",render:(e,{row:t})=>e("span",[i()(1e3*t.update_time).format("YYYY-MM-DD HH:mm:ss")])}],actions:[{name:$t("iohl804","转账确认","lang"),key:"detail",type:"button",buttonType:"text",visible:e=>"0"==e.check_status,action:{handler:([e])=>{this.editTitle=$t("j3i7ix6","转账确认审核","lang"),this.getItemDetail(e),this.deliveryman=!0,this.isLook=!1}}},{name:$t("obrz2","详情","lang"),key:"detail",type:"button",buttonType:"text",visible:e=>"0"!=e.check_status,action:{handler:([e])=>{this.editTitle=$t("mv8nqo6","转账审核详情","lang"),this.getItemDetail(e),this.deliveryman=!0,this.isLook=!0}}},{name:$t("d1tfy94","操作日志","lang"),key:"apply",type:"button",buttonType:"text",action:{handler:async([e])=>{this.$router.push(`/financial/offline-transfer/voucher-review/logs?orderId=${e.order_id}&resource=${this.$route.path}`)}}}]},addForm:{id:"",order_id:"",pay_fee:0,check_status:"1",remark:"",bank_account_name:"",bank_account_no:"",bank_name:"",china_ums_no:""},addFormList:[{component:()=>e("div",[e("el-descriptions",{attrs:{title:$t("f6qmm54","用户信息","lang"),column:3}},[e("el-descriptions-item",{attrs:{label:$t("kuwys3","订单号","lang")}},[this.itemInfo?.order_info?.order_id]),e("el-descriptions-item",{attrs:{label:$t("a72nl44","下单时间","lang")}},[this.itemInfo?.create_time&&i()(1e3*this.itemInfo?.order_info?.create_time).format("YYYY-MM-DD HH:mm:ss")]),e("el-descriptions-item",{attrs:{label:$t("ytf6465","会员手机号","lang")}},[this.itemInfo?.order_info?.mobile]),e("el-descriptions-item",{attrs:{label:$t("p8ix2","运费","lang")}},["¥",this.itemInfo?.order_info?.freight_fee?(this.itemInfo?.order_info?.freight_fee/100).toFixed(2):"0.00"]),e("el-descriptions-item",{attrs:{label:$t("hyxqu74","订单金额","lang")}},["bargain"!=this.itemInfo?.order_info?.order_type?this.itemInfo?.order_info?.item_fee?`¥${(this.itemInfo?.order_info?.item_fee/100).toFixed(2)}`:"￥0.00":this.itemInfo?.order_info?.item_price?`¥${(this.itemInfo?.order_info?.item_price/100).toFixed(2)}`:"￥0.00"]),e("el-descriptions-item",{attrs:{label:$t("abwukm4","会员优惠","lang")}},["￥",this.itemInfo?.order_info?.member_discount?(this.itemInfo?.order_info?.member_discount/100).toFixed(2):"0.00"]),e("el-descriptions-item",{attrs:{label:$t("xbw7ub5","优惠卷减免","lang")}},["￥",this.itemInfo?.order_info?.coupon_discount?(this.itemInfo?.order_info?.coupon_discount/100).toFixed(2):"0.00"]),e("el-descriptions-item",{attrs:{label:$t("x9pmjl5","优惠总金额","lang")}},["￥",this.itemInfo?.order_info?.discount_fee?(this.itemInfo?.order_info?.discount_fee/100).toFixed(2):"0.00"]),e("el-descriptions-item",{attrs:{label:$t("ginsgf6","积分抵扣金额","lang")}},["￥",this.itemInfo?.order_info?.point_fee?(this.itemInfo?.order_info?.point_fee/100).toFixed(2):"0.00"]),e("el-descriptions-item",{attrs:{label:$t("ozze3n5","应付总金额","lang")}},[this.itemInfo?.order_info?.total_fee?(this.itemInfo?.order_info?.total_fee/100).toFixed(2):"0.00"]),e("el-descriptions-item",{attrs:{label:$t("df7cbx5","实付总金额","lang")}},["￥","point"===this.itemInfo?.tradeInfo?.payType||"NOTPAY"==this.itemInfo?.tradeInfo?.tradeState?"0.00":this.itemInfo?.order_info?.total_fee?(this.itemInfo?.order_info?.total_fee/100).toFixed(2):"0.00"]),e("el-descriptions-item",{attrs:{label:$t("d3jhas4","支付状态","lang")}},[o.UP[this.itemInfo?.tradeInfo?.tradeState]])]),e("div",{class:"good-info-title"},[$t("b400fd4","商品信息","lang")]),e("SpFinder",{ref:"goodfinder",class:"goodfinder",attrs:{setting:this.goodSetting,data:this.itemInfo?.order_info?.items,"show-pager":!1,"no-selection":!0}}),e("el-descriptions",{attrs:{title:$t("l8fxwb6","付款账户信息","lang"),column:2}},[e("el-descriptions-item",{attrs:{label:$t("yc5zij5","交易流水号","lang")}},[this.itemInfo?.pay_sn]),e("el-descriptions-item",{attrs:{label:$t("iolz8m4","转账金额","lang")}},[(this.itemInfo?.pay_fee/100).toFixed(2)]),e("el-descriptions-item",{attrs:{label:$t("d3f6kq4","支付备注","lang"),span:2}},[this.itemInfo?.transfer_remark]),e("el-descriptions-item",{attrs:{label:$t("oikpfl6","凭证图片集合","lang"),span:2}},[Array.isArray(this.itemInfo?.voucher_pic)&&this.itemInfo?.voucher_pic.length>0&&this.itemInfo?.voucher_pic.map(t=>e("ElImage",{attrs:{src:t,previewSrcList:this.itemInfo.voucher_pic},class:"voucher-pic"}))])]),e("div",{class:"modal-header el-descriptions__title"},[$t("hym7z54","订单信息","lang")])])},{label:$t("gc7k305","收款账户名","lang"),key:"bank_account_id",type:"select",required:!0,message:$t("tzb7to9","收款账户名不能为空","lang"),options:[],onChange:e=>{const t=this.bankList.find(t=>t.id==e);this.addForm.bank_account_no=t?.bank_account_no,this.addForm.bank_name=t?.bank_name,this.addForm.china_ums_no=t?.china_ums_no}},{label:$t("85ndwf6","收款银行名称","lang"),component:()=>e("span",[this.addForm.bank_name||"-"]),display:"inline"},{label:$t("85dvrl6","收款银行账号","lang"),key:"bank_name",component:()=>e("span",[this.addForm.bank_account_no||"-"]),display:"inline"},{label:$t("gax8of5","收款银联号","lang"),key:"china_ums_no",component:()=>e("span",[this.addForm.china_ums_no||"-"]),display:"inline"},{label:$t("g5o72","审核","lang"),key:"check_status",type:"radio",required:!0,options:[{label:"1",name:$t("c00pno4","审核通过","lang")},{label:"2",name:$t("bzsx1e4","审核拒绝","lang")}]},{label:$t("bzr5iw4","审核备注","lang"),key:"remark",type:"textarea",maxlength:500,required:!1,message:$t("wx5jqw8","审核备注不能为空","lang")}]}},computed:{},watch:{"addForm.check_status"(e){this.addFormList[6].required="1"!=e}},mounted(){this.getBankList()},methods:{async getBankList(){const{list:e}=await this.$api.trade.getBankList({page:1,pageSize:999}),t=e.map(e=>({...e,label:`${e.bank_name}:${e.bank_account_no}`,value:e.id,title:e.bank_account_name}));this.bankList=t,this.addFormList[1].options=t},onSearch(){this.$refs.finder.refresh()},beforeSearch(e){return{...e,...this.getParams()}},getParams(){const e={...this.params,...this.dateTransfer(this.params.create_time)};return delete e.create_time,e},dateStrToTimeStamp(e){return Date.parse(new Date(e))/1e3},dateTransfer(e){let t,a;return e.length>0&&(t=e[0]+" 00:00:00",a=e[1]+" 23:59:59"),{begin_date:t,end_date:a}},async getItemDetail({id:e}){const t=await this.$api.trade.getOffLineInfo({id:e});this.itemInfo=t,this.addForm={...this.addForm,id:e,order_id:t?.order_info?.order_id,pay_fee:t?.pay_fee},this.isLook?(this.addForm.check_status=t.check_status+"",this.addForm.remark=t.remark):(this.addForm.check_status="1",this.addForm.remark=""),this.addForm.bank_account_id=t.bank_account_id,this.addForm.bank_account_no=t.bank_account_no,this.addForm.bank_name=t.bank_name,this.addForm.china_ums_no=t.china_ums_no},getCheckStatusLabel(e){return this.checkStatusOptions.find(t=>t.value==e)?.label},async onAddSubmit(){this.confirmStatus=!0;let e={...this.addForm};try{await this.$api.trade.offlineCheck(e),this.$message.success($t("bzsjnq4","审核成功","lang")),this.deliveryman=!1,this.confirmStatus=!1,this.onSearch()}catch(e){this.confirmStatus=!1}},async exportData(){const{status:e,url:t,filename:a}=await this.$api.trade.exportOffline({...this.getParams()});if(e)return this.$message({type:"success",message:$t("xdh90kk","已加入执行队列，请在设置-导出列表中下载","lang")}),void this.$export_open("offline_payment");t?(this.downloadUrl=t,this.downloadName=a,this.downloadView=!0):this.$message({type:"error",message:$t("d17rj2j","无内容可导出 或 执行失败，请检查重试","lang")})}}},s=(0,a(81656).A)(r,function(){var e=this,t=e._self._c;return t("SpPage",[t("SpRouterView",[t("SpFilterForm",{attrs:{model:e.params},on:{onSearch:e.onSearch,onReset:e.onSearch}},[t("SpFilterFormItem",{attrs:{prop:"bank_account_name",label:$t("9apwpm6","收款账户名:","lang")}},[t("el-input",{attrs:{placeholder:$t("9oviyz8","请输入收款账户名","lang")},model:{value:e.params.bank_account_name,callback:function(t){e.$set(e.params,"bank_account_name",t)},expression:"params.bank_account_name"}})],1),t("SpFilterFormItem",{attrs:{prop:"order_id",label:$t("hymdzq4","订单号:","lang")}},[t("el-input",{attrs:{placeholder:$t("7djicl6","请输入订单号","lang")},model:{value:e.params.order_id,callback:function(t){e.$set(e.params,"order_id",t)},expression:"params.order_id"}})],1),t("SpFilterFormItem",{attrs:{prop:"check_status",label:$t("h97673","状态:","lang")}},[t("el-select",{model:{value:e.params.check_status,callback:function(t){e.$set(e.params,"check_status",t)},expression:"params.check_status"}},e._l(e.checkStatusOptions,function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),t("SpFilterFormItem",{attrs:{prop:"bank_name",label:$t("gawcf85","收款银行:","lang")}},[t("el-select",{model:{value:e.params.bank_name,callback:function(t){e.$set(e.params,"bank_name",t)},expression:"params.bank_name"}},e._l(e.bankList,function(e){return t("el-option",{key:e.bank_name,attrs:{label:e.label,value:e.bank_name}})}),1)],1),t("SpFilterFormItem",{attrs:{prop:"create_time",label:$t("e8915d5","日期范围:","lang")}},[t("el-date-picker",{attrs:{type:"daterange","value-format":"yyyy/MM/dd",placeholder:$t("to1gvf6","选择日期范围","lang")},model:{value:e.params.create_time,callback:function(t){e.$set(e.params,"create_time",t)},expression:"params.create_time"}})],1)],1),t("div",{staticClass:"action-container"},[t("el-button",{attrs:{type:"primary",plain:""},on:{click:e.exportData}},[e._v($t("efepu4"," 导出 ","lang"))])],1),t("SpFinder",{ref:"finder",attrs:{url:"/order/offline_payment/get_list","fixed-row-action":!0,"no-selection":"",setting:e.setting,hooks:{beforeSearch:e.beforeSearch}}}),t("SpDialog",{ref:"addDialogRef",attrs:{width:"900px","is-show-footer":!e.isLook,"confirm-status":e.confirmStatus,title:e.editTitle,form:e.addForm,"form-list":e.addFormList},on:{onSubmit:e.onAddSubmit},model:{value:e.deliveryman,callback:function(t){e.deliveryman=t},expression:"deliveryman"}}),t("el-dialog",{attrs:{title:$t("yg3h485","交易单下载","lang"),visible:e.downloadView,"close-on-click-modal":!1},on:{"update:visible":function(t){e.downloadView=t}}},[e.downloadUrl?[t("a",{attrs:{href:e.downloadUrl,download:""}},[e._v(e._s(e.downloadName))])]:e._e()],2)],1)],1)},[],!1,null,"30fcf979",null).exports}}]);