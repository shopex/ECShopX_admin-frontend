"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[1993],{11993:function(t,e,a){a.r(e),a.d(e,{default:function(){return i}});a(18111),a(7588),a(61701);var o={data(){const t=this.$createElement;return{loading:!1,categoryList:[],appID:"",appCodeUrl:"",curPageUrl:"",mapData:null,cacheRowData:null,categoryDialog:!1,categoryForm:{category_id:"",category_name:"",sort:0,parent_id:0,parent_name:"",image_url:"",customize_page_id:""},categoryFormList:[{label:$t("av333s4","分类名称","lang"),key:"category_name",type:"input",placeholder:$t("mnzxr37","请输入分类名称","lang"),required:!0,message:$t("adohlc4","不能为空","lang")},{label:$t("av5kqa4","分类排序","lang"),key:"sort",type:"number"},{label:$t("exjndy4","父级分类","lang"),key:"parent_name",type:"text",isShow:({key:t},e)=>this.categoryForm.parent_id>0&&!this.categoryForm.category_id},{label:$t("av3jlq4","分类图片","lang"),key:"image_url",component:({key:e},a)=>t("SpImagePicker",{model:{value:a[e],callback:t=>{this.$set(a,e,t)}}})},{label:$t("g2ls2r6","一级分类模版","lang"),key:"customize_page_id",type:"select",options:[],placeholder:$t("2e0k7u9","请选择一级分类模版","lang"),display:"inline"}],profitDialog:!1,profitForm:{parent_id:"",category_id:"",category_name:"",profit_conf_profit:"",profit_conf_popularize_profit:""},profitFormList:[{component:()=>t("div",[t("div",{style:"margin-left: 8px; line-height: initial;"},[$t("xyzltva","导购分润计算方式: ","lang")]),t("div",{class:"form-item-tip"},[$t("73sg0x1a","【按比例分佣】商品最终金额 × 百分比（其中商品最终金额为【支付金额-运费-商品优惠金额】）","lang")]),t("div",{class:"form-item-tip"},[$t("u91zsod","【按金额分佣】固定金额分佣","lang")])])},{label:$t("av333s4","分类名称","lang"),key:"category_name",type:"text"},{label:$t("cyqv7b4","推广分润","lang"),key:"profit_conf_profit",component:({key:e},a)=>t("SpInput",{attrs:{suffix:"%"},model:{value:a[e],callback:t=>{this.$set(a,e,t)}}})},{label:$t("cvue934","拉新分润","lang"),key:"profit_conf_popularize_profit",component:({key:e},a)=>t("SpInput",{attrs:{suffix:"%"},model:{value:a[e],callback:t=>{this.$set(a,e,t)}}})}]}},created(){this.mapData=new Map},mounted(){this.init(),this.classification()},methods:{async classification(){let{list:t}=await this.$api.wxa.getCustomPageList({page:1,pageSize:10,page_type:"category",template_name:"yykweishop"});t.forEach(t=>{t.title=t.page_name,t.value=t.id}),this.categoryFormList[4].options=t},async init(){const t=await this.getCategory();this.categoryList=t},addCategory(){this.categoryForm={category_id:"",category_name:"",sort:0,parent_id:0,parent_name:"",image_url:"",customize_page_id:""},this.categoryDialog=!0},editCategory({parent_id:t,category_id:e,category_name:a,sort:o,image_url:i,customize_page_id:r}){this.categoryForm={category_id:e,category_name:a,sort:o,parent_id:t,image_url:i,customize_page_id:0==r?"":r},this.categoryDialog=!0},appendChildren(t){const{category_id:e,category_name:a}=t;this.cacheRowData=t,this.categoryForm={category_id:"",category_name:"",sort:0,parent_id:e,parent_name:a,image_url:"",customize_page_id:""},this.categoryDialog=!0},handleProfitPrice({parent_id:t,category_id:e,category_name:a,profit_conf_profit:o,profit_conf_popularize_profit:i}){this.profitForm={parent_id:t,category_id:e,category_name:a,profit_conf_profit:o,profit_conf_popularize_profit:i},this.profitDialog=!0},async onProfitFormSubmit(){const{parent_id:t,category_id:e,profit_conf_profit:a,profit_conf_popularize_profit:o}=this.profitForm,i={category_id:e,profit_conf:JSON.stringify({profit_conf_profit:a,profit_conf_popularize_profit:o})};await this.$api.goods.saveCategoryProfitPrice(i),this.$message.success($t("aghf564","保存成功","lang")),this.profitDialog=!1;const{resolve:r}=this.mapData.get(t);r(await this.getCategory(t))},async onLinkGoodsParams({parent_id:t,category_id:e,goods_params:a=[]}){const{data:o}=await this.$picker.goodsParams({dialogTitle:$t("at1ckv4","关联参数","lang"),data:JSON.parse(a),queryParams:{attribute_type:"item_params"},num:99});await this.$api.goods.updateCategory(e,{goods_params:JSON.stringify(o.map(t=>t.attribute_id))}),this.refreshNode(t)},async onLinkGoodsSku({parent_id:t,category_id:e,goods_spec:a=[]}){const{data:o}=await this.$picker.goodsParams({dialogTitle:$t("atajuh4","关联规格","lang"),data:JSON.parse(a),queryParams:{attribute_type:"item_spec"},num:3,islimitImgType:!0});await this.$api.goods.updateCategory(e,{goods_spec:JSON.stringify(o.map(t=>t.attribute_id))}),this.refreshNode(t)},async getCategory(t=0){return(await this.$api.goods.getCategory({parent_id:t,is_main_category:!0})).map(t=>({...t,image_url:t.image_url||"",customize_page_id:t.customize_page_id||"",hasChildren:"1"==t.has_children}))},async load(t,e,a){const{category_id:o}=t;this.mapData.set(o,{tree:t,treeNode:e,resolve:a});a(await this.getCategory(o,e))},async onCategoryFormSubmit(){const{category_name:t,sort:e,image_url:a,customize_page_id:o,parent_id:i,category_id:r}=this.categoryForm;r?(await this.$api.goods.editCategory({category_name:t,sort:e,image_url:a,category_id:r,customize_page_id:o}),this.$message.success($t("gmjwui4","编辑成功","lang"))):(await this.$api.goods.addCategory({category_name:t,sort:e,is_main_category:1,image_url:a,customize_page_id:o,parent_id:"0"!=i?i:void 0}),this.$message.success($t("e7ygyc4","添加成功","lang"))),this.refreshNode(i),this.categoryDialog=!1},async deleteCategory({parent_id:t,category_id:e}){await this.$confirm($t("59pcidg","此操作将删除该分类, 是否继续?","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang")}),await this.$api.goods.deleteCategory(e),this.$message.success($t("uehn3s6","删除分类成功","lang")),this.refreshNode(t)},async refreshNode(t){if("0"==t)return void this.init();const e=await this.getCategory(t),{resolve:a}=this.mapData.get(t)||{};if(a)if(e.length>0)a(e);else{const{lazyTreeNodeMap:e}=this.$refs.tableTree.store.states;this.$set(e,t,[])}else{const t=this.$refs.tableTree.store;this.cacheRowData.hasChildren=!0,this.$nextTick(()=>{t.loadOrToggle(this.cacheRowData)})}}}},i=(0,a(81656).A)(o,function(){var t=this,e=t._self._c;return e("SpPage",[e("div",{staticClass:"page-goods-maincategory"},[t.IS_DISTRIBUTOR()?t._e():e("div",{staticClass:"action-container"},[e("el-button",{attrs:{type:"primary"},on:{click:t.addCategory}},[t._v($t("7uu3of8"," 添加管理分类 ","lang"))])],1),e("el-table",{ref:"tableTree",attrs:{data:t.categoryList,"row-key":"category_id",border:"",lazy:"","tree-props":{children:"children",hasChildren:"hasChildren"},load:t.load}},[e("el-table-column",{attrs:{label:$t("av333s4","分类名称","lang"),width:"180"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.hasChildren||"1"!=a.row.category_level?t._e():e("span",{staticStyle:{display:"inline-block",width:"24px"}}),e("span",[t._v(t._s(a.row.category_name))])]}}])}),e("el-table-column",{attrs:{label:$t("ava74m4","分类编号","lang"),prop:"category_id",width:"120"}}),e("el-table-column",{attrs:{prop:"sort",label:$t("av5kqa4","分类排序","lang"),width:"140"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",[t._v(t._s(a.row.sort))])]}}])}),e("el-table-column",{attrs:{label:$t("av3jlq4","分类图片","lang"),width:"200"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"img-container"},[a.row.image_url?e("SpImage",{attrs:{src:a.row.image_url,width:48,height:48}}):t._e(),e("span",[t._v(t._s(a.row.category_name))])],1)]}}])}),e("el-table-column",{attrs:{prop:"sort",label:$t("av5kqa4","分类排序","lang"),width:"140"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",[t._v(t._s(a.row.sort))])]}}])}),e("el-table-column",{attrs:{label:$t("g2ls2r6","一级分类模版","lang"),width:"200",prop:"customize_page_name"}}),e("el-table-column",{attrs:{label:$t("hkxb2","操作","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{type:"text"}},[e("router-link",{attrs:{to:{path:"/products/product-manage/self-products",query:{main_cat_id:a.row.category_id}}}},[t._v(" "+t._s(t.VERSION_PLATFORM()?$t("c9kgd44","平台商品","lang"):$t("dllim94","查看商品","lang"))+" ")])],1),t.VERSION_PLATFORM()?e("el-button",{attrs:{type:"text"}},[e("router-link",{attrs:{to:{path:"/entity/goods/goodsaudit",query:{main_cat_id:a.row.category_id}}}},[t._v($t("m1iaym6"," 店铺商品 ","lang"))])],1):t._e(),3==a.row.category_level?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.onLinkGoodsParams(a.row)}}},[t._v($t("4zyj9r6"," 关联参数 ","lang"))]):t._e(),3==a.row.category_level?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.onLinkGoodsSku(a.row)}}},[t._v($t("4s19zt6"," 关联规格 ","lang"))]):t._e(),a.row.category_level<3?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.appendChildren(a.row)}}},[t._v($t("1vg0hl6"," 新增子类 ","lang"))]):t._e(),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.editCategory(a.row)}}},[t._v($t("juz394"," 编辑 ","lang"))]),e("el-button",{attrs:{type:"text"},nativeOn:{click:function(e){return e.preventDefault(),t.deleteCategory(a.row)}}},[t._v($t("db22k4"," 删除 ","lang"))])]}}])})],1),e("SpDialog",{ref:"categoryDialogRef",attrs:{title:t.categoryForm.category_id>0?$t("gmhewg4","编辑分类","lang"):$t("e7vz0a4","添加分类","lang"),modal:!1,form:t.categoryForm,"form-list":t.categoryFormList},on:{onSubmit:t.onCategoryFormSubmit},model:{value:t.categoryDialog,callback:function(e){t.categoryDialog=e},expression:"categoryDialog"}}),e("SpDialog",{ref:"profitDialogRef",attrs:{title:`${$t("at7bq94","分润配置","lang")}`,modal:!1,form:t.profitForm,"form-list":t.profitFormList},on:{onSubmit:t.onProfitFormSubmit},model:{value:t.profitDialog,callback:function(e){t.profitDialog=e},expression:"profitDialog"}})],1)])},[],!1,null,null,null).exports}}]);