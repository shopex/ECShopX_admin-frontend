"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[9348],{29348:function(e,t,a){a.r(t),a.d(t,{default:function(){return p}});a(44114);var s=a(95353),i=a(2038),l=a(77944),o=a(50002),r=a(11129),n=a(25159),d=a(71196),h={components:{StoreSelect:r.default,shopSelect:n.default,SideBar:d.A},data(){return{dialog:!1,dialog_role:!1,roleList:{},roleForm:{role:""},activeName:"admin",list:[],total_count:0,loading:!1,salesman_id:"",params:{page:1,pageSize:20},form:{distributor_id:[],mobile:"",role:"",salesman_name:"",is_valid:"true"},relShop:{list:[],total_count:0,params:{page:1,pageSize:20},relShopVisible:!1},setStoreStatus:!1,storeVisible:!1,relStores:[],rel_distributor_ids:[],showSideBar:!1,relationship:{saleId:"",total_count:0,loading:!1,list:[],params:{page:1,pageSize:20,is_friend:1,is_bind:0}}}},computed:{...(0,s.L8)(["wheight"])},mounted(){this.getList(),this.getRoleList()},methods:{searchMembers(e){let t=this.$router.resolve({path:"/member/member",query:{salesman_mobile:e.mobile}});window.open(t.href,"_blank")},handleAddSalesmanAction(){this.dialog=!0,this.salesman_id=!1,this.form.distributor_id="",this.form.mobile="",this.form.is_valid="true",this.form.salesman_name="",this.rel_distributor_ids=""},addSelectStoreChange(e){this.form.distributor_id=e.shop_id},count(e,t){if(t.children_count>0){let e=this.$router.resolve({path:this.matchRoutePath("children"),query:{promoter_id:t.promoter_id}});window.open(e.href,"_blank")}},storeChange(e){e&&e.shop_id,this.params.distributor_id=e.shop_id,this.params.page=1,this.getList()},initChange(){this.shopId=""},numberSearch(){this.params.page=1,this.getList()},handleUpdateSalesmanRole(e){this.dialog_role=!0,this.salesman_id=e.salespersonId,this.roleForm.role=e.role},handleUpdateSalesman(e){this.dialog=!0,this.salesman_id=e.salespersonId;var t={salesperson_id:e.salespersonId};(0,l.getSalespersonInfo)(t).then(e=>{this.form={salesman_name:e.data.data.name,mobile:e.data.data.mobile,salesperson_type:e.data.data.salesperson_type,shop_id:e.data.data.shop_ids,role:e.data.data.role,distributor_id:e.data.data.distributor_id?e.data.data.distributor_id:e.data.data.distributor_ids,is_valid:e.data.data.is_valid},this.rel_distributor_ids=e.data.data.distributorList})},handleDeleteSalesman(e,t){this.$confirm($t("1jpq98d","此操作将禁用, 是否继续?","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(()=>{(0,i.updateSalesman)(t.salespersonId,{is_valid:"delete"}).then(t=>{this.list.splice(e,1),this.$message({type:"success",message:$t("d1spvi4","操作成功","lang")})})}).catch(()=>{this.$message({type:"info",message:$t("e68dg3","已取消","lang")})})},defaultSwitchChange(e){(0,i.updateSalesman)(e.salesperson_id,{is_valid:e.is_valid}).then(e=>{this.$message({type:"success",message:$t("d1spvi4","操作成功","lang")})})},handleAddSalesman(){this.salesman_id?this.updateSalesmanAction():this.addSalesmanAction()},updateSalesmanAction(){(0,i.updateSalesman)(this.salesman_id,this.form).then(e=>{this.form={distributor_id:"",mobile:"",role:"",salesman_name:""},this.dialog=!1,this.getList(),this.$message({type:"success",message:$t("d1spvi4","操作成功","lang")})})},handleAddSalesmanRole(){(0,i.updateSalesmanRole)(this.salesman_id,this.roleForm).then(e=>{this.dialog_role=!1,this.getList(),this.$message({type:"success",message:$t("d1spvi4","操作成功","lang")})})},addSalesmanAction(){(0,i.addSalesman)(this.form).then(e=>{this.form={distributor_id:"",mobile:"",role:"",salesman_name:""},this.dialog=!1,this.getList(),this.$message({type:"success",message:$t("d1spvi4","操作成功","lang")})})},getList(){this.loading=!0,(0,i.getSalesmanList)(this.params).then(e=>{e.data.data.list&&(this.list=e.data.data.list,this.total_count=Number(e.data.data.total_count)),this.loading=!1})},getRoleList(){(0,i.getRoleList)().then(e=>{e.data.data.list&&(this.roleList=e.data.data.list)})},getSalepersonShopList(e,t){this.relShop.relShopVisible=!0,this.relShop.params.salesperson_id=e,t&&(this.relShop.params.store_type=t),(0,l.getRelShopList)(this.relShop.params).then(e=>{this.relShop.list=e.data.data.list,this.relShop.total_count=e.data.data.total_count})},handleCancel(){this.relShop.relShopVisible=!1},handleRelShopCurrentChange(e){this.relShop.params.page=e,this.getSalepersonShopList(this.relShop.params.salesperson_id)},storeClose(e,t){this.setStoreStatus=!1,this.rel_distributor_ids.splice(t,1),this.form.distributor_id=[];for(var a=0;a<e.length;a++)this.form.distributor_id.indexOf(e[a].distributor_id)<0&&this.form.distributor_id.push(Number(e[a].distributor_id))},addStoreAction(){this.storeVisible=!0,this.setStoreStatus=!0,this.relStores=JSON.parse(JSON.stringify(this.rel_distributor_ids))},closeStoreDialogAction(){this.storeVisible=!1},chooseStoreAction(e){if(this.storeVisible=!1,this.form.distributor_id=[],!(null===e||e.length<=0)){this.rel_distributor_ids=e;for(var t=0;t<e.length;t++)this.form.distributor_id.indexOf(e[t].distributor_id)<0&&this.form.distributor_id.push(Number(e[t].distributor_id))}},handleClick(){"invalid"==this.activeName?(this.params.is_valid="delete",this.getList()):(this.params.is_valid="",this.getList())},handleSizeChange(e){this.params.page=1,this.params.pageSize=e,this.getList()},handleCurrentChange(e){this.params.page=e,this.getList()},handleShowSideBar(e){this.showSideBar=!0,this.relationship.saleId=e,this.getWorkWechatRelList()},handleRelaSizeChange(e){this.relationship.params.page=1,this.relationship.params.pageSize=e,this.getWorkWechatRelList()},handleRelaCurrentChange(e){this.relationship.params.page=e,this.getWorkWechatRelList()},getWorkWechatRelList(){this.relationship.saleId&&(this.relationship.loading=!0,(0,o.getWorkWechatRelList)(this.relationship.saleId,this.relationship.params).then(e=>{this.relationship.list=e.data.data.list,this.relationship.total_count=e.data.data.total_count,this.relationship.loading=!1}))}}},p=(0,a(81656).A)(h,function(){var e=this,t=e._self._c;return t("SpPage",[t("SpRouterView",[t("div",[t("el-row",{attrs:{gutter:20}},[t("el-col",[t("shop-select",{attrs:{distributors:""},on:{update:e.storeChange,init:e.initChange}}),t("el-input",{staticClass:"input-m",attrs:{placeholder:$t("ewbd43","手机号","lang"),clearable:""},model:{value:e.params.mobile,callback:function(t){e.$set(e.params,"mobile",t)},expression:"params.mobile"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.numberSearch},slot:"append"})],1),t("el-button",{attrs:{type:"primary",icon:"plus"},on:{click:e.handleAddSalesmanAction}},[e._v($t("h2eu34"," 添加 ","lang"))])],1)],1),t("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:$t("epm92","列表","lang"),name:"admin"}}),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.list}},[t("el-table-column",{attrs:{prop:"salesman_name",label:$t("fqmy2","姓名","lang")}}),t("el-table-column",{attrs:{prop:"mobile",label:$t("ewbd43","手机号","lang")}}),t("el-table-column",{attrs:{prop:"storeInfo.name",label:$t("gwn72","店铺","lang")}}),t("el-table-column",{attrs:{prop:"children_count",width:"130",label:$t("vv4w4v6","累计会员数量","lang")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",icon:"edit",type:"text"},on:{click:function(t){return e.count(a.$index,a.row)}}},[e._v(" "+e._s(a.row.children_count)+" ")])]}}])}),t("el-table-column",{attrs:{label:$t("d8pu5s4","是否启用","lang")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-switch",{attrs:{"active-value":"true","inactive-value":"false","active-color":"#13ce66","inactive-color":"#ccc"},on:{change:function(t){return e.defaultSwitchChange(a.row)}},model:{value:a.row.is_valid,callback:function(t){e.$set(a.row,"is_valid",t)},expression:"scope.row.is_valid"}})]}}])}),t("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),width:"160px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticClass:"operating-icons"},[t("i",{staticClass:"iconfont icon-edit1",on:{click:function(t){return e.handleUpdateSalesman(a.row)}}})])]}}])})],1),t("div",{staticClass:"mt-4 text-right"},[t("el-pagination",{attrs:{background:"","current-page":e.params.page,"page-sizes":[10,20,50,100],"page-size":e.params.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total_count},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),t("el-dialog",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{title:$t("4t0wb07","编辑导购员角色","lang"),visible:e.dialog_role,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialog_role=t}}},[t("el-form",{attrs:{"label-width":"160px"},model:{value:e.form,callback:function(t){e.form=t},expression:"form"}},[t("el-form-item",{attrs:{label:$t("o5pc2","角色","lang")}},[t("el-radio-group",{model:{value:e.roleForm.role,callback:function(t){e.$set(e.roleForm,"role",t)},expression:"roleForm.role"}},e._l(e.roleList,function(a,s){return t("el-radio",{key:s,attrs:{label:a.salesman_role_id}},[e._v(" "+e._s(a.role_name)+" ")])}),1)],1)],1),t("div",{staticClass:"dialog-footer content-center",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.handleAddSalesmanRole}},[e._v($t("in1ck4"," 确定 ","lang"))])],1)],1),t("el-dialog",{attrs:{title:$t("e9wi9x5","添加/编辑","lang"),visible:e.dialog,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialog=t}}},[t("el-form",{attrs:{"label-width":"160px"},model:{value:e.form,callback:function(t){e.form=t},expression:"form"}},[t("el-form-item",{attrs:{label:$t("g2tcw84","管理店铺","lang")}},[t("shop-select",{attrs:{distributors:"","shop-id-default":e.form.distributor_id},on:{update:e.addSelectStoreChange,init:e.initChange}})],1),t("el-form-item",{attrs:{label:$t("ewbd43","手机号","lang")}},[t("el-input",{staticStyle:{width:"193px"},attrs:{placeholder:$t("7ji3y96","请输入手机号","lang"),readonly:e.salesman_id>0},model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",t)},expression:"form.mobile"}}),e.salesman_id?t("div",[e._v($t("a3js699","* 手机号不可修改","lang"))]):e._e()],1),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:$t("o5pc2","角色","lang")}},[t("el-radio-group",{model:{value:e.form.role,callback:function(t){e.$set(e.form,"role",t)},expression:"form.role"}},e._l(e.roleList,function(a,s){return t("el-radio",{key:s,attrs:{label:a.salesman_role_id}},[e._v(" "+e._s(a.role_name)+" ")])}),1)],1),t("el-form-item",{attrs:{label:$t("fqmy2","姓名","lang")}},[t("el-input",{staticStyle:{width:"193px"},attrs:{placeholder:$t("2jaekd5","请输入姓名","lang")},model:{value:e.form.salesman_name,callback:function(t){e.$set(e.form,"salesman_name",t)},expression:"form.salesman_name"}})],1),"invalid"==e.activeName?t("el-form-item",{attrs:{label:$t("d8pu5s4","是否启用","lang")}},[t("el-radio",{attrs:{label:"true"},model:{value:e.form.is_valid,callback:function(t){e.$set(e.form,"is_valid",t)},expression:"form.is_valid"}},[e._v($t("dg9c74"," 启用 ","lang"))]),t("el-radio",{attrs:{label:"delete"},model:{value:e.form.is_valid,callback:function(t){e.$set(e.form,"is_valid",t)},expression:"form.is_valid"}},[e._v($t("ix1qx4"," 禁用 ","lang"))])],1):e._e()],1),t("div",{staticClass:"dialog-footer content-center",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.handleAddSalesman}},[e._v($t("in1ck4"," 确定 ","lang"))])],1)],1),t("el-dialog",{attrs:{title:$t("cjq4s44","店铺列表","lang"),visible:e.relShop.relShopVisible,"before-close":e.handleCancel,width:"70%"},on:{"update:visible":function(t){return e.$set(e.relShop,"relShopVisible",t)}}},[[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.relShop.list}},[t("el-table-column",{attrs:{prop:"shop_id",label:"id",width:"60"}}),t("el-table-column",{attrs:{prop:"store_name",label:$t("cjqdxi4","店铺名称","lang"),width:"300"}}),t("el-table-column",{attrs:{prop:"address",label:$t("cjqqab4","店铺地址","lang")}})],1),e.relShop.total_count>e.relShop.params.pageSize?t("div",{staticClass:"content-center content-top-padded"},[t("el-pagination",{attrs:{layout:"prev, pager, next","current-page":e.relShop.params.page,total:e.relShop.total_count,"page-size":e.relShop.params.pageSize},on:{"update:currentPage":function(t){return e.$set(e.relShop.params,"page",t)},"update:current-page":function(t){return e.$set(e.relShop.params,"page",t)},"current-change":e.handleRelShopCurrentChange}})],1):e._e()]],2),t("StoreSelect",{attrs:{"store-visible":e.storeVisible,"is-valid":!0,"rel-data-ids":e.relStores,"get-status":e.setStoreStatus},on:{chooseStore:e.chooseStoreAction,closeStoreDialog:e.closeStoreDialogAction}}),t("SideBar",{attrs:{visible:e.showSideBar,title:$t("gdn91t4","绑定关系","lang"),width:"50"},on:{"update:visible":function(t){e.showSideBar=t}}},[t("div",{staticClass:"relationship"},[t("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.relationship.loading,expression:"relationship.loading"}]},[t("el-table",{attrs:{data:e.relationship.list}},[t("el-table-column",{attrs:{label:$t("e5i9z3","导购员","lang")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.salesperson_info.salesman_name)+" ")]}}])}),t("el-table-column",{attrs:{prop:"work_userid",label:$t("co29yfd","导购员企业微信userid","lang")}}),t("el-table-column",{attrs:{label:$t("ewbd43","手机号","lang")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.user_info.mobile)+" ")]}}])}),t("el-table-column",{attrs:{label:$t("dx1a2","会员","lang")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("router-link",{attrs:{to:{path:"/member/member/memberlist/detail",query:{user_id:a.row.user_id}}}},[e._v(" "+e._s(a.row.user_info.username)+" ")])]}}])}),t("el-table-column",{attrs:{label:$t("fluduw5","是否是朋友","lang")},scopedSlots:e._u([{key:"default",fn:function(a){return[0==a.row.is_friend?t("span",[e._v($t("gme1","否","lang"))]):t("span",[e._v($t("k6n1","是","lang"))])]}}])}),t("el-table-column",{attrs:{label:$t("d8wy684","是否绑定","lang")},scopedSlots:e._u([{key:"default",fn:function(a){return[0==a.row.is_bind?t("span",[e._v($t("gme1","否","lang"))]):t("span",[e._v($t("k6n1","是","lang"))])]}}])})],1),t("div",{staticClass:"mt-4 text-right"},[t("el-pagination",{attrs:{background:"","current-page":e.relationship.params.page,"page-sizes":[10,20,50,100],"page-size":e.relationship.params.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.relationship.total_count},on:{"size-change":e.handleRelaSizeChange,"current-change":e.handleRelaCurrentChange}})],1)],1)],1)])],1)])],1)},[],!1,null,"8866125a",null).exports}}]);