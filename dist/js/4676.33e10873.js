"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[4676],{84676:function(e,t,s){s.r(t),s.d(t,{default:function(){return o}});s(44114),s(18111),s(22489),s(61701),s(13579);var a=s(2487),i=s(2038),n={name:"AddressBook",data(){return{list:[],treeProps:{label:"name",children:"children"},tableData:[],selectNodeKey:[],selectMemberList:[],isLoading:!1,storeList:[],departmentId:{},param:{page:1,pageSize:10,unbound:!0,name:""},total:0,loading:{syncDepart:!1,syncMember:!1,storeList:!1,syncClub:!1},tableLoading:!1,title:"",dialogFormVisible:!1}},mounted(){this.getAdressBook()},methods:{getAdressBook:function(){this.isLoading=!0,this.selectNodeKey=[],this.$refs.elTree.setCheckedKeys([]),(0,a.getWorkwechat)().then(e=>{this.list=e.data.data,this.isLoading=!1;const{id:t,name:s}=this.list[0];this.getWorkMember(t,s)})},getWorkMember:function(e,t){this.tableLoading=!0,this.selectMemberList=[],(0,a.getMemberByClub)(e).then(e=>{this.title=t,this.tableData=e.data.data,this.$nextTick(()=>{this.dealCheckable()}),this.tableLoading=!1}).catch(()=>this.tableLoading=!1)},dealCheckable:function(){if(!this.$refs.multipleTable)return;const e=this.tableData;for(let t=0;t<e.length;t++){const s=this.selectMemberList.some(s=>s.userid===e[t].userid);this.$refs.multipleTable.toggleRowSelection(e[t],s)}},syncDepartToShop:function(){if(this.selectNodeKey.length<=0)return void this.$message({message:$t("2ecyvd5","请选择部门","lang"),type:"error"});const e={department_id:JSON.stringify(this.selectNodeKey)};(0,a.syncClubToStore)(e).then(e=>{this.$message({message:$t("ska0wo6","同步部门成功","lang"),type:"success"})})},syncToShop:function(e){const t={department_id:JSON.stringify([this.departmentId]),distributor_id:e};(0,a.syncClubToStore)(t).then(e=>{this.$message({message:$t("mewu828","同步当前部门成功","lang"),type:"success"})})},getStoreList:function(){this.loading.storeList=!0,(0,i.getDistributorList)(this.param).then(e=>{this.storeList=e.data.data.list,this.total=e.data.data.total_count,this.loading.storeList=!1})},pageChange:function(e){this.param.page=e,this.getStoreList()},syncMemberToGuide:function(){const e=this.selectMemberList;if(e.length<=0)this.$message({message:$t("2elao15","请选择成员","lang"),type:"error"});else{this.loading.syncMember=!0;const t=e.map(e=>e.userid),s={user_ids:JSON.stringify(t)};(0,a.syncMemberToGuide)(s).then(e=>{this.$message({message:$t("xwfqhy6","同步会员成功","lang"),type:"success"}),this.loading.syncMember=!1}).catch(e=>{this.loading.syncMember=!1})}},nodeClick:function(e){if(this.tableLoading)return;const{id:t,name:s}=e;this.getWorkMember(t,s)},checkAllChild:function(e,t=!1){const s=this.mapChildren(e.children,t);this.dealNodeKey(s)},mapChildren:function(e,t){const s=[];for(let a=0;a<e.length;a++)if(e[a].disabled||s.push({id:e[a].id,name:e[a].name}),e[a].children&&t){const t=this.mapChildren(e[a].children);s.push(...t)}return s},dealNodeKey:function(e){let t=!0;const s=[...this.selectNodeKey];if(s.length>0)for(let a=0;a<e.length;a++){const i=s.findIndex(t=>t&&t.id===e[a].id);-1!==i?s.splice(i,1):t=!1}else t=!1;t||s.push(...e),this.selectNodeKey=s;const a=s.map(e=>e.id);this.$refs.elTree.setCheckedKeys(a)},changeChecked:function(e,t){const s=[...this.selectNodeKey],a=s.findIndex(t=>t&&t.id===e.id);-1!==a?s.splice(a,1):s.push({id:e.id,name:e.name}),this.selectNodeKey=s},mapChecked:function(e){const t=[],s=e.childNodes;if(e.checked&&t.push({name:e.data.name,id:e.data.id}),s&&s.length>0)for(let e=0;e<s.length;e++){const a=this.mapChecked(s[e]);t.push(...a)}return t},syncAllCheck:function(e){const{data:t}=e;this.departmentId={id:t.id,name:t.name},this.dialogFormVisible=!0,this.param.page=1,this.param.name="",this.getStoreList()},isSelectable:function(e){return e.mobile},selectAllMember:function(e){let t=this.selectMemberList;if(e.length>0){const s=e.filter(e=>!t.some(t=>t.userid===e.userid));t.push(...s)}else{const e=this.tableData,s=t.filter(t=>!e.some(e=>t.userid===e.userid));t=s}this.selectMemberList=t},selectMember:function(e){let t=this.selectMemberList;if(e.length>0){t=t.filter(e=>!this.tableData.some(t=>t.userid===e.userid));const s=e.filter(e=>!t.some(t=>t.userid===e.userid));t.push(...s)}else{const e=this.tableData,s=t.filter(t=>!e.some(e=>t.userid===e.userid));t=s}this.selectMemberList=t}}},l=(0,s(81656).A)(n,function(){var e=this,t=e._self._c;return t("div",{staticClass:"addressBook"},[t("div",{staticClass:"actButton"},[t("el-button",{attrs:{type:"primary",loading:e.isLoading},on:{click:function(t){return t.stopPropagation(),e.getAdressBook.apply(null,arguments)}}},[e._v($t("l1w07fb"," 获取企业微信通讯录 ","lang"))]),t("el-button",{attrs:{loading:e.loading.syncDepart},on:{click:function(t){return t.stopPropagation(),e.syncDepartToShop.apply(null,arguments)}}},[e._v($t("lksddib"," 同步选中部门到店铺 ","lang"))]),t("el-button",{attrs:{loading:e.loading.syncMember},on:{click:function(t){return t.stopPropagation(),e.syncMemberToGuide.apply(null,arguments)}}},[e._v($t("areiucb"," 同步选中成员到导购 ","lang"))])],1),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"main"},[t("el-tree",{ref:"elTree",staticClass:"elTree",attrs:{data:e.list,props:e.treeProps,"expand-on-click-node":!1,"node-key":"id","default-expand-all":"","check-strictly":"","show-checkbox":""},on:{check:e.changeChecked,"node-click":e.nodeClick},scopedSlots:e._u([{key:"default",fn:function({node:s,data:a}){return t("span",{staticClass:"custom-node"},[t("span",[e._v(e._s(s.label))]),t("span",[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:$t("lv0uera","切换直属下级全选状态","lang"),placement:"top-start"}},[t("i",{staticClass:"el-icon-sort",on:{click:function(t){return t.stopPropagation(),(()=>e.checkAllChild(a)).apply(null,arguments)}}})]),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:$t("dvqo1q8","切换子级全选状态","lang"),placement:"top-start"}},[t("i",{staticClass:"iconfont icon-qiehuan",on:{click:function(t){return t.stopPropagation(),(()=>e.checkAllChild(a,!0)).apply(null,arguments)}}})]),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:$t("8gg8nxb","同步当前部门到已有门店","lang"),placement:"top-start"}},[t("i",{staticClass:"iconfont icon-tongbu",on:{click:function(t){return t.stopPropagation(),(()=>e.syncAllCheck(s)).apply(null,arguments)}}})])],1)])}}])}),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticClass:"table"},[t("h3",{staticClass:"title"},[e._v(" "+e._s(e.title)+" ")]),t("el-table",{ref:"multipleTable",attrs:{height:"800",data:e.tableData},on:{select:e.selectMember,"select-all":e.selectAllMember}},[t("el-table-column",{attrs:{type:"selection",width:"55",selectable:e.isSelectable}}),t("el-table-column",{attrs:{prop:"name",label:$t("fqmy2","姓名","lang")}}),t("el-table-column",{attrs:{prop:"mobile",label:$t("ewbd43","手机号","lang")}})],1)],1)],1),t("el-dialog",{attrs:{title:$t("il7vsf4","选择门店","lang"),"custom-class":"dialog",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[t("el-input",{staticClass:"input-with-select",attrs:{placeholder:$t("kzcmxd7","请输入店铺名称","lang"),clearable:""},on:{clear:function(t){return e.pageChange(1)}},model:{value:e.param.name,callback:function(t){e.$set(e.param,"name",t)},expression:"param.name"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(t){return t.stopPropagation(),e.pageChange(1)}},slot:"append"})],1),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.storeList,expression:"loading.storeList"}]},[t("el-table",{attrs:{data:e.storeList,size:"small"}},[t("el-table-column",{attrs:{prop:"name",label:$t("jaxr3m4","门店名称","lang")}}),t("el-table-column",{attrs:{label:$t("hkxb2","操作","lang")},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{loading:e.loading.syncClub,type:"text"},on:{click:function(t){return t.stopPropagation(),e.syncToShop(s.row.distributor_id)}}},[e._v($t("qz8k998"," 同步至此店铺 ","lang"))])]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.total,"current-page":e.param.page},on:{"current-change":e.pageChange}})],1)],1)],1)],1)},[],!1,null,"2ef5070e",null),o=l.exports}}]);