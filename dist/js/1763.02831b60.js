"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[1763],{91763:function(t,e,a){a.r(e),a.d(e,{default:function(){return o}});a(44114),a(18111),a(61701),a(18237);var l=a(98818),i=a(5134),r={components:{imgPicker:a(87378).default},data(){return{activeName:"1",dataForm:{turntable_open:!1,long_term:!1,turntable_title:"",long_date:"",max_times_day:"",login_get_times:"",shopping_full:"",clear_times_after_end:!1},coupon_options:"",goods_options:"",upload_index:0,rotateBg:0,rotateGift:0,isCheck:!0,picsDialog:!1,isGetPics:!1,prize_type_options:[{value:"points",label:$t("l6uv2","积分","lang")},{value:"coupon",label:$t("c1zlc3","优惠券","lang")},{value:"coupons",label:$t("adq3rp4","优惠券包","lang")},{value:"thanks",label:$t("i9anry4","谢谢惠顾","lang")}],tableData:[],isB:!0,isP:!0,turntableData:{background_img:"",shadow_color:"rgba(254, 234, 149, 1)",line_color:"rgba(254, 234, 149, 1)",border_color:"rgba(193, 63, 7, 1)",pointer_img:"",describe:""}}},watch:{tableData(t){this.rotateBg=360/t.length/2,this.rotateGift=-(360/t.length-45)}},mounted(){this._getEffectiveCardList(),this._getSurntableconfig()},methods:{handelChangeUpdateContent(t){this.turntableData.describe=t},_getEffectiveCardList(){(0,l.getEffectiveCardList)({page_size:1e3}).then(t=>{this.coupon_options=t.data.data.list})},handleChangeType(t){this.isCheck=!1,t.row.prize_value="","coupons"===t.row.prize_type&&(t.row.prize_value=[]),setTimeout(()=>{this.isCheck=!0})},handleClickDel(t,e){this.tableData.splice(e,1)},handleClickAdd(){this.tableData.length>=8||this.tableData.push({prize_type:"",prize_name:"",prize_describe:"",prize_probability:0,prize_image:"",prize_url:"",prize_bgcolor:"",prize_value:"",goods_options:""})},_getSurntableconfig(){(0,i.getSurntableconfig)({}).then(t=>{if(Array.isArray(t))return;let e=t.data.data,a=e.prizes.map(t=>(t.prize_probability=t.prize_probability/100,t));this.tableData=a,this.rotateBg=360/e.prizes.length/2,this.rotateGift=-(360/e.prizes.length-45);let l={turntable_open:"1"==e.turntable_open,turntable_title:e.turntable_title,long_term:"1"==e.long_term,long_date:[1e3*e.start_time,1e3*e.end_time],login_get_times:e.login_get_times?e.login_get_times:"",shopping_full:e.shopping_full?e.shopping_full:"",clear_times_after_end:"1"==e.clear_times_after_end,max_times_day:e.max_times_day};e.prizes[0].dataForm&&(this.turntableData=e.prizes[0].dataForm),this.dataForm=l})},handleClickAddBackground(){this.isB=!0,this.isP=!1,this.picsDialog=!0,this.isGetPics=!0},handleClickDelBackground(){this.turntableData.background_img=""},handleClickAddPointer(){this.isB=!1,this.isP=!0,this.picsDialog=!0,this.isGetPics=!0},handleClickDelPointer(){this.turntableData.pointer_img=""},handleClickUpload(t){this.isB=!1,this.isP=!1,this.picsDialog=!0,this.isGetPics=!0,this.upload_index=t},pickPics(t){this.isB?this.turntableData.background_img=t.url:this.isP?this.turntableData.pointer_img=t.url:this.tableData[this.upload_index].prize_image=t.url,this.picsDialog=!1},closePicsDialog(){this.picsDialog=!1},async handleChangePrizaValue(t,e){let{data:a}=await(0,i.getGoodsbycoupon)(t.prize_value),{list:l}=a.data,r=l.map(t=>({value:t.item_id,label:t.item_name}));t.goods_options=r,t.prize_url="",this.tableData.splice(e,1,t)},handleClickSave(){let t=JSON.parse(JSON.stringify(this.tableData));if(100!==t.reduce((t,e)=>"number"==typeof t?t+e.prize_probability:t.prize_probability+e.prize_probability))return void this.$message.error($t("wd5yymd","中奖概况总和需要等于100","lang"));let e=t.map(t=>({...t,prize_probability:100*t.prize_probability,dataForm:this.turntableData})),a={turntable_open:this.dataForm.turntable_open?1:0,turntable_title:this.dataForm.turntable_title,long_term:this.dataForm.long_term?1:0,start_time:this.dataForm.long_date[0]/1e3,end_time:this.dataForm.long_date[1]/1e3,max_times_day:this.dataForm.max_times_day,login_get_times:this.dataForm.login_get_times?this.dataForm.login_get_times:-1,shopping_full:this.dataForm.shopping_full?this.dataForm.shopping_full:-1,clear_times_after_end:this.dataForm.clear_times_after_end?1:0,prizes:JSON.stringify(e)};(0,i.setSurntableconfig)(a).then(t=>{this.$message({message:$t("aghf564","保存成功","lang"),type:"success"})})}}},o=(0,a(81656).A)(r,function(){var t=this,e=t._self._c;return e("SpPage",{staticClass:"wheel"},[e("el-form",{ref:"dataForm",attrs:{model:t.dataForm,"label-width":"125px"}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:$t("u0gkel7","是否开启大转盘","lang")}},[e("el-switch",{model:{value:t.dataForm.turntable_open,callback:function(e){t.$set(t.dataForm,"turntable_open",e)},expression:"dataForm.turntable_open"}})],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:$t("jdki0m6","是否长期有效","lang")}},[e("el-switch",{model:{value:t.dataForm.long_term,callback:function(e){t.$set(t.dataForm,"long_term",e)},expression:"dataForm.long_term"}})],1)],1),e("el-col",{attrs:{span:12}},[t.dataForm.long_term?e("div",{staticStyle:{height:"40px","margin-bottom":"22px"}}):e("el-form-item",{attrs:{label:$t("e4httw4","活动周期","lang")}},[e("el-date-picker",{attrs:{type:"daterange","range-separator":"-","start-placeholder":$t("cd0ag54","开始日期","lang"),"end-placeholder":$t("gfhy2u4","结束日期","lang"),"value-format":"timestamp"},model:{value:t.dataForm.long_date,callback:function(e){t.$set(t.dataForm,"long_date",e)},expression:"dataForm.long_date"}})],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:$t("c0lds45","大转盘标题","lang")}},[e("el-input",{attrs:{maxlength:"20"},model:{value:t.dataForm.turntable_title,callback:function(e){t.$set(t.dataForm,"turntable_title",e)},expression:"dataForm.turntable_title"}})],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:$t("xuuvgp8","每天最大抽奖次数","lang")}},[e("el-input",{attrs:{maxlength:"20"},model:{value:t.dataForm.max_times_day,callback:function(e){t.$set(t.dataForm,"max_times_day",e)},expression:"dataForm.max_times_day"}})],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:$t("mzxlgv7","登录送抽奖次数","lang")}},[e("el-input",{attrs:{maxlength:"20"},model:{value:t.dataForm.login_get_times,callback:function(e){t.$set(t.dataForm,"login_get_times",e)},expression:"dataForm.login_get_times"}})],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:""}},[e("div",{staticClass:"op"})])],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:$t("l8hhh3","购物满","lang")}},[e("el-input",{attrs:{maxlength:"20"},model:{value:t.dataForm.shopping_full,callback:function(e){t.$set(t.dataForm,"shopping_full",e)},expression:"dataForm.shopping_full"}})],1)],1),e("el-col",{staticClass:"line-height__40",attrs:{span:6}},[t._v($t("dhuqvpb"," 元获取一次抽奖次数 ","lang"))]),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:$t("7orodib","活动结束时清空抽奖次数","lang"),"label-width":"170px"}},[e("el-switch",{model:{value:t.dataForm.clear_times_after_end,callback:function(e){t.$set(t.dataForm,"clear_times_after_end",e)},expression:"dataForm.clear_times_after_end"}})],1)],1)],1)],1),e("div",{staticClass:"wheel-con"},[e("el-tabs",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[e("el-tab-pane",{attrs:{label:$t("bwogdg4","奖项配置","lang"),name:"1"}},[e("div",{staticClass:"wheel-con__table"},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData}},[e("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),width:"100"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){return t.handleClickDel(a.row,a.$index)}}},[t._v($t("db22k4"," 删除 ","lang"))])]}}])}),e("el-table-column",{attrs:{label:$t("bwkp034","奖项类型","lang"),width:"140"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-select",{on:{change:function(e){return t.handleChangeType(a)}},model:{value:a.row.prize_type,callback:function(e){t.$set(a.row,"prize_type",e)},expression:"scope.row.prize_type"}},t._l(t.prize_type_options,function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)]}}])}),e("el-table-column",{attrs:{label:$t("bwe0864","奖项名称","lang"),width:"130"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-input",{attrs:{maxlength:"4"},model:{value:a.row.prize_name,callback:function(e){t.$set(a.row,"prize_name",e)},expression:"scope.row.prize_name"}})]}}])}),e("el-table-column",{attrs:{label:$t("bwgt2c4","奖项描述","lang"),width:"130"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-input",{model:{value:a.row.prize_describe,callback:function(e){t.$set(a.row,"prize_describe",e)},expression:"scope.row.prize_describe"}})]}}])}),e("el-table-column",{attrs:{label:$t("bzfa4ae","中奖概率  0-100的整数","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-input-number",{attrs:{controls:!1,min:0,max:100},model:{value:a.row.prize_probability,callback:function(e){t.$set(a.row,"prize_probability",e)},expression:"scope.row.prize_probability"}})]}}])}),e("el-table-column",{attrs:{label:$t("dtfw93","奖项值","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return t.isCheck?["points"===a.row.prize_type?e("el-input",{model:{value:a.row.prize_value,callback:function(e){t.$set(a.row,"prize_value",e)},expression:"scope.row.prize_value"}}):t._e(),"coupon"===a.row.prize_type?e("el-select",{attrs:{filterable:"",placeholder:$t("l72nr3","请选择","lang")},on:{change:function(e){return t.handleChangePrizaValue(a.row,a.$index)}},model:{value:a.row.prize_value,callback:function(e){t.$set(a.row,"prize_value",e)},expression:"scope.row.prize_value"}},t._l(t.coupon_options,function(t){return e("el-option",{key:t.card_id,attrs:{label:t.title,value:t.card_id}})}),1):t._e(),"coupons"===a.row.prize_type?e("el-select",{attrs:{multiple:"",filterable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:a.row.prize_value,callback:function(e){t.$set(a.row,"prize_value",e)},expression:"scope.row.prize_value"}},t._l(t.coupon_options,function(t){return e("el-option",{key:t.card_id,attrs:{label:t.title,value:t.card_id}})}),1):t._e()]:void 0}}],null,!0)}),e("el-table-column",{attrs:{prop:"address",label:$t("ff9l2","图片","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",[e("el-image",{staticStyle:{width:"30px",height:"30px"},attrs:{src:a.row.prize_image,fit:"fill"}})],1),e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.handleClickUpload(a.$index)}}},[t._v($t("evisox6"," 图片上传 ","lang"))])]}}])}),e("el-table-column",{attrs:{prop:"address",label:$t("i5lh9n4","设置商品","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return["coupon"===a.row.prize_type&&a.row.goods_options.length>0?e("el-select",{attrs:{placeholder:$t("l72nr3","请选择","lang")},model:{value:a.row.prize_url,callback:function(e){t.$set(a.row,"prize_url",e)},expression:"scope.row.prize_url"}},t._l(a.row.goods_options,function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1):t._e()]}}])})],1),e("el-button",{staticClass:"add-prize",attrs:{type:"primary"},on:{click:t.handleClickAdd}},[t._v($t("h2eu34"," 添加 ","lang"))])],1)]),e("el-tab-pane",{attrs:{label:$t("c0s9jo5","大转盘配置","lang"),name:"2"}},[e("div",{staticClass:"wheel-con__turntable"},[e("div",{staticClass:"turntable-box"},[e("div",{staticClass:"turntable-box__background"},[t.turntableData.background_img?e("el-image",{attrs:{src:t.turntableData.background_img,fit:"contain"}}):t._e()],1),e("div",{staticClass:"turntable-box__con"},[e("div",{staticClass:"turntable",style:{border:`5px solid ${t.turntableData.border_color}`,"box-shadow":`0px 0px 5px 5px ${t.turntableData.shadow_color}`}},[e("ul",{staticClass:"turntable-bg",style:{transform:`rotate(${t.rotateBg}deg)`}},t._l(t.tableData,function(a,l){return e("li",{key:l,style:{transform:`rotate(${360/t.tableData.length*(l+1)}deg)`,background:`${t.turntableData.line_color}`}})}),0),e("ul",{staticClass:"turntable-gift",style:{transform:`rotate(${t.rotateGift}deg)`}},t._l(t.tableData,function(a,l){return e("li",{key:l,class:{"even-numbers":l%2==0},style:{transform:`rotate(${360/t.tableData.length*(l+1)}deg)`}},[e("div",{staticClass:"div-text"},[e("div",[t._v(t._s(a.prize_name))]),e("img",{attrs:{src:a.prize_image}})])])}),0),e("div",{staticClass:"turntable_pointer"},[t.turntableData.pointer_img?e("el-image",{staticStyle:{width:"100%",height:"100%"},attrs:{src:t.turntableData.pointer_img,fit:"fill"}}):t._e()],1)]),e("div",{staticClass:"turntable-box__con-describe",domProps:{innerHTML:t._s(t.turntableData.describe)}})])]),e("div",{staticClass:"turntable-setup"},[e("el-form",{ref:"turntableData",attrs:{model:t.turntableData,"label-width":"120px"}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:24}},[e("el-form-item",{attrs:{label:$t("mgwz2","背景","lang")}},[e("el-button",{attrs:{size:"mini"},on:{click:t.handleClickAddBackground}},[t._v($t("4xbx0q7"," 添加背景图 ","lang"))]),t.turntableData.background_img?e("el-button",{attrs:{size:"mini"},on:{click:t.handleClickDelBackground}},[t._v($t("iwm7xl7"," 删除背景图 ","lang"))]):t._e()],1)],1),e("el-col",{attrs:{span:24}},[e("el-form-item",{attrs:{label:$t("mgwz2","背景","lang")}},[e("el-button",{attrs:{size:"mini"},on:{click:t.handleClickAddPointer}},[t._v($t("ogx93r6"," 上传指针 ","lang"))]),t.turntableData.pointer_img?e("el-button",{attrs:{size:"mini"},on:{click:t.handleClickDelPointer}},[t._v($t("hss8r6"," 删除指针 ","lang"))]):t._e()],1)],1),e("el-col",{attrs:{span:8}},[e("el-form-item",{attrs:{label:$t("iklqkj4","边框颜色","lang")}},[e("el-color-picker",{attrs:{"show-alpha":""},model:{value:t.turntableData.border_color,callback:function(e){t.$set(t.turntableData,"border_color",e)},expression:"turntableData.border_color"}})],1)],1),e("el-col",{attrs:{span:8}},[e("el-form-item",{attrs:{label:$t("jcqh8z4","阴影颜色","lang")}},[e("el-color-picker",{attrs:{"show-alpha":""},model:{value:t.turntableData.shadow_color,callback:function(e){t.$set(t.turntableData,"shadow_color",e)},expression:"turntableData.shadow_color"}})],1)],1),e("el-col",{attrs:{span:8}},[e("el-form-item",{attrs:{label:$t("nicp5j5","分割线颜色","lang")}},[e("el-color-picker",{attrs:{"show-alpha":""},model:{value:t.turntableData.line_color,callback:function(e){t.$set(t.turntableData,"line_color",e)},expression:"turntableData.line_color"}})],1)],1),e("el-col",{attrs:{span:24}},[e("el-form-item",{attrs:{label:$t("e4ko7i4","活动描述","lang")}},[e("SpRichText",{model:{value:t.turntableData.describe,callback:function(e){t.$set(t.turntableData,"describe",e)},expression:"turntableData.describe"}})],1)],1)],1)],1)],1)])])],1)],1),e("div",{staticClass:"wheel-save"},[e("el-button",{attrs:{type:"danger"},on:{click:t.handleClickSave}},[t._v($t("cp35x4"," 保存 ","lang"))])],1),e("imgPicker",{attrs:{"dialog-visible":t.picsDialog,"sc-status":t.isGetPics,"is-most":!1},on:{chooseImg:t.pickPics,closeImgDialog:t.closePicsDialog}})],1)},[],!1,null,"4be6c88c",null).exports}}]);