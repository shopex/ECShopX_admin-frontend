"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[2304],{92304:function(t,e,l){l.r(e),l.d(e,{default:function(){return o}});var s=l(1243),a=l(57270),i=l(432),n={components:{draggable:l.n(i)()},data(){return{version:6,dragOptions:{animation:120,disabled:!0,scroll:!0,group:"sortlist",ghostClass:"ghost-style"},isDisabledUpdateUrl:!0,isEdit:!1,editApisVisible:!1,editVisible:!1,disabledIsMenu:!1,draggableDisabled:$t("b3vvaj4","启用拖动","lang"),parent_name:$t("k4g1","无","lang"),colspan:0,setApisForm:{shopmenu_id:"",is_menu:!0,apis:""},form:{},shopmenulist:[],tableData:[]}},created(){this.getMenuTrees()},methods:{getMenuTrees(){let t={version:this.version};(0,s.getShopMenu)(t).then(t=>{this.tableData=t.list,this.shopmenulist=t.list})},uploadHandleChange(t,e){let l={isUploadFile:!0,file:t.raw,version:this.version};(0,s.uploadMenu)(l).then(t=>{this.getMenuTrees()})},handleDraggableDisabled(){this.dragOptions.disabled?(this.dragOptions.disabled=!1,this.draggableDisabled=$t("ftcbyx4","禁用拖动","lang")):(this.dragOptions.disabled=!0,this.draggableDisabled=$t("b3vvaj4","启用拖动","lang"))},handleDownMenu(){(0,s.downMenu)(this.version)},handleMoveEndCheck(t){if(t.newIndex==t.oldIndex)return;let e,l,i;if(t.newIndex>t.oldIndex?(e=this.shopmenulist[t.oldIndex],l=this.shopmenulist[t.newIndex],i=this.shopmenulist[t.newIndex+1]):(e=this.shopmenulist[t.oldIndex],l=this.shopmenulist[t.newIndex-1],i=this.shopmenulist[t.newIndex]),!e.is_menu)return(0,a.Message)({message:$t("nnyk89j","功能页面不可移动，只能跟着上级菜单移动","lang"),type:"success",duration:5e3}),void(this.tableData=this.shopmenulist);if(l||0!=e.pid)if(e.level==l.level&&l.isChildrenMenu==e.isChildrenMenu)e.sort=l.sort+1,e.pid=l.pid;else{if((e.level!=l.level||l.isChildrenMenu==e.isChildrenMenu)&&e.level-1!=l.level)return this.tableData=this.shopmenulist,void(0,a.Message)({message:$t("6l62k5c","只能移动到相同级别的菜单","lang"),type:"error",duration:5e3});e.sort=i?i.sort-1:1,e.pid=l.shopmenu_id}else e.sort=this.shopmenulist[t.newIndex+1].sort-1;(0,s.saveMenu)(!0,e).then(t=>{this.getMenuTrees()})},handleUrlDisabled(){this.isDisabledUpdateUrl=!1,(0,a.Message)({message:$t("hzagx09","解锁更新URL成功","lang"),type:"success",duration:5e3})},handleCellClassName({row:t,column:e,rowIndex:l,columnIndex:s}){if(0===s)return"level-"+t.level},handleSetApis(t){this.editApisVisible=!0,this.setApisForm.apis=t.apis,this.setApisForm.shopmenu_id=t.shopmenu_id,this.setApisForm.is_menu=t.is_menu},actionSetMenuApis(){(0,s.saveMenu)(!0,this.setApisForm).then(t=>{this.editApisVisible=!1,this.getMenuTrees()})},handleUpdateMenu(t){this.parent_name=t.parent_name,this.editVisible=!0,t.level>=3||1==t.level?this.disabledIsMenu=!0:this.disabledIsMenu=!1,this.isEdit=!0,this.form=t},handleAddSubMenu(t){this.isEdit=!1,this.form={version:this.version,is_menu:!0,is_show:!0,pid:0,name:"",alias_name:"",menu_type:t.menu_type,parentUrl:t.url,url:"",sort:1},t.level>=3?(this.form.is_menu=!1,this.disabledIsMenu=!0):(this.form.is_menu=!0,this.disabledIsMenu=!1),this.editVisible=!0,this.parent_name=t.name,this.form.pid=t.shopmenu_id},handleAddMenu(){this.isEdit=!1,this.form={version:this.version,is_menu:!0,is_show:!0,pid:0,name:"",alias_name:"",menu_type:["all"],url:"",sort:1},this.disabledIsMenu=!0,this.editVisible=!0},acitonDeleteMenu(t){this.$confirm($t("7nqvtii","此操作将=删 除该菜单, 是否继续?","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(()=>{(0,s.deleteMenu)(t).then(t=>{this.getMenuTrees()})})},actionSaveMenu(){this.form.url&&"/"!==this.form.url[0]&&(this.form.url=`/${this.form.url}`),this.form.parentUrl&&(this.form.url=this.form.parentUrl+this.form.url),(0,s.saveMenu)(this.isEdit,this.form).then(t=>{this.editVisible=!1,this.getMenuTrees()})}}},o=(0,l(81656).A)(n,function(){var t=this,e=t._self._c;return e("SpPage",{staticClass:"table"},[e("div",{staticClass:"container"},[e("div",{staticClass:"handle-box"},[e("el-button",{attrs:{type:"primary"},on:{click:t.handleAddMenu}},[t._v($t("zdship8"," 添加顶级菜单 ","lang"))]),e("el-button",{attrs:{type:"info"},on:{click:t.handleUrlDisabled}},[t._v($t("x0o2ysb"," 解锁更新菜单URL ","lang"))]),t.dragOptions.disabled?e("el-button",{attrs:{type:"danger"},on:{click:t.handleDraggableDisabled}},[t._v(" "+t._s(t.draggableDisabled)+" ")]):e("el-button",{attrs:{type:"success"},on:{click:t.handleDraggableDisabled}},[t._v(" "+t._s(t.draggableDisabled)+" ")]),e("el-button",{attrs:{type:"primary"},on:{click:t.handleDownMenu}},[t._v($t("7gr5nt7"," 下载版本配置","lang")),e("i",{staticClass:"el-icon-download el-icon--right"})]),e("el-upload",{staticStyle:{"margin-right":"10px",float:"right"},attrs:{action:"","on-change":t.uploadHandleChange,"auto-upload":!1,"show-file-list":!1}},[e("el-button",{attrs:{type:"primary"}},[t._v($t("gr2h3"," 导入","lang")),e("i",{staticClass:"el-icon-upload el-icon--right"})])],1)],1),e("div",{staticClass:"el-table el-table--fit el-table--border el-table--enable-row-transition el-table--small",staticStyle:{width:"100%"}},[e("div",{staticClass:"el-table__header-wrapper"},[e("table",{staticClass:"el-table__header",attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[e("colgroup",[e("col",{attrs:{name:"el-table_5_column_31",width:"220"}}),e("col",{attrs:{name:"el-table_5_column_32",width:"230"}}),e("col",{attrs:{name:"el-table_5_column_33",width:"100"}}),e("col",{attrs:{name:"el-table_5_column_34",width:"100"}}),e("col",{attrs:{name:"el-table_5_column_35",width:"100"}}),e("col",{attrs:{name:"el-table_5_column_36",width:"100"}}),e("col",{attrs:{name:"el-table_5_column_37",width:"927"}})]),e("thead",{},[e("tr",{},[e("th",{staticClass:"el-table_5_column_31 is-leaf",attrs:{colspan:"1",rowspan:"1"}},[e("div",{staticClass:"cell",staticStyle:{width:"210px"}},[t._v($t("gzcenw4","菜单名称","lang"))])]),e("th",{staticClass:"el-table_5_column_32 is-leaf",attrs:{colspan:"1",rowspan:"1"}},[e("div",{staticClass:"cell",staticStyle:{width:"220px"}},[t._v($t("sv23zq5","菜单URL","lang"))])]),e("th",{staticClass:"el-table_5_column_33 is-leaf",attrs:{colspan:"1",rowspan:"1"}},[e("div",{staticClass:"cell",staticStyle:{width:"80px"}},[t._v($t("d8sxjn4","是否显示","lang"))])]),e("th",{staticClass:"el-table_5_column_34 is-leaf",attrs:{colspan:"1",rowspan:"1"}},[e("div",{staticClass:"cell",staticStyle:{width:"80px"}},[t._v($t("qgd12","顺序","lang"))])]),e("th",{staticClass:"el-table_5_column_35 is-leaf",attrs:{colspan:"1",rowspan:"1"}},[e("div",{staticClass:"cell",staticStyle:{width:"80px"}},[t._v($t("fp7t6s5","是否为菜单","lang"))])]),e("th",{staticClass:"el-table_5_column_36 is-leaf",attrs:{colspan:"1",rowspan:"1"}},[e("div",{staticClass:"cell",staticStyle:{width:"80px"}},[t._v($t("gzj3ft4","菜单类型","lang"))])]),e("th",{staticClass:"el-table_5_column_37 is-leaf",attrs:{colspan:"1",rowspan:"1"}},[e("div",{staticClass:"cell"},[t._v($t("hkxb2","操作","lang"))])])])])])])]),e("draggable",{attrs:{options:t.dragOptions},on:{end:t.handleMoveEndCheck}},[e("transition-group",{attrs:{tag:"div"}},t._l(t.tableData,function(l){return e("div",{key:l.shopmenu_id},[e("div",{staticClass:"el-table el-table--fit el-table--border el-table--enable-row-transition el-table--small",staticStyle:{width:"100%"}},[e("div",{staticClass:"el-table__body-wrapper"},[e("table",{staticClass:"el-table__body",attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[e("colgroup",[e("col",{attrs:{name:"el-table_5_column",width:"220"}}),e("col",{attrs:{name:"el-table_5_column",width:"230"}}),e("col",{attrs:{name:"el-table_5_column",width:"100"}}),e("col",{attrs:{name:"el-table_5_column",width:"100"}}),e("col",{attrs:{name:"el-table_5_column",width:"100"}}),e("col",{attrs:{name:"el-table_5_column",width:"100"}}),e("col",{attrs:{name:"el-table_5_column",width:"927"}})]),e("thead",{},[e("tr",{staticStyle:{"font-size":"12px",color:"#606266","font-weight":"400"}},[e("td",{staticClass:"el-table_5_column_31",attrs:{colspan:"1",rowspan:"1"}},[1==l.level?e("div",{staticClass:"cell",staticStyle:{"padding-left":"10px",width:"210px"}},[t._v(" "+t._s(l.name)+" ")]):t._e(),2==l.level?e("div",{staticClass:"cell",staticStyle:{"padding-left":"40px",width:"210px"}},[t._v(" "+t._s(l.name)+" ")]):t._e(),3==l.level?e("div",{staticClass:"cell",staticStyle:{"padding-left":"70px",width:"210px"}},[t._v(" "+t._s(l.name)+" ")]):t._e(),4==l.level?e("div",{staticClass:"cell",staticStyle:{"padding-left":"100px",width:"210px"}},[t._v(" "+t._s(l.name)+" ")]):t._e()]),e("td",{staticClass:"el-table_5_column_32 is-leaf",attrs:{colspan:"1",rowspan:"1"}},[e("div",{staticClass:"cell",staticStyle:{width:"220px"}},[t._v(" "+t._s(l.url)+" ")])]),e("td",{staticClass:"el-table_5_column_33 is-leaf",attrs:{colspan:"1",rowspan:"1"}},[l.is_show?e("div",{staticClass:"cell",staticStyle:{width:"80px"}},[t._v($t("i20s2","显示","lang"))]):e("div",{staticClass:"cell",staticStyle:{width:"80px"}},[t._v($t("qce72","隐藏","lang"))])]),e("td",{staticClass:"el-table_5_column_34 is-leaf",attrs:{colspan:"1",rowspan:"1"}},[e("div",{staticClass:"cell",staticStyle:{width:"80px"}},[t._v(" "+t._s(l.sort)+" ")])]),e("td",{staticClass:"el-table_5_column_35 is-leaf",attrs:{colspan:"1",rowspan:"1"}},[l.is_menu?e("div",{staticClass:"cell",staticStyle:{width:"80px"}},[t._v($t("mvw92","菜单","lang"))]):e("div",{staticClass:"cell",staticStyle:{width:"80px"}},[t._v($t("jutz0r4","页面功能","lang"))])]),e("td",{staticClass:"el-table_5_column_36 is-leaf",attrs:{colspan:"1",rowspan:"1"}},t._l(l.menu_type,function(l,s){return e("div",{key:s,staticClass:"cell",staticStyle:{width:"80px"}},["b2c"===l?[t._v($t("66rjrw6"," 品牌官网 ","lang"))]:t._e(),"platform"===l?[t._v(" ECX ")]:t._e(),"standard"===l?[t._v($t("cisuy4"," 云店 ","lang"))]:t._e(),"in_purchase"===l?[t._v($t("bcyn285"," 内购版 ","lang"))]:t._e(),"all"===l?[t._v($t("m87ea4"," 通用 ","lang"))]:t._e()],2)}),0),e("td",{staticClass:"el-table_5_column_37 is-leaf",attrs:{colspan:"1",rowspan:"1"}},[e("div",{staticClass:"cell"},[l.is_menu&&l.level<=3?e("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){return t.handleAddSubMenu(l)}}},[t._v($t("bf6ak7"," 添加子菜单 ","lang"))]):t._e(),e("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){return t.handleUpdateMenu(l)}}},[t._v($t("xhr4zw6"," 编辑菜单 ","lang"))]),e("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){return t.handleSetApis(l)}}},[t._v($t("4xycs97"," API权限 ","lang"))]),e("el-button",{staticClass:"red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(e){return t.acitonDeleteMenu(l.shopmenu_id)}}},[t._v($t("db22k4"," 删除 ","lang"))])],1)])])])])])])])}),0)],1),e("el-dialog",{attrs:{title:$t("fnrzca","设置菜单API权限集","lang"),visible:t.editApisVisible,width:"30%"},on:{"update:visible":function(e){t.editApisVisible=e}}},[e("el-form",{ref:"form",attrs:{model:t.form,"label-width":"100px"}},[e("el-alert",{attrs:{title:$t("66l29bm","设置菜单API权限集，请添加每个API后回车","lang"),type:"info","close-text":$t("i96ig3","知道了","lang")}}),e("el-input",{attrs:{type:"textarea",rows:15,placeholder:$t("2jbrwj5","请输入内容","lang")},model:{value:t.setApisForm.apis,callback:function(e){t.$set(t.setApisForm,"apis",e)},expression:"setApisForm.apis"}})],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.editApisVisible=!1}}},[t._v($t("caoqm3","取 消","lang"))]),e("el-button",{attrs:{type:"primary"},on:{click:t.actionSetMenuApis}},[t._v($t("hnjoo3","确 定","lang"))])],1)],1),e("el-dialog",{attrs:{title:$t("620dbq7","添加&更新菜单","lang"),visible:t.editVisible,width:"40%"},on:{"update:visible":function(e){t.editVisible=e}}},[e("el-form",{ref:"form",attrs:{model:t.form,"label-width":"100px"}},[e("el-form-item",{attrs:{label:$t("adj5w64","上级菜单","lang")}},[e("span",[t._v(t._s(t.parent_name))])]),e("el-form-item",{attrs:{label:$t("gzcenw4","菜单名称","lang")}},[e("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),e("el-form-item",{attrs:{label:$t("gzj3ft4","菜单类型","lang")}},[e("el-checkbox-group",{model:{value:t.form.menu_type,callback:function(e){t.$set(t.form,"menu_type",e)},expression:"form.menu_type"}},[e("el-checkbox",{attrs:{label:"all"}},[t._v($t("p5ji2","通用","lang"))]),e("el-checkbox",{attrs:{label:"b2c"}},[t._v($t("b6112c4","品牌官网","lang"))]),e("el-checkbox",{attrs:{label:"platform"}},[t._v("ECX")]),e("el-checkbox",{attrs:{label:"standard"}},[t._v($t("dvs62","云店","lang"))]),e("el-checkbox",{attrs:{label:"in_purchase"}},[t._v($t("cmhog3","内购版","lang"))])],1)],1),e("el-form-item",{attrs:{label:$t("hmh8c76","菜单唯一标识","lang")}},[e("el-input",{model:{value:t.form.alias_name,callback:function(e){t.$set(t.form,"alias_name",e)},expression:"form.alias_name"}})],1),e("el-form-item",{attrs:{label:$t("gzct4y4","菜单图标","lang")}},[e("el-input",{model:{value:t.form.icon,callback:function(e){t.$set(t.form,"icon",e)},expression:"form.icon"}})],1),e("el-form-item",{attrs:{label:$t("gzewae4","菜单排序","lang")}},[e("el-input",{model:{value:t.form.sort,callback:function(e){t.$set(t.form,"sort",e)},expression:"form.sort"}})],1),e("el-form-item",{attrs:{label:$t("sv23zq5","菜单URL","lang")}},[e("div",{staticClass:"view-flex"},[e("div",{staticClass:"parent-path"},[t._v(" "+t._s(t.form.parentUrl)+" ")]),t.isEdit?e("el-input",{attrs:{disabled:t.isDisabledUpdateUrl},model:{value:t.form.url,callback:function(e){t.$set(t.form,"url",e)},expression:"form.url"}}):e("el-input",{model:{value:t.form.url,callback:function(e){t.$set(t.form,"url",e)},expression:"form.url"}})],1)]),t.disabledIsMenu?t._e():e("el-form-item",{attrs:{label:$t("fp7t6s5","是否为菜单","lang")}},[e("el-switch",{model:{value:t.form.is_menu,callback:function(e){t.$set(t.form,"is_menu",e)},expression:"form.is_menu"}})],1),e("el-form-item",{attrs:{label:$t("d8sxjn4","是否显示","lang")}},[e("el-switch",{model:{value:t.form.is_show,callback:function(e){t.$set(t.form,"is_show",e)},expression:"form.is_show"}})],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.editVisible=!1}}},[t._v($t("caoqm3","取 消","lang"))]),e("el-button",{attrs:{type:"primary"},on:{click:t.actionSaveMenu}},[t._v($t("hnjoo3","确 定","lang"))])],1)],1)],1)])},[],!1,null,null,null).exports}}]);