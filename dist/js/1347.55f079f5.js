"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[1347],{31347:function(t,e,a){a.r(e),a.d(e,{default:function(){return i}});var l=a(95353),n=a(28308),s={data(){return{pane_list:[{name:"normal_goods",label:$t("udjz637","上传实体类商品","lang")}],loading:!1,total_count:0,pageSize:20,page:1,activeName:"normal_goods",uploadList:[],flie:{file_type:"update_distribution_item",file_name:$t("wfbqwq6","更新店铺商品","lang")}}},computed:{...(0,l.L8)(["wheight"])},mounted(){this.getUploadList()},methods:{handleClick(){this.getUploadList()},async uploadHandleChange(t,e){let a={isUploadFile:!0,file_type:"update_distribution_item",file:t.raw};await(0,n.uploadFiles)(a),this.$message({type:"success",message:$t("dn5eu39","上传成功，等待处理","lang")}),this.getUploadList()},async uploadHandleTemplate(){try{const{status:t,data:e}=await(0,n.getTemplate)(this.flie);if(200===t){const t=document.createElement("a");t.href=e.data.file,t.download=e.data.name,document.body.appendChild(t),t.click(),t.remove()}}catch(t){this.$message({type:"error",message:$t("yndnt89","没有相关数据可导出","lang")})}},async exportErrorFile(t,e){let a={file_type:e};try{const{data:e}=await(0,n.exportUploadErrorFile)(t,a);let l=document.createElement("a");l.href=e.data.file,l.download=e.data.name,document.body.appendChild(l),l.click(),l.remove()}catch(t){this.$message({type:"error",message:$t("yndnt89","没有相关数据可导出","lang")})}},handleCurrentChange(t){this.page=t,this.getUploadList()},async getUploadList(){this.loading=!0;let t={file_type:this.flie.file_type,page:this.page,pageSize:this.pageSize};const{data:e,status:a}=await(0,n.getFlieList)(t);200===a&&(this.uploadList=e.data.list,this.total_count=e.data.total_count,this.loading=!1)}}},i=(0,a(81656).A)(s,function(){var t=this,e=t._self._c;return e("SpPage",[e("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[e("div",{staticClass:"tip-info"},[e("p",[t._v($t("flzk9x1f"," 上传文件如果有处理失败的行数后将会生成错误文件，请及时查看错误信息修改后重新下载，错误描述文件只保留","lang")),e("strong",[t._v($t("1j7p3","15天","lang"))]),t._v("。 ")]),e("p",[t._v($t("ouzm2","超过","lang")),e("strong",[t._v($t("1j7p3","15天","lang"))]),t._v($t("84meojk","的错误描述文件将会删除，不再提供下载查看","lang"))])]),t._l(t.pane_list,function(a){return e("div",{key:a.label},[e("el-tab-pane",{attrs:{label:a.label,name:a.name}},[e("el-form",{ref:"form",refInFor:!0,attrs:{"label-width":"100px"}},[e("div",{staticClass:"content-bottom-padded flex"},[e("el-upload",{staticClass:"fl",staticStyle:{"margin-right":"10px"},attrs:{action:"","on-change":t.uploadHandleChange,"auto-upload":!1,"show-file-list":!1}},[e("el-button",{attrs:{size:"small",type:"primary"}},[t._v($t("unjubc6"," 点击上传 ","lang"))])],1),e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.uploadHandleTemplate()}}},[t._v($t("gb8vax6"," 下载模版 ","lang"))])],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.uploadList,height:t.wheight-220,"element-loading-text":$t("go5gpa5","数据加载中","lang")}},[e("el-table-column",{attrs:{prop:"file_name",label:$t("a6fdb94","上传文件","lang"),"min-width":"100"}}),e("el-table-column",{attrs:{prop:"created_date",label:$t("a6ftzo4","上传时间","lang"),"min-width":"80"}}),e("el-table-column",{attrs:{prop:"file_size_format",label:$t("d4zx3r4","文件大小","lang"),"min-width":"60"}}),e("el-table-column",{attrs:{label:$t("bpqivh4","处理状态","lang"),"min-width":"50"},scopedSlots:t._u([{key:"default",fn:function(a){return["wait"==a.row.handle_status?e("span",[t._v($t("fy7x7i4","等待处理","lang"))]):t._e(),"processing"==a.row.handle_status?e("span",[t._v($t("dljhn3","处理中","lang"))]):t._e(),"finish"==a.row.handle_status?e("span",[t._v($t("bpmlfq4","处理完成","lang"))]):t._e()]}}],null,!0)}),e("el-table-column",{attrs:{prop:"finish_date",label:$t("w8vqkk6","处理完成时间","lang")}}),e("el-table-column",{attrs:{label:$t("bpnma94","处理成功","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.handle_message?e("span",[t._v(t._s(a.row.handle_message.successLine)+$t("qx81","行","lang"))]):t._e()]}}],null,!0)}),e("el-table-column",{attrs:{label:$t("bpmfiu4","处理失败","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.handle_message?e("span",[t._v(t._s(a.row.handle_message.errorLine)+$t("qx81","行","lang"))]):t._e(),a.row.handle_message&&a.row.handle_message.errorLine>0?e("a",{staticClass:"error_a",attrs:{type:"primary"},on:{click:function(e){return t.exportErrorFile(a.row.id,a.row.file_type)}}},[t._v($t("ols2cn6","下载错误详情","lang"))]):t._e()]}}],null,!0)})],1),t.total_count>t.pageSize?e("div",{staticClass:"content-top-padded content-center"},[e("el-pagination",{attrs:{layout:"total, prev, pager, next",total:t.total_count,"page-size":t.pageSize},on:{"current-change":t.handleCurrentChange}})],1):t._e()],1)],1)],1)})],2)],1)},[],!1,null,null,null).exports}}]);