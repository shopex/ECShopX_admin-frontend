"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[9269],{59269:function(t,e,a){a.r(e),a.d(e,{default:function(){return w}});var i=a(50002),s={props:["activeName","getStatus"],data(){return{loading:!1,isLoadData:!1,videoList:{},total_count:0,params:{type:"video",page:1,pageSize:20},uploadDialog:!1,videoForm:{title:"",description:""}}},watch:{getStatus(t,e){t&&this.getList()}},methods:{handleCurrentChange(t){this.isLoadData=!1,this.params.page=t,this.getList()},handleSizeChange(t){this.isLoadData=!1,this.params.page=1,this.params.pageSize=t,this.getList()},uploadVideo(t,e){if(this.videoForm.title.length<=0)return void this.$message({message:$t("lu0ubi6","视频标题必填","lang"),type:"error"});if(this.videoForm.description.length<=0)return void this.$message({message:$t("meg3ce6","视频描述必填","lang"),type:"error"});this.isLoadData=!0,this.videoForm.isUploadFile=!0,this.videoForm.file=t.raw,this.videoForm.type="video",(0,i.uploadMaterial)(this.videoForm).then(t=>{this.isLoadData=!1,this.uploadDialog=!1,this.getList()}).catch(function(t){this.isLoadData=!1})},getList(){this.isLoadData||(this.loading=!0,(0,i.getWechatMaterial)(this.params).then(t=>{this.videoList=t.data.data,this.total_count=t.data.data.total_count,this.isLoadData=!1,this.loading=!1}).catch(function(t){this.loading=!1}))},removeItem(t,e){this.$confirm($t("xoqr539","确定删除此视频吗？","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(()=>{(0,i.deleteWechatMaterial)({media_id:t.media_id}).then(t=>{this.videoList.item.splice(e,1),this.$message({message:$t("azeh8z4","删除成功","lang"),type:"success",duration:5e3})})}).catch(()=>{this.$message({type:"info",message:$t("e68dg3","已取消","lang")})})},addVideo(){this.uploadDialog=!0},handleCancel(){this.uploadDialog=!1}}},l=a(81656),o=(0,l.A)(s,function(){var t=this,e=t._self._c;return e("div",{staticClass:"video_pick_panel section-white"},[e("el-button",{attrs:{type:"primary",icon:"plus"},on:{click:t.addVideo}},[t._v($t("ob89c16"," 上传视频 ","lang"))]),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"video_pick"},[e("ul",{staticClass:"clearfix"},t._l(t.videoList.item,function(a,i){return e("li",{key:i,staticClass:"video_item"},[e("div",{staticClass:"video_item_bd"},[e("video",{staticClass:"video-html",attrs:{src:a.url,controls:"controls"}},[t._v($t("dtn6qak"," 您的浏览器不支持 video 标签。 ","lang"))]),e("div",{staticClass:"check_content"},[e("span",{staticClass:"video_name",attrs:{title:a.name}},[t._v(t._s(a.name))])])]),e("div",{staticClass:"msg_card"},[e("el-row",[e("el-col",{attrs:{span:24}},[e("div",{staticClass:"opr_item",on:{click:function(e){return t.removeItem(a,i)}}},[e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:$t("eslg2","删除","lang"),placement:"top"}},[e("i",{staticClass:"el-icon-delete"})])],1)])],1)],1)])}),0)]),e("div",{staticClass:"tc"},[e("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next","current-page":t.params.page,"page-sizes":[10,20,50],total:t.total_count,"page-size":t.params.pageSize},on:{"update:currentPage":function(e){return t.$set(t.params,"page",e)},"update:current-page":function(e){return t.$set(t.params,"page",e)},"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange}})],1),e("el-dialog",{attrs:{title:$t("fteids6","上传视频文件","lang"),visible:t.uploadDialog,"before-close":t.handleCancel},on:{"update:visible":function(e){t.uploadDialog=e}}},[[e("el-form",{ref:"form",staticClass:"demo-ruleForm",attrs:{model:t.videoForm,"label-width":"90px"}},[e("el-form-item",{attrs:{label:$t("i0frr04","视频标题","lang")}},[e("el-col",{attrs:{span:14}},[e("el-input",{attrs:{maxlength:"20"},model:{value:t.videoForm.title,callback:function(e){t.$set(t.videoForm,"title",e)},expression:"videoForm.title"}})],1)],1),e("el-form-item",{attrs:{label:$t("i0f07g4","视频描述","lang")}},[e("el-col",{attrs:{span:14}},[e("el-input",{attrs:{maxlength:"20"},model:{value:t.videoForm.description,callback:function(e){t.$set(t.videoForm,"description",e)},expression:"videoForm.description"}})],1)],1),e("el-form-item",{attrs:{label:$t("i0exwa4","视频文件","lang")}},[e("el-col",{attrs:{span:14}},[e("el-upload",{staticClass:"upload-demo",attrs:{action:"","auto-upload":!1,"show-file-list":!1,"on-change":t.uploadVideo}},[e("el-button",{attrs:{size:"small",type:"primary",loading:t.isLoadData}},[t._v($t("ob89c16"," 上传视频 ","lang"))]),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v($t("7b6w4nh","只能上传MP4文件，且不超过15M","lang"))])],1)],1)],1)],1)]],2)],1)},[],!1,null,"0c890fc8",null).exports,n=a(78069),r={props:["activeName","getStatus"],data(){return{loading:!1,isLoadData:!1,imageList:{},total_count:0,params:{type:"image",page:1,pageSize:20}}},watch:{getStatus(t,e){t&&this.getList()}},methods:{handleCurrentChange(t){this.isLoadData=!1,this.params.page=t,this.getList()},handleSizeChange(t){this.isLoadData=!1,this.params.page=1,this.params.pageSize=t,this.getList()},uploadImage(t,e){let a=(0,n.ES)(t);if(!0!==a)return void this.$message({message:a,type:"error",duration:5e3});let s={isUploadFile:!0,file:t.raw,type:"image"};(0,i.uploadMaterial)(s).then(t=>{this.isLoadData=!1,this.getList()})},getList(){this.isLoadData||(this.loading=!0,(0,i.getWechatMaterial)(this.params).then(t=>{this.imageList=t.data.data,this.total_count=t.data.data.total_count,this.isLoadData=!0,this.loading=!1}).catch(()=>{this.loading=!1}))},removeItem(t,e){this.$confirm($t("r4k1d19","确定删除此图片吗？","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(()=>{(0,i.deleteWechatMaterial)({media_id:t.media_id}).then(t=>{this.imageList.item.splice(e,1),this.$message({message:$t("azeh8z4","删除成功","lang"),type:"success",duration:5e3})})}).catch(()=>{this.$message({type:"info",message:$t("e68dg3","已取消","lang")})})}}},c=(0,l.A)(r,function(){var t=this,e=t._self._c;return e("div",{staticClass:"img_pick_panel section-white"},[e("el-upload",{staticClass:"upload-demo",attrs:{action:"","auto-upload":!1,"show-file-list":!1,"on-change":t.uploadImage}},[e("el-button",{attrs:{type:"primary"}},[t._v($t("oiujgf6"," 上传图片 ","lang"))]),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v($t("ze395rk","只能上传jpg/png文件，且不超过2M","lang"))])],1),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"img_pick"},[e("ul",{staticClass:"clearfix"},t._l(t.imageList.item,function(a,i){return e("li",{key:i,staticClass:"img_item"},[e("div",{staticClass:"img_item_bd"},[e("div",{staticClass:"pic",style:{backgroundImage:"url("+(t.wximageurl+a.url)+")"}}),e("div",{staticClass:"check_content"},[e("span",{staticClass:"img_name",attrs:{title:a.name}},[t._v(t._s(a.name))])])]),e("div",{staticClass:"msg_card"},[e("el-row",[e("el-col",{attrs:{span:24}},[e("div",{staticClass:"opr_item",on:{click:function(e){return t.removeItem(a,i)}}},[e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:$t("eslg2","删除","lang"),placement:"top"}},[e("i",{staticClass:"el-icon-delete"})])],1)])],1)],1)])}),0)]),e("div",{staticClass:"tc"},[e("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next","current-page":t.params.page,"page-sizes":[10,20,50],total:t.total_count,"page-size":t.params.pageSize},on:{"update:currentPage":function(e){return t.$set(t.params,"page",e)},"update:current-page":function(e){return t.$set(t.params,"page",e)},"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange}})],1)],1)},[],!1,null,"05f2dbd0",null).exports,d=(a(44114),{provide(){return{refresh:this.getList}},props:["activeName","getStatus"],data(){return{loading:!1,isLoadData:!1,list_news:[],total_count:0,params:{type:"news",page:1,pageSize:20}}},watch:{getStatus(t,e){t&&this.getList()}},mounted(){"imagetext"==this.activeName&&this.getStatus&&this.getList()},methods:{handleCurrentChange(t){this.isLoadData=!1,this.params.page=t,this.getList()},handleSizeChange(t){this.isLoadData=!1,this.params.page=1,this.params.pageSize=t,this.getList()},getList(){this.isLoadData||(this.loading=!0,(0,i.getWechatMaterial)(this.params).then(t=>{this.list_news=t.data.data,this.total_count=t.data.data.total_count,this.isLoadData=!0,this.loading=!1}).catch(t=>{this.loading=!1}))},editNewsItem(t){t?this.$router.push({path:this.matchRoutePath("editor/")+t}):this.$router.push({path:this.matchRoutePath("editor/")})},removeNewsItem(t,e){this.$confirm($t("r2ot2d9","确定删除此图文吗？","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(()=>{(0,i.deleteWechatMaterial)({media_id:t.media_id}).then(t=>{this.list_news.item.splice(e,1),this.$message({message:$t("azeh8z4","删除成功","lang"),type:"success",duration:5e3})})}).catch(()=>{this.$message({type:"info",message:$t("e68dg3","已取消","lang")})})}}}),g=(0,l.A)(d,function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"clearfix",staticStyle:{margin:"0.6%"}},[e("div",{staticClass:"f_l"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.editNewsItem()}}},[t._v($t("r2l9lu8"," 新增图文消息 ","lang"))])],1)]),e("div",{directives:[{name:"masonry",rawName:"v-masonry"},{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"masonry",staticClass:"msg-list",attrs:{"transition-duration":"0.3s","item-selector":".msg-item"}},[t._l(t.list_news.item,function(a,i){return"imagetext"===t.activeName?[e("div",{directives:[{name:"masonry-tile",rawName:"v-masonry-tile"}],key:i,staticClass:"msg-item has-first-cover",class:{multi:a.content.news_item[1],single:!a.content.news_item[1]}},[e("div",{staticClass:"msg-content"},[e("div",{staticClass:"msg-info"},[e("span",[t._v($t("deqidq4","更新于 ","lang")+t._s(t._f("datetime")(a.update_time)))])]),e("div",{staticClass:"sub-msg-item",class:{coverMsgItem:a.content.news_item[1]}},[e("h4",{staticClass:"msg-title"},[e("a",[t._v(t._s(a.content.news_item[0].title))])]),e("div",{staticClass:"msg-thumb-wrap",style:{backgroundImage:"url("+t.wximageurl+a.content.news_item[0].thumb_url+")"}}),e("a",{staticClass:"edit-mask preview-mask",attrs:{href:a.content.news_item[0].url}},[e("div",{staticClass:"edit-mask-content"},[t._v($t("jt70fx4","预览文章","lang"))])]),a.content.news_item[1]?t._e():e("p",{staticClass:"msg-desc"},[t._v(" "+t._s(a.content.news_item[0].digest)+" ")])]),t._l(a.content.news_item.length-1,function(i){return e("div",{key:i},[a.content.news_item[1]?e("div",{staticClass:"article-msg-item has-cover clearfix"},[e("div",{staticClass:"msg-thumb-wrap",style:{backgroundImage:"url("+t.wximageurl+a.content.news_item[i].thumb_url+")"}}),e("h4",{staticClass:"msg-title"},[e("a",[t._v(t._s(a.content.news_item[i].title))])]),e("a",{staticClass:"edit-mask preview-mask",attrs:{href:a.content.news_item[i].url}},[e("div",{staticClass:"edit-mask-content"},[t._v($t("jt70fx4","预览文章","lang"))])])]):t._e()])})],2),e("div",{staticClass:"msg-operate"},[e("el-row",[e("el-col",{attrs:{span:12}},[e("div",{on:{click:function(e){return t.editNewsItem(a.media_id)}}},[e("el-tooltip",{key:a.id,attrs:{effect:"dark",content:$t("mekb2","编辑","lang"),placement:"top"}},[e("a",[e("i",{staticClass:"el-icon-edit"})])])],1)]),e("el-col",{attrs:{span:12}},[e("div",{staticClass:"opr_item",on:{click:function(e){return t.removeNewsItem(a,i)}}},[e("el-tooltip",{key:a.id,attrs:{effect:"dark",content:$t("eslg2","删除","lang"),placement:"top"}},[e("i",{staticClass:"el-icon-delete"})])],1)])],1)],1)])]:t._e()})],2),e("div",{staticClass:"tc"},[e("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next","current-page":t.params.page,"page-sizes":[10,20,50],total:t.total_count,"page-size":t.params.pageSize},on:{"update:currentPage":function(e){return t.$set(t.params,"page",e)},"update:current-page":function(e){return t.$set(t.params,"page",e)},"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange}})],1)])},[],!1,null,"e9bca208",null).exports,p=(a(18111),a(61701),a(17756)),u=a(97570),m=a(26456),h=a(79646),v={config:{},props:{value:{type:Object,validator(t){return null===t||!!t.type&&void 0!==t.data}}},data(){return{type:"",defaultVal:"",localVal:{}}},watch:{value:{immediate:!0,handler(t){t=t&&t.type===this.type?(0,h.A)(t):this.resolveDefaultVal(),this.localVal=t}}},methods:{resolveDefaultVal(){return{type:this.type,data:this.defaultVal}},getVal(){return this.localVal},updateVal(t){const e={data:t};this.localVal=e,this.$emit("input",e)}}},_={data(){return{pageCur:1,pageSize:18,pageCount:0,loading:!1}},computed:{pageTotal(){if(this.pageCount<=0)return 1;return Math.ceil(this.pageCount/this.pageSize)}},methods:{async refresh(t){t&&this.resetPage(),await this.goPage(this.pageCur)},resetPage(){this.pageCur=1,this.pageCount=-1},nextPage(){return this.goPage(1)},async goPage(t=1){t>this.pageTotal&&-1!==this.pageCount?this.pageCur=this.pageTotal:this.pageCur=t<0?0:t,this.loading=!0;const{count:e}=await this.fetch({page_no:this.pageCur,page_size:this.pageSize});this.loading=!1,this.pageCount=e}}},f=a(12104),C={name:"PickerImage",components:{VueCropper:p.VueCropper},extends:v,mixins:[_],config:{title:$t("cv2ifw4","我的图片","lang")},props:["value"],data(){let{multiple:t=!0,data:e}=this.value||{};return e||(e=t?[]:""),{multiple:t,list:[],selected:e,catgoryList:[],selectCatgory:-1,groupDialog:!1,groupForm:{groupId:"",groupName:""},groupFormList:[{label:$t("avf4w14","分组名称","lang"),key:"groupName",type:"input",maxlength:150,placeholder:$t("mnnvyu7","请输入分组名称","lang"),required:!0,message:$t("adohlc4","不能为空","lang")}],editDialog:!1,editForm:{groupId:""},editFormList:[{label:$t("bg564n4","图片分组","lang"),key:"groupId",placeholder:$t("v8qygu7","请选择图片分组","lang"),type:"select",options:[],required:!0,message:$t("adohlc4","不能为空","lang")}],cropperDialogShow:!1,localpostData:{token:"",key:"",fname:""},option:{img:"",size:1,autoCrop:!0}}},computed:{disabledDeleteGroup(){return-1==this.selectCatgory},disabledBtnCropper(){return this.multiple?1!==this.selected.length:!this.selected},disabledBtnEdit(){return this.multiple?0==this.selected.length:!this.selected},disabledBtnDelete(){return this.multiple?0==this.selected.length:!this.selected},disabledBtnDownload(){return this.multiple?0==this.selected.length:!this.selected},disabledBtnCancel(){return this.multiple?0==this.selected.length:!this.selected},disabledBtn(){return this.multiple?0==this.selected.length:!this.selected}},created(){},mounted(){this.nextPage(),this.getImageAllCatgory()},methods:{isActive({image_id:t,url:e}){if(this.multiple)return!!(0,m.cy)(this.selected)&&this.selected.findIndex(t=>t.url==e);if(this.selected){const t=t=>{const[e,a,i]=/^(http|https):\/\/(.*)/g.exec(t);return i};return(0,m.Gv)(this.selected)?t(this.selected.url)==t(e):t(this.selected)==t(e)}return!1},onAddGroup(){const{groupForm:t}=this.$options.data();this.groupForm=t,this.groupDialog=!0},onEditGroup({image_cat_id:t,image_cat_name:e}){this.groupForm={groupId:t,groupName:e},this.groupDialog=!0},async onDeleteGroup({image_cat_id:t,image_cat_name:e}){try{await this.$confirm(`${$t("j4agtk7","确认删除分组【","lang")}${e}】？`,$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang")}),await this.$api.picker.deleteImageGroup(t),this.getImageAllCatgory(),this.refresh(!0)}catch(t){}},async onGroupFormSubmit(){const{groupId:t,groupName:e}=this.groupForm;t?await this.$api.picker.addImageCatgory({image_cat_id:t,image_cat_name:e,parent_id:0}):await this.$api.picker.addImageCatgory({image_cat_name:e,parent_id:0}),this.groupDialog=!1,this.getImageAllCatgory()},onMoveGroup(){this.editDialog=!0},async onEditFormSubmit(){const{groupId:t}=this.editForm;let e;this.$refs.editDialogRef.resetForm(),e=(0,m.cy)(this.selected)?this.selected.map(({image_id:t})=>t):this.selected.image_id,await this.$api.picker.moveImageGroup({image_cat_id:t,image_id:e.toString()}),this.editDialog=!1,this.refresh(!0)},handleEdit(){const{multiple:t,selected:e}=this;this.editFormList[1].disabled=!1,t&&1==e.length?this.editForm.name=e[0].image_name:!t&&e?this.editForm.name=e.image_name:this.editFormList[1].disabled=!0,this.editDialog=!0},handleCropper(){const{selected:t,multiple:e}=this;this.option.img=e?t[0].url:t.url,this.cropperDialogShow=!0},async fetch({page_no:t,page_size:e}){let a={type:"image",page:t,pageSize:e};"-1"!=this.selectCatgory&&(a={...a,image_cat_id:this.selectCatgory});const{list:i,total_count:s}=await this.$api.picker.getImageList(a);return this.list=i,{count:s}},async getImageAllCatgory(){const{list:t}=await this.$api.picker.getImageAllCatgory({image_cat_id:0});this.catgoryList=[{image_cat_id:-1,image_cat_name:$t("avad1l4","全部图片","lang")},...t.reverse()],this.editFormList[0].options=this.catgoryList.map(t=>({title:t.image_cat_name,value:t.image_cat_id}))},handleClickCatgory({image_cat_id:t}){this.selectCatgory=t,this.refresh(!0)},handleClickItem(t){const{image_id:e,url:a}=t,i={image_id:e,url:a};if(this.multiple){const e=this.selected.findIndex(e=>e.image_id==t.image_id);e>-1?this.selected.splice(e,1):this.selected.push(i)}else this.selected=i;this.updateVal(this.selected)},beforeAvatarUpload(t){const e="image/jpeg"===t.type,a="image/png"===t.type,i="image/gif"===t.type,s=t.size/1024/1024<5;e||a||i?s?this.localpostData.fname=t.name:this.$message.error($t("8aj5j2f","上传图片大小不能超过 5MB!","lang")):this.$message.error($t("8hirmwm","上传图片只能是 JPG 或者 PNG 格式!","lang"))},async handleAvatarSuccess(t,e){const a={image_cat_id:this.selectCatgory,image_name:e.name,image_url:t.key,image_type:e.raw.type,storage:"image"};await this.$api.qiniu.uploadQiniuPic(a),this.$message.success($t("a6esth4","上传成功","lang")),this.refresh(!0)},handleUpload:function(t){(new u.A).uploadImg(t.file,t.file.name).then(e=>t.onSuccess(e),e=>t.onError(e)).catch(e=>t.onError(e))},uploadError:function(t){},async handleCopy(t){await this.$copyText(t),this.$notify.success({message:$t("7lynsx6","链接复制成功","lang"),showClose:!0})},removeItem(t,e){this.$confirm($t("r4k1d19","确定删除此图片吗？","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(()=>{(0,f.deleteImage)({image_id:t.image_id}).then(t=>{this.refresh(!0),this.$message({message:$t("azeh8z4","删除成功","lang"),type:"success",duration:5e3})})}).catch(()=>{this.$message({type:"info",message:$t("e68dg3","已取消","lang")})})},handleCancelAll(){const{multiple:t}=this;this.selected=t?[]:null},handleCropperAction(t){switch(t){case"minus":this.$refs.cropper.changeScale(-2);break;case"plus":this.$refs.cropper.changeScale(2);break;case"rotateRight":this.$refs.cropper.rotateRight();break;case"rotateLeft":this.$refs.cropper.rotateLeft()}}}},$=C,y=(0,l.A)($,function(){var t=this,e=t._self._c;return e("div",{staticClass:"picker-image"},[e("div",{staticClass:"picker-image-hd"},[e("div",{staticClass:"btn-actions"},[e("el-upload",{staticClass:"btn-upload",attrs:{action:"",accept:"image/jpeg,image/png,image/gif",multiple:!0,"show-file-list":!1,data:t.localpostData,"http-request":t.handleUpload,"before-upload":t.beforeAvatarUpload,"on-success":t.handleAvatarSuccess,"on-error":t.uploadError}},[e("el-button",[t._v($t("a6d3a74","上传图片","lang"))])],1),e("el-button",{on:{click:t.onAddGroup}},[t._v($t("trb40t6"," 添加分组 ","lang"))]),e("el-button",{attrs:{disabled:t.disabledBtn},on:{click:t.onMoveGroup}},[t._v($t("itoyb4"," 移动 ","lang"))]),e("el-button",{attrs:{disabled:t.disabledBtn},on:{click:t.handleCancelAll}},[t._v($t("32ol2q6"," 全部取消 ","lang"))])],1)]),e("div",{staticClass:"picker-image-bd"},[e("div",{staticClass:"lf-container"},t._l(t.catgoryList,function(a,i){return e("div",{key:`catgory-item__${i}`,staticClass:"catgory-item flex justify-between items-center",class:{active:t.selectCatgory==a.image_cat_id},on:{click:function(e){return t.handleClickCatgory(a)}}},[e("div",{staticClass:"flex items-center justify-between w-full"},[e("div",[e("SpIcon",{attrs:{name:"folder-plus"}}),t._v(" "+t._s(a.image_cat_name)+" ")],1),e("div",[i>0?e("SpIcon",{attrs:{name:"editor"},on:{click:function(e){return e.stopPropagation(),t.onEditGroup(a)}}}):t._e(),i>0?e("SpIcon",{attrs:{name:"delete"},on:{click:function(e){return e.stopPropagation(),t.onDeleteGroup(a)}}}):t._e()],1)])])}),0),e("div",{staticClass:"rg-container"},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"image-list"},[t._l(t.list,function(a,i){return e("div",{key:`image-item-wrap__${i}`,staticClass:"image-item-wrap",on:{click:function(e){return t.handleClickItem(a)}}},[e("div",{staticClass:"image-item",style:{color:"#fff",backgroundImage:`url('${a.url}')`}},[e("SpIcon",{attrs:{name:"link-two",size:"20"},on:{click:function(e){return e.stopPropagation(),t.handleCopy(a.url)}}}),e("SpIcon",{attrs:{name:"delete",size:"18"},on:{click:function(e){return e.stopPropagation(),t.removeItem(a,i)}}})],1),e("div",{staticClass:"image-title-wrap",attrs:{title:a.image_name}},[e("p",{staticClass:"image-title-wrap__title"},[t._v(" "+t._s(a.image_name)+" ")])]),(t.multiple?t.isActive(a)>-1:t.isActive(a))?e("div",{staticClass:"image-box-selected"},[e("div",{staticClass:"image-box-selected__right-angle"}),e("div",{staticClass:"image-box-selected__text"},[t.multiple?e("span",[t._v(t._s(t.isActive(a)+1))]):t._e(),t.multiple?t._e():e("i",{staticClass:"iconfont icon-check"})])]):t._e()])}),0==t.list.length?e("el-empty",{attrs:{description:$t("dcv57g4","暂无数据","lang")}}):t._e()],2),e("el-pagination",{attrs:{layout:"total, prev, pager, next","current-page":t.pageCur,"page-size":t.pageSize,total:t.pageCount},on:{"update:currentPage":function(e){t.pageCur=e},"update:current-page":function(e){t.pageCur=e},"current-change":t.goPage}})],1)]),e("SpDialog",{ref:"groupDialogRef",attrs:{title:$t("e7vzgj4","添加分组","lang"),modal:!1,form:t.groupForm,"form-list":t.groupFormList},on:{onSubmit:t.onGroupFormSubmit},model:{value:t.groupDialog,callback:function(e){t.groupDialog=e},expression:"groupDialog"}}),e("SpDialog",{ref:"editDialogRef",attrs:{title:$t("fqdp3f4","移动分组","lang"),modal:!1,form:t.editForm,"form-list":t.editFormList},on:{onSubmit:t.onEditFormSubmit},model:{value:t.editDialog,callback:function(e){t.editDialog=e},expression:"editDialog"}}),e("el-dialog",{staticClass:"cropper-dialog",attrs:{title:$t("bge8ia4","图片裁剪","lang"),modal:!1,visible:t.cropperDialogShow,width:"500px"},on:{"update:visible":function(e){t.cropperDialogShow=e}}},[e("div",{staticClass:"cropper-container"},[e("vueCropper",{ref:"cropper",attrs:{img:t.option.img,"output-size":t.option.size,"output-type":t.option.outputType,"auto-crop":t.option.autoCrop}}),e("div",{staticClass:"cropper-actions"},[e("i",{staticClass:"iconfont icon-search-minus",on:{click:function(e){return t.handleCropperAction("minus")}}}),e("i",{staticClass:"iconfont icon-search-plus",on:{click:function(e){return t.handleCropperAction("plus")}}}),e("i",{staticClass:"iconfont icon-undo-alt",on:{click:function(e){return t.handleCropperAction("rotateRight")}}}),e("i",{staticClass:"iconfont icon-redo-alt",on:{click:function(e){return t.handleCropperAction("rotateLeft")}}})])],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.cropperDialogShow=!1}}},[t._v($t("caoqm3","取 消","lang"))]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.cropperDialogShow=!1}}},[t._v($t("hnjoo3","确 定","lang"))])],1)])],1)},[],!1,null,"819ea2e2",null).exports,b={mixins:[a(77825).Ay],props:["activeName","getStatus"],data(){return{actionPath:"https://upload-z2.qiniup.com",uploadDialog:!1,image_prefix:"",postData:{token:"",key:"",fname:""},loading:!1,isLoadData:!1,localvideosList:{},params:{storage:"videos",page:1,pageSize:20},videoForm:{title:"",description:""}}},watch:{getStatus(t,e){t&&(this.params={storage:"videos",page:1,pageSize:this.params.pageSize},this.getList())}},methods:{beforeVideoUpload(t){if(this.videoForm.title.length<=0)return void this.$message({message:$t("lu0ubi6","视频标题必填","lang"),type:"error"});if(this.videoForm.description.length<=0)return void this.$message({message:$t("meg3ce6","视频描述必填","lang"),type:"error"});const e="video/mp4"===t.type,a=t.size/1024/1024<50;if(!e)return void this.$message.error($t("r4ic86f","上传视频只能是 mp4 格式!","lang"));if(!a)return void this.$message.error($t("f01rdgg","上传视频大小不能超过 50MB!","lang"));this.postData.fname=t.name;t.name},handleVideoSuccess(t,e){let a={image_cat_id:2,image_name:this.videoForm.title,brief:this.videoForm.description,image_url:t.key,image_type:e.raw.type,storage:"videos"};(0,f.uploadQiniuVideo)(a).then(t=>{this.$message({message:$t("a6esth4","上传成功","lang"),type:"success",duration:5e3}),this.uploadDialog=!1,this.isLoadData=!1,this.getList()})},getList(){this.isLoadData||(this.loading=!0,(0,f.getQiniuVideoList)(this.params).then(t=>{this.localvideosList=t.data.data,this.isLoadData=!0,this.loading=!1}).catch(()=>{this.loading=!1}))},handleCurrentChange(t){this.isLoadData=!1,this.params.page=t,this.getList()},handleSizeChange(t){this.isLoadData=!1,this.params.page=1,this.params.pageSize=t,this.getList()},removeItem(t,e){this.$confirm($t("xoqr539","确定删除此视频吗？","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(()=>{(0,f.deleteVideo)({image_id:t.image_id}).then(t=>{this.localvideosList.list.splice(e,1),this.$message({message:$t("azeh8z4","删除成功","lang"),type:"success",duration:5e3})})}).catch(()=>{this.$message({type:"info",message:$t("e68dg3","已取消","lang")})})},addVideo(){this.uploadDialog=!0},handleCancel(){this.uploadDialog=!1},handleUpload:function(t){new u.A("videos").uploadImg(t.file,t.file.name).then(e=>t.onSuccess(e),e=>t.onError(e)).catch(e=>t.onError(e))},uploadError:function(t){}}},k={components:{imagesList:c,newsList:g,videoList:o,localimagesList:y,localvideosList:(0,l.A)(b,function(){var t=this,e=t._self._c;return e("div",{staticClass:"video_pick_panel section-white"},[e("div",{staticClass:"upload_box"},[e("el-button",{attrs:{type:"primary",icon:"plus"},on:{click:t.addVideo}},[t._v($t("ob89c16"," 上传视频 ","lang"))])],1),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"video_pick"},[e("ul",{staticClass:"clearfix"},t._l(t.localvideosList.list,function(a,i){return e("li",{key:i,staticClass:"video_item"},[e("div",{staticClass:"video_item_bd"},[e("video",{staticClass:"video-html",attrs:{src:a.image_full_url,controls:"controls"}},[t._v($t("dtn6qak"," 您的浏览器不支持 video 标签。 ","lang"))]),e("div",{staticClass:"check_content"},[e("span",{staticClass:"video_name",attrs:{title:a.name}},[t._v(t._s(a.image_name))])])]),e("div",{staticClass:"msg_card"},[e("el-row",[e("el-col",{attrs:{span:t.VERSION_IN_PURCHASE()?12:24}},[e("div",{staticClass:"opr_item",on:{click:function(e){return t.removeItem(a,i)}}},[e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:$t("eslg2","删除","lang"),placement:"top"}},[e("i",{staticClass:"el-icon-delete"})])],1)]),t.VERSION_IN_PURCHASE()?e("el-col",{attrs:{span:t.VERSION_IN_PURCHASE()?12:24}},[e("div",{staticClass:"copy-url"},[e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:a.image_full_url,placement:"top"}},[e("i",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:a.image_full_url,expression:"videoitem.image_full_url",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:t.onCopySuccess,expression:"onCopySuccess",arg:"success"}],staticClass:"el-icon-document-copy"})])],1)]):t._e()],1)],1)])}),0)]),e("div",{staticClass:"tc"},[e("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next","current-page":t.params.page,"page-sizes":[10,20,50],total:t.localvideosList.total_count,"page-size":t.params.pageSize},on:{"update:currentPage":function(e){return t.$set(t.params,"page",e)},"update:current-page":function(e){return t.$set(t.params,"page",e)},"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange}})],1),e("el-dialog",{attrs:{title:$t("fteids6","上传视频文件","lang"),visible:t.uploadDialog,"before-close":t.handleCancel},on:{"update:visible":function(e){t.uploadDialog=e}}},[[e("el-form",{ref:"form",staticClass:"demo-ruleForm",attrs:{model:t.videoForm,"label-width":"90px"}},[e("el-form-item",{attrs:{label:$t("i0frr04","视频标题","lang")}},[e("el-col",{attrs:{span:14}},[e("el-input",{attrs:{maxlength:"20"},model:{value:t.videoForm.title,callback:function(e){t.$set(t.videoForm,"title",e)},expression:"videoForm.title"}})],1)],1),e("el-form-item",{attrs:{label:$t("i0f07g4","视频描述","lang")}},[e("el-col",{attrs:{span:14}},[e("el-input",{attrs:{maxlength:"20"},model:{value:t.videoForm.description,callback:function(e){t.$set(t.videoForm,"description",e)},expression:"videoForm.description"}})],1)],1),e("el-form-item",{attrs:{label:$t("i0exwa4","视频文件","lang")}},[e("el-col",{attrs:{span:14}},[e("el-upload",{staticClass:"upload-demo",attrs:{multiple:!0,action:"",accept:"video/mp4","show-file-list":!1,"http-request":t.handleUpload,"on-error":t.uploadError,"before-upload":t.beforeVideoUpload,"on-success":t.handleVideoSuccess}},[e("el-button",{attrs:{type:"primary"}},[t._v($t("3oueee6"," 本地上传 ","lang"))]),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v($t("n8padah","只能上传mp4文件，且不超过50M","lang"))])],1)],1)],1)],1)]],2)],1)},[],!1,null,"c2da89fe",null).exports},data(){return{activeName:"local",stats:[],picStatus:!1,newsStatus:!0,videoStatus:!1,localpicStatus:!1,localvideoStatus:!1,Status:!1}},mounted(){this.$store.getters.login_type,this.activeName="local",this.handleClick()},methods:{handleClick(){"picture"==this.activeName?(this.picStatus=!0,this.newsStatus=!1,this.videoStatus=!1,this.localpicStatus=!1,this.localvideoStatus=!1):"imagetext"==this.activeName?(this.picStatus=!1,this.videoStatus=!1,this.newsStatus=!0,this.localpicStatus=!1,this.localvideoStatus=!1,(0,i.getMaterialStats)().then(t=>{this.stats=t.data.data})):"video"==this.activeName?(this.picStatus=!1,this.videoStatus=!0,this.newsStatus=!1,this.localpicStatus=!1,this.localvideoStatus=!1):"localvideo"==this.activeName?(this.picStatus=!1,this.videoStatus=!1,this.newsStatus=!1,this.localpicStatus=!1,this.localvideoStatus=!0):(this.picStatus=!1,this.videoStatus=!1,this.newsStatus=!1,this.localpicStatus=!0,this.localvideoStatus=!1)}}},w=(0,l.A)(k,function(){var t=this,e=t._self._c;return e("SpPage",[-1===t.$route.path.indexOf("editor")?e("div",[e("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[e("el-tab-pane",{attrs:{label:$t("ddnvd94","本地图片","lang"),name:"local"}},[e("localimages-list",{attrs:{"active-name":t.activeName,"get-status":t.localpicStatus}})],1),e("el-tab-pane",{attrs:{label:$t("ddwpvz4","本地视频","lang"),name:"localvideo"}},[e("localvideos-list",{attrs:{"active-name":t.activeName,"get-status":t.localvideoStatus}})],1)],1)],1):t._e(),e("router-view")],1)},[],!1,null,null,null).exports}}]);