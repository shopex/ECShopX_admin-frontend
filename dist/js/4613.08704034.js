"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[4613],{14613:function(e,t,i){i.r(t),i.d(t,{default:function(){return l}});var a=i(88986).A,l=(0,i(81656).A)(a,function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"200px"}},[t("el-form-item",{attrs:{label:$t("bor30q5","活动名称：","lang"),rules:[{required:!0,message:$t("jel5hj7","请输入活动名称","lang"),trigger:"blur"}]}},[t("el-input",{staticStyle:{width:"400px"},attrs:{maxlength:30,type:"textarea","show-word-limit":""},model:{value:e.form.purchase_name,callback:function(t){e.$set(e.form,"purchase_name",t)},expression:"form.purchase_name"}})],1),t("el-form-item",{attrs:{label:$t("bq211o5","活动封面：","lang"),rules:[{required:!0,message:$t("jejmyx7","请输入活动封面","lang"),trigger:"blur"}]}},[t("div",{staticClass:"frm-tips"},[e._v($t("3wjv5f13","建议上传尺寸大小为300*300且格式为png、jpg图片；文件大小为2M内。","lang"))]),t("div",[t("imgBox",{attrs:{"img-url":e.form.ad_pic,inline:""},on:{click:e.handleImgChange}})],1),t("imgPicker",{attrs:{"dialog-visible":e.imgDialog,"sc-status":e.isGetImage},on:{chooseImg:e.pickImg,closeImgDialog:e.closeImgDialog}})],1),t("el-form-item",{attrs:{label:$t("briaen5","活动时间：","lang"),rules:[{required:!0,message:$t("jehya47","请输入活动时间","lang"),trigger:"blur"}]}},[t("el-col",{attrs:{span:20}},[t("el-date-picker",{attrs:{type:"datetimerange","range-separator":$t("po31","至","lang"),"start-placeholder":$t("cd0k3t4","开始时间","lang"),"end-placeholder":$t("gfi7qi4","结束时间","lang"),"value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"],"picker-options":e.pickerOptions},model:{value:e.activity_date,callback:function(t){e.activity_date=t},expression:"activity_date"}})],1)],1),t("el-form-item",{attrs:{label:$t("a6boyc5","适用角色：","lang")}},[t("el-checkbox-group",{model:{value:e.form.used_roles,callback:function(t){e.$set(e.form,"used_roles",t)},expression:"form.used_roles"}},e._l(e.roleArr,function(i){return t("el-checkbox",{key:i.key,attrs:{label:i.key,disabled:"employee"===i.key,value:i.key}},[e._v(" "+e._s(i.name)+" ")])}),1)],1),t("div",{staticStyle:{display:"flex"}},[t("el-form-item",{attrs:{label:$t("cw86585","员工额度：","lang"),rules:{required:!0,message:$t("mhmf4x7","请输入员工额度","lang"),trigger:"blur"}}},[t("el-input",{staticStyle:{width:"240px"},model:{value:e.form.employee_limitfee,callback:function(t){e.$set(e.form,"employee_limitfee",t)},expression:"form.employee_limitfee"}},[t("template",{slot:"append"},[e._v($t("ehct3"," 元 ","lang"))])],2)],1),e.form.used_roles.includes("dependents")?t("el-form-item",[t("el-checkbox",{model:{value:e.form.is_share_limitfee,callback:function(t){e.$set(e.form,"is_share_limitfee",t)},expression:"form.is_share_limitfee"}},[e._v($t("oiirve8"," 是否共享额度 ","lang"))])],1):e._e()],1),e.form.used_roles.includes("dependents")&&!e.form.is_share_limitfee?t("el-form-item",{attrs:{label:$t("yry5qw5","亲友额度：","lang"),rules:{required:e.form.used_roles.includes("dependents")&&!e.form.is_share_limitfee,message:$t("n8qzpx7","请输入亲友额度","lang"),trigger:"blur"}}},[t("el-input",{staticStyle:{width:"240px"},model:{value:e.form.dependents_limitfee,callback:function(t){e.$set(e.form,"dependents_limitfee",t)},expression:"form.dependents_limitfee"}},[t("template",{slot:"append"},[e._v($t("ehct3"," 元 ","lang"))])],2)],1):e._e(),e.form.used_roles.includes("dependents")?t("el-form-item",{attrs:{label:$t("bf5q8g7","员工邀请上限：","lang"),rules:{required:e.form.used_roles.includes("dependents"),message:$t("jv2jnx9","请输入员工邀请上限","lang"),trigger:"blur"}}},[t("el-input",{staticStyle:{width:"240px"},model:{value:e.form.dependents_limit,callback:function(t){e.$set(e.form,"dependents_limit",t)},expression:"form.dependents_limit"}},[t("template",{slot:"append"},[e._v($t("e1ty3"," 人 ","lang"))])],2)],1):e._e(),t("el-form-item",{attrs:{label:$t("g0n0b29","单笔订单最低金额：","lang")}},[t("el-input",{staticStyle:{width:"240px"},model:{value:e.form.minimum_amount,callback:function(t){e.$set(e.form,"minimum_amount",t)},expression:"form.minimum_amount"}},[t("template",{slot:"append"},[e._v($t("ehct3"," 元 ","lang"))])],2)],1),t("el-card",{attrs:{header:$t("e4hvig4","活动商品","lang"),shadow:"naver"}},[t("el-form-item",{attrs:{label:$t("ingkrl4","适用商品","lang")}},[t("el-radio-group",{on:{change:e.itemTypeChange},model:{value:e.form.item_type,callback:function(t){e.$set(e.form,"item_type",t)},expression:"form.item_type"}},[t("el-radio",{attrs:{label:"all"}},[e._v($t("32l7x76"," 全部商品 ","lang"))]),t("el-radio",{attrs:{label:"item"}},[e._v($t("q7xfmc8"," 指定商品适用 ","lang"))]),t("el-radio",{attrs:{label:"category"}},[e._v($t("xx0gpa8"," 指定分类适用 ","lang"))]),t("el-radio",{attrs:{label:"tag"}},[e._v($t("5ghnxxa"," 指定商品标签适用 ","lang"))]),t("el-radio",{attrs:{label:"brand"}},[e._v($t("oiwwqs8"," 指定品牌适用 ","lang"))])],1)],1),e.allHiden?e._e():t("el-form-item",{attrs:{label:$t("5wkab65","每人限购：","lang"),rules:{required:!0,message:$t("jlax4f7","请输入每人限购","lang"),trigger:"blur"}}},[t("el-input",{staticStyle:{width:"240px"},model:{value:e.allLimit,callback:function(t){e.allLimit=t},expression:"allLimit"}},[t("template",{slot:"append"},[e._v($t("e39m3"," 件 ","lang"))])],2)],1),e.zdItemHidden?e._e():t("div",[t("div",{staticStyle:{position:"relative"}},[t("div",{staticStyle:{position:"absolute",bottom:"0px",left:"112px"}},[t("el-upload",{staticStyle:{display:"inline-block"},attrs:{action:"","on-change":e.uploadHandleChange,"auto-upload":!1,"show-file-list":!1}},[t("el-button",{attrs:{type:"primary"}},[e._v($t("7afr9o6"," 批量上传 ","lang"))])],1),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:function(t){return e.uploadHandleTemplate()}}},[e._v($t("gbapcg6"," 下载模板 ","lang"))])],1),t("SkuSelector",{attrs:{data:e.relItems},on:{change:e.getItems}})],1),t("el-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"primary",plain:""},on:{click:function(t){e.dialogFormVisible=!0}}},[e._v($t("7166jq6"," 批量设置 ","lang"))]),t("el-table",{key:"currentGoodKey",attrs:{data:e.good.currentGoods}},[t("el-table-column",{attrs:{prop:"item_id",label:"ID",width:"180"}}),t("el-table-column",{attrs:{prop:"itemName",label:$t("b40v0e4","商品名称","lang"),width:"180"}}),t("el-table-column",{attrs:{prop:"item_spec_desc",label:$t("o06w2","规格","lang"),width:"180"}}),t("el-table-column",{attrs:{prop:"limit_num",label:$t("dxs3qg4","每人限购","lang"),width:"280"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{on:{input:function(t){return e.inputChange(i.$index,"good.currentGoods")}},model:{value:i.row.limit_num,callback:function(t){e.$set(i.row,"limit_num",t)},expression:"scope.row.limit_num"}},[t("template",{slot:"append"},[e._v($t("e39m3"," 件 ","lang"))])],2)]}}],null,!1,2574817839)}),t("el-table-column",{attrs:{prop:"limit_fee",label:$t("dxs5zs4","每人限额","lang"),width:"280"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{on:{input:function(t){return e.inputChange(i.$index,"good.currentGoods")}},model:{value:i.row.limit_fee,callback:function(t){e.$set(i.row,"limit_fee",t)},expression:"scope.row.limit_fee"}},[t("template",{slot:"append"},[e._v($t("ehct3"," 元 ","lang"))])],2)]}}],null,!1,2586114602)})],1)],1),e.categoryHidden?e._e():t("el-col",[t("div",[t("div",{staticStyle:{width:"300px"}},[t("treeselect",{attrs:{options:e.categoryList,"show-count":!0,multiple:!0,"disable-branch-nodes":!0,clearable:!1,"value-format":"object"},model:{value:e.item_category,callback:function(t){e.item_category=t},expression:"item_category"}})],1),t("el-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"primary",plain:""},on:{click:function(t){e.dialogFormVisible=!0}}},[e._v($t("7166jq6"," 批量设置 ","lang"))]),t("el-table",{key:"categoryKey",attrs:{data:e.item_category}},[t("el-table-column",{attrs:{prop:"category_id",label:"ID",width:"180"}}),t("el-table-column",{attrs:{prop:"category_name",label:$t("av333s4","分类名称","lang"),width:"180"}}),t("el-table-column",{attrs:{label:$t("dxs3qg4","每人限购","lang"),width:"280"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{on:{input:function(t){return e.inputChange(i.$index,"item_category")}},model:{value:i.row.limit_num,callback:function(t){e.$set(i.row,"limit_num",t)},expression:"scope.row.limit_num"}},[t("template",{slot:"append"},[e._v($t("e39m3"," 件 ","lang"))])],2)]}}],null,!1,2399208321)}),t("el-table-column",{attrs:{prop:"limit_fee",label:$t("dxs5zs4","每人限额","lang"),width:"280"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{on:{input:function(t){return e.inputChange(i.$index,"item_category")}},model:{value:i.row.limit_fee,callback:function(t){e.$set(i.row,"limit_fee",t)},expression:"scope.row.limit_fee"}},[t("template",{slot:"append"},[e._v($t("ehct3"," 元 ","lang"))])],2)]}}],null,!1,1297031620)})],1)],1)]),e.tagHidden?e._e():[t("div",{staticClass:"view-flex"},[t("div",{staticClass:"label"},[e._v($t("47inz05","未选标签：","lang"))]),e._l(e.tag.tags,function(i,a){return t("el-tag",{key:a,staticClass:"tag-item",attrs:{size:"medium",color:"#ffffff","disable-transitions":!1},nativeOn:{click:function(t){return e.tagAdd(i,a)}}},[e._v(" "+e._s(i.tag_name)+" ")])})],2),t("div",{staticClass:"selected-tags view-flex",staticStyle:{"margin-top":"10px"}},[t("div",{staticClass:"label"},[e._v($t("uryxnw5","已选标签：","lang"))]),t("div",{staticClass:"view-flex-item"},e._l(e.tag.currentTags,function(i,a){return t("el-tag",{key:a,attrs:{closable:"",size:"small","disable-transitions":!1},on:{close:function(t){return e.tagRemove(a)}}},[e._v(" "+e._s(i.tag_name)+" ")])}),1)]),t("el-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"primary",plain:""},on:{click:function(t){e.dialogFormVisible=!0}}},[e._v($t("7166jq6"," 批量设置 ","lang"))]),t("el-table",{key:"currentTagKey",attrs:{data:e.tag.currentTags}},[t("el-table-column",{attrs:{prop:"tag_id",label:"ID",width:"180"}}),t("el-table-column",{attrs:{prop:"tag_name",label:$t("dmuom24","标签名称","lang"),width:"180"}}),t("el-table-column",{attrs:{prop:"limit_num",label:$t("dxs3qg4","每人限购","lang"),width:"280"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{on:{input:function(t){return e.inputChange(i.$index,"tag.currentTags")}},model:{value:i.row.limit_num,callback:function(t){e.$set(i.row,"limit_num",t)},expression:"scope.row.limit_num"}},[t("template",{slot:"append"},[e._v($t("e39m3"," 件 ","lang"))])],2)]}}],null,!1,4042702415)}),t("el-table-column",{attrs:{prop:"limit_fee",label:$t("dxs5zs4","每人限额","lang"),width:"280"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{on:{input:function(t){return e.inputChange(i.$index,"tag.currentTags")}},model:{value:i.row.limit_fee,callback:function(t){e.$set(i.row,"limit_fee",t)},expression:"scope.row.limit_fee"}},[t("template",{slot:"append"},[e._v($t("ehct3"," 元 ","lang"))])],2)]}}],null,!1,2622159306)})],1)],e.brandHidden?e._e():[t("div",{staticClass:"view-flex"},[t("div",{staticClass:"label"},[e._v($t("4aduwg5","未选品牌：","lang"))]),t("div",{staticClass:"view-flex-item"},e._l(e.brand.brands,function(i,a){return t("el-tag",{key:a,staticClass:"tag-item",attrs:{size:"medium",color:"#ffffff","disable-transitions":!1},nativeOn:{click:function(t){return e.brandAdd(i,a)}}},[e._v(" "+e._s(i.attribute_name)+" ")])}),1)]),t("div",{staticClass:"selected-tags view-flex",staticStyle:{"margin-top":"10px"}},[t("div",{staticClass:"label"},[e._v($t("up3qqg5","已选品牌：","lang"))]),t("div",{staticClass:"view-flex-item"},e._l(e.brand.currentBrands,function(i,a){return t("el-tag",{key:a,attrs:{closable:"",size:"small","disable-transitions":!1},on:{close:function(t){return e.brandRemove(a)}}},[e._v(" "+e._s(i.attribute_name)+" ")])}),1)]),t("el-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"primary",plain:""},on:{click:function(t){e.dialogFormVisible=!0}}},[e._v($t("7166jq6"," 批量设置 ","lang"))]),t("el-table",{key:"currentBrandKey",attrs:{data:e.brand.currentBrands}},[t("el-table-column",{attrs:{prop:"attribute_id",label:"ID",width:"180"}}),t("el-table-column",{attrs:{prop:"attribute_name",label:$t("b5zpta4","品牌名称","lang"),width:"180"}}),t("el-table-column",{attrs:{prop:"limit_num",label:$t("dxs3qg4","每人限购","lang"),width:"280"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{on:{input:function(t){return e.inputChange(i.$index,"brand.currentBrands")}},model:{value:i.row.limit_num,callback:function(t){e.$set(i.row,"limit_num",t)},expression:"scope.row.limit_num"}},[t("template",{slot:"append"},[e._v($t("e39m3"," 件 ","lang"))])],2)]}}],null,!1,1394363055)}),t("el-table-column",{attrs:{prop:"limit_fee",label:$t("dxs5zs4","每人限额","lang"),width:"280"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{on:{input:function(t){return e.inputChange(i.$index,"brand.currentBrands")}},model:{value:i.row.limit_fee,callback:function(t){e.$set(i.row,"limit_fee",t)},expression:"scope.row.limit_fee"}},[t("template",{slot:"append"},[e._v($t("ehct3"," 元 ","lang"))])],2)]}}],null,!1,792125162)})],1)],t("el-dialog",{attrs:{title:$t("mmu56r6","批量设置限购","lang"),visible:e.dialogFormVisible,width:"500px"},on:{close:e.dialogClose}},[t("el-form",{key:"dialogFormKey",attrs:{model:e.dialogForm}},[t("el-form-item",{staticStyle:{display:"flex"},attrs:{label:$t("5wkab65","每人限购：","lang")}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.dialogForm.limit_num,callback:function(t){e.$set(e.dialogForm,"limit_num",t)},expression:"dialogForm.limit_num"}},[t("template",{slot:"append"},[e._v($t("e39m3"," 件 ","lang"))])],2)],1),t("el-form-item",{staticStyle:{display:"flex"},attrs:{label:$t("5wm8ci5","每人限额：","lang")}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.dialogForm.limit_fee,callback:function(t){e.$set(e.dialogForm,"limit_fee",t)},expression:"dialogForm.limit_fee"}},[t("template",{slot:"append"},[e._v($t("ehct3"," 元 ","lang"))])],2)],1),t("div",[e._v($t("g1827hl","设置后将更新所有参与活动的商品规格限购数量","lang"))])],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v($t("b2spxe5"," 取 消 ","lang"))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.dialogFormConfirm()}}},[e._v($t("fovd945"," 确 定 ","lang"))])],1)],1)],2),t("div",{staticClass:"content-center"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitActivityAction()}}},[e._v($t("cp35x4"," 保存 ","lang"))])],1)],1)],1)},[],!1,null,"f9ab272a",null).exports},88986:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(44114),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es_iterator_constructor_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(18111),core_js_modules_es_iterator_constructor_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_iterator_constructor_js__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es_iterator_for_each_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(7588),core_js_modules_es_iterator_for_each_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es_iterator_for_each_js__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es_iterator_map_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(61701),core_js_modules_es_iterator_map_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es_iterator_map_js__WEBPACK_IMPORTED_MODULE_3__),_components_element_imgBox__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(43224),_components_imageselect__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(87378),_components_function_skuSelector__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(21837),_riophae_vue_treeselect__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(18979),_riophae_vue_treeselect__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_riophae_vue_treeselect__WEBPACK_IMPORTED_MODULE_7__),_api_common__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(59025),_api_goods__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(5748),_api_purchase__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(16519);__webpack_exports__.A={components:{imgBox:_components_element_imgBox__WEBPACK_IMPORTED_MODULE_4__.A,imgPicker:_components_imageselect__WEBPACK_IMPORTED_MODULE_5__.default,SkuSelector:_components_function_skuSelector__WEBPACK_IMPORTED_MODULE_6__.A,Treeselect:_riophae_vue_treeselect__WEBPACK_IMPORTED_MODULE_7___default()},inject:["refresh"],data(){return{pickerOptions:{disabledDate(e){return e.getTime()<new Date((new Date).toLocaleDateString()).getTime()}},form:{purchase_id:"",purchase_name:"",ad_pic:"",item_type:"all",tag_ids:[],begin_time:"",end_time:"",employee_limitfee:"",dependents_limit:"",dependents_limitfee:"",is_share_limitfee:!1,used_roles:["employee"],item_limit:"",minimum_amount:""},activity_date:[],rules:{},imgDialog:!1,isGetImage:!1,roleArr:[{key:"employee",name:$t("ev0t2","员工","lang")},{key:"dependents",name:$t("duft2","亲友","lang")}],allHiden:!1,allLimit:"",zdItemHidden:!0,relItems:[],categoryHidden:!0,categoryList:[],item_category:[],good:{currentGoods:[]},tagHidden:!0,tag:{list:[],currentTags:[],tags:[]},brandHidden:!0,brand:{list:[],currentBrands:[],brands:[]},ItemsList:[],dialogFormVisible:!1,dialogForm:{limit_num:"",limit_fee:""},invalidItemsList:[],itemTreeLists:[]}},mounted(){if(this.fetchMainCate(),this.getAllTagLists(),this.getBrandList("",!0),this.$route.query.id){let filter={purchase_id:this.$route.query.id};(0,_api_purchase__WEBPACK_IMPORTED_MODULE_10__.getPurchaseInfo)(filter).then(res=>{this.form=res.data.data;const{used_roles:used_roles,dependents_limitfee:dependents_limitfee,employee_limitfee:employee_limitfee,item_limit:item_limit,minimum_amount:minimum_amount}=this.form;this.form.used_roles=eval(used_roles),this.form.dependents_limitfee=(dependents_limitfee/100).toFixed(2),this.form.minimum_amount=(minimum_amount/100).toFixed(2),this.form.employee_limitfee=(employee_limitfee/100).toFixed(2),Array.isArray(item_limit)&&item_limit.length>0&&(this.form.item_limit=item_limit.map(e=>(e.limit_fee=(e.limit_fee/100).toFixed(2),e))),this.activity_date=[this.form.begin_date,this.form.end_date],"category"===this.form.item_type&&(this.categoryHidden=!1,this.allHiden=!0,this.item_category=this.form.item_limit.map(e=>(e.category_id=e.item_id,e.category_name=e.name,e))),"tag"===this.form.item_type&&(this.tagHidden=!1,this.allHiden=!0,this.tag.currentTags=this.form.item_limit.map(e=>(e.tag_id=e.item_id,e.tag_name=e.name,e))),"brand"===this.form.item_type&&(this.brandHidden=!1,this.allHiden=!0,this.brand.currentBrands=this.form.item_limit.map(e=>(e.attribute_id=e.item_id,e.attribute_name=e.name,e))),"item"===this.form.item_type&&(this.zdItemHidden=!1,this.allHiden=!0,this.$nextTick(()=>{this.relItems=res.data.data.itemTreeLists})),"all"===this.form.item_type&&(this.allHiden=!1,this.allLimit=this.form.item_limit)})}},methods:{handleImgChange(){this.imgDialog=!0,this.isGetImage=!0},pickImg(e){"image/jpeg"===e.image_type||"image/png"===e.image_type?(this.form.ad_pic=e.url,this.imgDialog=!1):this.$message({type:"warning",message:$t("ay2ks4g","仅支持格式为png、jpg的图片","lang")})},closeImgDialog(){this.imgDialog=!1},itemTypeChange:function(e){this.allHiden=!0,this.zdItemHidden=!0,this.categoryHidden=!0,this.tagHidden=!0,this.brandHidden=!0,this.itemTreeLists=[],this.item_category=[],this.tag.currentTags=[],this.form.item_type=e,this.dialogForm={limit_num:"",limit_fee:""},"item"===e?(this.zdItemHidden=!1,this.good.currentGoods=[]):"category"===e?(this.categoryHidden=!1,this.item_category=[]):"tag"===e?(this.tagHidden=!1,this.tag.currentTags=[],this.showTags()):"brand"===e?(this.brandHidden=!1,this.brand.currentBrands=[],this.showBrands()):"all"===e&&(this.allHiden=!1)},fetchMainCate:function(){(0,_api_goods__WEBPACK_IMPORTED_MODULE_9__.getCategory)({is_main_category:!0,ignore_none:!0}).then(e=>{this.categoryList=e.data.data})},getItems(e){const{item_limit:t}=this.form;Array.isArray(t)&&t.length>0?this.good.currentGoods=e.map(e=>(this.form.item_limit.forEach(t=>{e.itemId===t.item_id&&(e.limit_fee=t.limit_fee,e.limit_num=t.limit_num)}),e)):this.good.currentGoods=e},dialogClose(){this.dialogFormVisible=!1},inputChange(index,arr){const curObj=eval("this."+arr),tempObj=curObj[index];this.$set(curObj,index,tempObj),this.$forceUpdate()},uploadHandleChange(e,t){let i={isUploadFile:!0,file_type:"purchase_goods",file:e.raw};(0,_api_common__WEBPACK_IMPORTED_MODULE_8__.handleUploadFile)(i).then(e=>{this.$message({type:"success",message:$t("a6esth4","上传成功","lang")});let{data:t}=e.data;if(t.fail.length>0){let e=t.fail.map(e=>e.item_bn);setTimeout(()=>{this.$message({showClose:!0,message:`${$t("ojz3zza","以下商品编号不存在：","lang")}${e}`,type:"error",duration:5e3})},1500)}if(t.succ.length<=0)return;this.relItems=t.succ;let i=[];t.succ.forEach(e=>{e.nospec?i.push(e):i.push(Object.assign(e,{spec_items:[]}))})})},uploadHandleTemplate(){let e={file_type:"purchase_goods",file_name:$t("b44ik94","商品模板","lang")};(0,_api_common__WEBPACK_IMPORTED_MODULE_8__.exportUploadTemplate)(e).then(e=>{let{data:t}=e.data;if(t.file){var i=document.createElement("a");i.href=t.file,i.download=t.name,document.body.appendChild(i),i.click(),i.remove()}else this.$message({type:"error",message:$t("yndnt89","没有相关数据可导出","lang")})})},getAllTagLists:function(){(0,_api_goods__WEBPACK_IMPORTED_MODULE_9__.getTagList)({page:1,pageSize:500}).then(e=>{this.tag.list=e.data.data.list,this.showTags()})},showTags:function(){let e=[];this.tag.tags=[...this.tag.list],this.tag.tags.forEach((t,i)=>{-1==this.tag.currentTags.findIndex(e=>e.tag_id==t.tag_id)&&e.push(t)}),this.tag.tags=e},tagAdd:function(e,t){-1==this.tag.currentTags.findIndex(t=>t.tag_id==e.tag_id)&&(this.tag.currentTags.push(e),this.tag.tags.splice(t,1)),this.form.tag_ids=[],this.tag.currentTags.forEach(e=>{this.form.tag_ids.push(e.tag_id)})},tagRemove:function(e){this.tag.tags.unshift(this.tag.currentTags[e]),this.tag.currentTags.splice(e,1),this.form.tag_ids=[];let t=[];this.tag.currentTags.forEach(e=>{this.form.tag_ids.push(e.tag_id);let i=[];this.ItemsList.forEach(t=>{-1!=t.tag_ids.indexOf(e.tag_id)&&i.push(t)}),t=i}),this.ItemsList=t,this.getItems(this.ItemsList)},getBrandList:function(e="",t=!1){const i=[];(0,_api_goods__WEBPACK_IMPORTED_MODULE_9__.getGoodsAttr)({page:1,pageSize:1e3,attribute_type:"brand",attribute_name:e,attribute_ids:t?this.form.brand_id:""}).then(e=>{for(let t of e.data.data.list)i.push({attribute_name:t.attribute_name,attribute_id:t.attribute_id});this.brand.list=i,this.showBrands()})},showBrands:function(){let e=[];this.brand.brands=[...this.brand.list],this.brand.brands.forEach((t,i)=>{-1==this.brand.currentBrands.findIndex(e=>e.attribute_id==t.attribute_id)&&e.push(t)}),this.brand.brands=e},brandRemove:function(e){let t=[];this.ItemsList.forEach(i=>{this.brand.currentBrands[e].attribute_id!=i.brand_id&&t.push(i)}),this.ItemsList=t,this.getItems(this.ItemsList),this.brand.brands.unshift(this.brand.currentBrands[e]),this.brand.currentBrands.splice(e,1)},brandAdd:function(e,t){-1==this.brand.currentBrands.findIndex(t=>t.attribute_id==e.attribute_id)&&(this.brand.currentBrands.push(e),this.brand.brands.splice(t,1))},submitActivityAction(){const e=this;if(!(this.activity_date.length>0))return this.$message({type:"error",message:$t("dvs78h8","请选择活动时间!","lang")}),!1;if(this.form.begin_time=this.activity_date[0],this.form.end_time=this.activity_date[1],"brand"===this.form.item_type){const e=this.brand.currentBrands.map(e=>{const t={};return t.id=e.attribute_id,t.limit_fee=e.limit_fee,t.limit_num=e.limit_num,t});this.form.item_limit=e}if("tag"===this.form.item_type){const e=this.tag.currentTags.map(e=>{const t={};return t.id=e.tag_id,t.limit_fee=e.limit_fee,t.limit_num=e.limit_num,t});this.form.item_limit=e}if("category"===this.form.item_type){const e=this.item_category.map(e=>{const t={};return t.id=e.category_id,t.limit_fee=e.limit_fee,t.limit_num=e.limit_num,t});this.form.item_limit=e}if("item"===this.form.item_type){const e=this.good.currentGoods.map(e=>{const t={};return t.id=e.itemId,t.limit_fee=e.limit_fee,t.limit_num=e.limit_num,t});this.form.item_limit=e}"all"===this.form.item_type&&(this.form.item_limit=this.allLimit),this.form.purchase_id?(0,_api_purchase__WEBPACK_IMPORTED_MODULE_10__.editPurchase)(this.form).then(t=>{if(!t.data.data.purchase_id)return this.$message.error($t("uzl20e5","保存失败!","lang")),!1;this.loading=!1,this.$message({message:$t("deua4r4","更新成功","lang"),type:"success",duration:2e3,onClose(){e.refresh(),e.$router.go(-1)}})}):(0,_api_purchase__WEBPACK_IMPORTED_MODULE_10__.createPurchase)(this.form).then(t=>{if(!t.data.data.purchase_id)return this.$message.error($t("uzl20e5","保存失败!","lang")),!1;this.loading=!1,this.$message({message:$t("e7ygyc4","添加成功","lang"),type:"success",duration:2e3,onClose(){e.refresh(),e.$router.go(-1)}})})},dialogFormConfirm(){const e=this.form.item_type;let t=[];const{limit_num:i,limit_fee:a}=this.dialogForm;switch(e){case"item":t=this.good.currentGoods;break;case"tag":t=this.tag.currentTags;break;case"category":t=this.item_category;break;case"brand":t=this.brand.currentBrands}t.forEach((e,l)=>{e.limit_num=i,e.limit_fee=a,this.$set(t,l,e),this.$forceUpdate()}),this.dialogFormVisible=!1}}}}}]);