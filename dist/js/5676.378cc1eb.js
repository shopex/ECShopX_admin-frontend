"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[5676],{55676:function(t,e,a){a.r(e),a.d(e,{default:function(){return o}});a(44114);var n=a(79296),i=a(77825),l={name:"ExtMiniLink",mixins:[i.Ay,i.v8],data(){return{params:{app_name:""},rules:{app_name:[{required:!0,message:$t("ofhtff8","请输入小程序id","lang"),trigger:"blur"}],app_id:[{required:!0,message:$t("of2x8z8","请输入小程序名称","lang"),trigger:"blur"}]},modalTitle:$t("enbu325","添加小程序","lang"),showModal:!1,isHttping:!1,tableLoading:!1,editInfo:{app_id:"",app_name:"",app_desc:""}}},mounted(){this.init()},methods:{init(){this.fetchList()},showEditModal(t={}){t&&t.wx_external_config_id&&(this.modalTitle=$t("th1c545","修改小程序","lang"),this.editInfo={app_id:t.app_id,app_name:t.app_name,app_desc:t.app_desc,wx_external_config_id:t.wx_external_config_id}),this.modalTitle=$t("enbu325","添加小程序","lang"),this.showModal=!0},closeModal(){this.editInfo={app_id:"",app_name:"",app_desc:""},this.$refs.editForm.resetFields(),this.showModal=!1},async editWxConfig(){if(this.isHttping)return!1;this.isHttping=!0;const t=this.editInfo;let e=n.createWxLinkSetting;t.wx_external_config_id&&(e=n.updateWxLinkSetting);try{await e(t),this.closeModal(),this.fetchList(!1)}catch(t){}this.isHttping=!1},jumpDetail(t){const e=this.matchRoutePath("editor");this.$router.push({path:e,query:{id:t.wx_external_config_id}})},removeCurrent(t){const e=this;this.$confirm($t("rz8md9","确认删除当前设置？","lang")).then(a=>{(0,n.removeWxLinkSetting)({id:t.wx_external_config_id}).then(t=>{this.$message({message:$t("azeh8z4","删除成功","lang"),type:"success",onClose(){e.page.total_count%e.page.pageIndex==1&&e.page.pageIndex>1?(e.page.pageIndex-=1,e.fetchList(!0)):e.fetchList(!1)}})})}).catch(t=>{})},async fetchList(t=!0){this.tableLoading=!0,t&&(this.params.page=1);const{pageIndex:e,pageSize:a}=this.page;let n={page:e,pageSize:a,...this.params};const{total_count:i,list:l}=await this.$api.wxa.getWxLinkListSetting(n);this.tableList=l,this.page.total_count=i,this.tableLoading=!1}}},s=(0,a(81656).A)(l,function(){var t=this,e=t._self._c;return e("SpPage",[e("SpRouterView",[e("SpFilterForm",{attrs:{model:t.params},on:{onSearch:t.onSearch,onReset:t.onSearch}},[e("SpFilterFormItem",{attrs:{prop:"app_name",label:$t("18p1x86","小程序名称:","lang")}},[e("el-input",{attrs:{placeholder:$t("of2x8z8","请输入小程序名称","lang")},model:{value:t.params.app_name,callback:function(e){t.$set(t.params,"app_name",e)},expression:"params.app_name"}})],1)],1),e("div",{staticClass:"action-container"},[e("el-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(e){return t.showEditModal("")}}},[t._v($t("fvpaq4"," 新增 ","lang"))])],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],staticClass:"table",attrs:{border:"",data:t.tableList}},[e("el-table-column",{attrs:{prop:"created_at",label:$t("ar7uqh4","创建日期","lang"),width:"220"}}),e("el-table-column",{attrs:{prop:"app_id",label:$t("qk9tah8","小程序APPID","lang"),width:"220"}}),e("el-table-column",{attrs:{prop:"app_name",label:$t("kky1o65","小程序名称","lang"),width:"320"}}),e("el-table-column",{attrs:{prop:"app_desc",label:$t("hrlt2","描述","lang"),width:"520"}}),e("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),width:"320"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{staticClass:"actBtn",attrs:{type:"text"},on:{click:function(e){return t.showEditModal(a.row)}}},[t._v($t("juz394"," 编辑 ","lang"))]),e("el-button",{staticClass:"actBtn",attrs:{type:"text"},on:{click:function(e){return t.jumpDetail(a.row)}}},[t._v($t("8c8dc26"," 页面路径 ","lang"))]),e("el-button",{staticClass:"actBtn",attrs:{type:"text"},on:{click:function(e){return t.removeCurrent(a.row)}}},[t._v($t("db22k4"," 删除 ","lang"))])]}}])})],1),t.page.total>t.page.pageSize?e("div",{staticClass:"mt-4 text-right"},[e("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":t.page.pageIndex,"page-sizes":[10,20,50],total:t.page.total,"page-size":t.page.pageSize},on:{"update:currentPage":function(e){return t.$set(t.page,"pageIndex",e)},"update:current-page":function(e){return t.$set(t.page,"pageIndex",e)},"current-change":t.onCurrentChange,"size-change":t.onSizeChange}})],1):t._e(),e("el-dialog",{staticClass:"modal",attrs:{width:"30%",title:t.modalTitle,visible:t.showModal},on:{close:t.closeModal}},[e("el-form",{ref:"editForm",staticClass:"form",attrs:{"label-suffix":":","label-width":"120px",rules:t.rules,model:t.editInfo}},[e("el-form-item",{attrs:{label:$t("kky1o65","小程序名称","lang"),prop:"app_name"}},[e("el-input",{model:{value:t.editInfo.app_name,callback:function(e){t.$set(t.editInfo,"app_name",e)},expression:"editInfo.app_name"}})],1),e("el-form-item",{attrs:{label:$t("qk9tah8","小程序APPID","lang"),prop:"app_id"}},[e("el-input",{model:{value:t.editInfo.app_id,callback:function(e){t.$set(t.editInfo,"app_id",e)},expression:"editInfo.app_id"}})],1),e("el-form-item",{attrs:{label:$t("hrlt2","描述","lang")}},[e("el-input",{attrs:{type:"textarea",placeholder:$t("niv1qoa","请输入内容（非必填）","lang"),resize:"none",maxlength:"30","show-word-limit":"",rows:3},model:{value:t.editInfo.app_desc,callback:function(e){t.$set(t.editInfo,"app_desc",e)},expression:"editInfo.app_desc"}})],1)],1),e("div",{staticClass:"btns"},[e("el-button",{staticClass:"btn",on:{click:t.closeModal}},[t._v($t("b2spxe5"," 取 消 ","lang"))]),e("el-button",{staticClass:"btn",attrs:{type:"primary",loading:t.isHttping},on:{click:function(e){return e.stopPropagation(),t.editWxConfig.apply(null,arguments)}}},[t._v($t("fovd945"," 确 定 ","lang"))])],1)],1)],1)],1)},[],!1,null,"dfb62512",null),o=s.exports}}]);