"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[2466],{92466:function(e,t,a){a.r(t),a.d(t,{default:function(){return m}});a(44114);var l=a(5134),i=(a(87378),a(43224)),n=a(98818),r=a(65124),o={inject:["refresh"],components:{imgBox:i.A},data(){return{pickerOptions2:{shortcuts:[{text:$t("dl4oop4","最近一周","lang"),onClick(e){const t=new Date;t.setHours(23,59,59,0);const a=new Date;a.setHours(0,0,0,0),t.setTime(t.getTime()+6048e5),e.$emit("pick",[a,t])}},{text:$t("4znkgj5","最近一个月","lang"),onClick(e){const t=new Date;t.setHours(23,59,59,0);const a=new Date;a.setHours(0,0,0,0),t.setTime(t.getTime()+2592e6),e.$emit("pick",[a,t])}},{text:$t("4zndsa5","最近三个月","lang"),onClick(e){const t=new Date;t.setHours(23,59,59,0);const a=new Date;a.setHours(0,0,0,0),t.setTime(t.getTime()+7776e6),e.$emit("pick",[a,t])}}]},used_scene:{1:$t("hypfnl4","订单抵扣","lang")},level:0,levelData:[],monthOptions:[],weekOptions:[],dayOptions:[],memberDay:{month:"",week:"",day:"",begin_time:"",end_time:"",date:[]},submitLoading:!1,condition:"",vipGrade:[],memberGrade:[],form:{activity_id:"",title:"",trigger_condition:[],begin_time:"",end_time:"",is_forever:!1,upvaluation:"",max_up_point:"",valid_grade:[],used_scene:["1"]},activity_date:"",imgDialog:!1}},mounted(){function e(e){var t="";switch(e){case 1:t=$t("feo1","一","lang");break;case 2:t=$t("fik1","二","lang");break;case 3:t=$t("fex1","三","lang");break;case 4:t=$t("h5n1","四","lang");break;case 5:t=$t("fis1","五","lang");break;case 6:t=$t("g311","六","lang");break;case 7:t=$t("k4l1","日","lang")}return t}for(var t=[],a=[],l=[],i=0;i<12;i++){let e={};e.value=i+1,e.label=e.value+$t("kco1","月","lang"),t.push(e)}for(i=0;i<7;i++){let t={};t.value=i+1,t.label=$t("hxpc2","星期","lang")+e(t.value),a.push(t)}for(i=0;i<31;i++){let e={};e.value=i+1,e.label=e.value+$t("k4l1","日","lang"),l.push(e)}this.monthOptions=t,this.weekOptions=a,this.dayOptions=l,(0,n.listVipGrade)().then(e=>{null!=e&&e.data.data&&e.data.data.length>0&&(this.vipGrade=e.data.data)}),(0,r.getGradeList)().then(e=>{if(null!=e&&e.data.data&&e.data.data.length>0){var t=e.data.data;t&&(this.memberGrade=t)}}),this.$route.params.id&&this.getActivityDetail(this.$route.params.id)},methods:{dateChange(e){this.memberDay.date=e},submitActivityAction(){const e=this;let t="",a="";this.memberDay.date.length>0&&(t=this.memberDay.date[0],a=this.memberDay.date[1]);let i={type:this.condition,month:this.memberDay.month,week:this.memberDay.week,day:this.memberDay.day,begin_time:t,end_time:a};this.form.trigger_condition={trigger_time:i},this.activity_date.length>0&&(this.form.begin_time=this.activity_date[0],this.form.end_time=this.activity_date[1]);let n=JSON.stringify(this.form);n=JSON.parse(n),n.items=JSON.stringify(n.items),n.item_category=JSON.stringify(n.item_category),this.form.activity_id?(0,l.updatePointupvaluation)(n).then(t=>{if(!t.data.data.activity_id)return this.$message.error($t("uzl20e5","保存失败!","lang")),!1;this.loading=!1,this.$message({message:$t("deua4r4","更新成功","lang"),type:"success",duration:2e3,onClose(){e.refresh(),e.$router.go(-1)}})}):(0,l.createPointupvaluation)(n).then(t=>{if(!t.data.data.activity_id)return this.$message.error($t("uzl20e5","保存失败!","lang")),!1;this.loading=!1,this.$message({message:$t("e7ygyc4","添加成功","lang"),type:"success",duration:2e3,onClose(){e.refresh(),e.$router.go(-1)}})})},getTaskTime(e){let t=new Date(e),a=t.getFullYear(),l=t.getMonth()+1;l=l<10?"0"+l:l;let i=t.getDate();return i=i<10?"0"+i:i,a+"-"+l+"-"+i},getActivityDetail(e){(0,l.getPointupvaluationInfo)({activity_id:e}).then(e=>{let t=e.data.data,a={activity_id:t.activity_id,title:t.title,trigger_condition:t.trigger_condition,begin_time:t.begin_time,end_time:t.end_time,upvaluation:t.upvaluation,max_up_point:t.max_up_point,valid_grade:t.valid_grade,used_scene:t.used_scene,is_forever:t.is_forever};Object.assign(this.form,a);const l=t.trigger_condition.trigger_time;this.activity_date=[t.begin_date,t.end_date],this.condition=l.type,this.memberDay.day=Number(l.day||1),this.memberDay.month=Number(l.month||1),this.memberDay.week=Number(l.week||1);const{begin_date:i,end_date:n}=l;this.memberDay.date=[i||"",n||""]})},formatDate(e,t){const a=Number(t)||1,l=[$t("feo1","一","lang"),$t("fik1","二","lang"),$t("fex1","三","lang"),$t("h5n1","四","lang"),$t("fis1","五","lang"),$t("g311","六","lang"),$t("k4l1","日","lang")];return{week:`${$t("hxpc2","星期","lang")}${l[a-1]}`,month:`${a}${$t("kco1","月","lang")}`,day:`${a}${$t("k4l1","日","lang")}`}[e]},handleCancel:function(){this.$router.go(-1)}}},s=(0,a(81656).A)(o,function(){var e=this,t=e._self._c;return t("SpPage",[t("el-form",{ref:"form",staticClass:"box-set",attrs:{model:e.form,"label-width":"120px"}},[t("el-card",{attrs:{header:$t("ijkaav6","积分升值活动","lang"),shadow:"naver"}},[t("el-form-item",{attrs:{label:$t("e4hvdc4","活动名称","lang"),prop:"title",rules:{required:!0,message:$t("750pjq6","活动名称必填","lang"),trigger:"blur"}}},[t("el-col",{attrs:{span:8}},[t("el-input",{attrs:{maxlength:30,placeholder:$t("jel5hj7","请输入活动名称","lang")},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1)],1),t("el-form-item",{attrs:{label:$t("e4l2kr4","活动时间","lang")}},[t("el-date-picker",{attrs:{type:"datetimerange",align:"right","value-format":"yyyy-MM-dd HH:mm:ss","unlink-panels":"","range-separator":$t("po31","至","lang"),"start-placeholder":$t("cd0ag54","开始日期","lang"),"end-placeholder":$t("gfhy2u4","结束日期","lang"),disabled:e.form.is_forever,"default-time":["00:00:00","23:59:59"],"picker-options":e.pickerOptions2},model:{value:e.activity_date,callback:function(t){e.activity_date=t},expression:"activity_date"}}),e._v("     "),t("el-checkbox",{model:{value:e.form.is_forever,callback:function(t){e.$set(e.form,"is_forever",t)},expression:"form.is_forever"}},[e._v($t("q5tipr6"," 长期有效 ","lang"))])],1),t("el-form-item",{attrs:{label:$t("hwbe2","日期","lang")}},[t("el-radio-group",{model:{value:e.condition,callback:function(t){e.condition=t},expression:"condition"}},[t("el-radio",{attrs:{label:"every_year"}},[e._v($t("gsyzf4"," 每年 ","lang"))]),t("el-radio",{attrs:{label:"every_month"}},[e._v($t("gufif4"," 每月 ","lang"))]),t("el-radio",{attrs:{label:"every_week"}},[e._v($t("gr9gn4"," 每周 ","lang"))]),t("el-radio",{attrs:{label:"date"}},[e._v($t("buvwml6"," 指定日期 ","lang"))])],1),t("transition",{attrs:{name:"el-fade-in-linear"}},["every_year"===e.condition?t("div",[t("el-select",{attrs:{placeholder:$t("2ekhas5","请选择月份","lang")},model:{value:e.memberDay.month,callback:function(t){e.$set(e.memberDay,"month",t)},expression:"memberDay.month"}},e._l(e.monthOptions,function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),t("el-select",{attrs:{placeholder:$t("2ekjhr5","请选择日期","lang")},model:{value:e.memberDay.day,callback:function(t){e.$set(e.memberDay,"day",t)},expression:"memberDay.day"}},e._l(e.dayOptions,function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e(),"every_month"===e.condition?t("div",[t("el-select",{attrs:{placeholder:$t("2ekjhr5","请选择日期","lang")},model:{value:e.memberDay.day,callback:function(t){e.$set(e.memberDay,"day",t)},expression:"memberDay.day"}},e._l(e.dayOptions,function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e(),"every_week"===e.condition?t("div",[t("el-select",{attrs:{placeholder:$t("2eki3t5","请选择星期","lang")},model:{value:e.memberDay.week,callback:function(t){e.$set(e.memberDay,"week",t)},expression:"memberDay.week"}},e._l(e.weekOptions,function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e(),"date"===e.condition?t("div",{staticStyle:{width:"350px"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":$t("po31","至","lang"),"start-placeholder":$t("cd0ag54","开始日期","lang"),"end-placeholder":$t("gfhy2u4","结束日期","lang"),"value-format":"yyyy-MM-dd"},on:{change:e.dateChange},model:{value:e.memberDay.date,callback:function(t){e.$set(e.memberDay,"date",t)},expression:"memberDay.date"}})],1):e._e()])],1),t("el-form-item",{attrs:{label:$t("au9y8o4","升值倍数","lang"),prop:"upvaluation",rules:{required:!0,message:$t("nbg9426","升值倍数必填","lang"),trigger:"blur"}}},[e._v($t("4lx36ie"," 活动期内，每个积分升值为 ","lang")),t("el-input",{staticStyle:{width:"150px"},attrs:{maxlength:30,placeholder:$t("mot2m77","请输入升值倍数","lang")},model:{value:e.form.upvaluation,callback:function(t){e.$set(e.form,"upvaluation",t)},expression:"form.upvaluation"}}),e._v($t("e9xv3"," 倍 ","lang"))],1),t("el-form-item",{attrs:{label:$t("e1146l4","每日积分","lang")}},[e._v($t("ro6gsli"," 活动期内，每个客户每天最多可使用 ","lang")),t("el-input",{staticStyle:{width:"150px"},attrs:{type:"number",placeholder:"",min:1,max:9999999},model:{value:e.form.max_up_point,callback:function(t){e.$set(e.form,"max_up_point",t)},expression:"form.max_up_point"}}),e._v($t("7nx81ic"," 积分用于积分升值活动 ","lang")),t("div",{staticStyle:{"font-size":"12px",color:"#999"}},[e._v($t("sy3kdg1o"," 活动期内，每个客户每天升值后积分 = 每日积分 × 升值倍数，积分抵扣订单金额=（升值后积分+普通积分）× 抵扣比例 ","lang"))])],1),t("el-form-item",{attrs:{label:$t("infiw44","适用会员","lang")}},[t("el-checkbox-group",{model:{value:e.form.valid_grade,callback:function(t){e.$set(e.form,"valid_grade",t)},expression:"form.valid_grade"}},[e._l(e.memberGrade,function(a){return t("el-checkbox",{key:a.grade_id,attrs:{label:a.grade_id}},[e._v(" "+e._s(a.grade_name)+" ")])}),e._l(e.vipGrade,function(a){return t("el-checkbox",{key:a.lv_type,attrs:{label:a.lv_type}},[e._v($t("euf53"," 付费","lang")+e._s(a.grade_name)+" ")])})],2)],1),t("el-form-item",{attrs:{label:$t("cf147d4","应用场景","lang")}},[t("el-checkbox-group",{model:{value:e.form.used_scene,callback:function(t){e.$set(e.form,"used_scene",t)},expression:"form.used_scene"}},e._l(e.used_scene,function(a,l){return t("el-checkbox",{key:l,attrs:{label:l}},[e._v(" "+e._s(a)+" ")])}),1)],1)],1)],1),t("template",{slot:"page-footer"},[t("div",{staticClass:"text-center"},[t("el-button",{nativeOn:{click:function(t){return e.handleCancel.apply(null,arguments)}}},[e._v($t("m1m0m4"," 返回 ","lang"))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitActivityAction()}}},[e._v($t("cp35x4"," 保存 ","lang"))])],1)])],2)},[],!1,null,null,null),m=s.exports}}]);