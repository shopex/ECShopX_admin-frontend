"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[9767],{79767:function(t,e,i){i.r(e),i.d(e,{default:function(){return u}});i(44114),i(18111),i(7588);var s=i(81193),a=i(2038),o=i(78571),l=i(77825),r=i(95564),n=i(2895),d={components:{DistributorSelect:r.A,ShopSelect:n.A},mixins:[l.v8],props:{status:{type:Boolean,default:!1}},data(){return{oldData:[],isValid:!0,DistributorStatus:!1,ShopStatus:!1,relDistributors:[],relShops:[],DistributorVisible:!1,ShopVisible:!1,isEdit:!1,editVisible:!1,editTitle:"",form:{operator_type:"staff",mobile:"",login_name:"",username:"",distributor_ids:[],password:"",role_id:[]},activeName:"staff",editLoginName:"",editMobile:"",accountsList:[],detailData:{},loading:!1,total_count:0,params:{mobile:"",operator_type:"staff"},operator_id:0,rolesListData:[],datapass_block:0}},watch:{status(t){t&&this.fetchList()}},mounted(){this.fetchList(),this.getRolesListData()},methods:{handleClose(t){this.relDistributors.splice(t,1),this.form.distributor_ids.splice(t,1)},storeHandleClose(t){this.DistributorStatus=!1,this.form.shop_ids.splice(t,1),this.relShops.splice(t,1)},addDistributoreAction(){this.DistributorVisible=!0,this.DistributorStatus=!0},addStoreAction(){this.ShopVisible=!0,this.ShopStatus=!0},getDistributor(t){let e={distributor_id:t};(0,a.getDistributorList)({...e,is_app:1}).then(t=>{this.relDistributors=t.data.data.list,this.oldData=[...t.data.data.list]})},handleCancel(){this.editVisible=!1,this.form.operator_type="staff",this.operator_id="",this.form.login_name="",this.form.mobile="",this.form.username="",this.form.password="",this.form.role_id=[],this.form.distributor_ids=[],this.form.shop_ids=[],this.relDistributors=[],this.relShops=[]},addLabels(){this.handleCancel(),this.editTitle=$t("xxs5tw6","添加账号信息","lang"),this.editVisible=!0,this.isEdit=!1,this.form.username="",this.form.login_name="",this.editLoginName="",this.editMobile="",this.operator_id="",this.form.password="",this.form.role_id=[]},editAction(t,e){if(this.handleCancel(),this.editTitle=$t("1jfmbe6","编辑账号信息","lang"),this.editVisible=!0,this.isEdit=!0,this.form.username=e.username,this.form.login_name=e.login_name,this.editLoginName=e.login_name,this.editMobile=e.mobile,this.operator_id=e.operator_id,this.form.password="",e.role_data.forEach(t=>{this.form.role_id.push(t.role_id)}),e.distributor_ids&&e.distributor_ids.length>0){let t=[];e.distributor_ids.forEach(e=>{t.push(e.distributor_id)}),this.getDistributor(t)}},submitAction(){this.form.shop_ids=[],this.form.distributor_ids=[],this.relShops.length>0&&this.relShops.forEach(t=>{this.form.shop_ids.push({name:t.storeName,shop_id:t.wxShopId})}),this.relDistributors.length>0&&this.relDistributors.forEach(t=>{this.form.distributor_ids.push({name:t.name,distributor_id:t.distributor_id})}),this.operator_id?(0,s.updateAccountInfo)(this.operator_id,this.form).then(t=>{this.detailData=t.data.data,this.editVisible=!1,this.fetchList()}):(0,s.createAccount)(this.form).then(t=>{this.detailData=t.data.data,this.editVisible=!1,this.fetchList(),this.handleCancel()})},fetchList(){this.loading=!0;const{pageIndex:t,pageSize:e}=this.page;let i={page:t,pageSize:e,...this.params};(0,s.getAccountList)(i).then(t=>{let e=t.data.data.list;e.forEach(t=>{1==t.is_disable?t.is_disable="1":t.is_disable="0"}),this.accountsList=e,this.total_count=t.data.data.total_count,this.datapass_block=t.data.data.datapass_block,this.loading=!1})},deleteAccountAction(t,e){this.$confirm($t("yevseng","此操作将删除该账号, 是否继续?","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(()=>{(0,s.deleteAccountInfo)(e.operator_id).then(e=>{this.accountsList.splice(t,1),this.$message({message:$t("azeh8z4","删除成功","lang"),type:"success",duration:5e3})}).catch(()=>{this.$message({type:"error",message:$t("azdahk4","删除失败","lang")})})}).catch(()=>{this.$message({type:"info",message:$t("e68dg3","已取消","lang")})})},acitonDisabled(t,e){if(!0===e.is_disabled){var i=$t("taozdqg","此操作将会禁用该账号，是否继续?","lang");this.$confirm(i,$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(()=>{let t={operator_id:e.operator_id,is_disable:e.is_disable};(0,o.changeOperatorStatus)(t).then(t=>{})})}else{let t={operator_id:e.operator_id,is_disable:e.is_disable};(0,o.changeOperatorStatus)(t).then(t=>{})}},getRolesListData(){(0,s.getRolesList)({page:1,pageSize:100,version:1}).then(t=>{this.rolesListData=t.data.data.list})},DistributorChooseAction(t){this.DistributorVisible=!1,this.DistributorStatus=!1,null===t||t.length<=0||(this.relDistributors=t)},ShopChooseAction(t){this.ShopVisible=!1,this.ShopStatus=!1,null===t||t.length<=0||(this.relShops=t,this.relDistributors=t)},closeDialogAction(){this.ShopVisible=!1,this.ShopStatus=!1,this.relDistributors=this.oldData,this.DistributorStatus=!1,this.DistributorVisible=!1}}},c=(0,i(81656).A)(d,function(){var t=this,e=t._self._c;return e("SpPage",[e("SpFilterForm",{attrs:{model:t.params},on:{onSearch:t.onSearch,onReset:t.onSearch}},[e("SpFilterFormItem",{attrs:{prop:"login_name",label:$t("lcmxm95","登录账号:","lang")}},[e("el-input",{attrs:{placeholder:$t("7dber16","请输入账号名","lang")},model:{value:t.params.login_name,callback:function(e){t.$set(t.params,"login_name",e)},expression:"params.login_name"}})],1),e("SpFilterFormItem",{attrs:{prop:"mobile",label:$t("cttsc24","手机号:","lang")}},[e("el-input",{attrs:{placeholder:$t("7ji3y96","请输入手机号","lang")},model:{value:t.params.mobile,callback:function(e){t.$set(t.params,"mobile",e)},expression:"params.mobile"}})],1),e("SpFilterFormItem",{attrs:{prop:"username",label:$t("djxsw3","姓名:","lang")}},[e("el-input",{attrs:{placeholder:$t("2jaekd5","请输入姓名","lang")},model:{value:t.params.username,callback:function(e){t.$set(t.params,"username",e)},expression:"params.username"}})],1)],1),e("div",{staticClass:"action-container"},[e("el-button",{attrs:{type:"primary",icon:"plus"},on:{click:t.addLabels}},[t._v($t("tzrlgq6"," 添加账号 ","lang"))])],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{border:"",data:t.accountsList}},[e("el-table-column",{attrs:{prop:"login_name",label:$t("fcm8nf4","登录账号","lang")}}),e("el-table-column",{attrs:{prop:"mobile",label:$t("ewbd43","手机号","lang")}}),e("el-table-column",{attrs:{prop:"username",label:$t("fqmy2","姓名","lang")}}),e("el-table-column",{attrs:{prop:"roles",label:$t("o5pc2","角色","lang")},scopedSlots:t._u([{key:"default",fn:function(i){return t._l(i.row.role_data,function(i){return e("el-tag",{key:i.role_id,attrs:{size:"mini",type:"warning"}},[t._v(" "+t._s(i.role_name)+" ")])})}}])}),e("el-table-column",{attrs:{prop:"is_disable",label:$t("lb5z2","禁用","lang"),width:"80"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-switch",{attrs:{"active-value":"1","inactive-value":"0","active-color":"#ff4949","inactive-color":"#ccc"},on:{change:function(e){return t.acitonDisabled(i.$index,i.row)}},model:{value:i.row.is_disable,callback:function(e){t.$set(i.row,"is_disable",e)},expression:"scope.row.is_disable"}})]}}])}),e("el-table-column",{attrs:{label:$t("hkxb2","操作","lang")},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.editAction(i.$index,i.row)}}},[t._v($t("juz394"," 编辑 ","lang"))])]}}])})],1),e("div",{staticClass:"content-center content-top-padded"},[e("el-pagination",{attrs:{layout:"prev, pager, next","current-page":t.page.pageIndex,total:t.total_count,"page-size":t.page.pageSize},on:{"update:currentPage":function(e){return t.$set(t.page,"pageIndex",e)},"update:current-page":function(e){return t.$set(t.page,"pageIndex",e)},"current-change":t.onCurrentChange}})],1),e("el-dialog",{attrs:{title:t.editTitle,visible:t.editVisible,"before-close":t.handleCancel},on:{"update:visible":function(e){t.editVisible=e}}},[[e("el-form",{ref:"form",staticClass:"demo-ruleForm",attrs:{model:t.form,"label-width":"120px"}},[e("el-form-item",{attrs:{label:$t("fcm8nf4","登录账号","lang")}},[e("el-col",{attrs:{span:10}},[t.editLoginName?e("el-input",{attrs:{disabled:!0},model:{value:t.form.login_name,callback:function(e){t.$set(t.form,"login_name",e)},expression:"form.login_name"}}):e("el-input",{attrs:{minlength:4,maxlength:16,placeholder:$t("nbgqgv9","请输入员工登录账号","lang")},model:{value:t.form.login_name,callback:function(e){t.$set(t.form,"login_name",e)},expression:"form.login_name"}})],1),e("p",{staticClass:"frm-tips"},[t._v($t("2iy7hxw","账号名称4-16位，名称使用字母开头，字符有有字母，数字，下划线","lang"))])],1),e("el-form-item",{attrs:{label:$t("ewbd43","手机号","lang")}},[e("el-col",{attrs:{span:10}},[t.isEdit?e("el-input",{attrs:{disabled:!0},model:{value:t.editMobile,callback:function(e){t.editMobile=e},expression:"editMobile"}}):e("el-input",{attrs:{maxlength:11,placeholder:$t("b2kmjg9","请输入11位手机号","lang")},model:{value:t.form.mobile,callback:function(e){t.$set(t.form,"mobile",e)},expression:"form.mobile"}})],1)],1),e("el-form-item",{attrs:{label:$t("fqmy2","姓名","lang")}},[e("el-col",{attrs:{span:10}},[e("el-input",{attrs:{required:"",placeholder:$t("9hpash5","请填写姓名","lang")},model:{value:t.form.username,callback:function(e){t.$set(t.form,"username",e)},expression:"form.username"}})],1)],1),e("el-form-item",{attrs:{label:$t("fce1f94","登录密码","lang")}},[e("el-col",{attrs:{span:10}},[e("el-input",{attrs:{maxlength:255},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1)],1),e("el-form-item",{attrs:{label:$t("cs44ip4","所属店铺","lang")}},[t._l(t.relDistributors,function(i,s){return e("el-tag",{key:i.distributor_id,staticClass:"new-tag",attrs:{closable:"","disable-transitions":!1},on:{close:function(e){return t.handleClose(s)}}},[t._v(" "+t._s(i.name)+" ")])}),e("el-button",{staticClass:"button-new-tag",attrs:{size:"medium"},on:{click:t.addDistributoreAction}},[t._v($t("ud7swa"," + 点击搜索店铺 ","lang"))])],2),e("el-form-item",{attrs:{label:$t("o5pc2","角色","lang")}},[e("el-checkbox-group",{model:{value:t.form.role_id,callback:function(e){t.$set(t.form,"role_id",e)},expression:"form.role_id"}},t._l(t.rolesListData,function(i){return e("el-checkbox",{key:i.role_id,attrs:{label:i.role_id,value:i.role_id}},[t._v(" "+t._s(i.role_name)+" ")])}),1)],1)],1)],e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{nativeOn:{click:function(e){return t.handleCancel.apply(null,arguments)}}},[t._v($t("dd4ni4"," 取消 ","lang"))]),e("el-button",{attrs:{type:"primary"},on:{click:t.submitAction}},[t._v($t("cp35x4"," 保存 ","lang"))])],1)],2),e("DistributorSelect",{attrs:{"store-visible":t.DistributorVisible,"is-valid":t.isValid,"rel-data-ids":t.relDistributors,"get-status":t.DistributorStatus},on:{chooseStore:t.DistributorChooseAction,closeStoreDialog:t.closeDialogAction}}),e("ShopSelect",{attrs:{"store-visible":t.ShopVisible,"is-valid":t.isValid,"rel-data-ids":t.relShops,"old-data":t.oldData,"get-status":t.ShopStatus},on:{chooseStore:t.ShopChooseAction,closeStoreDialog:t.closeDialogAction}})],1)},[],!1,null,"25810b1e",null),u=c.exports}}]);