"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[1850],{11850:function(e,t,r){r.r(t),r.d(t,{default:function(){return _}});r(18111),r(20116),r(44114),r(22489),r(7588),r(61701);var i=r(95353),a=r(77825),s=r(26456),l=r(41776),o=r(5006),n=r(89435),d=r(95093),c=r.n(d),p=r(33318),m={mixins:[a.Ay,a.v8],data(){const e=this.$createElement;return{confirmStatus:!1,personnelDialog:!1,statusPersonnel:!1,loading:!1,defaultTime:["00:00:00","23:59:59"],params:{receiver_mobile:"",mobile:"",order_id:"",original_order_id:"",supplier_name:"",order_class_exclude:"drug,pointsmall,community",salesman_mobile:"",receipt_type:"",self_delivery_status:"",source_id:"",order_status:"",order_class:"",delivery_staff_id:"",is_prescription_order:"",serial_no:"",user_family_name:"",invoice_status:"",time_start_begin:"",time_start_end:"",order_holder:"",distributor_id:"",subDistrict:[],salespersonname:"",role:""},deliveryPersonnel:[],datapass_block:1,subDistrictList:[],roleList:p.oc,distributionType:p.as,distributionStatus:p.oU,orderStatus:(0,s.L3)()||(0,s.go)()?p.i8:(0,s.hd)()?p.dj:p.w8,openStatus:p.Ql,orderType:p.W4,invoiceStatus:p.jY,invoiceStatusArr:p.XO,orderCategory:p.In,pickerOptions:p.Dv,orderSourceList:[],remarkDialog:!1,remarkFormList:[{label:$t("70idij5","备注信息:","lang"),key:"remark",type:"textarea",maxlength:150,placeholder:$t("4dr4fe","请输入对此订单需要备注的内容","lang"),required:!0,message:$t("adohlc4","不能为空","lang")}],remarkForm:{orderId:"",is_distribution:1,remark:""},cancelOrderDialog:!1,cancelOrderFormList:[{component:()=>e("div",{class:"tip-bar"},[$t("a2n8qw13","订单取消后，消费者在商城中看到的订单状态将变更为已取消，无法对其进行支付操作。","lang")])},{label:"",component:()=>e(n.A,{attrs:{orderId:this.cancelOrderForm.order_id},on:{onLoad:this.onLoadCancelOrderRef}})},{label:$t("d6vxbt5","取消原因:","lang"),key:"cancel_reason",placeholder:$t("amt70d9","请选择取消订单原因","lang"),type:"select",options:[{title:$t("pz0w3u8","客户现在不想购买","lang"),value:1},{title:$t("s2wbp58","客户商品价格较贵","lang"),value:2},{title:$t("5ub2dc6","客户价格波动","lang"),value:3},{title:$t("54f4lf6","客户商品缺货","lang"),value:4},{title:$t("2iss7z6","客户重复下单","lang"),value:5},{title:$t("s1oguha","客户订单商品选择有误","lang"),value:6},{title:$t("yfg8h2a","客户支付方式选择有误","lang"),value:7},{title:$t("9z46tka","客户收货信息填写有误","lang"),value:8},{title:$t("ozd78ya","客户发票信息填写有误","lang"),value:9},{title:$t("l4oqme8","客户无法支付订单","lang"),value:10},{title:$t("j4es208","客户长时间未付款","lang"),value:11},{title:$t("5mt8x66","客户其他原因","lang"),value:12}],required:!0,message:$t("adohlc4","不能为空","lang"),onChange:e=>{this.cancelOrderFormList[3].isShow=12==e}},{label:$t("qckd0n5","其他原因:","lang"),key:"other_reason",type:"input",placeholder:$t("bf9qgl9","请填写取消订单原因","lang"),isShow:!1,validator:(e,t,r)=>{12!=this.cancelOrderForm.cancel_reason||t?r():r(new Error($t("adohlc4","不能为空","lang")))}}],cancelOrderForm:{order_id:"",buy_member:"",buy_mobile:"",receive_name:"",receive_mobile:"",receive_address:"",loading:!1,cancel_reason:"",other_reason:""},deliverGoodsDialog:!1,deliverGoodsFormList:[{label:$t("b5qxrg4","发货方式","lang"),key:"delivery_way",type:"radio",disabled:!0,options:[{label:"1",name:$t("h3t32","快递","lang")},{label:"2",name:$t("9mdraq5","商家自配送","lang")}],onChange:e=>{"1"==e?(this.deliverGoodsFormList[1].options=[{label:"batch",name:$t("d5a74n4","整单发货","lang")},{label:"sep",name:$t("csx9py4","拆分发货","lang")}],this.deliverGoodsFormList[3].options=this.logisticsList.filter(e=>"SELF_DELIVERY"!=e.value),this.deliverGoodsForm.delivery_corp=""):(this.deliverGoodsFormList[1].options=[{label:"batch",name:$t("d5a74n4","整单发货","lang")}],this.deliverGoodsForm.delivery_type="batch",this.deliverGoodsFormList[3].options=this.logisticsList.filter(e=>"SELF_DELIVERY"==e.value),this.deliverGoodsForm.delivery_corp="SELF_DELIVERY")}},{label:$t("b5urmu4","发货类型","lang"),key:"delivery_type",type:"radio",disabled:!1,options:[{label:"batch",name:$t("d5a74n4","整单发货","lang")},{label:"sep",name:$t("csx9py4","拆分发货","lang")}],onChange:e=>{this.deliverGoodsFormList[2].options[7].isShow="sep"==e}},{label:"",key:"items",type:"table",options:[{title:$t("cwisy3","商品名","lang"),key:"item_name"},{title:$t("b47jsb4","商品类型","lang"),key:"item_holder",render:(e,t,r)=>this.goodCategoryMap[e.item_holder]},{title:$t("7msy3i5","来源供应商","lang"),key:"supplier_name",width:100,isShow:({key:e},t)=>this.VERSION_STANDARD()||this.IS_ADMIN()},{title:$t("i1y72","数量","lang"),key:"num",width:60},{title:$t("nbuukn5","已发货数量","lang"),key:"delivery_item_num",width:100},{title:$t("mapop37","总支付价（¥）","lang"),key:"total_fee",render:(e,t,r)=>(e.total_fee/100).toFixed(2),width:120},{title:$t("c4yuhd6","成本价（¥）","lang"),key:"cost_price",width:100,render:(e,t,r)=>e.cost_price/100},{title:$t("b5r61h4","发货数量","lang"),key:"item_num",width:160,render:(t,r,i)=>t.num-t.delivery_item_num==0?"":e("el-input-number",{attrs:{size:"mini",min:1,disabled:(0,s.Hr)()&&t.supplier_id>0,max:t.num-t.delivery_item_num},model:{value:t.delivery_num,callback:e=>{this.$set(t,"delivery_num",e)}}}),isShow:!1}]},{label:$t("cp0yj74","快递公司","lang"),key:"delivery_corp",placeholder:$t("whmqve7","请选择快递公司","lang"),type:"select",options:[],required:!0,message:$t("adohlc4","不能为空","lang")},{label:$t("evwh164","物流单号","lang"),key:"delivery_code",type:"input",placeholder:$t("s5y24m6","物流公司单号","lang"),required:!0,isShow:({key:e},t)=>"1"==t.delivery_way,message:$t("adohlc4","不能为空","lang")},{label:$t("lz4hw3","配送员","lang"),key:"self_delivery_operator_id",placeholder:$t("3c0fmb6","请选择配送员","lang"),type:"select",options:[],required:!0,isShow:({key:e},t)=>"2"==t.delivery_way,message:$t("adohlc4","不能为空","lang"),onChange:e=>{let t=this.deliverGoodsFormList[5].options.find(t=>t.operator_id==e)||{},{staff_no:r,mobile:i}=t;this.deliverGoodsForm.self_delivery_operator_mobile=i,this.deliverGoodsForm.self_delivery_operator_staffno=r}},{label:$t("1zwl8k6","配送员手机号","lang"),key:"self_delivery_operator_mobile",type:"input",display:"inline",placeholder:" ",isShow:({key:e},t)=>"2"==t.delivery_way,disabled:!0},{label:$t("iecoit5","配送员编号","lang"),key:"self_delivery_operator_staffno",display:"inline",type:"input",placeholder:" ",isShow:({key:e},t)=>"2"==t.delivery_way,disabled:!0},{label:$t("ixekbj4","配送状态","lang"),key:"self_delivery_status",placeholder:$t("wb3pbe7","请选择配送状态","lang"),type:"select",options:[{title:$t("lz3a13","配送中","lang"),value:"DELIVERING"}],required:!0,isShow:({key:e},t)=>"2"==t.delivery_way,message:$t("adohlc4","不能为空","lang")},{label:$t("ixa9lh4","配送备注","lang"),key:"delivery_remark",type:"input",isShow:({key:e},t)=>"2"==t.delivery_way},{label:$t("av3jlq4","分类图片","lang"),key:"delivery_pics",isShow:({key:e},t)=>"2"==t.delivery_way,component:({key:t},r)=>e("SpImagePicker",{attrs:{drag:!0,max:9},model:{value:r[t],callback:e=>{this.$set(r,t,e)}}}),tip:`${$t("bp0gz52j","1. 最多可上传9张图片，文件格式为bmp、png、jpeg、jpg或gif，大小不超过2M（建议尺寸：500px * 500px）<br />2. 相册图朋友圈分享是否生成小程序码","lang")}`}],deliverGoodsForm:{order_id:"",receipt_type:"",delivery_way:null,delivery_type:"batch",delivery_corp:"",delivery_code:"",type:"",items:[],self_delivery_operator_id:"",self_delivery_operator_mobile:"",self_delivery_operator_staffno:"",self_delivery_status:"",delivery_remark:"",delivery_pics:[]},writeOffDialog:!1,writeOffFormList:[{label:"",key:"items",type:"table",options:[{title:$t("cwisy3","商品名","lang"),key:"item_name"},{title:$t("i1y72","数量","lang"),key:"num",width:60},{title:$t("nbuukn5","已发货数量","lang"),key:"delivery_item_num",width:100},{title:$t("mapop37","总支付价（¥）","lang"),key:"price",width:120}]}],writeOffForm:{order_id:"",pickupcode:"",items:[]},goodCategoryMap:p.g5,refundDialog:!1,refundFormList:[{label:$t("b17rgd4","取消来源","lang"),key:"source",type:"text"},{label:$t("fd5ujm4","申请时间","lang"),key:"applyTime",type:"text"},{label:$t("im43bd4","退款状态","lang"),key:"refundStatus",type:"text"},{label:$t("bpvh2l4","处理进度","lang"),key:"process",type:"text"},{label:$t("im9oyy4","退款金额","lang"),key:"refundPrice",type:"text"},{label:$t("ffimz25","是否退运费","lang"),key:"freight_fee",type:"text",component:({key:t},r)=>e("div",[r[t]>0?$t("k6n1","是","lang"):$t("gme1","否","lang")])},{label:$t("ditdzp5","退运费金额","lang"),key:"freight_fee",type:"text",component:({key:t},r)=>e("div",[r[t]>0?r[t]/100:0])},{label:$t("d3h9kv4","支付方式","lang"),key:"payType",type:"text"},{label:$t("b149oz4","取消原因","lang"),key:"reason",type:"text"},{label:$t("bpsmjv4","处理结果","lang"),key:"check_cancel",type:"radio",options:[{label:"0",name:$t("budzk3","不同意","lang")},{label:"1",name:$t("ettv2","同意","lang")}],onChange:e=>{this.refundFormList[8].isShow="0"==e}},{label:$t("czp1gs4","拒绝原因","lang"),key:"shop_reject_reason",type:"input",placeholder:$t("kjdze37","请输入拒绝原因","lang"),isShow:()=>"0"==this.refundForm.check_cancel,validator:(e,t,r)=>{"0"!=this.refundFormList.check_cancel||t?r():r(new Error($t("adohlc4","不能为空","lang")))}}],refundForm:{order_id:"",source:"",applyTime:"",refundStatus:"",process:"",refundPrice:"",payType:"",reason:"",check_cancel:"1",shop_reject_reason:""},changePriceDialog:!1,changePriceFormList:[{component:()=>e("div",{class:"tip-bar"},[$t("bb8alp10","仅未支付订单可修改价格，改价后请联系买家刷新订单并核实订单金额后再支付。","lang")])},{component:()=>e("div",{class:"receive-info"},[e("div",{class:"receive-item"},[e("label",{class:"item-label"},[$t("byljo3","买家：","lang")]),`${this.changePriceForm.buy_member} | ${this.changePriceForm.buy_mobile}`]),e("div",{class:"receive-item"},[e("label",{class:"item-label"},[`${this.changePriceForm.isZiti?$t("d6anuf4","提货人：","lang"):$t("dcn95d4","收货人：","lang")}`]),`${this.changePriceForm.receive_name} | ${this.changePriceForm.receive_mobile}`]),e("div",{class:"receive-item"},[e("label",{class:"item-label"},[`${this.changePriceForm.isZiti?$t("np8obo5","自提地址：","lang"):$t("ca5zk75","收货地址：","lang")}`]),this.changePriceForm.receive_address])])},{component:()=>e(o.A,{attrs:{value:this.changePriceForm.items,orderId:this.changePriceForm.order_id,itemTotalFee:this.changePriceForm.itemTotalFee,pointFreightFee:this.changePriceForm.pointFreightFee,receiptType:this.changePriceForm.receipt_type,freightFee:this.changePriceForm.freightFee,orderFee:this.changePriceForm.orderFee},on:{onChange:this.onChangeTableView}})}],changePriceForm:{order_id:"",buy_member:"",buy_mobile:"",receive_name:"",receive_mobile:"",receive_address:"",loading:!1,isZiti:!1,items:[],receipt_type:"",itemTotalFee:0,freightFee:0,orderFee:0,pointFreightFee:0},origin:"",isBindOMS:!1,personnelForm:{order_id:"",self_delivery_operator_id:""},personnelFormList:[{label:$t("kuwys3","订单号","lang"),key:"order_id",placeholder:$t("7djicl6","请输入订单号","lang"),type:"input",disabled:!0,required:!0,message:$t("w4f4hg7","订单号不能为空","lang")},{label:$t("lz4hw3","配送员","lang"),key:"self_delivery_operator_id",type:"select",options:[],required:!0,message:$t("bk72b07","配送员不能为空","lang"),isShow:()=>this.statusPersonnel}],logisticsList:[],updateDeliverGoodsDialog:!1,updateDeliverGoodsForm:{order_id:"",self_delivery_operator_id:"",self_delivery_operator_mobile:"",orders_delivery_id:"",self_delivery_status:"",delivery_remark:"",delivery_pics:[],delivery_code:""},updateDeliverGoodsFormList:[{label:$t("cp0yj74","快递公司","lang"),key:"delivery_corp",placeholder:$t("whmqve7","请选择快递公司","lang"),type:"select",options:[],disabled:!0},{label:$t("b5nqyg4","发货单号","lang"),key:"orders_delivery_id",type:"input",placeholder:" ",disabled:!0},{label:$t("lz4hw3","配送员","lang"),key:"self_delivery_operator_id",placeholder:$t("3c0fmb6","请选择配送员","lang"),type:"select",display:"inline",disabled:!0,options:[],required:!0,message:$t("adohlc4","不能为空","lang"),onChange:e=>{let t=this.updateDeliverGoodsFormList[2].options.find(t=>t.operator_id==e)||{},{staff_no:r,mobile:i}=t;this.updateDeliverGoodsForm.self_delivery_operator_mobile=i}},{label:$t("1zwl8k6","配送员手机号","lang"),key:"self_delivery_operator_mobile",type:"input",display:"inline",placeholder:" ",disabled:!0},{label:$t("ixekbj4","配送状态","lang"),key:"self_delivery_status",placeholder:$t("wb3pbe7","请选择配送状态","lang"),type:"select",options:[],required:!0,message:$t("adohlc4","不能为空","lang")},{label:$t("ixa9lh4","配送备注","lang"),key:"delivery_remark",type:"input"},{label:$t("av3jlq4","分类图片","lang"),key:"delivery_pics",component:({key:t},r)=>e("SpImagePicker",{attrs:{drag:!0,max:9},model:{value:r[t],callback:e=>{this.$set(r,t,e)}}}),tip:`${$t("bp0gz52j","1. 最多可上传9张图片，文件格式为bmp、png、jpeg、jpg或gif，大小不超过2M（建议尺寸：500px * 500px）<br />2. 相册图朋友圈分享是否生成小程序码","lang")}`}],selectList:[],is_pharma_industry:!1,jstErpSetting:{}}},computed:{...(0,i.L8)(["login_type","isMicorMall"])},watch:{"deliverGoodsForm.delivery_way"(e){"1"==e?(this.deliverGoodsFormList[1].options=[{label:"batch",name:$t("d5a74n4","整单发货","lang")},{label:"sep",name:$t("csx9py4","拆分发货","lang")}],this.deliverGoodsFormList[3].options=this.logisticsList.filter(e=>"SELF_DELIVERY"!=e.value),this.deliverGoodsForm.delivery_corp="",this.deliverGoodsFormList[5].required=!1,this.deliverGoodsFormList[8].required=!1,this.deliverGoodsFormList[4].required=!0):(this.deliverGoodsFormList[1].options=[{label:"batch",name:$t("d5a74n4","整单发货","lang")}],this.deliverGoodsForm.delivery_type="batch",this.deliverGoodsFormList[3].options=this.logisticsList.filter(e=>"SELF_DELIVERY"==e.value),this.deliverGoodsForm.delivery_corp="SELF_DELIVERY",this.deliverGoodsFormList[5].required=!0,this.deliverGoodsFormList[8].required=!0,this.deliverGoodsFormList[4].required=!1)}},async created(){const{result:e}=await this.$api.trade.isBindOMS();this.isBindOMS=e},async mounted(){this.origin=window.location.origin;const{tab:e,order_id:t,sourceId:r,monitorId:i}=this.$route.query;e&&(this.params.order_status=e),i&&(this.params.monitor_id=i),r&&(this.params.source_id=r),t&&(this.params.order_id=t),this.getBaseSetting(),await this.getJstErpSetting(),this.fetchList(),this.getOrderSourceList(),this.getLogisticsList(),this.getSubDistrictList(),this.getPickupcodeSetting(),this.delivery(),this.$EventBus.$on("event.tradelist.refresh",()=>{this.fetchList()})},methods:{onSearch(){this.page.pageIndex=1,this.$nextTick(()=>{this.fetchList()})},async getJstErpSetting(){const e=await this.$api.third.getJstErpSetting();this.jstErpSetting=e},async getBaseSetting(){const e=await this.$api.company.getGlobalSetting();this.is_pharma_industry="1"==e.medicine_setting.is_pharma_industry},async accountManagement(e){let t={pageSize:999,page:1,finderId:100,operator_type:"self_delivery_staff",is_disable:0};"0"==e?t.staff_type="platform":t.distributor_id=e;let r=await this.$api.trade.accountManagement(t);r.list.forEach(e=>{e.value=e.operator_id,e.title=e.username}),this.personnelFormList[1].options=r.list,this.deliverGoodsFormList[5].options=r.list,this.updateDeliverGoodsFormList[2].options=r.list},assignPersonnel(e){if(1!=this.selectList.length)return this.$message.error($t("5nb7e58","请选择一个订单！","lang"));const{order_id:t,self_delivery_status:r,distributor_id:i,self_delivery_operator_id:a}=this.selectList[0];if(e){if(0!=a)return this.$message.error($t("p84575b","该订单无法分配配送员！","lang"))}else if(this.personnelFormList[1].required=!1,!["RECEIVEORDER","DELIVERING"].includes(r))return this.$message.error($t("x9rraqa","该订单无法取消配送！","lang"));e&&this.accountManagement(i),this.personnelDialog=!0,this.statusPersonnel=e,this.personnelForm={order_id:t,self_delivery_operator_id:""}},async onPersonnelSubmit(){this.statusPersonnel?(await this.$api.trade.orderDeliverystaffConfirm(this.personnelForm),this.$message({message:$t("ay71ee4","分配成功","lang"),type:"success"}),this.personnelDialog=!1):(await this.$api.trade.orderCancelDeliverystaff({order_id:this.personnelForm.order_id}),this.$message({message:$t("b16pa94","取消成功","lang"),type:"success"}),this.personnelDialog=!1),this.fetchList()},async delivery(){let{list:e}=await this.$api.company.getAccountList({pageSize:1e3,page:1,operator_type:"self_delivery_staff"});e.forEach(e=>{e.value=e.operator_id,e.title=e.username}),this.deliveryPersonnel=e},async fetchList(){this.loading=!0;const{pageIndex:e,pageSize:t}=this.page;let r={page:e,pageSize:t,order_type:"normal",...this.params,subdistrict_parent_id:this.params.subDistrict[0],subdistrict_id:this.params.subDistrict[1]};delete r.subDistrict,(0,s.cy)(this.params.create_time)&&this.params.create_time.length>=2&&(r.time_start_begin=c()(this.params.create_time[0]).unix(),r.time_start_end=c()(this.params.create_time[1]).unix()),(0,s.cy)(this.params.delivery_time)&&this.params.delivery_time.length>=2&&(r.delivery_time_begin=c()(this.params.delivery_time[0]).unix(),r.delivery_time_end=c()(this.params.delivery_time[1]).unix()),delete r.create_time,delete r.delivery_time;const{list:i,pager:a,datapass_block:l}=await this.$api.trade.getOrderList(r);this.tableList=i.map(e=>{const t=[],{distributor_id:r,receipt_type:i,cancel_status:a,is_logistics:l,is_invoiced:o,invoice:n,order_status:d,order_status_des:c,ziti_status:p,dada:m,delivery_status:u,pay_status:_,can_apply_aftersales:g,self_delivery_status:h,order_holder:y}=e,f="dada"==i,v="logistics"==i,b="merchant"==i;return"ziti"==i||((0,s.bz)()||0==r)&&"supplier"!=y||"distributor"==this.login_type?(!f&&"NO_APPLY_CANCEL"==a&&["NOTPAY","PAYED"].includes(d)&&"DONE"!=p&&(!f||f&&["0","1"].includes(m.data_status))&&("ziti"==i?("distributor"==y&&(0,s.JR)()||(0,s.Hr)()&&"distributor"!=y)&&t.push({name:$t("b1drz94","取消订单","lang"),key:"cancel"}):t.push({name:$t("b1drz94","取消订单","lang"),key:"cancel"})),"PAYED"==d&&"ziti"==i&&"PENDING"==p&&t.push({name:$t("ijm02","核销","lang"),key:"writeOff"}),f&&["NO_APPLY_CANCEL","FAILS"].includes(a)&&"PAYED"==d&&"DONE"!=u&&"0"==m.dada_status&&t.push({name:$t("hemo2","接单","lang"),key:"takeOrder"}),f&&"PAYED"==_&&"9"==m.dada_status&&t.push({name:$t("frz0444","确认退回","lang"),key:"orderSendBack"}),!(v||l||b)||f||"PAYED"!=d||"DONE"==u||"ziti"==i||"WAIT_PROCESS"==a||this.jstErpSetting?.is_open||t.push({name:$t("f14m2","发货","lang"),key:"deliverGoods"}),"WAIT_PROCESS"==a&&"PAYED"==d&&t.push({name:$t("p2ym2","退款","lang"),key:"refund"}),"0"==o&&n&&t.push({name:$t("eghwt3","待开票","lang"),key:"waitInvoice"}),"merchant"==i&&"WAIT_BUYER_CONFIRM"==d&&"DONE"!=h&&t.push({name:$t("des6gi4","更新发货","lang"),key:"updatedelivery"}),"merchant"==i&&["CONFIRMING","RECEIVEORDER"].includes(h)&&"PAYED"===d&&t.push({name:$t("e8jus3","已打包","lang"),key:"confirmpackag"}),t.push({name:$t("fqo12","备注","lang"),key:"remark"})):"supplier"==y&&(!f&&"NO_APPLY_CANCEL"==a&&["NOTPAY","PAYED"].includes(d)&&"DONE"!=p&&(!f||f&&["0","1"].includes(m.data_status))&&t.push({name:$t("b1drz94","取消订单","lang"),key:"cancel"}),t.push({name:$t("fqo12","备注","lang"),key:"remark"})),"NOTPAY"==d&&((0,s.fE)()?(this.IS_ADMIN()&&0==r||this.IS_DISTRIBUTOR())&&t.push({name:$t("hnfi2","改价","lang"),key:"changePrice"}):(0,s.hd)()||t.push({name:$t("hnfi2","改价","lang"),key:"changePrice"})),1==g&&((0,s.fE)()?(this.IS_ADMIN()&&0==r||this.IS_DISTRIBUTOR())&&t.push({name:$t("fd2mro4","申请售后","lang"),key:"salesAfter"}):(0,s.hd)()||t.push({name:$t("fd2mro4","申请售后","lang"),key:"salesAfter"})),{...e,actionBtns:t}}),this.page.total=a?a.count:0,this.datapass_block=l,this.loading=!1},async getSubDistrictList(){const e=await this.$api.subdistrict.getSubDistrictList();this.subDistrictList=e},getOrderCategoryName(e){return this.orderCategory.find(t=>t.value==e)?.title??""},getOrderType({order_class:e,type:t}){if("normal"==e)return"1"==t?$t("i9z8we4","跨境订单","lang"):$t("divfxb4","普通订单","lang");const r=p.W4.find(t=>t.value==e);return r?r.title:void 0},getDistributionType({receipt_type:e}){const t=p.as.find(t=>t.value==e);if(t)return t.title},getDistributionStatus({self_delivery_status:e}){const t=p.oU.find(t=>t.value==e);if(t)return t.title},async getOrderSourceList(){const{list:e}=await this.$api.datacube.getSourcesList({page:1,pageSize:1e3});this.orderSourceList=e.map(({sourceName:e,sourceId:t})=>({title:e,value:t}))},async getLogisticsList(){const{list:e}=await this.$api.trade.getLogisticsList();this.logisticsList=e.map(e=>({title:e.name,value:e.value})),this.deliverGoodsFormList[3].options=this.logisticsList,this.logisticsList.push({title:$t("9mdraq5","商家自配送","lang"),value:"SELF_DELIVERY"}),this.updateDeliverGoodsFormList[0].options=this.logisticsList},async handleAction({order_id:e,order_status:t,distributor_remark:r,items:i,distributor_id:a,delivery_type:l,delivery_status:o,receipt_type:n,orders_delivery_id:d,self_delivery_operator_id:m,delivery_corp:u,self_delivery_operator_mobile:_,delivery_code:g,self_delivery_status:h,order_holder:y},{key:f}){if("remark"==f)this.$refs.remarkDialogRef.resetForm(),this.remarkForm.orderId=e,this.remarkForm.remark=r,this.remarkDialog=!0;else if("cancel"==f)this.$refs.cancelOrderDialogRef.resetForm(),this.cancelOrderFormList[0].isShow="PAYED"!=t,this.cancelOrderForm.order_id=e,this.cancelOrderForm.loading=!0,this.cancelOrderDialog=!0;else if("deliverGoods"==f){if(this.isBindOMS&&this.IS_ADMIN())return this.$message.warning($t("tckdokb","请至OMS处理订单发货","lang"));await this.accountManagement(a),this.deliverGoodsForm.delivery_way="merchant"==n?"2":"1",this.deliverGoodsForm.self_delivery_operator_id=["PACKAGED","RECEIVEORDER"].includes(h)?m:"",this.deliverGoodsForm.self_delivery_operator_mobile=["PACKAGED","RECEIVEORDER"].includes(h)?_:"";let t=this.deliverGoodsFormList[5].options.find(e=>e.operator_id==m)?.staff_no??"";this.deliverGoodsForm.self_delivery_operator_staffno=["PACKAGED","RECEIVEORDER"].includes(h)?t:"",this.deliverGoodsForm.delivery_remark="",this.deliverGoodsForm.delivery_pics=[],this.$refs.deliverGoodsDialogRef.resetForm(),this.deliverGoodsForm.order_id=e,this.deliverGoodsForm.receipt_type=n,this.deliverGoodsForm.items=i.map(e=>({...e,price:e.price/100})),this.deliverGoodsForm.type=l,this.deliverGoodsForm.delivery_type="batch",this.deliverGoodsForm.delivery_corp="",this.deliverGoodsForm.delivery_code="","PARTAIL"==o||"self_supplier"==y?(this.deliverGoodsForm.delivery_type="sep",this.deliverGoodsFormList[1].disabled=!0,this.deliverGoodsFormList[2].options[7].isShow=!0):(this.deliverGoodsFormList[1].disabled=!1,this.deliverGoodsFormList[2].options[7].isShow=!1),this.deliverGoodsDialog=!0}else if("writeOff"==f)this.$refs.writeOffDialogRef.resetForm(),this.writeOffForm.order_id=e,this.writeOffForm.items=i.map(e=>({...e,price:e.price/100})),this.writeOffDialog=!0;else if("takeOrder"==f)this.$confirm($t("8zir98d","请在接单前确认商品当前库存","lang"),$t("cx567u4","接单提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(async()=>{await this.$api.trade.doBusinessReceipt(e),this.$message.success($t("cx4nvj4","接单成功","lang"))});else if("orderSendBack"==f)this.$confirm($t("frz0444","确认退回","lang"),$t("w4w05a6","确认退回提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(async()=>{await this.$api.trade.confirmBack(e),this.$message.success($t("ij1qzx4","退回成功","lang"))});else if("refund"==f){this.$refs.refundRef.resetForm(),this.refundDialog=!0;const{cancel_from:t,create_time:r,refund_status:i,progress:a,fee_symbol:s,total_fee:l,pay_type:o,pay_channel:n,cancel_reason:d}=await this.$api.trade.getCancelOrderInfo(e,{order_type:"normal"});this.refundForm={...this.refundForm,order_id:e,source:"buyer"==t?$t("kff1qw5","消费者申请","lang"):$t("ysidro6","系统自动取消","lang"),applyTime:c()(1e3*r).format("YYYY-MM-DD HH:mm:ss"),refundStatus:p.ks[i],process:p.hi[a],refundPrice:`${s}${l/100}`,payType:n?p.CV[n]:p.CV[o],reason:d}}else if("waitInvoice"==f)this.$confirm($t("ektlr8c","确定更新该订单开票状态？","lang"),$t("hn562","提示","lang"),{cancelButtonText:$t("ev022","取消","lang"),confirmButtonText:$t("kzjg2","确定","lang"),type:"warning"}).then(async()=>{const{success:t}=await this.$api.trade.isInvoiced({order_id:e,status:1});this.fetchList(),t?this.$message.success($t("75zb4x7","已更新开票状态","lang")):this.$message.error($t("4q13i58","更新开票状态失败","lang"))});else if("changePrice"==f){this.changePriceDialog=!0,this.changePriceForm.loading=!0;const{orderInfo:t,distributor:r,profit:i,tradeInfo:a}=await this.$api.trade.getOrderDetail(e),{store_address:s,store_name:l}=r,{items:o=[],user_id:n,receiver_name:d,receiver_mobile:c,receiver_state:p,receiver_city:m,receiver_district:u,receiver_address:_,order_class:g,total_fee:h,freight_fee:y,item_fee_new:f,item_total_fee:v,receipt_type:b,point_freight_fee:$}=t,{username:k,mobile:F}=await this.$api.member.getMember({user_id:n});this.changePriceForm.loading=!1,this.changePriceForm.order_id=e,this.changePriceForm.buy_member=k,this.changePriceForm.buy_mobile=F,"excard"==g||"shopadmin"==g||"normal"==g&&"ziti"==b?(this.changePriceForm.receive_name=k,this.changePriceForm.receive_mobile=F,this.changePriceForm.receive_address=`${s}（${l}）`,this.changePriceForm.isZiti=!0):(this.changePriceForm.receive_name=d,this.changePriceForm.receive_mobile=c,this.changePriceForm.receive_address=`${p}${m}${u}${_}`,this.changePriceForm.isZiti=!1),this.changePriceForm.receipt_type=b,this.changePriceForm.freightFee=y/100,this.changePriceForm.orderFee=h/100,this.changePriceForm.itemTotalFee=v/100,this.changePriceForm.pointFreightFee=$/100,this.changePriceForm.items=o.map(e=>({...e,change_discount:"",change_price:"",total:v/100}))}else if("salesAfter"==f){const t=(0,s.DT)();this.$router.push({path:`${t?`/${t}`:""}/order/order-manage/order-list/after-sale/${e}`})}else"updatedelivery"==f?(this.$refs.updateDeliverGoodsDialogRef.resetForm(),this.updateDeliverGoodsForm.delivery_pics=[],this.updateDeliverGoodsForm.delivery_remark="",this.updateDeliverGoodsDialog=!0,this.updateDeliverGoodsForm.order_id=e,this.updateDeliverGoodsForm.orders_delivery_id=d,this.updateDeliverGoodsForm.self_delivery_operator_id="0"!=m&&m?m:"",this.updateDeliverGoodsForm.delivery_corp=u,this.updateDeliverGoodsForm.self_delivery_operator_mobile=_,this.updateDeliverGoodsForm.delivery_code=g,this.updateDeliverGoodsForm.self_delivery_status="","CONFIRMING"==h?(this.updateDeliverGoodsFormList[4].options=[{title:$t("lz3a13","配送中","lang"),value:"DELIVERING"}],this.updateDeliverGoodsFormList[2].disabled=!1):(this.updateDeliverGoodsFormList[2].disabled=!0,this.updateDeliverGoodsFormList[4].options=[{title:$t("egnkf3","已送达","lang"),value:"DONE"},{title:$t("e68dg3","已取消","lang"),value:"CONFIRMING"}])):"confirmpackag"==f&&this.$confirm($t("fuwwkf6","是否确认打包","lang"),$t("b432q54","商品打包","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang")}).then(async()=>{await this.$api.trade.confirmpackag({order_id:e}),this.$message.success($t("cr36zl4","打包成功","lang")),this.fetchList()})},onLoadCancelOrderRef(){this.cancelOrderForm.loading=!1},async onRemarkSubmit(){await this.$api.order.remarks(this.remarkForm),this.$message.success($t("rzycyb9","订单备注修改成功!","lang")),this.remarkDialog=!1,this.fetchList()},async onCancelOrderSubmit(){const{order_id:e}=this.cancelOrderForm;await this.$api.trade.cancelOrderConfirm(e,this.cancelOrderForm),this.cancelOrderDialog=!1,this.$message.success($t("zgosdp7","订单取消成功!","lang")),this.fetchList()},async updateDeliverGoodsSubmit(){const{orders_delivery_id:e,delivery_corp:t,self_delivery_status:r,self_delivery_operator_id:i,delivery_code:a,delivery_remark:s,delivery_pics:l}=this.updateDeliverGoodsForm,o={delivery_corp:t,self_delivery_status:r,self_delivery_operator_id:i,delivery_remark:s,delivery_pics:l,delivery_code:a};await this.$api.trade.updateLogistics(e,o);this.$message.success($t("aellqi5","更新成功!","lang")),this.updateDeliverGoodsDialog=!1,this.fetchList()},async deliverGoodsSubmit(){const{order_id:e,delivery_type:t,delivery_corp:r,delivery_code:i,type:a,items:s,receipt_type:l,delivery_way:o,self_delivery_operator_id:n,self_delivery_status:d,delivery_pics:c,delivery_remark:p}=this.deliverGoodsForm;let m={};m="2"==o?{order_id:e,delivery_type:t,delivery_corp:r,type:a,self_delivery_operator_id:n,self_delivery_status:d,delivery_pics:c,delivery_remark:p}:{order_id:e,delivery_type:t,delivery_corp:r,delivery_code:i,type:a},"sep"==t&&(m.sepInfo=JSON.stringify(s.filter(e=>e.delivery_num))),this.confirmStatus=!0;const{delivery_status:u}=await this.$api.trade.delivery(m);this.deliverGoodsDialog=!1,this.$nextTick(()=>{this.confirmStatus=!1}),this.fetchList(),u&&"PENDING"!=u?this.$message.success($t("97ym6c5","发货成功!","lang")):this.$message.error($t("98zfs95","发货失败!","lang"))},async writeOffSubmit(){const{order_id:e}=this.writeOffForm,{ziti_status:t}=await this.$api.trade.doWriteoff(e,this.writeOffForm);"DONE"==t?this.$message.success($t("cza3sh9","自提订单核销成功!","lang")):this.$message.error($t("cy9a6k9","自提订单核销失败!","lang")),this.writeOffDialog=!1},async refundSubmit(){const{order_id:e,check_cancel:t,shop_reject_reason:r}=this.refundForm,{refund_status:i}=await this.$api.trade.cancelConfirm(e,{order_id:e,check_cancel:t,shop_reject_reason:r});"AUDIT_SUCCESS"==i?this.$message.success($t("gv1tj15","审核通过!","lang")):"SHOP_CHECK_FAILS"==i?this.$message.success($t("j11vzv6","审核已拒绝!","lang")):this.$message.error($t("gmztyu5","审核失败!","lang")),this.refundDialog=!1},async changePriceSubmit(){const{items:e,freightFee:t,order_id:r,pointFreightFee:i}=this.changePriceForm;let a={order_id:r,down_type:"items"};t>=0&&(a.freight_fee=100*(t-i)),e.length>0&&(a.items=e.map(e=>({item_id:e.item_id,total_fee:e.total_fee}))),await this.$api.trade.changePriceConfirm(a),this.changePriceDialog=!1,this.fetchList()},handleSelectionChange(e){this.selectList=e},async salesAfterSubmit(){},exportInvoice(){let e="normal";this.$emit("onChangeData","params",{type:e}),(0,l.exportInvoice)({...this.params,type:e,order_type:"normal",invoice_status:"ALL"}).then(e=>{const{status:t,url:r,filename:i}=e.data.data;if(t)return this.$message.success($t("xdh90kk","已加入执行队列，请在设置-导出列表中下载","lang")),void this.$export_open("invoice");r?window.open(r):this.$message.error($t("thm90yh","无内容可导出或执行失败，请检查重试","lang"))}).catch(e=>{})},exportDataNormal(){this.exportData("normal_order")},exportDataMaster(){this.exportData("normal_master_order")},async handleExport(e){"exportInvoice"===e?this.exportInvoice():"exportDataMaster"===e?this.exportDataMaster():"exportDataNormal"===e&&this.exportDataNormal()},exportData(e){let t={...this.params,order_type:"normal",type:e,page:this.page.pageIndex};(0,s.cy)(this.params.create_time)&&this.params.create_time.length>=2&&(t.time_start_begin=c()(this.params.create_time[0]).unix(),t.time_start_end=c()(this.params.create_time[1]).unix()),(0,s.cy)(this.params.delivery_time)&&this.params.delivery_time.length>=2&&(t.delivery_time_begin=c()(this.params.delivery_time[0]).unix(),t.delivery_time_end=c()(this.params.delivery_time[1]).unix()),delete t.create_time,delete t.delivery_time,(0,l.orderExport)(t).then(t=>{const{status:r,url:i,filename:a}=t.data.data;if(r)return this.$message.success($t("xdh90kk","已加入执行队列，请在设置-导出列表中下载","lang")),void this.$export_open(e);i?window.open(i):this.$message.error($t("thm90yh","无内容可导出或执行失败，请检查重试","lang"))})},async uploadHandleChange(e){const t={isUploadFile:!0,file_type:"normal_orders",file:e.raw};await this.$api.common.handleUploadFile(t),this.$message.success($t("dn5eu39","上传成功，等待处理","lang")),this.fetchList()},async uploadHandlePatchCancel(e){const t={isUploadFile:!0,file_type:"normal_orders_cancel",file:e.raw};await this.$api.common.handleUploadFile(t),this.$message.success($t("dn5eu39","上传成功，等待处理","lang")),this.fetchList()},async getPickupcodeSetting(){const{pickupcode_status:e}=await this.$api.company.getPickupcodeSetting();e&&this.writeOffFormList.push({label:$t("d6ga9c4","提货码:","lang"),key:"pickupcode",type:"input",placeholder:$t("7j3g5b6","请输入提货码","lang"),required:!0,message:$t("adohlc4","不能为空","lang")})},onChangeTableView({items:e,item_fee_new:t,freight_fee:r,total_fee:i,item_total_fee:a}){this.changePriceForm.freightFee=r/100,this.changePriceForm.orderFee=i/100,this.changePriceForm.itemTotalFee=a/100,this.changePriceForm.items=e.map(e=>({...e,change_discount:"",change_price:"",total:a/100}))},async downloadtemplate(){const{name:e,file:t}=await this.$api.common.download();if(t){var r=document.createElement("a");r.href=t,r.download=e,document.body.appendChild(r),r.click(),r.remove()}}}},u=m,_=(0,r(81656).A)(u,function(){var e=this,t=e._self._c;return t("SpRouterView",[t("SpPage",[t("SpFilterForm",{attrs:{model:e.params},on:{onSearch:e.onSearch,onReset:e.onSearch}},[t("SpFilterFormItem",{attrs:{prop:"mobile",label:$t("cttsc24","手机号:","lang")}},[t("el-input",{attrs:{placeholder:$t("m6m16f9","请输入客户手机号码","lang")},model:{value:e.params.mobile,callback:function(t){e.$set(e.params,"mobile",t)},expression:"params.mobile"}})],1),t("SpFilterFormItem",{attrs:{prop:"order_id",label:$t("hymdzq4","订单号:","lang")}},[t("el-input",{attrs:{placeholder:$t("7djicl6","请输入订单号","lang")},model:{value:e.params.order_id,callback:function(t){e.$set(e.params,"order_id",t)},expression:"params.order_id"}})],1),e.isMicorMall?e._e():t("SpFilterFormItem",{attrs:{prop:"receipt_type",label:$t("igqeuo5","配送方式:","lang")}},[t("el-select",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:e.params.receipt_type,callback:function(t){e.$set(e.params,"receipt_type",t)},expression:"params.receipt_type"}},e._l(e.distributionType,function(e){return t("el-option",{key:e.value,attrs:{size:"mini",label:e.title,value:e.value}})}),1)],1),e.VERSION_IN_PURCHASE()?e._e():t("SpFilterFormItem",{attrs:{prop:"source_id",label:$t("bc962s5","订单来源:","lang")}},[t("el-select",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:e.params.source_id,callback:function(t){e.$set(e.params,"source_id",t)},expression:"params.source_id"}},e._l(e.orderSourceList,function(e){return t("el-option",{key:e.value,attrs:{size:"mini",label:e.title,value:e.value}})}),1)],1),e.VERSION_STANDARD()||e.IS_ADMIN()?t("SpFilterFormItem",{attrs:{prop:"supplier_name",label:$t("njl71k6","来源供应商:","lang")}},[t("el-input",{attrs:{placeholder:$t("7msy3i5","来源供应商","lang")},model:{value:e.params.supplier_name,callback:function(t){e.$set(e.params,"supplier_name",t)},expression:"params.supplier_name"}})],1):e._e(),e.VERSION_IN_PURCHASE()?e._e():t("SpFilterFormItem",{attrs:{prop:"order_class",label:$t("b99wcp5","订单类型:","lang")}},[t("el-select",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:e.params.order_class,callback:function(t){e.$set(e.params,"order_class",t)},expression:"params.order_class"}},e._l(e.orderType,function(e){return t("el-option",{key:e.value,attrs:{size:"mini",label:e.title,value:e.value}})}),1)],1),e.is_pharma_industry?t("SpFilterFormItem",{attrs:{prop:"is_prescription_order",label:$t("bqv4l36","是否处方药:","lang")}},[t("el-select",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:e.params.is_prescription_order,callback:function(t){e.$set(e.params,"is_prescription_order",t)},expression:"params.is_prescription_order"}},[t("el-option",{attrs:{label:$t("en402","全部","lang"),value:""}}),t("el-option",{attrs:{label:$t("k6n1","是","lang"),value:"1"}}),t("el-option",{attrs:{label:$t("gme1","否","lang"),value:"0"}})],1)],1):e._e(),e.is_pharma_industry?t("SpFilterFormItem",{attrs:{prop:"serial_no",label:$t("693jok5","处方编号:","lang")}},[t("el-input",{attrs:{placeholder:$t("lvdv9d7","请输入处方编号","lang")},model:{value:e.params.serial_no,callback:function(t){e.$set(e.params,"serial_no",t)},expression:"params.serial_no"}})],1):e._e(),e.is_pharma_industry?t("SpFilterFormItem",{attrs:{prop:"user_family_name",label:$t("c7gbax4","就诊人:","lang")}},[t("el-input",{attrs:{placeholder:$t("7k83c86","请输入就诊人","lang")},model:{value:e.params.user_family_name,callback:function(t){e.$set(e.params,"user_family_name",t)},expression:"params.user_family_name"}})],1):e._e(),e.VERSION_IN_PURCHASE()?e._e():t("SpFilterFormItem",{attrs:{prop:"delivery_staff_id",label:$t("ix8vg64","配送员:","lang")}},[t("el-select",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:e.params.delivery_staff_id,callback:function(t){e.$set(e.params,"delivery_staff_id",t)},expression:"params.delivery_staff_id"}},e._l(e.deliveryPersonnel,function(e){return t("el-option",{key:e.value,attrs:{size:"mini",label:e.title,value:e.value}})}),1)],1),t("SpFilterFormItem",{attrs:{prop:"role",label:$t("kswuy3","角色:","lang")}},[t("el-select",{attrs:{placeholder:$t("l72nr3","请选择","lang"),clearable:""},model:{value:e.params.role,callback:function(t){e.$set(e.params,"role",t)},expression:"params.role"}},e._l(e.roleList,function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),t("SpFilterFormItem",{attrs:{prop:"create_time",label:$t("vyu3bm5","下单时间:","lang"),size:"max"}},[t("el-date-picker",{attrs:{clearable:"",type:"datetimerange",align:"right",format:"yyyy-MM-dd HH:mm:ss","range-separator":$t("po31","至","lang"),"start-placeholder":$t("cd0ag54","开始日期","lang"),"end-placeholder":$t("gfhy2u4","结束日期","lang"),"prefix-icon":"null","default-time":e.defaultTime,"picker-options":e.pickerOptions},model:{value:e.params.create_time,callback:function(t){e.$set(e.params,"create_time",t)},expression:"params.create_time"}})],1),e.isMicorMall||e.VERSION_IN_PURCHASE()?e._e():t("SpFilterFormItem",{attrs:{prop:"invoice_status",label:$t("w32o875","开票状态:","lang")}},[t("el-select",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:e.params.invoice_status,callback:function(t){e.$set(e.params,"invoice_status",t)},expression:"params.invoice_status"}},e._l(e.invoiceStatusArr,function(e){return t("el-option",{key:e.value,attrs:{size:"mini",label:e.title,value:e.value}})}),1)],1),t("SpFilterFormItem",{attrs:{prop:"delivery_time",label:$t("972ltm5","发货时间:","lang"),size:"max"}},[t("el-date-picker",{attrs:{clearable:"",type:"datetimerange",align:"right",format:"yyyy-MM-dd HH:mm:ss","range-separator":$t("po31","至","lang"),"start-placeholder":$t("cd0ag54","开始日期","lang"),"end-placeholder":$t("gfhy2u4","结束日期","lang"),"prefix-icon":"null","default-time":e.defaultTime,"picker-options":e.pickerOptions},model:{value:e.params.delivery_time,callback:function(t){e.$set(e.params,"delivery_time",t)},expression:"params.delivery_time"}})],1),e.VERSION_SHUYUN()||e.VERSION_B2C()?e._e():t("SpFilterFormItem",{attrs:{prop:"order_holder",label:$t("bfbhny5","订单分类:","lang")}},[t("el-select",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:e.params.order_holder,callback:function(t){e.$set(e.params,"order_holder",t)},expression:"params.order_holder"}},e._l(e.orderCategory,function(e){return t("el-option",{key:e.value,attrs:{size:"mini",label:e.title,value:e.value}})}),1)],1),e.isMicorMall&&"distributor"==e.login_type||e.VERSION_B2C()||e.VERSION_IN_PURCHASE()?e._e():t("SpFilterFormItem",{attrs:{prop:"distributor_id",label:$t("7kd5ck5","来源店铺:","lang")}},[t("SpSelectShop",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:e.params.distributor_id,callback:function(t){e.$set(e.params,"distributor_id",t)},expression:"params.distributor_id"}})],1),e.VERSION_SHUYUN()||e.VERSION_B2C()||e.VERSION_IN_PURCHASE()?e._e():t("SpFilterFormItem",{attrs:{prop:"subDistrict",label:$t("7z4uzi5","选择街道:","lang")}},[t("el-cascader",{attrs:{clearable:"",props:{value:"id",checkStrictly:!0},options:e.subDistrictList},model:{value:e.params.subDistrict,callback:function(t){e.$set(e.params,"subDistrict",t)},expression:"params.subDistrict"}})],1)],1),t("div",{staticClass:"action-container"},[t("el-dropdown",{on:{command:e.handleExport}},[t("el-button",{attrs:{type:"primary",plain:""}},[e._v($t("gr6m3"," 导出","lang")),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"exportInvoice"}},[e._v($t("3lwv9y6"," 发票订单 ","lang"))]),t("el-dropdown-item",{attrs:{command:"exportDataMaster"}},[e._v($t("ag26pe4","主订单 ","lang"))]),t("el-dropdown-item",{attrs:{command:"exportDataNormal"}},[e._v($t("c3glrx4","子订单 ","lang"))])],1)],1),e.IS_SUPPLIER()?t("el-tooltip",{attrs:{effect:"light",content:$t("ym4t5h1a","请将从订单列表导出的主订单文件，删除不想批量发货的订单号，修改物流公司，物流单号后上传即可。","lang"),placement:"top-start"}},[t("el-upload",{staticClass:"btn-upload",attrs:{action:"","on-change":e.uploadHandleChange,"auto-upload":!1,"show-file-list":!1}},[t("el-button",{attrs:{type:"primary",plain:""}},[e._v($t("79aqr06"," 批量发货 ","lang"))])],1)],1):e._e(),t("el-upload",{staticClass:"btn-upload",attrs:{action:"","on-change":e.uploadHandlePatchCancel,"auto-upload":!1,"show-file-list":!1}},[t("el-button",{attrs:{type:"primary",plain:""}},[e._v($t("79g0o86"," 批量取消 ","lang"))])],1),t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.assignPersonnel(!0)}}},[e._v($t("b1zcxp7"," 分配配送员 ","lang"))]),t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.assignPersonnel(!1)}}},[e._v($t("27uxkq6"," 取消配送 ","lang"))])],1),t("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.onSearch},model:{value:e.params.order_status,callback:function(t){e.$set(e.params,"order_status",t)},expression:"params.order_status"}},[e._l(e.orderStatus,function(e){return t("el-tab-pane",{key:e.value,attrs:{label:e.title,name:e.value}})}),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"",data:e.tableList},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{width:"180",prop:"order_id",label:$t("kuwys3","订单号","lang")},scopedSlots:e._u([{key:"default",fn:function(r){return[t("div",{staticClass:"order-num"},[e._v(" "+e._s(r.row.order_id)+" "),t("el-tooltip",{attrs:{effect:"dark",content:$t("fljd2","复制","lang"),placement:"top-start"}},[t("i",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:r.row.order_id,expression:"scope.row.order_id",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.onCopySuccess,expression:"onCopySuccess",arg:"success"}],staticClass:"el-icon-document-copy"})])],1),t("div",{staticClass:"order-store"},[t("el-tooltip",{attrs:{effect:"dark",content:$t("di507i4","来源店铺","lang"),placement:"top-start"}},[t("i",{staticClass:"el-icon-office-building"})]),e._v(" "+e._s(r.row.distributor_name)+" ")],1),t("div",{staticClass:"order-time"},[t("el-tooltip",{attrs:{effect:"dark",content:$t("a72nl44","下单时间","lang"),placement:"top-start"}},[t("i",{staticClass:"el-icon-time"})]),e._v(" "+e._s(e._f("datetime")(r.row.create_time,"YYYY-MM-DD HH:mm:ss"))+" ")],1)]}}])}),t("el-table-column",{attrs:{width:"120",label:$t("hymqnc4","订单分类","lang"),"header-align":"center",prop:"order_holder"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.getOrderCategoryName(t.row.order_holder))+" ")]}}])}),t("el-table-column",{attrs:{prop:"total_fee",width:"120",label:$t("obv0127","实付金额（¥）","lang"),align:"right","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s((t.row.total_fee/100).toFixed(2))+" ")]}}])}),t("el-table-column",{attrs:{prop:"point_fee",width:"120",label:$t("fq5dol4","积分抵扣","lang"),align:"right","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s((t.row.point_fee/100).toFixed(2))+" ")]}}])}),t("el-table-column",{attrs:{prop:"cost_fee",width:"120",label:$t("qm3ye16","结算价（¥）","lang"),align:"right","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s((t.row.cost_fee/100).toFixed(2))+" ")]}}])}),t("el-table-column",{attrs:{width:"100",label:$t("cwnwg35","运费（¥）","lang"),align:"right","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s((t.row.freight_fee/100+t.row.freight_point_fee/100).toFixed(2))+" ")]}}])}),t("el-table-column",{attrs:{prop:"invoice_status",label:$t("b2x14y4","发票状态","lang")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.openStatus?.find(e=>e.value===t.row.invoice_status)?.title)+" ")]}}])}),t("el-table-column",{attrs:{prop:"mobile",label:$t("fxg7tf5","客户手机号","lang")},scopedSlots:e._u([{key:"default",fn:function(r){return[r.row.user_delete||"merchant"===e.login_type?[t("span",[e._v(e._s(r.row.mobile))]),0==e.datapass_block?t("el-tooltip",{attrs:{effect:"dark",content:$t("fljd2","复制","lang"),placement:"top-start"}},[t("i",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:r.row.mobile,expression:"scope.row.mobile",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.onCopySuccess,expression:"onCopySuccess",arg:"success"}],staticClass:"el-icon-document-copy"})]):e._e()]:["distributor"!=e.login_type&&"supplier"!=e.login_type?t("router-link",{attrs:{target:"_blank",to:{path:""+("distributor"!=e.login_type?"/member/member/memberlist/detail":"/shopadmin/member/member/detail"),query:{user_id:r.row.user_id}}}},[e._v(" "+e._s(r.row.mobile)+" ")]):t("span",[e._v(" "+e._s(r.row.mobile)+" ")]),0==e.datapass_block?t("el-tooltip",{attrs:{effect:"dark",content:$t("fljd2","复制","lang"),placement:"top-start"}},[t("i",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:r.row.mobile,expression:"scope.row.mobile",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.onCopySuccess,expression:"onCopySuccess",arg:"success"}],staticClass:"el-icon-document-copy"})]):e._e()]]}}])}),t("el-table-column",{attrs:{prop:"distributor_name",label:$t("di507i4","来源店铺","lang")}}),t("el-table-column",{attrs:{prop:"work_userid",label:$t("gf5d2","导购","lang")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.salesman_info?.work_userid)+" ")]}}])}),"merchant"!=e.login_type?[e.isMicorMall?e._e():t("el-table-column",{attrs:{label:$t("hytrc34","订单类型","lang")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.getOrderType(t.row))+" ")]}}],null,!1,3071688018)})]:e._e(),t("el-table-column",{attrs:{prop:"order_status",label:$t("hys56m4","订单状态","lang")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.order_status_msg)+" ")]}}])}),t("el-table-column",{attrs:{label:$t("ixcclm4","配送方式","lang")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.getDistributionType(t.row))+" ")]}}])}),t("el-table-column",{attrs:{type:"selection",width:"55",fixed:"left"}}),t("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),fixed:"left"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-button",{staticStyle:{"margin-right":"8px"},attrs:{type:"text"}},[t("router-link",{attrs:{to:`${e.$route.path}/detail?orderId=${r.row.order_id}&resource=${e.$route.path}`}},[e._v($t("likox4"," 详情 ","lang"))])],1),t("el-popover",{attrs:{placement:"right",trigger:"hover"}},[t("div",{staticClass:"operating-icons"},[t("el-button",{attrs:{type:"text"}},[t("router-link",{attrs:{to:`${e.$route.path}/process?orderId=${r.row.order_id}&resource=${e.$route.path}`}},[e._v($t("fy0tq4"," 日志 ","lang"))])],1),e._l(r.row.actionBtns,function(i,a){return[t("el-button",{key:`btn-item__${a}`,attrs:{type:"text"},on:{click:function(t){return e.handleAction(r.row,i)}}},[e._v(" "+e._s(i.name)+" ")])]})],2),t("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v($t("inra3"," 更多","lang")),t("i",{staticClass:"el-icon-d-arrow-right"})])],1)]}}])})],2),t("div",{staticClass:"content-padded content-center"},[t("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":e.page.pageIndex,"page-sizes":[10,20,50],total:e.page.total,"page-size":e.page.pageSize},on:{"update:currentPage":function(t){return e.$set(e.page,"pageIndex",t)},"update:current-page":function(t){return e.$set(e.page,"pageIndex",t)},"current-change":e.onCurrentChange,"size-change":e.onSizeChange}})],1)],2),t("SpDialog",{ref:"remarkDialogRef",attrs:{title:`${$t("mk0yu58","修改备注【订单:","lang")}${e.remarkForm.orderId}】`,form:e.remarkForm,"form-list":e.remarkFormList},on:{onSubmit:e.onRemarkSubmit},model:{value:e.remarkDialog,callback:function(t){e.remarkDialog=t},expression:"remarkDialog"}}),t("SpDialog",{ref:"cancelOrderDialogRef",staticClass:"dialog-cancelorder",attrs:{title:`${$t("53n9c48","取消订单【订单:","lang")}${e.cancelOrderForm.order_id}】`,loading:e.cancelOrderForm.loading,form:e.cancelOrderForm,"form-list":e.cancelOrderFormList},on:{onSubmit:e.onCancelOrderSubmit},model:{value:e.cancelOrderDialog,callback:function(t){e.cancelOrderDialog=t},expression:"cancelOrderDialog"}}),t("SpDialog",{ref:"deliverGoodsDialogRef",attrs:{width:"1000px","confirm-status":e.confirmStatus,title:`${$t("7sn7qr6","发货【订单:","lang")}${e.deliverGoodsForm.order_id}】`,form:e.deliverGoodsForm,"form-list":e.deliverGoodsFormList},on:{onSubmit:e.deliverGoodsSubmit},model:{value:e.deliverGoodsDialog,callback:function(t){e.deliverGoodsDialog=t},expression:"deliverGoodsDialog"}}),t("SpDialog",{ref:"updateDeliverGoodsDialogRef",attrs:{width:"1000px",title:`${$t("cqubav8","更新发货【订单:","lang")}${e.updateDeliverGoodsForm.order_id}】`,form:e.updateDeliverGoodsForm,"form-list":e.updateDeliverGoodsFormList},on:{onSubmit:e.updateDeliverGoodsSubmit},model:{value:e.updateDeliverGoodsDialog,callback:function(t){e.updateDeliverGoodsDialog=t},expression:"updateDeliverGoodsDialog"}}),t("SpDialog",{ref:"writeOffDialogRef",attrs:{title:`${$t("9rdkkf6","核销【订单:","lang")}${e.writeOffForm.order_id}】`,form:e.writeOffForm,"form-list":e.writeOffFormList},on:{onSubmit:e.writeOffSubmit},model:{value:e.writeOffDialog,callback:function(t){e.writeOffDialog=t},expression:"writeOffDialog"}}),t("SpDialog",{ref:"refundRef",attrs:{title:`${$t("jozlez6","退款【订单:","lang")}${e.refundForm.order_id}】`,form:e.refundForm,"form-list":e.refundFormList},on:{onSubmit:e.refundSubmit},model:{value:e.refundDialog,callback:function(t){e.refundDialog=t},expression:"refundDialog"}}),t("SpDialog",{ref:"changePriceRef",staticClass:"dialog-changeprice",attrs:{width:"1000px",loading:e.changePriceForm.loading,"destroy-on-close":!0,title:`${$t("qw9gko8","订单改价【订单:","lang")}${e.changePriceForm.order_id}】`,form:e.changePriceForm,"form-list":e.changePriceFormList},on:{onSubmit:e.changePriceSubmit},model:{value:e.changePriceDialog,callback:function(t){e.changePriceDialog=t},expression:"changePriceDialog"}}),t("SpDialog",{ref:"personnel",attrs:{title:e.statusPersonnel?$t("fia2ub5","分配配送员","lang"):$t("b1f2o64","取消配送","lang"),form:e.personnelForm,"form-list":e.personnelFormList},on:{onSubmit:e.onPersonnelSubmit},model:{value:e.personnelDialog,callback:function(t){e.personnelDialog=t},expression:"personnelDialog"}})],1)],1)},[],!1,null,null,null).exports}}]);