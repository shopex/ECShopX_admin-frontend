"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[982],{90982:function(e,a,t){t.r(a),t.d(a,{default:function(){return v}});t(18111),t(7588),t(61701);var l={data(){return{list:[]}},watch:{list:{handler(e){this.$emit("change",e)}}},mounted(){this.getGradeLevel()},methods:{async getGradeLevel(){const e=await this.$api.membercard.getGradeList(),a=await this.$api.cardticket.listVipGrade({is_disabled:"false"}),t=e.map(e=>({grade_id:e.grade_id,grade_name:e.grade_name,coupons:[]})),l=a.map(e=>({grade_id:e.lv_type,grade_name:e.grade_name,coupons:[]}));"member_upgrade"===this.$route.params.type?this.list=t:"member_vip_upgrade"===this.$route.params.type?this.list=l:this.list=[...t,...l]},async addCoupon(e){const{data:a}=await this.$picker.coupon();a.length>0&&(e.coupons=e.coupons.concat(a.map(e=>({id:e.card_id,name:e.title,count:1}))))},deleteCoupon(e,a){e.coupons.splice(a,1)}}},n=t(81656),i=(0,n.A)(l,function(){var e=this,a=e._self._c;return a("el-table",{attrs:{border:"",data:e.list}},[a("el-table-column",{attrs:{label:$t("ac4j244","会员等级","lang"),prop:"grade_name",width:"300"}}),a("el-table-column",{attrs:{label:$t("c1zlc3","优惠券","lang")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._l(t.row.coupons,function(l,n){return a("div",{key:`coupon-item__${n}`,staticClass:"flex items-center"},[a("div",{staticClass:"coupon-name w-[300px]"},[e._v(e._s(l.name))]),a("div",{staticClass:"flex items-center"},[a("span",{staticClass:"mr-1"},[e._v($t("i1y72","数量","lang"))]),a("el-input-number",{staticClass:"mr-2",staticStyle:{width:"100px"},attrs:{size:"mini","controls-position":"right",min:1,max:10},model:{value:l.count,callback:function(a){e.$set(l,"count",a)},expression:"coupon.count"}})],1),a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.deleteCoupon(t.row,n)}}},[e._v($t("eslg2","删除","lang"))])],1)}),a("div",{staticClass:"add-coupon"},[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.addCoupon(t.row)}}},[e._v($t("elb4gb5","添加优惠券","lang"))])],1)],2)]}}])})],1)},[],!1,null,"7f4fe636",null).exports,s={props:{value:{type:Object,default:()=>({})}},data(){return{localValue:{date:this.value.date,is_forever:this.value.is_forever}}},watch:{localValue:{handler(e){this.$emit("change",e)},deep:!0,immediate:!1}}},o=(0,n.A)(s,function(){var e=this,a=e._self._c;return a("div",[a("el-date-picker",{attrs:{disabled:e.localValue.is_forever,type:"daterange","range-separator":$t("po31","至","lang"),"start-placeholder":$t("cd0ag54","开始日期","lang"),"end-placeholder":$t("gfhy2u4","结束日期","lang")},model:{value:e.localValue.date,callback:function(a){e.$set(e.localValue,"date",a)},expression:"localValue.date"}}),a("el-checkbox",{staticClass:"ml-4",model:{value:e.localValue.is_forever,callback:function(a){e.$set(e.localValue,"is_forever",a)},expression:"localValue.is_forever"}},[e._v($t("dzch7w4","永久有效","lang"))])],1)},[],!1,null,"1b732454",null).exports;t(26456);const r={member_birthday:$t("qtgvc01o","尊敬的会员：值此您生日之际，衷心祝您生日快乐！为感谢您对本店的支持，特此赠送您｛赠送内容｝｛数量｝。详情请查看官方小程序","lang"),member_day:$t("vaxvxjz","｛会员日时间｝是｛品牌｝会员日，特此为您奉上｛奖品｝。到店更有其他惊喜","lang"),member_anniversary:$t("fngeli1h","历史上的今天，您成为了｛品牌｝会员。感谢您一路来对｛品牌｝的支持，特此为您奉上｛奖品｝。到店更有其他惊喜。","lang"),member_upgrade:$t("3j1dyq12","恭喜您成为｛品牌｝｛会员等级名称｝，特此为您奉上｛奖品｝。到店更有其他惊喜。","lang"),member_vip_upgrade:$t("f7ous111","恭喜您成为 {品牌} 的 {付费会员等级名称}，特此为您奉上 {赠送内容}","lang")};var c={props:{value:{type:Object,default:()=>({})}},data(){return{localValue:{is_open:this.value.is_open,wxapp_name:this.value.wxapp_name},sms_template:r[this.$route.params.type]}},watch:{localValue:{handler(e){this.$emit("change",e)},deep:!0,immediate:!1}}},u=(0,n.A)(c,function(){var e=this,a=e._self._c;return a("div",[a("div",[a("el-switch",{model:{value:e.localValue.is_open,callback:function(a){e.$set(e.localValue,"is_open",a)},expression:"localValue.is_open"}}),a("p",{staticClass:"leading-normal flex items-center"},[a("span",{staticClass:"text-secondary"},[e._v($t("a0rnwdb","请确保短信账户余额充足","lang"))]),a("router-link",{attrs:{to:{path:e.getUrlPathByLoginType("/setting/system-config/sms-service")},target:"_blank"}},[a("el-link",{staticClass:"ml-2",attrs:{type:"primary"}},[e._v($t("4aedyx6","查看短息账户","lang"))])],1)],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:e.localValue.is_open,expression:"localValue.is_open"}]},["member_birthday"===e.$route.params.type?a("el-input",{staticClass:"!w-[300px] mt-4",attrs:{placeholder:$t("of2x8z8","请输入小程序名称","lang")},model:{value:e.localValue.wxapp_name,callback:function(a){e.$set(e.localValue,"wxapp_name",a)},expression:"localValue.wxapp_name"}}):e._e(),a("div",{staticClass:"sms-template mt-4"},[a("div",{staticClass:"sms-template__title"},[e._v($t("fgr5si4","短信模板","lang"))]),a("div",{staticClass:"sms-template__content"},[e._v(e._s(e.sms_template))])])],1)])},[],!1,null,"534c71cf",null).exports,m=(t(44114),{props:{options:{type:Array,default:()=>[]},value:{type:Object,default:()=>({})}},data(){const e=[],a=[];for(let a=0;a<12;a++)e.push({value:a+1,label:`${a+1}${$t("kco1","月","lang")}`});for(let e=0;e<31;e++)a.push({value:e+1,label:`${e+1}${$t("k4l1","日","lang")}`});return{localValue:{type:this.value?.type,month:this.value?.month,day:this.value?.day,week:this.value?.week},weekOptions:[{value:1,label:$t("fgg803","星期一","lang")},{value:2,label:$t("fggbw3","星期二","lang")},{value:3,label:$t("fgg893","星期三","lang")},{value:4,label:$t("fghyz3","星期四","lang")},{value:5,label:$t("fggc43","星期五","lang")},{value:6,label:$t("fggwd3","星期六","lang")},{value:7,label:$t("fgkxx3","星期日","lang")}],monthOptions:e,dayOptions:a}},watch:{localValue:{handler(e){this.$emit("change",e)},deep:!0,immediate:!1}}}),p=(0,n.A)(m,function(){var e=this,a=e._self._c;return a("div",[a("el-radio-group",{model:{value:e.localValue.type,callback:function(a){e.$set(e.localValue,"type",a)},expression:"localValue.type"}},e._l(e.options,function(t){return a("el-radio",{key:t.value,attrs:{label:t.value}},[e._v(" "+e._s(t.label)+" ")])}),1),"every_year"===e.localValue.type?a("div",{staticClass:"every-year flex items-center"},[a("el-select",{staticStyle:{width:"160px","margin-right":"10px"},attrs:{placeholder:$t("2ekhas5","请选择月份","lang")},model:{value:e.localValue.month,callback:function(a){e.$set(e.localValue,"month",a)},expression:"localValue.month"}},e._l(e.monthOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),a("el-select",{staticStyle:{width:"160px"},attrs:{placeholder:$t("2ekjhr5","请选择日期","lang")},model:{value:e.localValue.day,callback:function(a){e.$set(e.localValue,"day",a)},expression:"localValue.day"}},e._l(e.dayOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e(),"every_month"===e.localValue.type?a("div",{staticClass:"every-month"},[a("el-select",{staticStyle:{width:"160px"},attrs:{placeholder:$t("2ekjhr5","请选择日期","lang")},model:{value:e.localValue.day,callback:function(a){e.$set(e.localValue,"day",a)},expression:"localValue.day"}},e._l(e.dayOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e(),"every_week"===e.localValue.type?a("div",{staticClass:"every-week"},[a("el-select",{staticStyle:{width:"160px"},attrs:{placeholder:$t("2eki3t5","请选择星期","lang")},model:{value:e.localValue.week,callback:function(a){e.$set(e.localValue,"week",a)},expression:"localValue.week"}},e._l(e.weekOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e()],1)},[],!1,null,"31836021",null).exports;const d={member_birthday:[{label:$t("x74gt9a","生日当月1日统一发放","lang"),value:"birthday_month"},{label:$t("5elaoqa","生日当周周日统一发放","lang"),value:"birthday_week"},{label:$t("ai5hly8","生日当日统一发放","lang"),value:"birthday_day"}],member_upgrade:[{label:$t("h0bjgy9","会员升级成功后发放","lang"),value:"member_upgrade"}],member_vip_upgrade:[{label:$t("65wmmrb","付费会员升级成功后发放","lang"),value:"member_vip_upgrade"}],member_anniversary:[{label:$t("oc4w60c","周年入会当月1日统一发放","lang"),value:"anniversary_month"},{label:$t("e9kvbzc","周年入会当周周日统一发放","lang"),value:"anniversary_week"},{label:$t("dtm0bja","周年入会当日统一发放","lang"),value:"anniversary_day"}],member_day:[{label:$t("iuth2","每年","lang"),value:"every_year"},{label:$t("iwih2","每月","lang"),value:"every_month"},{label:$t("isu12","每周","lang"),value:"every_week"}]};var h={data(){this.$createElement;return{formData:{title:"",activity_time:{date:[],is_forever:!1},condition:{type:d[this.$route.params.type][0].value,month:"",day:"",week:""},gift_coupons:[],sms_notice:{is_open:!1,wxapp_name:""}},formItems:[{component:"input",componentProps:{placeholder:$t("jel5hj7","请输入活动名称","lang"),clearable:!0,maxlength:20,showWordLimit:!0},fieldName:"title",formItemClass:"w-1/2",label:$t("e4hvdc4","活动名称","lang"),rules:[{required:!0,message:$t("jel5hj7","请输入活动名称","lang")}]},{component:({h:e,value:a,onInput:t})=>e(o,{attrs:{value:a},on:{change:t}}),fieldName:"activity_time",label:$t("e4l2kr4","活动时间","lang")},{component:({h:e,value:a,onInput:t})=>e(p,{attrs:{value:a,options:d[this.$route.params.type]},on:{change:t}}),fieldName:"condition",label:$t("ifims74","赠送方式","lang")},{component:({h:e,onInput:a})=>e(i,{on:{change:a}}),fieldName:"gift_coupons",label:$t("30um9b5","赠送优惠券","lang")},{component:({h:e,value:a,onInput:t})=>e(u,{attrs:{value:a},on:{change:t}}),fieldName:"sms_notice",label:$t("fgxpjz4","短信通知","lang")}],submitLoading:!1}},methods:{async handleSave(){await this.$refs.formRef.handleSubmit()},async handleSubmit(e){this.submitLoading=!0;let a={};a="member_day"===this.$route.params.type?{type:this.formData.condition.type,month:this.formData.condition.month,week:this.formData.condition.week,day:this.formData.condition.day}:this.formData.condition.type;let t={};this.formData.gift_coupons.forEach(e=>{t[e.grade_id]=e.coupons});const l={title:this.formData.title,activity_type:this.$route.params.type,trigger_condition:{trigger_time:a},discount_config:{coupons:t,version:1},sms_isopen:this.formData.sms_notice.is_open,sms_params:{app_name:this.formData.sms_notice.wxapp_name},is_forever:this.formData.activity_time.is_forever,begin_time:this.formData.activity_time.date[0]?.getTime()/1e3,end_time:this.formData.activity_time.date[1]?.getTime()/1e3};try{await this.$api.promotions.createActivity(l),this.submitLoading=!1,this.$message.success($t("ar737y4","创建成功","lang")),this.$parent.onActivated(),this.$router.go(-2)}catch(e){this.submitLoading=!1}}}},v=(0,n.A)(h,function(){var e=this,a=e._self._c;return a("SpPage",{attrs:{title:$t("tx6v216","创建营销活动","lang")}},[a("div",{staticClass:"text-center",attrs:{slot:"page-footer"},slot:"page-footer"},[a("el-button",{attrs:{loading:e.submitLoading,type:"primary"},on:{click:e.handleSave}},[e._v($t("e32z2","保存","lang"))])],1),a("SpFormPlus",{ref:"formRef",attrs:{"form-type":"normalForm","form-items":e.formItems,"show-default-actions":!1,"label-width":"180px"},on:{submit:e.handleSubmit},model:{value:e.formData,callback:function(a){e.formData=a},expression:"formData"}})],1)},[],!1,null,"a4d26a6e",null).exports}}]);