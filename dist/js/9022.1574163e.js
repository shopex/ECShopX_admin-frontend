"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[9022],{79022:function(e,t,a){a.r(t),a.d(t,{default:function(){return n}});a(44114),a(18111),a(7588);var s=a(95353),i=(a(57270),a(81193)),l={data(){return{defaultProps:{children:"children",label:"name"},isEdit:!1,editRoleVisible:!1,editRoleTitle:"",form:{role_name:"",role_id:"",role_source:"distributor",permission:[]},defaultCheckedKeys:[],rolesList:[],loading:!1,total_count:0,params:{role_name:"",role_source:"distributor",page:1,pageSize:20},menuTreeData:[]}},computed:{...(0,s.L8)(["wheight"])},mounted(){this.getMenu(),this.getRolesDataList()},methods:{handleCancel(){this.editRoleVisible=!1,this.$refs.tree.setCheckedKeys([])},handleCurrentChange(e){this.params.page=e,this.getRolesDataList()},addRoleLabels(){this.editRoleTitle=$t("hxff1h4","角色添加","lang"),this.editRoleVisible=!0,this.isEdit=!1,this.form.role_name="",this.form.role_id="",this.form.role_source="distributor",this.form.permission=[],this.$refs.tree?this.$refs.tree.setCheckedKeys([]):this.defaultCheckedKeys=[]},editRoleAction(e,t){this.editRoleTitle=$t("hxintn4","角色编辑","lang"),this.editRoleVisible=!0,this.isEdit=!0,this.form.role_source="distributor",this.form.role_name=t.role_name,this.form.role_id=t.role_id,this.$refs.tree?this.$refs.tree.setCheckedKeys(t.permission.shopmenu_alias_name):this.defaultCheckedKeys=t.permission.shopmenu_alias_name},submitRoleAction(){var e=this.$refs.tree.getCheckedNodes(),t=[];e.forEach(e=>{e.isChildrenMenu||t.push(e.alias_name)});this.form.permission={shopmenu_alias_name:t,version:3},this.form.role_id?(0,i.updateRolesInfo)(this.form.role_id,this.form).then(e=>{this.editRoleVisible=!1,this.getRolesDataList(),this.handleCancel()}):(0,i.createRoles)(this.form).then(e=>{this.editRoleVisible=!1,this.getRolesDataList(),this.handleCancel()})},roleSearch(){this.params.page=1,this.getRolesDataList()},getRolesDataList(){this.loading=!0,this.params.service_type="timescard",(0,i.getRolesList)(this.params).then(e=>{this.rolesList=e.data.data.list,this.total_count=e.data.data.total_count,this.loading=!1}).catch(e=>{this.loading=!1,this.$message({type:"error",message:$t("o3tx49b","页面已过期，请刷新重试","lang")})})},deleteRoleAction(e,t){this.$confirm($t("sq2zc0g","此操作将删除该角色, 是否继续?","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(()=>{(0,i.deleteRole)(t.role_id).then(t=>{this.rolesList.splice(e,1),this.$message({message:$t("azeh8z4","删除成功","lang"),type:"success",duration:5e3})})}).catch(()=>{this.$message({type:"info",message:$t("e68dg3","已取消","lang")})})},getMenu(){(0,i.getPermissionList)({version:3}).then(e=>{this.menuTreeData=e.data.data})}}},o=(0,a(81656).A)(l,function(){var e=this,t=e._self._c;return t("div",[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-button",{attrs:{type:"primary",icon:"plus"},on:{click:e.addRoleLabels}},[e._v($t("tzhybf6"," 添加角色 ","lang"))])],1),t("el-col",{attrs:{span:12}},[t("el-input",{attrs:{placeholder:$t("hxb80z4","角色名称","lang")},model:{value:e.params.role_name,callback:function(t){e.$set(e.params,"role_name",t)},expression:"params.role_name"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.roleSearch},slot:"append"})],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.rolesList,height:e.wheight-160}},[t("el-table-column",{attrs:{prop:"role_name",label:$t("hxb80z4","角色名称","lang")}}),t("el-table-column",{attrs:{prop:"permission",label:$t("hxen9p4","角色权限","lang")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tree",{attrs:{data:a.row.permission_tree,props:e.defaultProps}})]}}])}),t("el-table-column",{attrs:{label:$t("hkxb2","操作","lang")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticClass:"operating-icons"},[t("i",{staticClass:"iconfont icon-edit1",on:{click:function(t){return e.editRoleAction(a.$index,a.row)}}}),t("i",{staticClass:"mark iconfont icon-trash-alt1",on:{click:function(t){return e.deleteRoleAction(a.$index,a.row)}}})])]}}])})],1),e.total_count>e.params.pageSize?t("div",{staticClass:"content-center content-top-padded"},[t("el-pagination",{attrs:{layout:"prev, pager, next","current-page":e.params.page,total:e.total_count,"page-size":e.params.pageSize},on:{"update:currentPage":function(t){return e.$set(e.params,"page",t)},"update:current-page":function(t){return e.$set(e.params,"page",t)},"current-change":e.handleCurrentChange}})],1):e._e(),t("el-dialog",{attrs:{title:e.editRoleTitle,visible:e.editRoleVisible,"before-close":e.handleCancel},on:{"update:visible":function(t){e.editRoleVisible=t}}},[[t("el-form",{ref:"form",staticClass:"demo-ruleForm",attrs:{model:e.form,"label-width":"90px"}},[t("el-form-item",{attrs:{label:$t("hxb80z4","角色名称","lang")}},[t("el-col",{attrs:{span:14}},[t("el-input",{attrs:{maxlength:20,placeholder:$t("5lqo0me","订单管理员、商品管理员、等等","lang")},model:{value:e.form.role_name,callback:function(t){e.$set(e.form,"role_name",t)},expression:"form.role_name"}})],1)],1),t("el-form-item",{attrs:{label:$t("hxen9p4","角色权限","lang")}},[t("el-tree",{ref:"tree",attrs:{data:e.menuTreeData,"default-checked-keys":e.defaultCheckedKeys,"node-key":"alias_name",props:e.defaultProps,"show-checkbox":""}})],1)],1)],t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{nativeOn:{click:function(t){return e.handleCancel.apply(null,arguments)}}},[e._v($t("dd4ni4"," 取消 ","lang"))]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitRoleAction}},[e._v($t("cp35x4"," 保存 ","lang"))])],1)],2)],1)},[],!1,null,null,null),n=o.exports}}]);