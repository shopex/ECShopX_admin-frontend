"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[8969],{8969:function(t,e,a){a.r(e),a.d(e,{default:function(){return c}});a(44114),a(18111),a(22489),a(7588);var i=a(95353),l=a(91142),s=a(77825),n=a(5134),o={components:{shopSelect:a(25159).default},mixins:[s.v8],provide(){return{refresh:this.fetchList}},data(){const t={specific:{name:void 0,id:void 0},status:"all"};return{initialParams:t,params:{...t},cursymbol:"￥",loading:!1,create_time:"",activityItemParams:{page:1,pageSize:20},mount:"3",memberTagList:[{value:$t("x5xa5v8","---无----","lang"),tag_id:0}],activity_date:"",form:{specific_type:"member_tag",specific_id:"",specific_name:"",cycle_type:"1",start_time:"",end_time:"",discount:0,limit_total_money:0,status:"1"},activityItemTotalCount:0,activityItemListsData:[],total_count:0,list:[],activityItemDialog:!1,ItemLoading:!1,specific_name:"",tabList:[{name:$t("en402","全部","lang"),activeName:"all"},{name:$t("hxqu2","暂存","lang"),activeName:"1"},{name:$t("e656s3","已发布","lang"),activeName:"2"},{name:$t("eb7w2","停用","lang"),activeName:"3"}]}},computed:{...(0,i.L8)(["wheight"])},mounted(){this.getAllMemberTagList(),this.fetchList()},methods:{viewDetail(t){this.$router.push({path:this.matchRoutePath("detail/")+t.id})},onSearch(){this.page.pageIndex=1,this.$nextTick(()=>{this.fetchList()})},onReset(){this.params={...this.initialParams},this.params={...this.params,specific:{id:void 0,name:void 0}},this.onSearch()},handleSelectStore(t){this.params.specific.id=t.tag_id},getParams(){return{...this.params,specific_id:this.params.specific.id||void 0,specific:void 0,status:"all"===this.params.status?void 0:this.params.status}},async fetchList(){this.loading=!0;const{pageIndex:t,pageSize:e}=this.page;let a={page:t,pageSize:e,...this.getParams()};const{list:i,total_count:l}=await this.$api.promotions.getListSpecificcrowddiscount(a);this.tableList=i,this.page.total=Number(l),this.loading=!1},handleTabClick(t,e){this.onSearch()},querySearch(t,e){var a=this.memberTagList;e(t?a.filter(this.createFilter(t)):a)},getAllMemberTagList(){(0,l.getTagList)({page:1,page_size:1e3}).then(t=>{t.data.data.list&&t.data.data.list.forEach(t=>{this.memberTagList.push({value:t.tag_name,tag_id:t.tag_id})})})},createFilter(t){return e=>0===e.value.toLowerCase().indexOf(t.toLowerCase())},selectTag(t){this.form.specific_id=t.tag_id},submitAction(){const t={start_time:this.dateStrToTimeStamp(this.form.start_time),end_time:this.dateStrToTimeStamp(this.form.end_time)};this.form.id?(0,n.updateSpecificcrowddiscount)({...this.form,...t}).then(t=>{this.fetchList(),this.activityItemDialog=!1}):(0,n.createSpecificcrowddiscount)({...this.form,...t}).then(t=>{this.$message.success($t("ar737y4","创建成功","lang")),this.fetchList(),this.activityItemDialog=!1})},cycleType(t){1==t&&this.monthChange()},monthChange(t){var e=new Date,a=e.getMonth();t&&(a=t-1);var i=e.getFullYear(),l=new Date(i,a,1),s=new Date(i,a+1,0,23,59,59);this.form.start_time=l,this.form.end_time=s},addActivityData(){this.form={specific_type:"member_tag",specific_id:"",specific_name:"",cycle_type:"1",start_time:"",end_time:"",discount:0,limit_total_money:0,status:"1"},this.activityItemDialog=!0,this.monthChange()},editActivityAction(t,e){this.activityItemDialog=!0,this.form=e,this.form.start_time=1e3*e.start_time,this.form.end_time=1e3*e.end_time,1==this.form.cycle_type&&this.monthChange()},handleCancel(){this.activityItemDialog=!1},dateStrToTimeStamp(t){return Date.parse(new Date(t))/1e3},updateStatusCommunityAction(t){var e=$t("3pkh9yi","此操作将永久终止该活动, 是否继续?","lang");this.$confirm(e,$t("hn562","提示","lang"),{cancelButtonText:$t("ev022","取消","lang"),confirmButtonText:$t("kzjg2","确定","lang"),type:"warning",beforeClose:(e,a,i)=>{"confirm"===e&&removeMarketingActivity({marketing_id:t.marketing_id,isEnd:!0}).then(t=>{this.fetchList(),this.$message({message:$t("c6bhfy8","修改活动状态成功","lang"),type:"success",duration:5e3})}),i()}})}}},r=(0,a(81656).A)(o,function(){var t=this,e=t._self._c;return e("SpPage",[e("SpRouterView",[t.VERSION_SHUYUN()?t._e():e("SpPlatformTip",{attrs:{h5:"",app:"",pc:"",alipay:""}}),e("SpFilterForm",{attrs:{model:t.params},on:{onSearch:t.onSearch,onReset:t.onReset}},[e("SpFilterFormItem",{attrs:{prop:"specific",label:$t("ofzein5","针对人群:","lang")}},[e("el-autocomplete",{attrs:{"fetch-suggestions":t.querySearch,placeholder:$t("cj2hc19","请输入会员标签名称","lang")},on:{select:t.handleSelectStore},model:{value:t.params.specific.name,callback:function(e){t.$set(t.params.specific,"name",e)},expression:"params.specific.name"}})],1)],1),e("div",{staticClass:"action-container"},[e("el-button",{attrs:{type:"primary",icon:"iconfont icon-xinzengcaozuo-01"},on:{click:t.addActivityData}},[t._v($t("cglukn8"," 添加标签折扣 ","lang"))])],1),e("el-tabs",{attrs:{type:"card"},on:{"tab-click":t.handleTabClick},model:{value:t.params.status,callback:function(e){t.$set(t.params,"status",e)},expression:"params.status"}},t._l(t.tabList,function(a,i){return e("el-tab-pane",{key:i,attrs:{label:a.name,name:a.activeName}},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableList,border:"","element-loading-text":$t("go5gpa5","数据加载中","lang")}},[e("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),"min-width":"180"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"operating-icons"},[e("el-button",{staticStyle:{"margin-right":"20px"},attrs:{type:"text"},on:{click:function(e){return t.editActivityAction(a.$index,a.row)}}},[t._v($t("juz394"," 编辑 ","lang"))]),e("el-button",{staticStyle:{"margin-right":"20px"},attrs:{type:"text"},on:{click:function(e){return t.viewDetail(a.row)}}},[t._v($t("rvc5k08"," 查看优惠日志 ","lang"))])],1)]}}],null,!0)}),e("el-table-column",{attrs:{prop:"id",width:"60",label:$t("m2sh2","编号","lang")}}),e("el-table-column",{attrs:{prop:"specific_name","min-width":"150",label:$t("infp5c4","适用人群","lang")}}),e("el-table-column",{attrs:{label:$t("ex872","周期","lang"),"min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(a){return["1"==a.row.cycle_type?e("span",[t._v($t("hcjy6c5"," 自然月 ","lang"))]):t._e(),"2"==a.row.cycle_type?e("span",[t._v(" "+t._s(a.row.start_date)+" ~ "+t._s(a.row.end_date)+" ")]):t._e()]}}],null,!0)}),e("el-table-column",{attrs:{prop:"discount","min-width":"100",label:$t("adsz2r4","优惠折扣","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.discount)+"% ")]}}],null,!0)}),e("el-table-column",{attrs:{prop:"limit_total_money","min-width":"150",label:$t("qhj5d19","周期内最高优惠限额","lang")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.limit_total_money)+$t("dtml2","元 ","lang"))]}}],null,!0)}),e("el-table-column",{attrs:{label:$t("k1e32","状态","lang"),"min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(a){return["1"==a.row.status?e("span",[t._v($t("hxqu2","暂存","lang"))]):t._e(),"2"==a.row.status?e("span",[t._v($t("e656s3","已发布","lang"))]):t._e(),"3"==a.row.status?e("span",[t._v($t("eb7w2","停用","lang"))]):t._e(),"4"==a.row.status?e("span",[t._v($t("p0s82","过期","lang"))]):t._e()]}}],null,!0)})],1),e("div",{staticClass:"mt-4 text-right"},[e("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":t.page.pageIndex,"page-sizes":[10,20,50],total:t.page.total,"page-size":t.page.pageSize},on:{"update:currentPage":function(e){return t.$set(t.page,"pageIndex",e)},"update:current-page":function(e){return t.$set(t.page,"pageIndex",e)},"current-change":t.onCurrentChange,"size-change":t.onSizeChange}})],1)],1)}),1),e("el-dialog",{attrs:{title:$t("rotx5l6","添加定向促销","lang"),visible:t.activityItemDialog,"before-close":t.handleCancel,width:"70%"},on:{"update:visible":function(e){t.activityItemDialog=e}}},[[e("el-form",{ref:"form",staticClass:"demo-ruleForm",attrs:{model:t.form,"label-width":"150px","label-position":"right"}},[e("el-form-item",{attrs:{label:$t("j4abff4","针对人群","lang")}},[e("el-autocomplete",{staticClass:"inline-input",attrs:{clearable:"","fetch-suggestions":t.querySearch,placeholder:$t("cj2hc19","请输入会员标签名称","lang"),size:"mini"},on:{select:t.selectTag},model:{value:t.form.specific_name,callback:function(e){t.$set(t.form,"specific_name",e)},expression:"form.specific_name"}})],1),e("el-form-item",{attrs:{label:$t("b3219z4","周期选择","lang")}},[e("el-radio",{attrs:{label:"1"},on:{change:t.cycleType},model:{value:t.form.cycle_type,callback:function(e){t.$set(t.form,"cycle_type",e)},expression:"form.cycle_type"}},[t._v($t("hcjy6c5"," 自然月 ","lang"))]),e("el-radio",{attrs:{label:"2"},on:{change:t.cycleType},model:{value:t.form.cycle_type,callback:function(e){t.$set(t.form,"cycle_type",e)},expression:"form.cycle_type"}},[t._v($t("mhwbr46"," 特定时段 ","lang"))])],1),e("el-form-item",{attrs:{label:$t("9g8eqy6","活动有效时间","lang")}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:8}},[e("el-date-picker",{attrs:{type:"datetime","default-time":"00:00:00",disabled:"1"==t.form.cycle_type,format:"yyyy/MM/dd HH:mm:ss","value-format":"timestamp",placeholder:$t("tnwvfc6","选择日期时间","lang")},model:{value:t.form.start_time,callback:function(e){t.$set(t.form,"start_time",e)},expression:"form.start_time"}})],1),e("el-col",{attrs:{span:1}},[t._v(" ~ ")]),e("el-col",{attrs:{span:8}},[e("el-date-picker",{attrs:{type:"datetime","default-time":"23:59:59",disabled:"1"==t.form.cycle_type,format:"yyyy/MM/dd HH:mm:ss","value-format":"timestamp",placeholder:$t("tnwvfc6","选择日期时间","lang")},model:{value:t.form.end_time,callback:function(e){t.$set(t.form,"end_time",e)},expression:"form.end_time"}})],1)],1)],1),e("el-form-item",{attrs:{label:$t("pqulz37","周期内优惠折扣","lang")}},[e("el-input",{staticStyle:{width:"20%"},attrs:{placeholder:$t("2jbrwj5","请输入内容","lang")},model:{value:t.form.discount,callback:function(e){t.$set(t.form,"discount",e)},expression:"form.discount"}}),t._v("% ")],1),e("el-form-item",{attrs:{label:$t("pqlikd7","周期内优惠限额","lang")}},[e("el-input",{staticStyle:{width:"20%"},attrs:{placeholder:$t("2jbrwj5","请输入内容","lang")},model:{value:t.form.limit_total_money,callback:function(e){t.$set(t.form,"limit_total_money",e)},expression:"form.limit_total_money"}}),t._v($t("dtml2","元 ","lang"))],1),e("el-form-item",{attrs:{label:$t("k1e32","状态","lang")}},[e("el-radio",{attrs:{label:"1"},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[t._v($t("g0hpm4"," 暂存 ","lang"))]),e("el-radio",{attrs:{label:"2"},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[t._v($t("41flcz6"," 直接发布 ","lang"))]),e("el-radio",{attrs:{label:"3"},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[t._v($t("cw3ec4"," 停用 ","lang"))])],1),e("el-form-item",[e("el-button",{nativeOn:{click:function(e){return t.handleCancel.apply(null,arguments)}}},[t._v($t("dd4ni4"," 取消 ","lang"))]),e("el-button",{attrs:{type:"primary"},on:{click:t.submitAction}},[t._v($t("cp35x4"," 保存 ","lang"))])],1)],1)]],2)],1)],1)},[],!1,null,"ece04f2a",null),c=r.exports}}]);