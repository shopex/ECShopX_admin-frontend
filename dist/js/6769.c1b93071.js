"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[6769],{6769:function(t,e,a){a.r(e),a.d(e,{default:function(){return y}});var s=a(26456),r=a(27671),i={name:"FormItemZitiAddress",props:{value:{type:Object}},data(){return{district:r,data:{region:[],address:""},isErrorKey:""}},watch:{value(t){this.data=t}},created(){},methods:{keyClass(t){return[t,"form-sub-item",{"is-error":this.isErrorKey==t}]},onChange(){this.$emit("input",this.data)},validator(){const{region:t,address:e}=this.data;if(this.isErrorKey="",0==t.length)throw this.isErrorKey="region",new Error($t("3g3lum6","请选择省市区","lang"));if(!e)throw this.isErrorKey="address",new Error($t("bm4g5i8","自提地址不能为空","lang"))}}},l=a(81656),n=(0,l.A)(i,function(){var t=this,e=t._self._c;return e("div",{staticClass:"fi-ziti-address"},[e("el-cascader",{ref:"region",class:t.keyClass("region"),attrs:{filterable:"",clearable:"",placeholder:$t("7wdcft5","选择省市区","lang"),options:t.district},on:{change:t.onChange},model:{value:t.data.region,callback:function(e){t.$set(t.data,"region",e)},expression:"data.region"}}),e("el-input",{class:t.keyClass("address"),attrs:{clearable:"",type:"text",placeholder:$t("68fknyb","请填写自提点的具体地址","lang")},on:{change:t.onChange},model:{value:t.data.address,callback:function(e){t.$set(t.data,"address",e)},expression:"data.address"}})],1)},[],!1,null,null,null).exports,o={name:"FormItemConnectPhone",props:{value:{type:Object}},data(){return{data:{areaNo:"",phone:""},isErrorKey:""}},watch:{value(t){this.data=t}},created(){},methods:{keyClass(t){return[(0,s.aY)(t),"form-sub-item",{"is-error":this.isErrorKey==t}]},onChange(){this.$emit("input",this.data)},validator(){const{areaNo:t,phone:e}=this.data;if(this.isErrorKey="",t&&!e)throw this.isErrorKey="phone",new Error($t("m65x4f7","请输入固定电话","lang"));if(!e)throw this.isErrorKey="phone",new Error($t("gtihrc7","请输入联系电话","lang"))}}},c=(0,l.A)(o,function(){var t=this,e=t._self._c;return e("div",{staticClass:"fi-connect-phone"},[e("el-input",{class:t.keyClass("areaNo"),attrs:{clearable:"",type:"text",placeholder:$t("em7x2","区号","lang")},on:{change:t.onChange},model:{value:t.data.areaNo,callback:function(e){t.$set(t.data,"areaNo",e)},expression:"data.areaNo"}}),e("el-input",{class:t.keyClass("phone"),attrs:{clearable:"",type:"text",placeholder:$t("frvl56s","请填写准确的联系电话，便于买家联系（手机号时区号可留空）","lang")},on:{change:t.onChange},model:{value:t.data.phone,callback:function(e){t.$set(t.data,"phone",e)},expression:"data.phone"}})],1)},[],!1,null,null,null).exports,d=(a(44114),a(18111),a(7588),{name:"FormItemTimeSlot",props:{value:{type:Array}},data(){return{data:[],isErrorKey:""}},watch:{value(t){this.data=t}},created(){this.data=this.value},methods:{addTimeSlot(t){this.data.push([null,null])},deleteTimeSlot(t){this.data.splice(t,1)},resetField(){this.data.forEach((t,e)=>{this.$set(this.data,e,[null,null])})},keyClass(t){return[t,"form-sub-item",{"is-error":this.isErrorKey==t}]},validator(){try{this.data.forEach((t,e)=>{const[a,s]=t;if(!a)throw this.isErrorKey=`time-${e}_start`,new Error;if(!s)throw this.isErrorKey=`time-${e}_end`,new Error})}catch(t){throw new Error($t("8c8me99","自提时间段不能为空","lang"))}}}}),h=(0,l.A)(d,function(){var t=this,e=t._self._c;return e("div",{staticClass:"fi-item-timeslots"},[e("div",{staticClass:"tip"},[t._v($t("dpqpm0i","买家下单时从下方时间段内选择自提时间","lang"))]),e("div",{staticClass:"time-slots"},t._l(t.data,function(a,s){return e("div",{key:`solt-item__${s}`},[e("el-time-select",{class:t.keyClass(`time-${s}_start`),attrs:{placeholder:$t("i7zt2q4","起始时间","lang"),"picker-options":{start:"00:00",step:"00:01",end:"23:59"}},model:{value:a[0],callback:function(e){t.$set(a,0,e)},expression:"item[0]"}}),e("span",{staticClass:"separator"},[t._v("~")]),e("el-time-select",{class:t.keyClass(`time-${s}_end`),attrs:{placeholder:$t("gfi7qi4","结束时间","lang"),"picker-options":{start:"00:00",step:"00:01",end:"23:59"}},model:{value:a[1],callback:function(e){t.$set(a,1,e)},expression:"item[1]"}}),s>0?e("el-button",{staticClass:"btn-delete",attrs:{type:"text"},on:{click:function(e){return t.deleteTimeSlot(s)}}},[t._v($t("db22k4"," 删除 ","lang"))]):t._e()],1)}),0),e("div",[e("el-button",{staticClass:"btn-add",attrs:{type:"text"},on:{click:function(e){return t.addTimeSlot()}}},[t._v($t("eowvbm5","添加时间段","lang"))])],1)])},[],!1,null,null,null).exports,u={name:"FormItemAppointDays",props:{value:{type:Object}},data(){return{data:{value:"current",days:1},isErrorKey:""}},watch:{value:function(t){this.data=t}},created(){this.data=this.value},methods:{keyClass(t){return[(0,s.aY)(t),"form-sub-item",{"is-error":this.isErrorKey==t}]},onChange(){this.$emit("input",this.data)},validator(){const{areaNo:t,phone:e}=this.data;if(this.isErrorKey="",t&&!e)throw this.isErrorKey="phone",new Error($t("m65x4f7","请输入固定电话","lang"));if(!e)throw this.isErrorKey="phone",new Error($t("gtihrc7","请输入联系电话","lang"))}}},p=(0,l.A)(u,function(){var t=this,e=t._self._c;return e("div",{staticClass:"fi-connect-appointdays"},[e("div",{staticClass:"appoint-item"},[e("el-radio",{attrs:{label:"current"},on:{change:t.onChange},model:{value:t.data.value,callback:function(e){t.$set(t.data,"value",e)},expression:"data.value"}},[t._v($t("x9twhb6","只能当天自提","lang"))])],1),e("div",{staticClass:"appoint-item"},[e("el-radio",{attrs:{label:"days"},on:{change:t.onChange},model:{value:t.data.value,callback:function(e){t.$set(t.data,"value",e)},expression:"data.value"}},[t._v($t("d17td3","可预约","lang"))]),e("el-select",{attrs:{clearable:""},on:{change:t.onChange},model:{value:t.data.days,callback:function(e){t.$set(t.data,"days",e)},expression:"data.days"}},[e("el-option",{attrs:{label:"1",value:"1"}}),e("el-option",{attrs:{label:"2",value:"2"}}),e("el-option",{attrs:{label:"3",value:"3"}}),e("el-option",{attrs:{label:"4",value:"4"}}),e("el-option",{attrs:{label:"5",value:"5"}}),e("el-option",{attrs:{label:"6",value:"6"}}),e("el-option",{attrs:{label:"7",value:"7"}}),e("el-option",{attrs:{label:"8",value:"8"}}),e("el-option",{attrs:{label:"9",value:"9"}}),e("el-option",{attrs:{label:"10",value:"10"}})],1),e("span",[t._v($t("blgdpr4","天内订单","lang"))])],1)])},[],!1,null,null,null).exports,m={name:"FormItemAppointZiti",props:{value:{type:String}},data(){return{data:null,isErrorKey:""}},watch:{value(t){this.data=t}},created(){},methods:{keyClass(t){return[(0,s.aY)(t),"form-sub-item",{"is-error":this.isErrorKey==t}]},onChange(){this.$emit("input",this.data)},validator(){const{areaNo:t,phone:e}=this.data;if(this.isErrorKey="",t&&!e)throw this.isErrorKey="phone",new Error($t("m65x4f7","请输入固定电话","lang"));if(!e)throw this.isErrorKey="phone",new Error($t("gtihrc7","请输入联系电话","lang"))}}},f=(0,l.A)(m,function(){var t=this,e=t._self._c;return e("div",{staticClass:"fi-connect-appointziti"},[e("el-time-select",{attrs:{placeholder:$t("jrkj4w4","预约时间","lang"),"picker-options":{start:"00:00",step:"00:30",end:"24:00"}},on:{change:t.onChange},model:{value:t.data,callback:function(e){t.data=e},expression:"data"}}),e("span",[t._v($t("4z75bcb","前下单，可预约当天自提","lang"))])],1)},[],!1,null,null,null).exports,g={name:"",data(){const t=this.$createElement;return{form:{name:"",zitiAddress:{region:[],address:""},connectPhone:{areaNo:"",phone:""},timeSlots:[[null,null]],workDays:[],waitPickupDays:{value:"current",days:1},latestPickupTime:null},formList:[{label:$t("nsy1p25","自提点名称","lang"),key:"name",type:"input",required:!0,message:$t("j4bie29","自提点名称不能为空","lang")},{label:$t("nsye1v5","自提点地址","lang"),key:"zitiAddress",component:()=>t(n,{ref:"zitiaddress",model:{value:this.form.zitiAddress,callback:t=>{this.$set(this.form,"zitiAddress",t)}}}),validator:(t,e,a)=>{try{this.$refs.zitiaddress.validator(),a()}catch(t){a(t)}}},{label:$t("gpkj3j4","联系电话","lang"),key:"connectPhone",component:()=>t(c,{ref:"connectphone",model:{value:this.form.connectPhone,callback:t=>{this.$set(this.form,"connectPhone",t)}}}),validator:(t,e,a)=>{try{this.$refs.connectphone.validator(),a()}catch(t){a(t)}}},{label:$t("nrofkh5","自提时间段","lang"),key:"timeSlots",component:()=>t(h,{ref:"timeslot",model:{value:this.form.timeSlots,callback:t=>{this.$set(this.form,"timeSlots",t)}}}),validator:(t,e,a)=>{try{this.$refs.timeslot.validator(),a()}catch(t){a(t)}}},{label:$t("pae82","重复","lang"),key:"workDays",type:"checkbox",options:[{label:"1",name:$t("es9k2","周一","lang")},{label:"2",name:$t("esdg2","周二","lang")},{label:"3",name:$t("es9t2","周三","lang")},{label:"4",name:$t("eu0j2","周四","lang")},{label:"5",name:$t("esdo2","周五","lang")},{label:"6",name:$t("esxx2","周六","lang")},{label:"7",name:$t("ewzh2","周日","lang")}]},{label:$t("dmbjhd4","最长预约","lang"),key:"waitPickupDays",component:()=>t(p,{model:{value:this.form.waitPickupDays,callback:t=>{this.$set(this.form,"waitPickupDays",t)}}}),tip:$t("58id891a","天数从第二天开始计算，如设置为可预约1天内订单，则买家最长可预约第二天上门自提；天为自然日。","lang")},{label:$t("jrp0eg4","预约自提","lang"),key:"latestPickupTime",component:()=>t(f,{model:{value:this.form.latestPickupTime,callback:t=>{this.$set(this.form,"latestPickupTime",t)}}}),tip:$t("g2s5k31d","该时间之后，只能选择第二天的自提时间；如上面最长预约选择只能当天自提，则该时间后下单不能选择自提。","lang")}]}},created(){const{id:t}=this.$route.params;t&&this.fetchZitiInfo(t)},methods:{async fetchZitiInfo(t){const{name:e,province:a,city:i,area:l,address:n,contract_phone:o,hours:c,workdays:d,wait_pickup_days:h,latest_pickup_time:u}=await this.$api.pickuplocation.getZitiLocation(t),p=o.split("-"),m=p.length>1?p[0]:"",f=p.length>1?p[1]:p[0];this.form={name:e,zitiAddress:{region:(0,s.Aj)([a,i,l],r),address:n},connectPhone:{areaNo:m,phone:f},timeSlots:c,workDays:d,waitPickupDays:{value:0==h?"current":"days",days:h},latestPickupTime:u}},timeSlotsSort(t){let e;for(let a=0;a<t.length-1;a++)for(let a=0;a<t.length-1;a++){const[s]=t[a],[r]=t[a+1],[i,l]=s.split(":"),[n,o]=r.split(":");60*i+parseInt(l)>60*n+parseInt(o)?(e=JSON.parse(JSON.stringify(t[a])),t[a]=JSON.parse(JSON.stringify(t[a+1])),t[a+1]=e):t[a]=JSON.parse(JSON.stringify(t[a]))}return t},async onSubmit(){const{name:t,zitiAddress:e,connectPhone:a,timeSlots:i,workDays:l,waitPickupDays:n,latestPickupTime:o}=this.form,{region:c,address:d}=e,{areaNo:h,phone:u}=a,{value:p,days:m}=n,[f,g,y]=(0,s.SK)(c,r);let v={name:t,province:f,city:g,area:y,address:d,area_code:h,contract_phone:u,hours:this.timeSlotsSort(i),workdays:l,wait_pickup_days:"current"==p?0:m,latest_pickup_time:o};const{id:$}=this.$route.params;$?(await this.$api.pickuplocation.updateZitiLocation($,v),this.$message.success($t("61xs4e7","自提点更新成功","lang"))):(await this.$api.pickuplocation.addZitiLocation(v),this.$message.success($t("6v1yxz7","自提点添加成功","lang"))),this.$EventBus.$emit("event.zitilist.refresh"),setTimeout(()=>{this.$router.go(-1)},1e3)}}},y=(0,l.A)(g,function(){var t=this,e=t._self._c;return e("SpPage",[e("SpForm",{ref:"form",staticClass:"ziti-form",attrs:{"form-list":t.formList,submit:!1},on:{onSubmit:t.onSubmit},model:{value:t.form,callback:function(e){t.form=e},expression:"form"}}),e("div",{staticClass:"text-center"},[e("el-button",{on:{click:()=>{this.$router.go(-1)}}},[t._v($t("dd4ni4"," 取消 ","lang"))]),e("el-button",{attrs:{type:"primary"},on:{click:()=>{this.$refs.form.handleSubmit()}}},[t._v($t("cp35x4"," 保存 ","lang"))])],1)],1)},[],!1,null,"c76a6752",null).exports}}]);