"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[2985],{92985:function(t,a,e){e.r(a),e.d(a,{default:function(){return r}});var s=e(95353),i=e(41776),n=e(77944),l={data(){return{shopListData:[],loading:!1,total_count:0,dataList:[],shopId:"",identifier:"",create_time:"",date_begin:"",date_end:"",params:{page:1,pageSize:20},downloadView:!1,downloadUrl:"",downloadName:""}},computed:{...(0,s.L8)(["wheight"])},mounted(){this.getParams(),this.getStoreList(),this.shopId&&(this.params.shop_id=this.shopId,this.getDataList(this.params))},methods:{shopHandle(t){this.params.shop_id=t,this.params.page=1,this.getDataList(this.params)},numberSearch(t){this.params.page=1,this.getParams(),this.getDataList(this.params)},dateChange(t){t&&t.length>0?(this.date_begin=this.dateStrToTimeStamp(t[0]+" 00:00:00"),this.date_end=this.dateStrToTimeStamp(t[1]+" 23:59:59")):(this.date_begin="",this.date_end=""),this.params.page=1,this.getParams(),this.getDataList(this.params)},dateStrToTimeStamp(t){return Date.parse(new Date(t))/1e3},getParams(){this.params.time_start_begin=this.date_begin,this.params.time_start_end=this.date_end,this.params.shop_id=this.shopId,this.params.mobile=this.identifier},getDataList(t){this.loading=!0,(0,i.getRightsLogList)(t).then(t=>{this.dataList=t.data.data.list,this.total_count=t.data.data.total_count,this.loading=!1})},handleCurrentChange(t){this.params.page=t,this.getDataList(this.params)},handleSizeChange(t){this.params.page=1,this.params.pageSize=t,this.getDataList(this.params)},exportData(){this.getParams(),this.params.page=1,(0,i.exportList)(this.params).then(t=>{t.data.data.status?this.$message({type:"success",message:$t("xdh90kk","已加入执行队列，请在设置-导出列表中下载","lang")}):t.data.data.url?(this.downloadUrl=t.data.data.url,this.downloadName=t.data.data.filename,this.downloadView=!0):this.$message({type:"error",message:$t("yndnt89","没有相关数据可导出","lang")})})},getStoreList(){this.storeList=[],this.loading=!0;(0,n.getWxShopsList)({page:1,pageSize:500}).then(t=>{this.shopListData=t.data.data.list,""==this.shopId&&this.shopListData[0].wxShopId&&(this.shopId=this.shopListData[0].wxShopId,this.shopHandle(this.shopListData[0].wxShopId)),this.loading=!1})}}},r=(0,e(81656).A)(l,function(){var t=this,a=t._self._c;return a("div",[a("el-row",{staticClass:"filter-header",attrs:{gutter:20}},[a("el-col",[a("el-select",{on:{change:t.shopHandle},model:{value:t.shopId,callback:function(a){t.shopId=a},expression:"shopId"}},t._l(t.shopListData,function(t){return a("el-option",{key:t.wxShopId,attrs:{label:t.storeName,value:t.wxShopId}})}),1),a("el-input",{staticClass:"input-m",attrs:{placeholder:$t("dml9sa7","服务人员手机号","lang")},model:{value:t.identifier,callback:function(a){t.identifier=a},expression:"identifier"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.numberSearch},slot:"append"})],1),a("el-date-picker",{attrs:{type:"daterange",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",placeholder:$t("to1gvf6","选择日期范围","lang")},on:{change:t.dateChange},model:{value:t.create_time,callback:function(a){t.create_time=a},expression:"create_time"}}),a("el-button",{attrs:{type:"primary"},on:{click:t.exportData}},[t._v($t("efepu4"," 导出 ","lang"))]),a("el-popover",{attrs:{placement:"top-start",width:"200",trigger:"hover",content:$t("lntxa712","导出任务会以队列执行，点击导出后，请至‘设置-导出列表’页面中查看及下载数据","lang")}},[a("i",{staticClass:"el-icon-question",attrs:{slot:"reference"},slot:"reference"})])],1)],1),a("el-dialog",{attrs:{title:$t("axx7m68","权益核销列表下载","lang"),visible:t.downloadView,"close-on-click-modal":!1},on:{"update:visible":function(a){t.downloadView=a}}},[t.downloadUrl?[a("a",{attrs:{href:t.downloadUrl,download:""}},[t._v(t._s(t.downloadName))])]:t._e()],2),a("el-card",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.dataList}},[a("el-table-column",{attrs:{prop:"shop_name",label:$t("jaxr3m4","门店名称","lang"),width:"150"}}),a("el-table-column",{attrs:{prop:"attendant",label:$t("dcegwi4","服务人员","lang"),width:"120"}}),a("el-table-column",{attrs:{prop:"name",label:$t("fzcls3","核销员","lang"),width:"120"}}),a("el-table-column",{attrs:{prop:"salesperson_mobile",label:$t("e661o86","核销员手机号","lang"),width:"120"}}),a("el-table-column",{attrs:{prop:"rights_name",label:$t("dcr7bd4","服务项目","lang")}}),a("el-table-column",{attrs:{prop:"user_name",label:$t("abylqw4","会员姓名","lang"),width:"100"}}),a("el-table-column",{attrs:{prop:"user_mobile",label:$t("ytf6465","会员手机号","lang"),width:"120"}}),a("el-table-column",{attrs:{prop:"user_sex",label:$t("abzo4i4","会员性别","lang"),width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return["2"==e.row.user_sex?a("span",[t._v($t("ho31","女","lang"))]):"1"==e.row.user_sex?a("span",[t._v($t("n5j1","男","lang"))]):a("span",[t._v($t("iv4r3"," 未知","lang"))])]}}])}),a("el-table-column",{attrs:{prop:"end_time",label:$t("dcis4y4","服务时间","lang"),width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("datetime")(e.row.end_time,"YYYY-MM-DD HH:mm:ss")))])]}}])})],1),a("div",{staticClass:"mt-4 text-right"},[a("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":t.params.page,"page-sizes":[10,20,50],total:t.total_count,"page-size":t.params.pageSize},on:{"update:currentPage":function(a){return t.$set(t.params,"page",a)},"update:current-page":function(a){return t.$set(t.params,"page",a)},"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange}})],1)],1)],1)},[],!1,null,null,null).exports}}]);