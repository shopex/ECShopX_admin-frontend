"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[2455],{52455:function(e,t,i){i.r(t),i.d(t,{default:function(){return b}});i(44114),i(18111),i(22489),i(20116),i(7588),i(61701),i(13579),i(17642),i(58004),i(33853),i(45876),i(32475),i(15024),i(31698);var a=i(70769),s=i(26456),l={name:"GoodsParams",props:{value:{type:Array,default:()=>[]}},data(){return{}},created(){},methods:{async handleChange(e){let t=[];e.children.forEach(e=>{t.push(e.value)}),e.attr_id&&-1==t.indexOf(e.attr_id)&&(await this.$api.goods.getItemParams({attribute_id:e.id,attribute_value:e.attr_id}),this.$emit("change",e))}}},n=i(81656),r=(0,n.A)(l,function(){var e=this,t=e._self._c;return t("el-form",{attrs:{inline:"","label-width":"100px"}},e._l(e.value,function(i,a){return t("el-form-item",{key:`params-item__${a}`,attrs:{label:`${i.label}:`}},[t("el-select",{attrs:{clearable:"",filterable:"","allow-create":"","default-first-option":"",placeholder:$t("l72nr3","请选择","lang")},on:{change:function(t){return e.handleChange(i)}},model:{value:i.attr_id,callback:function(t){e.$set(i,"attr_id",t)},expression:"item.attr_id"}},e._l(i.children,function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)}),1)},[],!1,null,null,null).exports,o=i(33318),p={name:"SpecParams",props:{value:{type:Object,default:()=>{}},isShowPoint:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},provinceList:{type:Array,default:()=>[]},isMedicine:{type:Boolean,default:!1},medicinePrescription:{type:Boolean,default:!1},isPrescriptionApproved:{type:Boolean,default:!1}},data(){let e=[{title:$t("meu01y5","前台可销售","lang"),value:"onsale",disabled:()=>this.medicinePrescription&&!this.isPrescriptionApproved},{title:$t("mfuo7t5","前台仅展示","lang"),value:"only_show",disabled:()=>this.medicinePrescription&&!this.isPrescriptionApproved},{title:$t("a7er004","不可销售","lang"),value:"instock"}];return this.VERSION_IN_PURCHASE()||e.push({title:$t("mfygnl5","前台不展示","lang"),value:"offline_sale",disabled:()=>this.medicinePrescription&&!this.isPrescriptionApproved}),{form:{buy_limit_area:["all"],item_id:"",approve_status:"onsale",store:1,item_bn:"",medicine_spec:"",max_num:"",weight:"",volume:"",price:"",cost_price:"",market_price:"",barcode:"",delivery_time:"",point_num:0,start_num:0},formList:[{label:$t("b45xmu4","商品状态","lang"),key:"approve_status",type:"select",isShow:!(0,s.WZ)(),options:e,display:"inline"},{label:$t("gl5x2","库存","lang"),key:"store",type:"input",display:"inline"},{label:$t("b4ad634","商品货号","lang"),key:"item_bn",type:"input",display:"inline"},{label:$t("pllu2","重量","lang"),key:"weight",type:"input",display:"inline"},{label:$t("e5to2","体积","lang"),key:"volume",type:"input",display:"inline"},{label:$t("m8lft3","销售价","lang"),key:"price",type:"input",required:!0,message:$t("flm65h8","请输入商品销售价","lang"),display:"inline"},{label:$t("ev2aj3","成本价","lang"),key:"cost_price",type:"input",required:!0,message:$t("fe8n078","请输入商品成本价","lang"),display:"inline"},{label:$t("e6yyn3","市场价","lang"),key:"market_price",type:"input",display:"inline"},{label:$t("flzwg3","条形码","lang"),key:"barcode",type:"input",display:"inline"},{label:$t("gxvcfe4","药品规格","lang"),key:"medicine_spec",type:"input",validator:async(e,t,i)=>{!t&&this.medicinePrescription?i($t("gl7ofh7","请输入药品规格","lang")):i()},isShow:()=>this.medicinePrescription,display:"inline"},{label:$t("bt9fw05","最大开方数","lang"),key:"max_num",type:"input",validator:async(e,t,i)=>{!t&&this.medicinePrescription?i($t("ejvf3c9","请输入最大开方数量","lang")):i()},isShow:()=>this.medicinePrescription,display:"inline"},{label:$t("lehpg3","起订量","lang"),key:"start_num",type:"input",display:"inline"},{label:$t("b5ra2c4","发货时间","lang"),key:"delivery_time",type:"input",display:"inline"}]}},watch:{value(e){this.form=e},form:{deep:!0,handler(e){this.$emit("input",e)}},isShowPoint:{handler(e){e&&this.formList.push({label:$t("gyxnw64","获取积分","lang"),key:"point_num",type:"input",display:"inline"})}},medicinePrescription(e){e&&!this.isPrescriptionApproved&&(this.form.approve_status="instock")}},methods:{async handleSubmit(){await this.$refs.form.handleSubmit()}}},u=(0,n.A)(p,function(){var e=this,t=e._self._c;return t("div",[t("SpForm",{ref:"form",attrs:{"label-width":"100px","form-list":e.formList,submit:!1},model:{value:e.form,callback:function(t){e.form=t},expression:"form"}})],1)},[],!1,null,null,null).exports,c={name:"SkuParams",props:{value:{type:Object,default:()=>{}},isShowPoint:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},provinceList:{type:Array,default:()=>[]},isSupplierGoods:{type:Boolean,default:!1},medicinePrescription:{type:Boolean,default:!1},isPrescriptionApproved:{type:Boolean,default:!1}},data(){let e=[{title:$t("meu01y5","前台可销售","lang"),value:"onsale"},{title:$t("mfuo7t5","前台仅展示","lang"),value:"only_show"},{title:$t("a7er004","不可销售","lang"),value:"instock"}];return this.VERSION_IN_PURCHASE()||e.push({title:$t("mfygnl5","前台不展示","lang"),value:"offline_sale"}),{tax_rate_list:o.oA,bulkFilling:[{approve_status:"",store:"",max_num:"",item_bn:"",price:"",cost_price:"",market_price:"",start_num:0,barcode:"",point_num:"",weight:"",volume:"",supplier_goods_bn:"",tax_rate:"",delivery_time:""}],statusOption:e,cacheSpecImages:[],cacheSpecItems:[],isFirst:!0}},watch:{medicinePrescription(e){e&&(this.isFirst?this.isFirst=!1:this.bulkFilling.forEach(e=>e.approve_status="instock"),this.value.specItems.length&&this.value.specItems.forEach(e=>e.approve_status="instock"))}},created(){this.isFirstRender=!0},methods:{renderRequire(e,{column:t}){return e("label",{class:"required-mark"},t.label)},cartesianProductOf(){var e=Array.prototype.reduce.call(arguments,function(e,t){var i=[];return t.length>0?e.forEach(function(e){t.forEach(function(t){i.push(e.concat([t]))})}):e[0].length?i.push(...e):i=[[]],i},[[]]);return 1===e.length&&0===e[0].length&&(e=[]),e},statusDisabled({value:e}){return!this.isPrescriptionApproved&&!(this.medicinePrescription&&"instock"==e||!this.medicinePrescription)},onCheckSkuChange(e){this.getSkuItemImages(),this.getSkuItems()},onInputSkuChange(){this.getSkuItemImages(),this.getSkuItems()},onSkuChange({spec_images:e,spec_items:t}){this.getSkuItemImages(e),this.getSkuItems(t)},getSkuItemImages(e){const{skuValue:t=[],checkedSku:i=[]}=JSON.parse(JSON.stringify(this.value.skus)).reverse().find(e=>e.isImage)||{};t&&(this.value.skuItemImages=t.filter(({attribute_value_id:e})=>i.includes(e)).map(t=>{if(!e){const e=this.value.skuItemImages.find(({attribute_value_id:e})=>e==t.attribute_value_id);return e?{...e,custom_attribute_value:t.custom_attribute_value||e.custom_attribute_value}:t}let i=[];const a=e.find(({spec_value_id:e})=>e==t.attribute_value_id);return a&&(i=a.item_image_url),{...t,sku_images:i}}))},getSkuItems(e){const t=this.value.skus.map(({checkedSku:e})=>e);let i=this.cartesianProductOf(...t),a=[];if(e||this.value.specItems){const t=e||this.value.specItems;a=t.map(e=>{const t=e.item_spec?.map(({spec_value_id:e})=>e)?.sort((e,t)=>e-t)||[],i=e.item_spec?.map(e=>e.spec_custom_value_name||e.spec_value_name)||[];return{sku_id:t.join("_")||"",spec_name:i?.join(" ")||"",item_id:e.item_id||"",is_default:!1,approve_status:e.approve_status||"",store:e.store||"",max_num:e.max_num||"",item_bn:e.item_bn||"",weight:e.weight||"",item_spec:e.item_spec||[],delivery_time:e.delivery_time||"",volume:e.volume||"",price:isNaN(e.price/100)?"":e.price/100,cost_price:isNaN(e.cost_price/100)?"":e.cost_price/100,market_price:isNaN(e.market_price/100)?"":e.market_price/100,start_num:e.start_num||"",barcode:e.barcode||"",point_num:e.point_num||"",supplier_goods_bn:e.supplier_goods_bn||"",tax_rate:e.tax_rate||""}})}if(this.isFirstRender&&(this.noDefaultSpecItems=a?.filter(e=>!e.item_id)?.map(e=>e.sku_id),a=a?.filter(e=>!!e.item_id),this.isFirstRender=!1),i=i?.filter(e=>!this.noDefaultSpecItems?.includes(e.join("_"))),i?.forEach(e=>{const t=e.sort((e,t)=>e-t).join("_");a.find(({sku_id:e})=>e==t)||a.push({sku_id:t,spec_name:this.getSpecName(e),is_default:!1,approve_status:e.approve_status||"",store:e.store||"",max_num:e.max_num||"",item_bn:e.item_bn||"",weight:e.weight||"",volume:e.volume||"",price:isNaN(e.price/100)?"":e.price/100,cost_price:isNaN(e.cost_price/100)?"":e.cost_price/100,market_price:isNaN(e.market_price/100)?"":e.market_price/100,start_num:e.start_num||"",barcode:e.barcode||"",point_num:e.point_num||"",supplier_goods_bn:e.supplier_goods_bn||"",tax_rate:e.tax_rate||"",delivery_time:e.delivery_time||"",item_spec:e.item_spec||[]})}),a?.length>=i?.length){const e=i.map(e=>e.join("_"));a=a.filter(t=>e.includes(t.sku_id))}this.value.specItems=a.map(e=>{const t=this.value.specItems.find(({sku_id:t})=>t==e.sku_id);return t?{...t,spec_name:e.spec_name}:e})},getSpecName(e){const{skus:t}=this.value,i=[],a=[];return t?.forEach(e=>{a.push(...e.skuValue)}),e?.forEach(e=>{const t=a.find(t=>t?.attribute_value_id==e)||{};i.push(t.custom_attribute_value||t.attribute_value)}),i.join(" ")},onFillSpecItems(){const{approve_status:e,store:t,max_num:i,item_bn:a,weight:s,volume:l,price:n,cost_price:r,market_price:o,start_num:p,barcode:u,point_num:c,supplier_goods_bn:m,tax_rate:d,delivery_time:_}=this.bulkFilling[0];this.value.specItems.forEach(g=>{g.approve_status=e,g.store=t,g.max_num=i,g.item_bn=a,g.weight=s,g.volume=l,g.price=n,g.cost_price=r,g.market_price=o,g.start_num=p,g.barcode=u,g.point_num=c,g.supplier_goods_bn=m,g.tax_rate=d,g.delivery_time=_})},async onClearSpecItem(e){await this.$confirm($t("vaskp9d","确定清除当前规格的数据吗？","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}),Object.assign(this.value.specItems[e],{approve_status:"",store:"",max_num:"",item_bn:"",weight:"",volume:"",price:"",cost_price:"",market_price:"",start_num:0,barcode:"",point_num:"",supplier_goods_bn:"",tax_rate:"",delivery_time:""})}}},m=c,d=(0,n.A)(m,function(){var e=this,t=e._self._c;return t("div",{staticClass:"cm-sku-params"},[t("el-form",{attrs:{"label-width":"100px"}},e._l(e.value.skus,function(i,a){return t("el-form-item",{key:`sku-item__${a}`,attrs:{label:`${i.skuName}:`}},[t("el-checkbox-group",{on:{change:e.onCheckSkuChange},model:{value:i.checkedSku,callback:function(t){e.$set(i,"checkedSku",t)},expression:"item.checkedSku"}},[t("div",{staticClass:"sku-item-group"},e._l(i.skuValue,function(i){return t("span",{key:i.attribute_value_id,staticClass:"sku-item"},[t("el-checkbox",{attrs:{label:i.attribute_value_id}},[e._v(e._s(i.custom_attribute_value||i.attribute_value))]),t("el-popover",{attrs:{placement:"top",trigger:"click"}},[t("div",{staticClass:"popover-edit"},[t("el-input",{on:{change:e.onInputSkuChange},model:{value:i.custom_attribute_value,callback:function(t){e.$set(i,"custom_attribute_value",t)},expression:"sku.custom_attribute_value"}})],1),t("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[t("i",{staticClass:"iconfont icon-edit1"})])],1)],1)}),0)])],1)}),1),e.value.skuItemImages.length>0?t("el-table",{staticClass:"sku-image-table",staticStyle:{"line-height":"initial",width:"100%","margin-bottom":"26px"},attrs:{data:e.value.skuItemImages,border:""}},[t("el-table-column",{attrs:{label:$t("ht82nv4","规格名称","lang"),width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.custom_attribute_value||t.row.attribute_value)+" ")]}}],null,!1,1731842289)}),t("el-table-column",{attrs:{prop:"spec_name",label:$t("ht8j5t4","规格图片","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("SpImagePicker",{staticClass:"sku-image",attrs:{max:5,size:"small"},model:{value:i.row.sku_images,callback:function(t){e.$set(i.row,"sku_images",t)},expression:"scope.row.sku_images"}})]}}],null,!1,3861002719)})],1):e._e(),t("el-table",{attrs:{data:e.bulkFilling,"show-header":!1,"highlight-current-row":!1}},[t("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.custom_attribute_value||t.row.item_spec)+" ")]}}])}),e.IS_SUPPLIER()||e.isSupplierGoods?e._e():t("el-table-column",{attrs:{label:$t("k1e32","状态","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-select",{attrs:{size:"mini",placeholder:$t("l72nr3","请选择","lang")},model:{value:i.row.approve_status,callback:function(t){e.$set(i.row,"approve_status",t)},expression:"scope.row.approve_status"}},e._l(e.statusOption,function(i){return t("el-option",{key:i.value,attrs:{label:i.title,size:"mini",disabled:e.statusDisabled(i),value:i.value}})}),1)]}}],null,!1,3915064143)}),t("el-table-column",{attrs:{label:$t("gl5x2","库存","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{type:"number",required:"",min:"0",size:"mini",placeholder:$t("gl5x2","库存","lang")},model:{value:i.row.store,callback:function(t){e.$set(i.row,"store",t)},expression:"scope.row.store"}})]}}])}),e.medicinePrescription?t("el-table-column",{attrs:{label:$t("bt9fw05","最大开方数","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{type:"number",required:"",min:"0",size:"mini",placeholder:$t("b1jlvl6","最大开方数量","lang")},model:{value:i.row.max_num,callback:function(t){e.$set(i.row,"max_num",t)},expression:"scope.row.max_num"}})]}}],null,!1,351548402)}):e._e(),t("el-table-column",{attrs:{label:$t("ogxc2","货号","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{maxlength:60,size:"mini",placeholder:$t("ogxc2","货号","lang")},model:{value:i.row.item_bn,callback:function(t){e.$set(i.row,"item_bn",t)},expression:"scope.row.item_bn"}})]}}])}),t("el-table-column",{attrs:{label:$t("pllu2","重量","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{maxlength:60,size:"mini",placeholder:$t("pllu2","重量","lang")},model:{value:i.row.weight,callback:function(t){e.$set(i.row,"weight",t)},expression:"scope.row.weight"}})]}}])}),t("el-table-column",{attrs:{label:$t("e5to2","体积","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{maxlength:60,size:"mini",placeholder:$t("e5to2","体积","lang")},model:{value:i.row.volume,callback:function(t){e.$set(i.row,"volume",t)},expression:"scope.row.volume"}})]}}])}),t("el-table-column",{attrs:{label:$t("m8lft3","销售价","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{type:"number",required:"",min:"0",size:"mini",placeholder:$t("m8lft3","销售价","lang")},model:{value:i.row.price,callback:function(t){e.$set(i.row,"price",t)},expression:"scope.row.price"}})]}}])}),t("el-table-column",{attrs:{label:$t("ev2aj3","成本价","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{type:"number",required:"",min:"0",size:"mini",placeholder:$t("ev2aj3","成本价","lang"),disabled:e.disabled},model:{value:i.row.cost_price,callback:function(t){e.$set(i.row,"cost_price",t)},expression:"scope.row.cost_price"}})]}}])}),t("el-table-column",{attrs:{label:$t("e6yyn3","市场价","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{type:"number",required:"",min:"0",size:"mini",placeholder:$t("e6yyn3","市场价","lang")},model:{value:i.row.market_price,callback:function(t){e.$set(i.row,"market_price",t)},expression:"scope.row.market_price"}})]}}])}),t("el-table-column",{attrs:{label:$t("lehpg3","起订量","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{type:"number",required:"",min:"0",size:"mini",placeholder:$t("lehpg3","起订量","lang")},model:{value:i.row.start_num,callback:function(t){e.$set(i.row,"start_num",t)},expression:"scope.row.start_num"}})]}}])}),t("el-table-column",{attrs:{label:$t("b5ra2c4","发货时间","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{maxlength:60,size:"mini",placeholder:$t("b5ra2c4","发货时间","lang")},model:{value:i.row.delivery_time,callback:function(t){e.$set(i.row,"delivery_time",t)},expression:"scope.row.delivery_time"}})]}}])}),t("el-table-column",{attrs:{label:$t("flzwg3","条形码","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{type:"number",required:"",min:"0",size:"mini",placeholder:$t("flzwg3","条形码","lang")},model:{value:i.row.barcode,callback:function(t){e.$set(i.row,"barcode",t)},expression:"scope.row.barcode"}})]}}])}),e.isShowPoint?t("el-table-column",{attrs:{label:$t("gyxnw64","获取积分","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{type:"number",min:"0",size:"mini",placeholder:$t("gyxnw64","获取积分","lang")},model:{value:i.row.point_num,callback:function(t){e.$set(i.row,"point_num",t)},expression:"scope.row.point_num"}})]}}],null,!1,3791269692)}):e._e(),t("el-table-column",{attrs:{width:"80"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.onFillSpecItems}},[e._v($t("dwhdy4"," 填充 ","lang"))])]}}])})],1),t("el-table",{staticStyle:{"line-height":"initial",width:"100%"},attrs:{data:e.value.specItems,border:""}},[t("el-table-column",{attrs:{prop:"spec_name",label:$t("o06w2","规格","lang")}}),e.IS_SUPPLIER()||e.isSupplierGoods?e._e():t("el-table-column",{attrs:{label:$t("k1e32","状态","lang"),"render-header":e.renderRequire},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-select",{attrs:{size:"mini",placeholder:$t("l72nr3","请选择","lang")},model:{value:i.row.approve_status,callback:function(t){e.$set(i.row,"approve_status",t)},expression:"scope.row.approve_status"}},e._l(e.statusOption,function(i){return t("el-option",{key:i.value,attrs:{label:i.title,value:i.value,disabled:e.statusDisabled(i),size:"mini"}})}),1)]}}],null,!1,2875701135)}),t("el-table-column",{attrs:{prop:"store",label:$t("gl5x2","库存","lang"),"render-header":e.renderRequire},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{type:"number",min:"0",size:"mini"},model:{value:i.row.store,callback:function(t){e.$set(i.row,"store",t)},expression:"scope.row.store"}})]}}])}),e.medicinePrescription?t("el-table-column",{attrs:{prop:"max_num",label:$t("bt9fw05","最大开方数","lang"),"render-header":e.renderRequire},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{size:"mini"},model:{value:i.row.max_num,callback:function(t){e.$set(i.row,"max_num",t)},expression:"scope.row.max_num"}})]}}],null,!1,3352178168)}):e._e(),t("el-table-column",{attrs:{prop:"item_bn",label:$t("ogxc2","货号","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{size:"mini"},model:{value:i.row.item_bn,callback:function(t){e.$set(i.row,"item_bn",t)},expression:"scope.row.item_bn"}})]}}])}),t("el-table-column",{attrs:{prop:"weight",label:$t("jqtfif6","重量（kg）","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{size:"mini"},model:{value:i.row.weight,callback:function(t){e.$set(i.row,"weight",t)},expression:"scope.row.weight"}})]}}])}),t("el-table-column",{attrs:{prop:"volume",label:$t("xnr0o96","体积（m³）","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{size:"mini"},model:{value:i.row.volume,callback:function(t){e.$set(i.row,"volume",t)},expression:"scope.row.volume"}})]}}])}),t("el-table-column",{attrs:{prop:"price",label:$t("m8lft3","销售价","lang"),"render-header":e.renderRequire},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{type:"number",min:"0",size:"mini"},model:{value:i.row.price,callback:function(t){e.$set(i.row,"price",t)},expression:"scope.row.price"}})]}}])}),t("el-table-column",{attrs:{prop:"cost_price",label:$t("ev2aj3","成本价","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{type:"number",min:"0",size:"mini",disabled:e.disabled},model:{value:i.row.cost_price,callback:function(t){e.$set(i.row,"cost_price",t)},expression:"scope.row.cost_price"}})]}}])}),t("el-table-column",{attrs:{prop:"market_price",label:$t("e6yyn3","市场价","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{type:"number",min:"0",size:"mini"},model:{value:i.row.market_price,callback:function(t){e.$set(i.row,"market_price",t)},expression:"scope.row.market_price"}})]}}])}),t("el-table-column",{attrs:{prop:"start_num",label:$t("lehpg3","起订量","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{type:"number",min:"0",size:"mini"},model:{value:i.row.start_num,callback:function(t){e.$set(i.row,"start_num",t)},expression:"scope.row.start_num"}})]}}])}),t("el-table-column",{attrs:{prop:"delivery_time",label:$t("b5ra2c4","发货时间","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{maxlength:60,size:"mini",placeholder:$t("b5ra2c4","发货时间","lang")},model:{value:i.row.delivery_time,callback:function(t){e.$set(i.row,"delivery_time",t)},expression:"scope.row.delivery_time"}})]}}])}),t("el-table-column",{attrs:{prop:"barcode",label:$t("flzwg3","条形码","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{size:"mini"},model:{value:i.row.barcode,callback:function(t){e.$set(i.row,"barcode",t)},expression:"scope.row.barcode"}})]}}])}),e.isShowPoint?t("el-table-column",{attrs:{prop:"point_num",label:$t("gyxnw64","获取积分","lang")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{type:"number",min:"0",size:"mini"},model:{value:i.row.point_num,callback:function(t){e.$set(i.row,"point_num",t)},expression:"scope.row.point_num"}})]}}],null,!1,3720906529)}):e._e(),t("el-table-column",{attrs:{width:"80"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.onClearSpecItem(i.$index)}}},[e._v($t("he57l4"," 清除 ","lang"))])]}}])})],1)],1)},[],!1,null,null,null),_=d.exports,g=(i(10356),{async beforeRouteLeave(e,t,i){this.$refs.decorateRef.dialogVisible?(this.$refs.decorateRef.resetDecorateTheme(),this.$refs.decorateRef.onClose()):(this.isLeave||this.routerParams.detail||await this.$confirm($t("lnrzlal","确定要离开当前页面，您将丢失已编辑的数据？","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}),i())},data(){const e=this.$createElement,t={props:{multiple:!0,value:"value",children:"children"}},{prohibit:i}=this.$route.query,a=1==i;return{form:{supplier_id:0,is_market:0,item_id:"",audit_status:"",itemType:"normal",specialType:"normal",itemSource:"mall",mainCategory:[],itemName:"",brief:"",isPrescriptionApproved:!1,templatesId:"",brandId:"",itemUnit:"",sort:1,regionsId:[],taxRate:"",isGift:!1,goods_bn:"",aftersales_end_date:"",delivery_data:{delivery_data_type:"fixed_date",delivery_desc:""},salesCategory:[],pics:[],picsQrcode:[],videos:"",paramsData:[],isSpecs:!1,isShowSpecimg:!1,specParams:{approve_status:"onsale",store:1,medicine_spec:"",item_bn:"",weight:"",volume:"",price:"",cost_price:"",market_price:"",barcode:"",point_num:0,tax_rate:"",tax_rate_code:"",buy_limit_area:["all"],package_type:"sku",delivery_time:"",start_num:0},skuParams:{skus:[],skuItemImages:[],specItems:[],package_type:"",package_num:1,buy_limit_area:["all"]},mode:"richText",intro:"",content:[],title:"",mate_description:"",mate_keywords:"",goods_notice:"",is_medicine:"0",medicine_type:"",manufacturer:"",common_name:"",special_common_name:"",approval_number:"",unit:"",packing_spec:"",dosage:"",is_prescription:!0,use_tip:"",symptom:""},formList:[{label:$t("g2r33u4","管理分类","lang"),type:"group"},{label:$t("g2r33u4","管理分类","lang"),key:"mainCategory",required:!0,disabled:a,message:$t("z5r6j37","请选择管理分类","lang"),component:({key:t},i)=>e("el-cascader",{style:{maxWidth:"500px"},attrs:{disabled:this.mainCategoryDisabled,options:this.categoryList},on:{change:this.onChangeMainCategory},model:{value:i[t],callback:e=>{this.$set(i,t,e)}}})},{label:$t("blh1h04","基础信息","lang"),type:"group"},{label:$t("b44fe44","商品标题","lang"),key:"itemName",type:"input",display:"inline",required:!0,message:$t("meylgr7","请输入商品标题","lang")},{label:$t("cl7a83","副标题","lang"),key:"brief",type:"input",display:"inline"},{label:$t("iq77af4","运费模板","lang"),key:"templatesId",type:"select",options:[],required:!0,disabled:a,message:$t("wib2ci7","请选择运费模板","lang"),display:"inline"},{label:$t("f1kb2","品牌","lang"),key:"brandId",type:"select",options:[],disabled:a,required:!0,message:$t("2ene8u5","请选择品牌","lang"),display:"inline"},{label:$t("i7rihy4","计量单位","lang"),key:"itemUnit",type:"input",disabled:a,display:"inline"},{label:$t("cyko7y4","排序编号","lang"),key:"sort",disabled:a,type:"number",min:0,display:"inline"},{label:$t("duuh2","产地","lang"),key:"regionsId",component:({key:t},i)=>e("el-cascader",{attrs:{disabled:a,clearable:!0,options:this.regionsList},model:{value:i[t],callback:e=>{this.$set(i,t,e)}}}),display:"inline"},{label:$t("1bq14z5","SPU编码","lang"),key:"goods_bn",disabled:a,type:"input",display:"inline"},{label:$t("b47jsb4","商品类型","lang"),key:"is_medicine",type:"radio",isShow:()=>this.is_pharma_industry,disabled:()=>!this.is_pharma_industry||!!this.$route.params.itemId,options:[{label:"0",name:$t("c167eu4","实物商品","lang")},{label:"1",name:$t("b1l2334","医药商品","lang")}],required:!0,message:$t("bwynb9","请选择是否是处方药","lang")},{label:$t("gxlz3b4","药品分类","lang"),key:"medicine_type",isShow:()=>"1"==this.form.is_medicine,type:"select",options:[{title:$t("o3ww2","西药","lang"),value:"0"},{title:$t("bxmbw3","中成药","lang"),value:"1"},{title:$t("eae82","其他","lang"),value:"3"}],validator:async(e,t,i)=>{t||"1"!=this.form.is_medicine?i():i($t("yawajm7","请选择药品分类","lang"))},display:"inline"},{label:$t("f3qbj04","生产厂家","lang"),key:"manufacturer",type:"input",isShow:()=>"1"==this.form.is_medicine,validator:async(e,t,i)=>{t||"1"!=this.form.is_medicine?i():i($t("ifcpbv7","请输入生产厂家","lang"))},display:"inline"},{label:$t("invdao4","通用别名","lang"),key:"common_name",isShow:()=>"1"==this.form.is_medicine,type:"input",validator:async(e,t,i)=>{t||"1"!=this.form.is_medicine?i():i($t("ev7nk77","请输入通用别名","lang"))},display:"inline"},{label:$t("zgqs0i5","特殊通用名","lang"),key:"special_common_name",type:"input",isShow:()=>"1"==this.form.is_medicine,display:"inline"},{label:$t("crlhfh4","批准文号","lang"),key:"approval_number",isShow:()=>"1"==this.form.is_medicine,type:"input",validator:async(e,t,i)=>{t||"1"!=this.form.is_medicine?i():i($t("krhjfe7","请输入批准文号","lang"))},display:"inline"},{label:$t("zubqp6","最小售卖单位","lang"),key:"unit",isShow:()=>"1"==this.form.is_medicine,type:"input",validator:async(e,t,i)=>{t||"1"!=this.form.is_medicine?i():i($t("8gdt80a","请输入第三方药品编码","lang"))},display:"inline"},{label:$t("b1nqzc4","包装规格","lang"),key:"packing_spec",isShow:()=>"1"==this.form.is_medicine,type:"input",display:"inline"},{label:$t("egzt2","剂型","lang"),key:"dosage",isShow:()=>"1"==this.form.is_medicine,type:"input",display:"inline"},{label:$t("fnrs655","是否处方药","lang"),key:"is_prescription",isShow:()=>"1"==this.form.is_medicine,disabled:()=>!!this.$route.params.itemId,type:"switch",tip:$t("b37tj5d","开启后前端走处方药下单流程","lang")},{label:$t("fbpbe94","用药提示","lang"),key:"use_tip",type:"input",isShow:()=>this.medicinePrescription,validator:async(e,t,i)=>{!t&&"1"==this.form.is_medicine&&this.form.is_prescription?i($t("i7dpgm7","请输入用药提示","lang")):i()}},{label:$t("gxs03l4","药品症状","lang"),key:"symptom",isShow:()=>this.medicinePrescription,type:"input",validator:async(e,t,i)=>{!t&&"1"==this.form.is_medicine&&this.form.is_prescription?i($t("glb0ra7","请输入药品症状","lang")):i()}},{label:$t("afv8kk4","供应状态","lang"),key:"is_market",type:"select",isShow:this.IS_SUPPLIER(),options:[{title:$t("eqsf2","可售","lang"),value:1},{title:$t("buay43","不可售","lang"),value:0}],display:"inline"},{label:$t("oig12","赠品","lang"),key:"isGift",type:"switch",tip:$t("d5w499","开启后前台不可购买","lang")},{label:$t("j5fnxf4","销售分类","lang"),key:"salesCategory",width:"720px",required:!0,message:$t("w32lpi7","请选择销售分类","lang"),component:({key:i},a)=>e("el-cascader",{class:[{"is-error":a[i]}],attrs:{clearable:!0,filterable:!0,options:this.saleCategoryList},props:{...t},model:{value:a[i],callback:e=>{this.$set(a,i,e)}}})},{label:$t("cwjdv3","商品图","lang"),key:"pics",required:!0,message:$t("jatdv37","请上传商品图片","lang"),component:({key:t},i)=>e("div",[e("div",[e("SpImagePicker",{attrs:{drag:!0,max:9},model:{value:i[t],callback:e=>{this.$set(i,t,e)}}}),e("div",{class:"image-checkbox-container"},[e("el-checkbox-group",{model:{value:i.picsQrcode,callback:e=>{this.$set(i,"picsQrcode",e)}}},[i[t].map((t,i)=>e("el-checkbox",{attrs:{label:i}}))])])])]),tip:`${$t("7ducf42k","1. 最多可上传9张图片，文件格式为bmp、png、jpeg、jpg或gif，大小不超过2M（建议尺寸：500px * 500px）<br />2. 相册图朋友圈分享是否生成小程序码1","lang")}`},{label:$t("b4a6124","商品视频","lang"),key:"videos",component:({key:t},i)=>e("div",[e("SpVideoPicker",{attrs:{disabled:a},model:{value:i[t],callback:e=>{this.$set(i,t,e)}}})])},{label:$t("b40p614","商品参数","lang"),disabled:a,type:"group",isShow:(e,{paramsData:t})=>t.length>0},{key:"paramsData",component:({key:t},i)=>e(r,{attrs:{disabled:a},on:{change:this.onChangeParamsData},model:{value:i[t],callback:e=>{this.$set(i,t,e)}}}),isShow:(e,{paramsData:t})=>t.length>0},{label:$t("b49wfn4","商品规格","lang"),type:"group"},{label:$t("dpu363","多规格","lang"),key:"isSpecs",disabled:a,type:"switch",onChange:()=>{},isShow:(e,{isSpecs:t})=>{const{itemId:i}=this.$route.params,{skus:a}=this.form.skuParams;return!i}},{label:$t("ht8j5t4","规格图片","lang"),key:"isShowSpecimg",type:"switch",disabled:a,onChange:()=>{},isShow:(e,{isSpecs:t})=>t,tip:$t("u57rs9h","是否在商详页规格选择器显示规格图片","lang")},{key:"specParams",component:({key:t},i)=>e(u,{ref:"specParams",attrs:{"is-show-point":this.isShowPoint,isMedicine:"1"==this.form.is_medicine,medicinePrescription:this.medicinePrescription,isPrescriptionApproved:this.isPrescriptionApproved,disabled:a,provinceList:this.provinceList},model:{value:i[t],callback:e=>{this.$set(i,t,e)}}}),isShow:(e,{isSpecs:t})=>!t,showMessage:!1,validator:async(e,t,i)=>{try{this.form.isSpecs||await this.$refs.specParams.handleSubmit(),i()}catch(e){const[t]=Object.keys(e),[a]=e[t];i(a.message)}}},{key:"skuParams",component:({key:t},i)=>e(_,{ref:"skuParams",attrs:{isSupplierGoods:this.routerParams.isSupplierGoods,medicinePrescription:this.medicinePrescription,isPrescriptionApproved:this.isPrescriptionApproved,"is-show-point":this.isShowPoint,disabled:a,provinceList:this.provinceList},model:{value:i[t],callback:e=>{this.$set(i,t,e)}}}),isShow:(e,{isSpecs:t})=>t,validator:async(e,t,i)=>{if(this.form.isSpecs){const{specItems:e,skus:a}=t,l=e.find(({approve_status:e})=>!!e),n=e.find(({store:e})=>!!e),r=e.find(({price:e})=>!!e),o=e.find(({max_num:e})=>!!e),p=a?.some(e=>!e.checkedSku.length);p&&i($t("n9f2696","请勾选规格项","lang")),(0,s.WZ)()||this.routerParams.isSupplierGoods||l?n?r?!o&&this.medicinePrescription?i($t("ejvf3c9","请输入最大开方数量","lang")):i():i($t("dloiix9","请输入商品销售价格","lang")):i($t("mf0jg77","请输入商品库存","lang")):i($t("uwrpz17","请选择商品状态","lang"))}}},{label:$t("u3rc9u9","PC关键词搜索引擎","lang"),type:"group"},{label:$t("juxqri4","页面标题","lang"),key:"title",disabled:a,type:"input"},{label:$t("juwz7y4","页面描述","lang"),key:"mate_description",type:"textarea",disabled:a,width:"720px"},{label:$t("cnmdu3","关键词","lang"),key:"mate_keywords",type:"textarea",placeholder:$t("zfyhawe","关键词之间请用半角”,”分隔","lang"),disabled:a,width:"720px"},{label:$t("bejmaw4","图文详情","lang"),type:"group"},{label:"",key:"mode",disabled:a,type:"radio",options:[{label:"richText",name:$t("dxvm93","富文本","lang")},{label:"component",name:$t("iydul3","组件式","lang")}]},{label:"",key:"intro",disabled:a,type:"richText",isShow:(e,{mode:t})=>"richText"==t},{label:"",key:"content",component:({key:t},i)=>e("SpIphone",[e("SpDecorate",{ref:"decorateRef",attrs:{scene:"1002"},model:{value:i[t],callback:e=>{this.$set(i,t,e)}}})]),isShow:(e,{mode:t})=>"component"==t}],categoryList:[],mainCategoryDisabled:!1,saleCategoryList:[],regionsList:[],provinceList:[],goodsSpec:[],is_pharma_industry:!0,submitLoading:!1,loading:!1,isLeave:!1,isShowPoint:!1,mainCategorySpec:[],multipleSkuGoods:!1,applyDialog:!1,applyForm:{applyResult:"rejected",audit_reason:""},applyFormList:[{label:$t("bpsmjv4","处理结果","lang"),key:"applyResult",type:"radio",options:[{label:"rejected",name:$t("budzk3","不同意","lang")},{label:"approved",name:$t("ettv2","同意","lang")}]},{label:$t("czp1gs4","拒绝原因","lang"),key:"audit_reason",type:"textarea",placeholder:$t("kjdze37","请输入拒绝原因","lang"),isShow:(e,t)=>"rejected"==t.applyResult,validator:(e,t,i)=>{"rejected"!=this.applyForm.applyResult||t?i():i(new Error($t("kjdze37","请输入拒绝原因","lang")))}}],routerParams:{isSupplierGoods:!1},customizeStatus:[]}},computed:{medicinePrescription(){return"1"==this.form.is_medicine&&this.form.is_prescription}},created(){this.getPointRule(),this.getMainCategory(),this.getShippingTemplates(),this.getBrandList(),this.getAddress(),this.getBaseSetting()},methods:{async getBaseSetting(){const e=await this.$api.company.getGlobalSetting();this.is_pharma_industry="1"==e.medicine_setting?.is_pharma_industry},async getPointRule(){const e=await this.$api.promotions.getPointRule();this.isShowPoint="items"==e.access&&("true"==e.isOpenMemberPoint||1==e.isOpenMemberPoint)},async getMainCategory(){const{itemId:e}=this.$route.params;this.loading=!0;let t=[];!function e(t,i){t.forEach(t=>{const a={label:t.category_name,value:t.category_id};t.children&&(a.children=[],e(t.children,a.children)),i.push(a)})}(await this.$api.goods.getCategory({is_main_category:!0}),t),this.categoryList=t,await this.getSaleCategory(),e?(this.fetchDetail(),this.mainCategoryDisabled=!0):this.loading=!1;const i=this.formList.findIndex(e=>"salesCategory"==e.key);-1!=i&&(this.formList[i].required=!(this.IS_SUPPLIER()||this.routerParams?.isSupplierGoods))},async getSaleCategory(){let e=[];!function e(t,i){t.forEach(t=>{const a={label:t.category_name,value:t.category_id};t.children&&(a.children=[],e(t.children,a.children)),i.push(a)})}(await this.$api.goods.getCategory({is_show:!1}),e),this.saleCategoryList=e},async fetchDetail(){const{itemId:e}=this.$route.params,{is_new:t,supplier:i,islist:a}=this.$route.query;this.routerParams=this.$route.query||{};const{item_id:l,supplier_id:n,audit_status:r,item_name:o,brief:p,templates_id:u,brand_id:c,item_unit:m,sort:d,regions_id:_,tax_rate:g,tax_rate_code:h,is_gift:b,pics:y,pics_create_qrcode:f,nospec:v,delivery_time:k,approve_status:$,store:w,item_bn:S,medicine_spec:x,start_num:P,weight:I,volume:C,price:z,cost_price:L,market_price:j,barcode:q,point_num:N,item_category_main:A,item_category_info:R,item_category:D,item_spec_list:E,item_main_cat_id:F,is_show_specimg:O,is_market:B,spec_images:G,spec_items:T,mode:M,tdk_content:U,intro:V,videos:J,item_params_list:Q,item_params:W,aftersales_end_date:Z,goods_notice:H,delivery_data_type:K,delivery_desc:X,supplier_goods_bn:Y,goods_bn:ee,audit_reason:te,package_num:ie,buy_limit_area:ae=[],package_type:se="",is_medicine:le,medicine_data:ne}=await this.$api.goods.getItemsDetail(e,{operate_source:i||(0,s.WZ)()||this.routerParams?.isSupplierGoods?"supplier":"platform",page_from:a?"supplier_items":""}),{medicine_type:re,manufacturer:oe,common_name:pe,special_common_name:ue,approval_number:ce,unit:me,packing_spec:de,dosage:_e,is_prescription:ge,use_tip:he,max_num:be,symptom:ye}=ne||{};this.loading=!1;let fe=[];this.deepMainCategory(A[0],fe),this.form.mainCategory=fe,this.form.audit_status=r,this.form.audit_reason=te,this.form.itemName=t?`${o}${$t("hjzc3","_复制","lang")}`:o,this.form.item_id=l,this.form.supplier_id=n,this.form.brief=p,this.form.templatesId=u.toString(),this.form.brandId=c+"",this.form.itemUnit=m,this.form.sort=d,this.form.regionsId=_,this.form.isGift=b,this.form.taxRate=g,this.form.videos=J||"",this.form.isShowSpecimg=O,this.form.is_market=B,this.form.aftersales_end_date=Z,this.form.goods_notice=H,this.form.goods_bn=t?"":ee,this.form.delivery_data={delivery_data_type:K,delivery_desc:X},this.form.salesCategory=this.deepSalesCategory(D),this.form.pics=y,2==ne?.audit_status&&(this.isPrescriptionApproved=!0),this.form.is_medicine=le+"",Object.keys(ne||{}).length&&(this.form.medicine_type=re+"",this.form.manufacturer=oe,this.form.common_name=pe,this.form.special_common_name=ue,this.form.approval_number=ce,this.form.unit=me,this.form.packing_spec=de,this.form.dosage=_e,this.form.is_prescription=1==ge,this.form.use_tip=he,this.form.symptom=ye),f.forEach((e,t)=>{e&&this.form.picsQrcode.push(t)}),this.form.isSpecs=!v,this.multipleSkuGoods=!v;const ve=[];this.form.specParams={approve_status:$,store:w,item_id:l,item_bn:t?"":S,medicine_spec:x,start_num:P,weight:I,volume:C,price:isNaN(z/100)?"":z/100,cost_price:isNaN(L/100)?"":L/100,market_price:isNaN(j/100)?"":j/100,barcode:q,point_num:N,tax_rate:g,tax_rate_code:h,package_num:ie,delivery_time:k,buy_limit_area:ve,package_type:"sku",max_num:be};const{goods_params:ke,goods_spec:$e=[]}=await this.$api.goods.getCategoryInfo(F);if(this.mainCategorySpec=$e,this.resolveParamsData(ke,W),this.customizeStatus=W,v)this.resolveSkuParams($e);else{const e={package_num:ie,buy_limit_area:ve,package_type:se};this.resolveSkuParams($e,T),this.$refs.skuParams.onSkuChange({spec_images:G,spec_items:T,restParams:e})}if(U){let{title:e,mate_description:t,mate_keywords:i}=JSON.parse(U)||{};this.form.title=e,this.form.mate_description=t,this.form.mate_keywords=i}(0,s.cy)(V)?(this.form.mode="component",this.form.content=V):this.form.intro=(0,s.Kg)(V)?V:V.toString()},deepMainCategory({category_id:e,category_name:t,children:i},a){a.push(e),i&&this.deepMainCategory(i[0],a)},deepSalesCategory(e){const{saleCategoryList:t}=this;function i(e,t,a){void 0===a&&(a=[]);for(let s=0;s<e.length;s++){let l=[...a];if(l.push(e[s].value),e[s].value==t)return l;if(e[s].children){const a=i(e[s].children,t,l);if(a)return a}}}let a=[];return e.forEach(e=>{a.push(i(t,e))}),a},async getShippingTemplates(){const{list:e}=await this.$api.shipping.getShippingTemplatesList({page:1,pageSize:99,status:1});e.length>0?this.formList[5].options=e.map(e=>({value:e.template_id,title:e.name})):this.$message.error($t("l83xib8","请先添加运费模板","lang"))},async getBrandList(){const{list:e}=await this.$api.goods.getGoodsAttr({page:1,pageSize:1e3,attribute_type:"brand"});this.formList[6].options=e.map(({attribute_id:e,attribute_name:t})=>({value:e,title:t}))},async getAddress(){const e=await this.$api.common.getAddress();this.regionsList=e;const t={value:"all",label:$t("en402","全部","lang")},i=e.map(e=>({...e,children:[]}));this.provinceList=[].concat(t,i)},async onChangeMainCategory(e){const{goods_params:t,goods_spec:i=[]}=await this.$api.goods.getCategoryInfo(e[e.length-1]);this.resolveParamsData(t),this.resolveSkuParams(i)},resolveParamsData(e,t=[]){this.form.paramsData=e.map(({attribute_id:e,attribute_name:i,attribute_values:{list:a}},s)=>{const l=t.find(t=>t.attribute_id==e)||{};return{id:e,label:i,attr_id:l?.attribute_value_id||"",children:a.map(({attribute_value_id:e,attribute_value:t})=>({value:e,label:t}))}})},resolveSkuParams(e,t){let i=[],s=[];t&&(t.forEach(({item_spec:e})=>{s=s.concat(e)}),i=(0,a.A)(s,"spec_value_id")),this.form.skuParams.skus=e.map(({attribute_id:e,attribute_name:t,is_image:a,attribute_values:{list:l}})=>{let n=[];return{skuId:e,skuName:t,isImage:Boolean(a),skuValue:l.map(({attribute_value_id:e,attribute_value:t})=>{i.find(({spec_value_id:t})=>t==e)&&n.push(e);const{spec_custom_value_name:a}=s.find(t=>t.spec_value_id==e)||{};return{attribute_value_id:e,attribute_value:t,custom_attribute_value:a,sku_images:[]}}),checkedSku:n}})},handleCancel(){this.$router.go(-1)},async onFormSubmit(e){const{isSpecs:t}=this.form;try{await this.$refs.form.handleSubmit(),this.onFormSave(e)}catch(e){}},async onChangeParamsData(e){this.form.paramsData=[];let{goods_params:t,goods_spec:i=[]}=await this.$api.goods.getCategoryInfo(this.form.mainCategory[this.form.mainCategory.length-1]),a={};t.forEach(t=>{t.attribute_id==e.id&&t.attribute_values.total_count>0&&t?.attribute_values?.list.forEach(t=>{t.attribute_value==e.attr_id&&(a=t)})}),this.customizeStatus.push({attribute_id:e.id,attribute_name:e.label,attribute_value_id:a.attribute_value_id,atttribute_value_name:a.attribute_value}),this.customizeStatus=this.uniqueArrayById(this.customizeStatus,"attribute_id"),this.resolveParamsData(t,this.customizeStatus)},uniqueArrayById(e,t="id"){const i=[],a=new Set;for(let s=e.length-1;s>=0;s--){const l=e[s];a.has(l[t])||(a.add(l[t]),i.unshift(l))}return i},async onFormSave(e){const{itemId:t}=this.$route.params,{is_new:i,supplier:a}=this.$route.query,{goods_bn:l,supplier_id:n,itemType:r,specialType:o,itemSource:p,mainCategory:u,itemName:c,brief:m,templatesId:d,brandId:_,itemUnit:g,sort:h,regionsId:b,isGift:y,taxRate:f,salesCategory:v,pics:k,picsQrcode:$,videos:w,isSpecs:S,is_market:x,title:P,mate_description:I,mate_keywords:C,mode:z,content:L,intro:j,specParams:q,isShowSpecimg:N,paramsData:A,aftersales_end_date:R,delivery_data:{delivery_data_type:D,delivery_desc:E},goods_notice:F,is_medicine:O,medicine_type:B,manufacturer:G,common_name:T,special_common_name:M,approval_number:U,unit:V,packing_spec:J,dosage:Q,is_prescription:W,use_tip:Z,symptom:H}=this.form;let K="";if(q.buy_limit_area){const e=q.buy_limit_area;e&&e.length&&(K=e.join(","))}const X=v?.map(e=>e?.[e?.length?e.length-1:0])||[];let Y=[];k.forEach((e,t)=>{Y.push($.includes(t))});let ee={buy_limit_area:K,goods_bn:l,supplier_id:n,is_market:x,item_type:r,operate_source:a||(0,s.WZ)()?"supplier":"platform",audit_status:e,special_type:o,item_source:p,item_main_cat_id:u[u.length-1],item_name:c,brief:m,templates_id:d,brand_id:_,item_unit:g,sort:h,regions_id:b?.length>0?b:"",regions:b?.length>0?(0,s.SK)(b,this.regionsList):"",aftersales_end_date:R,delivery_desc:E,delivery_data_type:D,goods_notice:F,is_gift:y,tax_rate:f,item_category:X,pics:k,pics_create_qrcode:Y,videos:w,nospec:String(!S),is_show_specimg:N,audit_reason:this.applyForm.audit_reason,item_params:A.map(({id:e,attr_id:t,children:i})=>({attribute_id:e,attribute_value_id:t,attribute_value_name:t&&i.find(({value:e})=>e==t)?.label||""})),tdk_content:JSON.stringify({title:P,mate_description:I,mate_keywords:C}),intro:"component"==z?JSON.stringify(L):j};if(S){const{skus:e,skuItemImages:a,specItems:s,package_type:l,package_num:n,buy_limit_area:r}=this.form.skuParams;ee={...ee,package_type:l,package_num:n,buy_limit_area:r.length?r.join(","):"",spec_images:JSON.stringify(a.map(({attribute_value_id:e,custom_attribute_value:t,attribute_value:i,sku_images:a})=>({spec_value_id:e,item_spec:t||i,item_image_url:a}))),spec_items:JSON.stringify(s?.filter(e=>e.spec_name)?.map((a,s)=>{const{sku_id:l,is_default:n,price:r,cost_price:o,market_price:p}=a,u=l.split("_");return{...a,item_bn:"true"==i?"":a.item_bn,is_default:t?0==s:n,item_spec:u.map(t=>{let i={};return e.forEach(e=>{e.skuValue?.forEach(({attribute_value_id:a,attribute_value:s,custom_attribute_value:l})=>{a==t&&(i.spec_id=e.skuId,i.spec_value_id=a,i.spec_value_name=s,i.spec_custom_value_name=l)})}),i})}}))}}else ee={...ee,...q},i&&(ee={...ee,item_bn:""});"1"==O?(ee={...ee,is_medicine:O,medicine_type:B,manufacturer:G,common_name:T,special_common_name:M,approval_number:U,unit:V,packing_spec:J,dosage:Q},W?ee={...ee,is_prescription:"1",use_tip:Z,symptom:H}:ee.is_prescription=W?"1":"0"):ee.is_medicine=O,this.submitLoading=!0;try{t&&!i?(await this.$api.goods.updateItems(t,{...ee,item_id:t}),this.$message.success($t("deua4r4","更新成功","lang"))):(await this.$api.goods.createItems(ee),this.$message.success($t("e7ygyc4","添加成功","lang"))),this.submitLoading=!1,this.isLeave=!0,this.$parent.onActivated();const e=this;setTimeout(()=>{e.$router.go(-1)},200)}catch(e){this.submitLoading=!1}},onApplyConfirm(){this.applyDialog=!0},async onApplySubmit(){this.onFormSubmit(this.applyForm.applyResult)},getOptions(e){return{aspectRatio:"16:9",fluid:!0,sources:[{type:"video/mp4",src:e}],notSupportedMessage:$t("2gq0je","此视频暂无法播放，请稍后再试","lang"),controlBar:!1}}}}),h=(0,n.A)(g,function(){var e=this,t=e._self._c;return t("SpPage",{staticClass:"goods-index",attrs:{title:$t("b4a80q4","商品详情","lang")}},[t("template",{slot:"page-footer"},[t("div",{staticClass:"text-center"},[t("el-button",{nativeOn:{click:function(t){return e.handleCancel.apply(null,arguments)}}},[e._v($t("dd4ni4"," 取消 ","lang"))]),!e.IS_SUPPLIER()&&e.form.supplier_id||e.routerParams.detail||e.routerParams.supplier?e._e():t("el-button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:function(t){return e.onFormSubmit("submitting")}}},[e._v($t("cp35x4"," 保存 ","lang"))]),e.IS_SUPPLIER()&&!e.routerParams.detail?t("el-button",{attrs:{type:"primary",loading:e.submitLoading},nativeOn:{click:function(t){return e.onFormSubmit("processing")}}},[e._v($t("agptt76"," 提交审核 ","lang"))]):e._e(),e.IS_ADMIN()&&"processing"==e.form.audit_status?t("el-button",{attrs:{type:"primary",loading:e.submitLoading},nativeOn:{click:function(t){return e.onApplyConfirm.apply(null,arguments)}}},[e._v($t("6qipxq7"," 保存并审核 ","lang"))]):e._e()],1)]),"rejected"==e.form.audit_status&&e.IS_SUPPLIER()?t("el-alert",{attrs:{title:`${$t("gn18bz5","审核失败：","lang")}${e.form.audit_reason||""}`,type:"warning"}}):e._e(),t("SpForm",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{"show-message":"","label-width":"100px","form-list":e.formList,submit:!1},model:{value:e.form,callback:function(t){e.form=t},expression:"form"}}),t("SpDialog",{ref:"sendNumDialogRef",attrs:{title:$t("g5o72","审核","lang"),form:e.applyForm,"form-list":e.applyFormList},on:{onSubmit:e.onApplySubmit},model:{value:e.applyDialog,callback:function(t){e.applyDialog=t},expression:"applyDialog"}})],2)},[],!1,null,null,null),b=h.exports}}]);