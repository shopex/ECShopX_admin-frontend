"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[3173],{13173:function(t,e,a){a.r(e),a.d(e,{default:function(){return c}});a(44114),a(18111),a(7588),a(18237);var n=a(17659),r=a(95093),i=a.n(r),o=a(94644),s=a(31625),l={data(){const t=i()().subtract("8","day"),e=i()().subtract("1","day");return{queryForm:{datetime:[t,e],activity_id:""},setting:(0,o.createSetting)({columns:[{name:$t("hwbe2","日期","lang"),key:"count_date"},{name:$t("kv0f13","订单数","lang"),key:"order_count"},{name:$t("wrrv495","付款订单数","lang"),key:"order_payed_count"},{name:$t("b3hm574","售后单数","lang"),key:"aftersales_count"},{name:$t("c0vbi3","交易额","lang"),key:"amount_payed_count",formatter:(t,e,a)=>t/100},{name:"GMV",key:"gmv_count",formatter:(t,e,a)=>t/100},{name:$t("lmdy73","退款额","lang"),key:"refunded_count",formatter:(t,e,a)=>t/100}]}),purchaseActivityList:[],tableData:[],loading:!0,dataTimeArr:[],total:{order_count:0,order_payed_count:0,aftersales_count:0,gmv_count:0,amount_payed_count:0,refunded_count:0},pickerOptions:{shortcuts:[{text:$t("dl4oop4","最近一周","lang"),onClick(t){const a=new Date;a.setTime(a.getTime()-6912e5),t.$emit("pick",[a,e])}},{text:$t("4znkgj5","最近一个月","lang"),onClick(t){const a=new Date;a.setTime(a.getTime()-26784e5),t.$emit("pick",[a,e])}},{text:$t("4zndsa5","最近三个月","lang"),onClick(t){const a=new Date;a.setTime(a.getTime()-78624e5),t.$emit("pick",[a,e])}}],disabledDate:t=>t.getTime()>e},line:null}},created(){this.pagesQuery=new n.A({fetch:this.getPurchaseActivity}).nextPage()},mounted(){this.fetchStatisticData()},methods:{onSearch(){this.fetchStatisticData()},async fetchStatisticData(){const{datetime:[t,e],activity_id:a}=this.queryForm,n={start:i()(t).format("YYYY-MM-DD"),end:i()(e).format("YYYY-MM-DD"),act_id:a.length>0?a.toString():""};n.act_id&&(n.order_class="employee_purchase"),this.loading=!0;const{list:r}=await this.$api.datacube.getCompanyData(n);this.loading=!1,this.tableData=r,this.total={order_count:r.reduce((t,e)=>t+parseInt(e.order_count),0),order_payed_count:r.reduce((t,e)=>t+parseInt(e.order_payed_count),0),aftersales_count:r.reduce((t,e)=>t+parseInt(e.aftersales_count),0),gmv_count:r.reduce((t,e)=>t+parseInt(e.gmv_count),0),amount_payed_count:r.reduce((t,e)=>t+parseInt(e.amount_payed_count),0),refunded_count:r.reduce((t,e)=>t+parseInt(e.refunded_count),0)},r.length>0&&this.$nextTick(()=>{this.renderChart(r)}),this.$nextTick(()=>{this.$refs.finder.refresh()})},renderChart(t){let e=[],a=[];t.forEach(t=>{e.push({time:t.count_date,name:$t("o7hv2","订单","lang"),value:parseInt(t.order_count)}),e.push({time:t.count_date,name:$t("wrrv495","付款订单数","lang"),value:parseInt(t.order_payed_count)}),e.push({time:t.count_date,name:$t("b3hm574","售后单数","lang"),value:parseInt(t.aftersales_count)}),a.push({time:t.count_date,name:"GMV",value:parseInt(t.gmv_count)}),a.push({time:t.count_date,name:$t("c0vbi3","交易额","lang"),value:parseInt(t.amount_payed_count)}),a.push({time:t.count_date,name:$t("lmdy73","退款额","lang"),value:parseInt(t.refunded_count)})}),this.line?this.line.changeData([e,a]):(this.line=new s.Im("container",{data:[e,a],padding:"auto",xField:"time",yField:["value","value"],geometryOptions:[{geometry:"line",seriesField:"name",smooth:!0},{geometry:"line",seriesField:"name",smooth:!0}],appendPadding:[0,8,0,0]}),this.line.render())},async getPurchaseActivity({page:t,pageSize:e}){const{list:a,total_count:n}=await this.$api.marketing.getPurchaseActivity({page:t,pageSize:e});this.pagesQuery.setTotal(n),this.purchaseActivityList=this.purchaseActivityList.concat(a)}}},c=(0,a(81656).A)(l,function(){var t=this,e=t._self._c;return e("SpPage",[e("SpFilterForm",{attrs:{model:t.queryForm},on:{onSearch:t.onSearch,onReset:t.onSearch}},[e("SpFilterFormItem",{attrs:{prop:"datetime",label:$t("1w000t5","查询日期:","lang")}},[e("el-date-picker",{attrs:{type:"daterange",align:"right",format:"yyyy-MM-dd","range-separator":$t("po31","至","lang"),"start-placeholder":$t("cd0ag54","开始日期","lang"),"end-placeholder":$t("gfhy2u4","结束日期","lang"),clearable:!1,"picker-options":t.pickerOptions},model:{value:t.queryForm.datetime,callback:function(e){t.$set(t.queryForm,"datetime",e)},expression:"queryForm.datetime"}})],1)],1),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:4}},[e("el-statistic",{attrs:{value:t.total.order_count,title:$t("o7hv2","订单","lang")}})],1),e("el-col",{attrs:{span:4}},[e("el-statistic",{attrs:{value:t.total.order_payed_count,title:$t("wrrv495","付款订单数","lang")}})],1),e("el-col",{attrs:{span:4}},[e("el-statistic",{attrs:{value:t.total.aftersales_count,title:$t("b3hm574","售后单数","lang")}})],1),e("el-col",{attrs:{span:4}},[e("el-statistic",{attrs:{value:t.total.gmv_count/100,title:$t("yugvum6","GMV(元)","lang")}})],1),e("el-col",{attrs:{span:4}},[e("el-statistic",{attrs:{value:t.total.amount_payed_count/100,title:$t("60kobk6","交易额(元)","lang")}})],1),e("el-col",{attrs:{span:4}},[e("el-statistic",{attrs:{value:t.total.refunded_count/100,title:$t("72pamp6","退款额(元)","lang")}})],1)],1),t.tableData.length>0?e("div",{staticStyle:{height:"400px",margin:"40px 0"},attrs:{id:"container"}}):t._e(),e("SpFinder",{ref:"finder",attrs:{"no-selection":"","show-pager":!1,setting:t.setting,"row-actions-align":"left",data:t.tableData}})],1)],1)},[],!1,null,"6361ec34",null).exports}}]);