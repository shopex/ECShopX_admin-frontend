"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[2408],{32408:function(e,t,a){a.r(t),a.d(t,{default:function(){return m}});a(18111),a(7588),a(61701);var i=a(47499),r=a.n(i),n=a(94644),o=a(95093),l=a.n(o),s=a(63366),d=a(41472);const c=e=>(0,d.u)([{label:$t("w14tjo5","开票方名称","lang"),key:"sales_party_id",type:"select",tip:$t("jz2exec","下拉选择配置销方开票信息","lang"),options:e.invoiceSellerList,required:!0},{label:$t("d1penj6","配置税率分类","lang"),key:"tax_rate_type",validator:(t,a,i)=>{"SPECIFIED"!=a||e.dialogForm.category_ids?.length?i():i(new Error($t("w42rk88","指定分类不能为空","lang")))},defaultValue:"ALL",component({key:t},a){const i=this.$createElement;return i("div",[i("el-radio-group",{on:{change:()=>{a.category_ids=""}},model:{value:a.tax_rate_type,callback:e=>{this.$set(a,"tax_rate_type",e)}}},[i("el-radio",{attrs:{label:"ALL"}},[$t("av9kmt4","全部分类","lang")]),i("el-radio",{attrs:{label:"SPECIFIED"}},[$t("cvgvs84","指定分类","lang")])]),i("div",["SPECIFIED"==a.tax_rate_type&&i("el-cascader",r()([{attrs:{placeholder:$t("l72nr3","请选择","lang"),clearable:!0,options:e.itemCategoryList},class:"invoice-cascader"},{props:{props:{value:"category_id",label:"category_name",multiple:!0,children:"children"}}},{model:{value:a.category_ids,callback:e=>{this.$set(a,"category_ids",e)}}}]))])])}},{label:$t("b2ydyo4","发票税率","lang"),key:"invoice_tax_rate",type:"input",required:!0,component({key:e},t){const a=this.$createElement;return a("div",[a("el-input",{attrs:{type:"number",min:0},model:{value:t[e],callback:a=>{this.$set(t,e,a)}}},[a("template",{slot:"append"},["%"])])])}}],e);var g=a(49986),h=a(77825),y=a(89886),_=a(79646),p={mixins:[h.v8],data(){return{activeName:"all",status:g.h5,selectedRows:[],editRow:null,areas:[],dialogForm:{sales_party_id:"",tax_rate_type:"ALL",category_ids:[],invoice_tax_rate:""},dialogShow:!1,dialogTitle:"",confirmStatus:!1,itemCategoryList:[],invoiceSellerList:[]}},computed:{tableSchema(){return e=this,(0,n.createSetting)({actions:[{name:$t("mekb2","编辑","lang"),key:"edit",type:"button",buttonType:"text",action:{handler:(0,s.default)(([t])=>{e.editRowHandle(t)},2e3,{leading:!0})}},{name:$t("eslg2","删除","lang"),key:"delete",type:"button",buttonType:"text",action:{handler:(0,s.default)(([t])=>{e.deleteRowHandle(t)},2e3,{leading:!0})}}],columns:[{name:$t("w14tjo5","开票方名称","lang"),key:"seller_company_name",width:"160",render(e,{row:t}){return e("span",[" ",t.sales_party_info?.seller_company_name," "])}},{name:$t("w1b2re5","开票方税号","lang"),key:"seller_tax_no",width:"160",render(e,{row:t}){return e("span",[" ",t.sales_party_info?.seller_tax_no," "])}},{name:$t("w1ak495","开票方电话","lang"),key:"seller_phone",width:"160",render(e,{row:t}){return e("span",[" ",t.sales_party_info?.seller_phone," "])}},{name:$t("g2r33u4","管理分类","lang"),key:"invoice_apply_bn",width:"300",render(t,{row:a}){if("ALL"==a.tax_rate_type)return $t("av9kmt4","全部分类","lang");const i=a.category_ids&&e.getCategoryPathsName(e.itemCategoryList,JSON.parse(a.category_ids))||[];return t("div",[i.map(e=>t("div",[e]))])}},{name:$t("le7t2","税率","lang"),key:"invoice_tax_rate",width:"80",render(e,{row:t}){return e("span",[" ",t.invoice_tax_rate," % "])}},{name:$t("ei0k23","开票人","lang"),key:"seller_name",width:"120",render(e,{row:t}){return e("span",[" ",t.sales_party_info?.seller_name," "])}},{name:$t("fcctu3","收款人","lang"),key:"payee",width:"120",render(e,{row:t}){return e("span",[" ",t.sales_party_info?.payee," "])}},{name:$t("djpzj3","复核人","lang"),key:"reviewer",width:"120",render(e,{row:t}){return e("span",[" ",t.sales_party_info?.reviewer," "])}},{name:$t("w155wh5","开票方地址","lang"),key:"seller_address",width:"160",render(e,{row:t}){return e("span",[" ",t.sales_party_info?.seller_address," "])}},{name:$t("e7zi4j4","添加时间","lang"),key:"created",width:"160",render(e,{row:t}){return e("span",[" ",l()(1e3*t.created_at).format("yyyy-MM-DD HH:mm:ss")," "])}}]});var e},dialogRuleForm(){return c(this)}},mounted(){this.getInvoiceSellerList(),this.getMainCategory()},methods:{async getInvoiceSellerList(){const{list:e}=await this.$api.financial.getInvoiceSellerList();this.invoiceSellerList=e.map(e=>({value:e.id,title:e.seller_company_name}))},async getMainCategory(){const e=await this.$api.goods.getCategory({is_main_category:!0});this.itemCategoryList=e},refresh(){this.$refs.finder.refresh(!0)},beforeSearch(e){return{...e}},handleTreeCheck(e,t){this.$nextTick(()=>{this.dialogForm.category_ids=t.checkedKeys})},getCategoryPaths(e=[],t=[]){const a={};function i(e,r){const n=[...r,e.category_id];t.includes(e.category_id)&&(a[e.category_id]=n),e.children&&e.children.length>0&&e.children.forEach(e=>i(e,n))}return e.forEach(e=>i(e,[])),t.map(e=>a[e]||[])},getCategoryPathsName(e=[],t=[]){const a={};function i(e,r){const n=[...r,{id:e.category_id,name:e.category_name}];t.includes(e.category_id)&&(a[e.category_id]=n),e.children&&e.children.length>0&&e.children.forEach(e=>i(e,n))}return e.forEach(e=>i(e,[])),t?.map(e=>a[e]||[])?.map(e=>e?.map(e=>e.name).join(" > "))},editRowHandle(e){this.dialogTitle=$t("h0v5hta","编辑管理分类税率配置","lang"),this.editRow=e,this.dialogShow=!0;const{id:t,sales_party_id:a,tax_rate_type:i,category_ids:r,invoice_tax_rate:n}=e,o=r&&this.getCategoryPaths(this.itemCategoryList,JSON.parse(r))||[];this.dialogForm={id:t,sales_party_id:a,tax_rate_type:i,category_ids:o,invoice_tax_rate:n}},handleSelectionChange(e){this.selectedRows=e},onDialogFormSubmit(){const e=(0,_.A)(this.dialogForm);"SPECIFIED"==e.tax_rate_type&&(e.category_ids=e.category_ids.map(e=>e[e.length-1])),this.confirmStatus=!0,this.editRow.id?y.default.financial.updateInvoiceTax(this.editRow.id,e).then(e=>{this.$message.success($t("deua4r4","更新成功","lang")),this.dialogShow=!1,this.refresh()}).finally(()=>{this.confirmStatus=!1}):y.default.financial.createInvoiceTax(e).then(e=>{this.$message.success($t("ar737y4","创建成功","lang")),this.dialogShow=!1,this.refresh()}).finally(()=>{this.confirmStatus=!1})},handleAdd(){this.dialogTitle=$t("5tds82a","新增管理分类税率配置","lang"),this.dialogShow=!0,this.editRow={},this.dialogForm={sales_party_id:"",tax_rate_type:"ALL",category_ids:[],invoice_tax_rate:""}},deleteRowHandle(e){this.$confirm($t("jk8kny9","确定删除该配置吗？","lang"),$t("hn562","提示","lang"),{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(async()=>{await y.default.trade.deleteCategoryTaxRate({id:e.id}),this.$message.success($t("azeh8z4","删除成功","lang")),this.refresh()})}}},m=(0,a(81656).A)(p,function(){var e=this,t=e._self._c;return t("SpPage",{staticClass:"page-body"},[t("SpRouterView",[t("SpFinder",{ref:"finder",attrs:{url:"/order/category-taxrate/list","fixed-row-action":"","row-actions-width":"100px",setting:e.tableSchema,hooks:{beforeSearch:e.beforeSearch},"row-actions-fixed-align":"left"},on:{"select-all":e.handleSelectionChange,"selection-change":e.handleSelectionChange},scopedSlots:e._u([{key:"tableTop",fn:function(){return[t("el-button",{staticClass:"add-btn",attrs:{type:"primary",icon:"iconfont icon-xinzengcaozuo-01"},on:{click:e.handleAdd}},[e._v($t("eouqto5","添加新配置","lang"))])]},proxy:!0}])}),t("SpDialog",{ref:"dialogRef",staticClass:"base-form",attrs:{title:e.dialogTitle,modal:!1,"label-width":"130px",form:e.dialogForm,"form-list":e.dialogRuleForm,"confirm-status":e.confirmStatus},on:{onSubmit:e.onDialogFormSubmit},model:{value:e.dialogShow,callback:function(t){e.dialogShow=t},expression:"dialogShow"}})],1)],1)},[],!1,null,"6654fe19",null).exports}}]);