"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[5746],{35746:function(t,e,a){a.r(e),a.d(e,{default:function(){return o}});a(44114);var i=a(95353),s=a(87378),r=a(5748),l=a(77825),n={components:{sideBar:a(71196).A,imgPicker:s.default},mixins:[l.v8],data(){return{currentIndex:"",form:{is_image:!1,attribute_type:"item_spec",attribute_id:"",attribute_name:"",attribute_memo:"",attribute_values:[]},params:{attribute_type:"item_spec",attribute_name:""},list:[],loading:!1,imgDialog:!1,isGetImage:!1,imgIndex:0,brand_name:"",total_count:0,show_sideBar:!1}},mounted(){this.fetchList()},methods:{handleDelete(t){this.$confirm($t("hbclsq8","确认删除该参数？","lang")).then(e=>{(0,r.deleteGoodsAttr)(t.row.attribute_id).then(e=>{this.list.splice(t.$index,1),this.$message({type:"success",message:$t("d1spvi4","操作成功","lang")})})}).catch(t=>{})},handleNew(){this.show_sideBar=!0,this.resetData()},resetData(){this.form={is_image:!1,attribute_type:"item_spec",attribute_id:"",attribute_name:"",attribute_memo:"",attribute_values:[]}},handleEdit(t){this.show_sideBar=!0,this.form={is_image:"true"===t.is_image,attribute_id:t.attribute_id,attribute_type:t.attribute_type,attribute_name:t.attribute_name,attribute_memo:t.attribute_memo,attribute_values:t.attribute_values.list}},addItem(){if(this.form.attribute_values.length>50)return void this.$message({type:"warning",message:$t("8ml6m97","最多添加50项","lang")});this.form.attribute_values.push({attribute_value:"",image_url:""})},removeItem(t){this.$confirm($t("my1gjt8","确认删除当前值？","lang")).then(e=>{this.form.attribute_values.splice(t,1)}).catch(t=>{})},save(){let t=JSON.parse(JSON.stringify(this.form));t.attribute_values=JSON.stringify(t.attribute_values),this.form.attribute_id?(0,r.updateGoodsAttr)(t.attribute_id,t).then(t=>{this.$message({type:"success",message:$t("d1spvi4","操作成功","lang")}),this.fetchList()}):(0,r.addGoodsAttr)(t).then(t=>{this.$message({type:"success",message:$t("d1spvi4","操作成功","lang")}),this.page.pageIndex=1,this.resetData(),this.fetchList()})},fetchList(){this.loading=!0;const{pageIndex:t,pageSize:e}=this.page;let a={page:t,pageSize:e,...this.params};(0,r.getGoodsAttr)(a).then(t=>{this.list=t.data.data.list,this.total_count=t.data.data.total_count,this.loading=!1})},handleImgChange(t){this.imgDialog=!0,this.isGetImage=!0,this.imgIndex=t.$index},handleImgPicker(t){this.currentIndex=t,this.imgDialog=!0,this.isGetImage=!0},pickImg(t){this.form.attribute_values[this.currentIndex].image_url=t.url,this.imgDialog=!1},closeImgDialog(){this.imgDialog=!1,this.isGetImage=!1},syncItemSpec(){(0,r.syncItemSpec)().then(t=>{1==t.data.data.status?this.$message({type:"success",message:$t("lgxi507","已加入执行队列","lang")}):this.$message({type:"error",message:$t("b1sq7h4","同步失败","lang")})})}},computed:{...(0,i.L8)(["wheight"])}},o=(0,a(81656).A)(n,function(){var t=this,e=t._self._c;return e("SpPage",[e("SpFilterForm",{attrs:{model:t.params},on:{onSearch:t.onSearch,onReset:t.onSearch}},[e("SpFilterFormItem",{attrs:{prop:"attribute_name",label:$t("g2y57l5","规格名称:","lang")}},[e("el-input",{attrs:{placeholder:$t("fpuy707","请输入规格名称","lang")},model:{value:t.params.attribute_name,callback:function(e){t.$set(t.params,"attribute_name",e)},expression:"params.attribute_name"}})],1)],1),e("div",{staticClass:"action-container"},[e("el-button",{attrs:{type:"primary"},on:{click:t.handleNew}},[t._v($t("1oqiee6"," 新增规格 ","lang"))])],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{border:"",data:t.list,height:t.wheight-170,"element-loading-text":$t("go5gpa5","数据加载中","lang"),"default-sort":{prop:"bind_date",order:"descending"}}},[e("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(a){return t._l(a.row.attribute_values.list,function(a,i){return e("span",{key:i,staticClass:"sku-value"},[a.image_url?e("img",{staticClass:"sku-img",attrs:{src:a.image_url}}):t._e(),t._v(t._s(a.attribute_value))])})}}])}),e("el-table-column",{attrs:{label:$t("hkxb2","操作","lang"),width:"150"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.handleEdit(a.row)}}},[t._v($t("juz394"," 编辑 ","lang"))]),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.handleDelete(a)}}},[t._v($t("db22k4"," 删除 ","lang"))])]}}])}),e("el-table-column",{attrs:{label:$t("lnjk2","类型","lang"),width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s("true"==e.row.is_image?$t("ff9l2","图片","lang"):$t("hrqo2","文字","lang"))+" ")]}}])}),e("el-table-column",{attrs:{prop:"attribute_name",label:$t("ht82nv4","规格名称","lang"),width:"200"}}),e("el-table-column",{attrs:{prop:"attribute_memo",label:$t("ht8uk94","规格备注","lang")}})],1),e("div",{staticClass:"mt-4 text-right"},[e("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next","current-page":t.page.pageIndex,"page-sizes":[10,20,50],total:t.total_count,"page-size":t.page.pageSize},on:{"update:currentPage":function(e){return t.$set(t.page,"pageIndex",e)},"update:current-page":function(e){return t.$set(t.page,"pageIndex",e)},"current-change":t.onCurrentChange,"size-change":t.onSizeChange}})],1),e("imgPicker",{attrs:{"dialog-visible":t.imgDialog,"sc-status":t.isGetImage},on:{chooseImg:t.pickImg,closeImgDialog:t.closeImgDialog}}),e("sideBar",{attrs:{visible:t.show_sideBar,title:$t("d7dco64","新增规格","lang")},on:{"update:visible":function(e){t.show_sideBar=e}}},[e("el-form",[e("el-form-item",{attrs:{label:$t("ht82nv4","规格名称","lang")}},[e("el-input",{model:{value:t.form.attribute_name,callback:function(e){t.$set(t.form,"attribute_name",e)},expression:"form.attribute_name"}})],1),e("el-form-item",{attrs:{label:$t("ht8uk94","规格备注","lang")}},[e("el-input",{model:{value:t.form.attribute_memo,callback:function(e){t.$set(t.form,"attribute_memo",e)},expression:"form.attribute_memo"}})],1),e("el-form-item",{attrs:{label:$t("hterfs4","规格类型","lang")}},[e("el-radio-group",{model:{value:t.form.is_image,callback:function(e){t.$set(t.form,"is_image",e)},expression:"form.is_image"}},[e("el-radio",{attrs:{label:!1}},[t._v($t("fvbkg4"," 文字 ","lang"))]),e("el-radio",{attrs:{label:!0}},[t._v($t("dukuv4"," 图片 ","lang"))])],1)],1),e("el-form-item",{attrs:{label:$t("kols43","规格值","lang")}}),t._l(t.form.attribute_values,function(a,i){return e("div",{key:i,staticClass:"key-item"},[t.form.is_image?e("div",{staticClass:"upload-box",on:{click:function(e){return t.handleImgPicker(i)}}},[a.image_url?e("img",{staticClass:"avatar",attrs:{src:a.image_url}}):e("SpIcon",{attrs:{size:"22",name:"camera"}})],1):t._e(),e("div",{staticClass:"key-item-input",class:t.form.is_image?"content-h-padded":"content-padded-right"},[e("el-input",{attrs:{placeholder:$t("g3o1mh5","规格值名称","lang")},model:{value:a.attribute_value,callback:function(e){t.$set(a,"attribute_value",e)},expression:"item.attribute_value"}})],1),e("div",{on:{click:function(e){return t.removeItem(i)}}},[e("SpIcon",{attrs:{size:"22",name:"delete"}})],1)])}),e("el-button",{attrs:{type:"default",size:"small"},on:{click:t.addItem}},[t._v($t("62abcx7"," 添加规格值 ","lang"))])],2),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v($t("fk4a44"," 提交 ","lang"))])],1)],1)],1)},[],!1,null,"5e179e66",null).exports}}]);