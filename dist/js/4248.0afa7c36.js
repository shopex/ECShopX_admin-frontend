"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[4248],{24248:function(e,t,a){a.r(t),a.d(t,{default:function(){return m}});a(44114),a(18111),a(20116),a(7588),a(57270);var l=a(6919),n=a(71196),s=a(87378),r=a(43224),i={inject:["refresh"],components:{SideBar:n.A,imgPicker:s.default,imgBox:r.A},data(){return{form:{id:"",tem_name:"",form_style:"single",header_link_title:"",header_title:"",bottom_title:"",content:[{title:"",sort:1,formdata:[]}],tem_type:"ask_answer_paper",status:1,key_index:[],header_bg_pic:"",header_height:""},params:{page:1,pageSize:10},settingList:[],total_count:0,keyIndexIsShow:!0,showElementList:!1,ItemsList:[],loading:!1,selectRows:[],formElement:[{name:$t("fdh0h3","文本框","lang"),value:"text"},{name:$t("fddru3","文本域","lang"),value:"textarea"},{name:$t("b3ysrd4","单选按钮","lang"),value:"radio"},{name:$t("dqmui3","复选框","lang"),value:"checkbox"},{name:$t("y2xu945","下拉选择框","lang"),value:"select"},{name:$t("dagpju4","日期选择","lang"),value:"date"},{name:$t("y1ei926","地区地址选择","lang"),value:"area"},{name:$t("hr6v2","数字","lang"),value:"number"},{name:$t("vkty615","上传身份证","lang"),value:"idcard"},{name:$t("n7nyvs6","上传其他附件","lang"),value:"otherfile"}],templateRadio:"",formcontentindex:0,selectdata:[],imgDialog:!1,isGetImage:!1}},mounted(){this.$route.query.id&&(0,l.getTemplateInfo)(this.$route.query.id).then(e=>{this.form=e.data.data,"basic_entry"===this.form.tem_type?this.keyIndexIsShow=!0:this.keyIndexIsShow=!1})},methods:{getDataList(){this.loading=!0,(0,l.getSettingList)(this.params).then(e=>{this.ItemsList=e.data.data.list,this.$refs.multipleTable.clearSelection(),this.selectdata.forEach(e=>{this.ItemsList.find(t=>t.id===e.id)&&this.$refs.multipleTable.toggleRowSelection(e)}),this.loading=!1,this.total_count=e.data.data.total_count})},submitAction(){const e=this;this.$refs.form.validate(t=>{if(!t)return this.$message({type:"error",message:$t("y73vps8","请录入正确的数据","lang")}),!1;{if("basic_entry"==this.form.tem_type&&this.form.key_index.length<=0)return this.$message({type:"error",message:$t("bhb76n7","请配置关键数值","lang")}),!1;const t=JSON.parse(JSON.stringify(this.form));t.key_index=JSON.stringify(t.key_index),t.content=JSON.stringify(t.content),this.form.id?(0,l.updateTemplate)(t).then(t=>{t.data.data&&this.$message({message:$t("deua4r4","更新成功","lang"),type:"success",duration:2e3,onClose(){e.refresh(),e.$router.go(-1)}})}):(0,l.saveTemplate)(t).then(t=>{t.data.data&&this.$message({message:$t("e7ygyc4","添加成功","lang"),type:"success",duration:2e3,onClose(){e.refresh(),e.$router.go(-1)}})}).catch(e=>{this.$message({type:"error",message:$t("agf1ru4","保存出错","lang")})})}})},handleCancel(){this.$router.go(-1)},handleTypeChange(e){this.showElementList=!1,this.form.tem_type=e,this.keyIndexIsShow="basic_entry"===e},checkIsRequired(e,t){},checkKeyIndex(e,t){if(t.key_index&&this.form.key_index.length>=5)return this.form.content[e].key_index=!1,this.$message({type:"error",message:$t("t86fcfb","关键指数最高只能选5个","lang")}),!1;if(this.form.key_index.length>0){let e=this.form.key_index.findIndex(e=>t.id===e.id);-1!==e?this.form.key_index.splice(e,1):t.key_index&&this.form.key_index.push(t)}else this.form.key_index.push(t)},checkContent(e){"basic_entry"==this.form.tem_type?(this.params.form_element="number",this.formElement=[{name:$t("hr6v2","数字","lang"),value:"number"}]):(this.params.form_element="",this.formElement=[{name:$t("fdh0h3","文本框","lang"),value:"text"},{name:$t("fddru3","文本域","lang"),value:"textarea"},{name:$t("b3ysrd4","单选按钮","lang"),value:"radio"},{name:$t("dqmui3","复选框","lang"),value:"checkbox"},{name:$t("y2xu945","下拉选择框","lang"),value:"select"},{name:$t("dagpju4","日期选择","lang"),value:"date"},{name:$t("y1ei926","地区地址选择","lang"),value:"area"},{name:$t("hr6v2","数字","lang"),value:"number"},{name:$t("vkty615","上传身份证","lang"),value:"idcard"},{name:$t("n7nyvs6","上传其他附件","lang"),value:"otherfile"}]),this.showElementList=!0,this.formcontentindex=e,this.selectdata=this.form.content[e].formdata,this.getDataList()},searchData(){this.params.page=1,this.getDataList()},handleCurrentChange(e){this.params.page=e,this.getDataList()},handleSizeChange(e){this.loading=!1,this.params.page=1,this.params.pageSize=e,this.getDataList()},getRowKeys(e){return e.id},getTemplateRow(e,t){this.selectRows=new Array(t)},saveStoreAction(){let e=this.formcontentindex;this.showElementList=!1;let t=JSON.parse(JSON.stringify(this.form.content[e].formdata));t.forEach(e=>{e.is_required=!1}),this.form.content[e].formdata=t},handleSelectAll(e){let t=this.formcontentindex;e.length>0?(this.form.content[t].formdata=[],e.forEach(e=>{-1===this.form.content[t].formdata.findIndex(t=>e.id===t.id)&&this.form.content[t].formdata.push(e)})):this.ItemsList.forEach((e,t)=>{let a=this.form.content[t].formdata.findIndex(t=>e.id===t.id);-1!==a&&this.form.content[t].formdata.splice(a,1)})},handleSelectChange(e,t){let a=this.formcontentindex,l=this.form.content[a].formdata.findIndex(e=>t.id===e.id);-1!==l?this.form.content[a].formdata.splice(l,1):this.form.content[a].formdata.push(t)},addCard(){this.form.content.push({title:"",formdata:[],sort:1})},delCard(e){this.form.content.splice(e,1)},handleImgBChange(){this.imgDialog=!0,this.isGetImage=!0},pickImg(e){this.form.header_bg_pic=e.url,this.imgDialog=!1},closeImgDialog(){this.imgDialog=!1}}},o=(0,a(81656).A)(i,function(){var e=this,t=e._self._c;return t("div",{staticClass:"section section-white page-formtemplateadd"},[t("div",{staticClass:"section-body"},[t("el-form",{ref:"form",staticClass:"demo-ruleForm",attrs:{model:e.form,"label-width":"150px","label-position":"right"}},[e.form.id?e._e():t("div",{staticClass:"content-center content-bottom-padded"},[t("el-radio-group",{on:{change:e.handleTypeChange},model:{value:e.form.tem_type,callback:function(t){e.$set(e.form,"tem_type",t)},expression:"form.tem_type"}},[t("el-radio-button",{attrs:{label:"ask_answer_paper"}},[e._v($t("qslzor6"," 问卷调查 ","lang"))]),t("el-radio-button",{attrs:{label:"basic_entry"}},[e._v($t("5207ouc"," 基础录入(统计报表) ","lang"))])],1)],1),t("el-form-item",{attrs:{label:$t("ij5d2","标题","lang"),prop:"tem_name",rules:[{required:!0,message:$t("2j7m1y5","请输入标题","lang"),trigger:"blur"}]}},[t("el-col",{attrs:{span:20}},[t("el-input",{attrs:{maxlength:30,placeholder:$t("aguh514","体测表单","lang")},model:{value:e.form.tem_name,callback:function(t){e.$set(e.form,"tem_name","string"==typeof t?t.trim():t)},expression:"form.tem_name"}})],1)],1),"ask_answer_paper"==e.form.tem_type?t("el-form-item",{attrs:{label:$t("hkb8wr4","表单风格","lang"),prop:"form_style",rules:[{required:!0,message:$t("2j7m1y5","请输入标题","lang"),trigger:"blur"}]}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:5}},[t("el-radio",{attrs:{label:"single"},model:{value:e.form.form_style,callback:function(t){e.$set(e.form,"form_style",t)},expression:"form.form_style"}},[e._v($t("i84sx5c"," 单页问卷(多项集合) ","lang"))])],1),t("el-col",{attrs:{span:10}},["multiple"==e.form.form_style?t("el-alert",{attrs:{"show-icon":"",closable:!1,title:$t("oh6xp2c","多页问卷方式提供图片显示","lang"),type:"warning"}}):e._e()],1)],1)],1):e._e(),t("el-form-item",{attrs:{label:$t("hjz1xd4","表单内容","lang"),prop:"content",rules:[{required:!0,message:$t("xoj7pk7","请选择表单内容","lang"),trigger:"change"}]}},e._l(e.form.content,function(a,l){return t("el-row",{key:l,attrs:{gutter:2}},[t("el-col",{attrs:{span:18}},[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},["ask_answer_paper"==e.form.tem_type?[t("span",[e._v($t("1xjyuy6","区块一标题:","lang"))]),t("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:$t("av7h5a4","区块标题","lang"),size:"mini"},model:{value:a.title,callback:function(t){e.$set(a,"title",t)},expression:"item.title"}}),t("span",[e._v($t("f147x3","排序:","lang"))]),t("el-input",{staticStyle:{width:"50px"},attrs:{size:"mini"},model:{value:a.sort,callback:function(t){e.$set(a,"sort",t)},expression:"item.sort"}})]:e._e(),t("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(t){return e.checkContent(l)}}},[e._v($t("el5h7l8"," 选择表单内容 ","lang"))])],2),a.formdata.length>0?t("el-col",[t("el-table",{staticStyle:{width:"100%"},attrs:{data:a.formdata}},[t("el-table-column",{attrs:{prop:"id",label:"ID",width:"40"}}),t("el-table-column",{attrs:{prop:"field_title",label:$t("ij5d2","标题","lang"),width:"100"}}),t("el-table-column",{attrs:{prop:"sort",label:$t("hge52","排序","lang"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-input",{attrs:{width:"80",size:"small"},model:{value:a.row.sort,callback:function(t){e.$set(a.row,"sort",t)},expression:"scope.row.sort"}})]}}],null,!0)}),t("el-table-column",{attrs:{prop:"sort",label:$t("d8rnfh4","是否必填","lang"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-checkbox",{attrs:{checked:a.row.is_required},model:{value:a.row.is_required,callback:function(t){e.$set(a.row,"is_required",t)},expression:"scope.row.is_required"}})]}}],null,!0)}),e.keyIndexIsShow?t("el-table-column",{attrs:{label:$t("ar3sx6e","设置关键指数(最多设置5个)","lang")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-checkbox",{on:{change:function(t){return e.checkKeyIndex(a.$index,a.row)}},model:{value:a.row.key_index,callback:function(t){e.$set(a.row,"key_index",t)},expression:"scope.row.key_index"}})]}}],null,!0)}):e._e()],1)],1):e._e()],1)],1),"ask_answer_paper"==e.form.tem_type?t("el-col",{attrs:{span:2}},[0==l?t("el-button",{attrs:{circle:"",type:"primary"},on:{click:e.addCard}},[e._v($t("fqea3"," 增 ","lang"))]):e._e(),0!=l?t("el-button",{attrs:{circle:"",type:"primary"},on:{click:function(t){return e.delCard(l)}}},[e._v($t("emn43"," 删 ","lang"))]):e._e()],1):e._e()],1)}),1),e.keyIndexIsShow&&e.form.key_index.length>0?t("el-form-item",{attrs:{label:$t("aw5w9w4","关键指数","lang"),prop:"tem_name"}},[t("el-row",e._l(e.form.key_index,function(a,l){return t("el-col",{key:l,attrs:{span:4}},[t("div",[e._v(e._s(a.field_title))])])}),1)],1):e._e(),"ask_answer_paper"==e.form.tem_type?t("el-form-item",{attrs:{label:$t("e58hax8","填写表单图片背景","lang"),prop:"header_bg_pic"}},[t("el-col",{attrs:{span:20}},[t("div",[t("imgBox",{attrs:{"img-url":e.wximageurl+e.form.header_bg_pic,inline:""},on:{click:e.handleImgBChange}})],1),t("div",{staticClass:"frm-tips"},[e._v($t("ko6kd015"," 只能上传jpg/png文件，且不超过2M （建议尺寸：640px，高度自适应） ","lang"))]),t("imgPicker",{attrs:{"dialog-visible":e.imgDialog,"sc-status":e.isGetImage},on:{chooseImg:e.pickImg,closeImgDialog:e.closeImgDialog}})],1)],1):e._e(),"ask_answer_paper"==e.form.tem_type?t("el-form-item",{attrs:{label:$t("6qtn3f8","表单距离顶部高度","lang"),prop:"header_height"}},[t("el-col",{attrs:{span:20}},[t("el-input",{staticStyle:{width:"50%"},attrs:{placeholder:$t("2j8e0g5","请输入数字","lang")},model:{value:e.form.header_height,callback:function(t){e.$set(e.form,"header_height","string"==typeof t?t.trim():t)},expression:"form.header_height"}})],1)],1):e._e(),t("el-form-item",[t("el-button",{nativeOn:{click:function(t){return e.handleCancel.apply(null,arguments)}}},[e._v($t("dd4ni4"," 取消 ","lang"))]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitAction}},[e._v($t("cp35x4"," 保存 ","lang"))])],1)],1)],1),t("SideBar",{attrs:{visible:e.showElementList,title:$t("xxm8dm6","选择表单元素","lang"),width:"40"},on:{"update:visible":function(t){e.showElementList=t}}},[t("el-row",{staticClass:"content-bottom-padded",attrs:{gutter:20}},[t("el-col",{attrs:{span:6}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:$t("xoj2ov7","请选择表单元素","lang"),clearable:""},on:{change:e.searchData},model:{value:e.params.form_element,callback:function(t){e.$set(e.params,"form_element",t)},expression:"params.form_element"}},e._l(e.formElement,function(e,a){return t("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})}),1)],1),t("el-col",{attrs:{span:6}},[t("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:$t("ij5d2","标题","lang")},model:{value:e.params.field_title,callback:function(t){e.$set(e.params,"field_title",t)},expression:"params.field_title"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.searchData},slot:"append"})],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.ItemsList,"tooltip-effect":"dark","row-key":e.getRowKeys,"select-on-indeterminate":!1},on:{select:e.handleSelectChange,"select-all":e.handleSelectAll}},[t("el-table-column",{attrs:{type:"selection","reserve-selection":!0,width:"50"}}),t("el-table-column",{attrs:{prop:"id",label:"ID",width:"40"}}),t("el-table-column",{attrs:{prop:"field_title",label:$t("ij5d2","标题","lang"),width:"150"}}),t("el-table-column",{attrs:{prop:"form_element",label:$t("eibh2","元素","lang"),width:"80"}}),t("el-table-column",{attrs:{label:$t("ll5kp3","选择项","lang")},scopedSlots:e._u([{key:"default",fn:function(a){return e._l(a.row.options,function(a,l){return t("span",{key:l},[e._v(" "+e._s(a.value))])})}}])})],1),e.total_count>e.params.pageSize?t("div",{staticClass:"tr"},[t("el-pagination",{attrs:{layout:"prev, pager, next",total:e.total_count,"page-size":e.params.pageSize},on:{"current-change":e.handleCurrentChange}})],1):e._e(),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.saveStoreAction}},[e._v($t("hnjoo3","确 定","lang"))])],1)],1)],1)},[],!1,null,"852ef758",null),m=o.exports}}]);