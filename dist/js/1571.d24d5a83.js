"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[1571],{91571:function(t,e,a){a.r(e),a.d(e,{default:function(){return m}});a(44114),a(18111),a(22489),a(61701);var l=a(78069),i=a(87378),s=a(79836),n=a(85135),r={components:{imgPicker:i.default,loadingBtn:s.default},data(){return{disabled:!1,imgDialog:!1,isGetImage:!1,pickerImgType:"",resultVisible:!1,signNameList:[],form:{template_type:"",scene_id:"",template_name:"",related_sign_name:"",template_content:"",remark:""},rules:{template_type:[(0,l.XU)($t("fgu70k4","短信类型","lang"),"change")],scene_id:[(0,l.XU)($t("fgnxu14","短信场景","lang")),"change"],related_sign_name:[(0,l.XU)($t("at80gg4","关联签名","lang")),"change"],template_name:[(0,l.XU)($t("dtgrr54","模板名称","lang"))],template_content:[(0,l.XU)($t("dtg6aa4","模板内容","lang")),(0,l.SO)(500),(0,l.gE)(1)],remark:[(0,l.XU)($t("fdc1q64","申请说明","lang")),(0,l.SO)(200)]},template_type_options:[],variables:[],isEditFirst:!0}},watch:{async"form.template_type"(t){let e=(await(0,n.getTemplateSeleteList)({template_type:t})).data.data.list.filter(t=>t.scene_name!=$t("bcm72h5","订单提货码","lang"));this.template_type_options=e;const{type:a}=this.$route.query;if("detail"==a||"edit"==a&&this.isEditFirst)return this.isEditFirst=!1;this.form.scene_id="",this.form.template_content="",this.variables=[]},async"form.scene_id"(t){if(!t)return;const e=await(0,n.getTemplateContentLabel)({id:t});this.variables=e.data.data.variables,"edit"!=this.$route.query.type&&"detail"!=this.$route.query.type&&(this.form.template_content=e.data.data.default_template)}},mounted(){this.init()},methods:{async init(){const{type:t,id:e}=this.$route.query,{list:a,total_count:l}=await this.$api.sms.getSmsSignatureList({status:"1",page:1,pageSize:500});if(this.signNameList=a.map(t=>({label:t.sign_name,value:t.sign_name})),t){const a=await(0,n.SmsTemplateDetail)({id:e});this.resultHandler(a),"detail"==t&&(this.disabled=!0)}},resultHandler(t){const{template_type:e,scene_id:a,template_name:l,template_content:i,remark:s,related_sign_name:n}=t.data.data;this.form={template_type:e,scene_id:a+"",template_name:l,template_content:i,remark:s,related_sign_name:n}},submitForm(t){const{type:e,id:a}=this.$route.query;this.$refs[t].validate(async t=>{if(!t)return this.$refs.loadingBtn.closeLoading(),!1;try{if("edit"==e){const t=await(0,n.editSmsTemplate)({id:a,...this.form});this.submitFormResult(t)}else{const t=await(0,n.addSmsTemplate)(this.form);this.submitFormResult(t)}}catch(t){this.$refs.loadingBtn.closeLoading()}})},submitFormResult(t){t.data.data.status&&(this.resultVisible=!0),this.$refs.loadingBtn.closeLoading()},fnBack(){this.$router.push({path:"/setting/system-config/sms-service/ali_sms/sms_template"})},fnAgain(){this.resultVisible=!1,this.$refs.form.resetFields()},pickImg({url:t}){if(t&&this.pickerImgType){this.form[this.pickerImgType]=t,this.imgDialog=!1}},closeImgDialog(){this.imgDialog=!1,this.isGetImage=!1},handleImgPicker(t){this.disabled||(this.pickerImgType=t,this.imgDialog=!0,this.isGetImage=!0)},fnKey(t){const{type:e}=this.$route.query;"detail"!=e&&(this.form.template_content=this.form.template_content+" ${"+t.var_title+"} ")}}},m=(0,a(81656).A)(r,function(){var t=this,e=t._self._c;return e("div",{staticClass:"sms_signatures_edit"},[e("h4",[t._v($t("v8y0lz6","添加短信模板","lang"))]),e("el-form",{ref:"form",staticClass:"demo-ruleForm",attrs:{model:t.form,rules:t.rules,"label-width":"150px"}},[e("el-form-item",{attrs:{label:$t("fgu70k4","短信类型","lang"),prop:"template_type"}},[e("el-radio-group",{attrs:{disabled:t.disabled},model:{value:t.form.template_type,callback:function(e){t.$set(t.form,"template_type",e)},expression:"form.template_type"}},[e("el-radio",{attrs:{label:"0"}},[t._v($t("u9xlirh"," 验证码（0.045元 / 条） ","lang"))]),e("el-radio",{attrs:{label:"1"}},[t._v($t("mu6bc0i"," 短信通知（0.045元 / 条） ","lang"))]),t.VERSION_IN_PURCHASE()?t._e():e("el-radio",{attrs:{label:"2"}},[t._v($t("7msg2zi"," 推广短信（0.055元 / 条） ","lang"))])],1)],1),t.form.template_type?e("el-form-item",{attrs:{label:$t("fgnxu14","短信场景","lang"),prop:"scene_id"}},[e("el-select",{staticStyle:{width:"400px"},attrs:{placeholder:$t("l72nr3","请选择","lang"),disabled:t.disabled},model:{value:t.form.scene_id,callback:function(e){t.$set(t.form,"scene_id",e)},expression:"form.scene_id"}},t._l(t.template_type_options,function(t){return e("el-option",{key:t.id,attrs:{label:t.scene_name,value:t.id}})}),1)],1):t._e(),e("el-form-item",{attrs:{label:$t("dtgrr54","模板名称","lang"),prop:"template_name"}},[e("el-input",{attrs:{disabled:t.disabled,minlength:"1",maxlength:"30","show-word-limit":"",placeholder:$t("3by1o7a","长度限1-30个字符","lang")},model:{value:t.form.template_name,callback:function(e){t.$set(t.form,"template_name",e)},expression:"form.template_name"}})],1),e("el-form-item",{attrs:{label:$t("at80gg4","关联签名","lang"),prop:"related_sign_name"}},[e("el-select",{staticStyle:{width:"400px"},attrs:{placeholder:$t("l72nr3","请选择","lang"),disabled:t.disabled},model:{value:t.form.related_sign_name,callback:function(e){t.$set(t.form,"related_sign_name",e)},expression:"form.related_sign_name"}},t._l(t.signNameList,function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),e("el-form-item",{attrs:{label:$t("dtg6aa4","模板内容","lang"),prop:"template_content"}},[e("nav",t._l(t.variables,function(a){return e("span",{key:a.var_name,class:["key",{detail:"detail"==t.$route.query.type}],on:{click:function(e){return t.fnKey(a)}}},[t._v("${ "+t._s(a.var_title)+" }")])}),0),e("el-input",{attrs:{disabled:t.disabled,type:"textarea",rows:8,maxlength:"500","show-word-limit":"",placeholder:$t("5xzzy6x","短信模板申请说明，请描述您的业务使用场景，长度为1-500个字符。","lang")},model:{value:t.form.template_content,callback:function(e){t.$set(t.form,"template_content",e)},expression:"form.template_content"}}),e("ul",{staticClass:"tips"},[e("li",[t._v($t("oammbc2c",' 短信字数含 " 签名 + 模版内容 + 变量内容”，短信 70 个字数含以内，按 1 条短信计费；超出 70 个字为长短信，按照 67 个字数记为 1 条短信费用。 ',"lang"))]),e("li",[t._v($t("5lw7jiy"," 短信服务的模板都需要经过审核，审核通过后才可以使用该模板，请参见 ","lang")),e("a",{attrs:{target:"_blank",href:"https://help.aliyun.com/document_detail/108253.htm?spm=a2c4g.11186623.0.0.7c8e2918ZCtnlV"}},[t._v($t("nwmv2p7","短信模板规范。","lang"))])])])],1),e("el-form-item",{attrs:{label:$t("fdc1q64","申请说明","lang"),prop:"remark"}},[e("el-input",{attrs:{disabled:t.disabled,type:"textarea",rows:4,maxlength:"100","show-word-limit":"",placeholder:$t("i9ix16x","短信模板申请说明，请描述您的业务使用场景，长度为1-100个字符。","lang")},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1),"detail"!==t.$route.query.type?e("el-form-item",[e("loadingBtn",{ref:"loadingBtn",on:{clickHandle:function(e){return t.submitForm("form")}}}),e("el-button",{on:{click:t.fnBack}},[t._v($t("dd4ni4"," 取消 ","lang"))]),e("ul",{staticClass:"tips"},[e("li",[t._v($t("udfn2lu","预计两小时完成审核，政企签名预计在 48 小时工作时间内审核","lang"))]),e("li",[t._v($t("52kl34v","审核工作时间：周一至周日 9:00-23:00（法定节日顺延）","lang"))])])],1):t._e()],1),e("imgPicker",{attrs:{"dialog-visible":t.imgDialog,"sc-status":t.isGetImage},on:{chooseImg:t.pickImg,closeImgDialog:t.closeImgDialog}}),e("el-dialog",{staticClass:"result",attrs:{visible:t.resultVisible,"show-close":!1}},[e("el-result",{attrs:{icon:"success",title:$t("cx7dr74","提交成功","lang"),"sub-title":$t("b3yngq9","请根据提示进行操作","lang")}},[e("template",{slot:"subTitle"},[e("h5",[t._v($t("x4eupwm","模板已提交审核，审核结果可在模板列表中查看。","lang"))]),e("ul",{staticClass:"tips"},[e("li",[t._v($t("udfn2lu","预计两小时完成审核，政企签名预计在 48 小时工作时间内审核","lang"))]),e("li",[t._v($t("52kl34v","审核工作时间：周一至周日 9:00-23:00（法定节日顺延）","lang"))])])]),e("template",{slot:"extra"},[e("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.fnBack}},[t._v($t("kkroyt6"," 返回列表 ","lang"))]),t.$route.query.type?t._e():e("el-button",{attrs:{size:"medium"},on:{click:t.fnAgain}},[t._v($t("mvkykm9"," 再添加一个模板 ","lang"))])],1)],2)],1)],1)},[],!1,null,"c455a8e6",null).exports}}]);