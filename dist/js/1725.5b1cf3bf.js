"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[1725],{1725:function(t,e,a){a.r(e),a.d(e,{default:function(){return p}});a(18111),a(20116);var s=a(42005),n=a(51125),i=a(77825),l={components:{AddClassifyBox:n.default},mixins:[i.Ay,i.v8],data(){return{AddClassifyBox:{visible:!1,parent_id:"",parent_name:""},loading:!1,editInfo:null,params:{name:"",sort_order_by:"asc"}}},mounted(){this.fetchList()},methods:{addClassify(){this.AddClassifyBox.parent_name="",this.AddClassifyBox.parent_id="0",this.editInfo={},this.switchBoxHandle()},fnSort({order:t}){"ascending"==t?(this.params.sort_order_by="asc",this.onSearch()):(this.params.sort_order_by="desc",this.onSearch())},addRow(t){this.editInfo=t,this.editInfo.type="add",this.AddClassifyBox.parent_id=t.id,this.AddClassifyBox.parent_name=t.name,this.switchBoxHandle()},editRow(t){this.editInfo=t,this.editInfo.type="edit",this.AddClassifyBox={visible:!0,parent_id:t.cur_level,parent_name:"0"!=t.parent_id?this.queryParent(t.parent_id).name:null}},queryParent(t){return this.tableList.find(e=>e.id==t)},async deleteRow(t){const{id:e}=t;this.$confirm($t("ol6ski6","确认删除吗？","lang"),"",{confirmButtonText:$t("kzjg2","确定","lang"),cancelButtonText:$t("ev022","取消","lang"),type:"warning"}).then(async()=>{(await(0,s.deleteMerchantsClassification)(e)).data.data.status&&(this.$message.success($t("azeh8z4","删除成功","lang")),this.onSearch())})},async callbackConfirm(t,e){if("edit"==e){const{name:e,sort:a,is_show:n}=t;(await(0,s.editMerchantsClassification)(t.id||this.editInfo&&this.editInfo.id,{name:e,sort:a,is_show:n})).data.data.status&&(this.$message.success($t("gmjwui4","编辑成功","lang")),this.switchBoxHandle(!0),this.onSearch())}else{const{name:e,sort:a,is_show:n,parent_id:i}=t;(await(0,s.addMerchantsClassification)({name:e,sort:a,is_show:n,parent_id:i})).data.data.status&&(this.$message.success($t("e7ygyc4","添加成功","lang")),this.switchBoxHandle(!0),this.onSearch())}},async fetchList(){this.loading=!0;const{pageIndex:t,pageSize:e}=this.page;let a={page:t,pageSize:e,...this.params};const s=await this.$api.mall_marketing.getMerchantsClassification(a);this.tableList=s,this.loading=!1},onSearch(){this.page.pageIndex=1,this.$nextTick(()=>{this.fetchList()})},onReset(){this.params={...this.initialParams},this.onSearch()},switchBoxHandle(t){this.AddClassifyBox.visible=!t}}},o=a(81656),r=(0,o.A)(l,function(){var t=this,e=t._self._c;return e("div",{staticClass:"classify"},[e("SpFilterForm",{attrs:{model:t.params},on:{onSearch:t.onSearch,onReset:t.onReset}},[e("SpFilterFormItem",{attrs:{prop:"name",label:$t("cdgbq3","内容:","lang")}},[e("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:$t("2jbrwj5","请输入内容","lang")},model:{value:t.params.name,callback:function(e){t.$set(t.params,"name",e)},expression:"params.name"}})],1)],1),e("div",{staticClass:"control"},[e("el-button",{staticStyle:{"margin-right":"10px"},attrs:{plain:"",type:"primary"},on:{click:t.addClassify}},[t._v($t("1wszsz6"," 新增分类 ","lang"))]),e("el-tooltip",{attrs:{content:$t("b66j1d4","商户类型","lang"),placement:"top",effect:"light"}},[e("i",{staticClass:"el-icon-question",staticStyle:{color:"#888"}})])],1),e("div",{staticClass:"list"},[e("el-table",{staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{loading:t.loading,data:t.tableList,border:"","row-key":"id","default-expand-all":"","default-sort":{prop:"sort",order:"ascending"},"tree-props":{children:"children",hasChildren:"hasChildren"}},on:{"sort-change":t.fnSort}},[e("el-table-column",{attrs:{prop:"name",label:$t("av333s4","分类名称","lang")}}),e("el-table-column",{attrs:{prop:"is_show",label:$t("d8pwp54","是否可见","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v(t._s("1"==a.row.is_show?$t("f16a2","可见","lang"):$t("bulbz3","不可见","lang")))])]}}])}),e("el-table-column",{attrs:{prop:"sort",label:$t("hge52","排序","lang"),sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-input",{style:{width:"100px"},attrs:{type:"number",min:"0"},on:{change:function(e){return t.callbackConfirm(a.row,"edit")}},model:{value:a.row.sort,callback:function(e){t.$set(a.row,"sort",e)},expression:"scope.row.sort"}})]}}])}),e("el-table-column",{attrs:{prop:"date",label:$t("hkxb2","操作","lang")},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.children?[e("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(e){return e.preventDefault(),t.addRow(a.row)}}},[t._v($t("1vg0hl6"," 新增子类 ","lang"))])]:t._e(),e("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(e){return e.preventDefault(),t.editRow(a.row)}}},[t._v($t("juz394"," 编辑 ","lang"))]),e("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(e){return e.preventDefault(),t.deleteRow(a.row)}}},[t._v($t("db22k4"," 删除 ","lang"))])]}}])})],1)],1),t.AddClassifyBox.visible?[e("AddClassifyBox",{attrs:{"edit-info":t.editInfo,visible:t.AddClassifyBox.visible,parent_id:t.AddClassifyBox.parent_id,parent_name:t.AddClassifyBox.parent_name},on:{switchBoxHandle:t.switchBoxHandle,callbackConfirm:t.callbackConfirm}})]:t._e()],2)},[],!1,null,"4b8c7034",null).exports,c={data(){return{form:{status:!0,settled_type:[],content:""},h5url:"www.baidu.com"}},mounted(){this.getConfig()},methods:{async getConfig(){const t=await(0,s.getShopConfig)();this.form=t.data.data,this.h5url=t.data.data.h5url,delete this.form.h5url},updateContent(t){this.form.content=t},async submitForm(){(await(0,s.saveShopConfig)(this.form)).data.data.status&&(this.$message.success($t("aghf564","保存成功","lang")),this.getConfig())},onCopy(){this.$notify({message:$t("bkv2mw4","复制成功","lang"),type:"success"})}}},d={components:{Classify:r,BaseCpn:(0,o.A)(c,function(){var t=this,e=t._self._c;return e("div",{staticClass:"baseSetting"},[e("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:t.form,"label-width":"150px"}},[e("el-form-item",{attrs:{label:$t("i5d2wf9","是否允许加盟商入驻","lang")}},[e("el-radio-group",{model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[e("el-radio",{attrs:{label:!0}},[t._v($t("d4nd54"," 允许 ","lang"))]),e("el-radio",{attrs:{label:!1}},[t._v($t("d7exy4"," 关闭 ","lang"))])],1)],1),t.form.settled_type?e("el-form-item",{attrs:{label:$t("jfqxd69","允许加盟商入驻类型","lang")}},[e("el-checkbox-group",{model:{value:t.form.settled_type,callback:function(e){t.$set(t.form,"settled_type",e)},expression:"form.settled_type"}},[e("el-checkbox",{attrs:{label:"enterprise"}},[t._v($t("ciaxz4"," 企业 ","lang"))]),e("el-checkbox",{attrs:{label:"soletrader"}},[t._v($t("aol9ua5"," 个体户 ","lang"))])],1)],1):t._e(),e("el-form-item",{attrs:{label:$t("v3kp6ma","商户入驻链接（H5）","lang")}},[e("span",[t._v(t._s(t.h5url)+" ")]),e("a",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.h5url,expression:"h5url",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:t.onCopy,expression:"onCopy",arg:"success"}],staticStyle:{cursor:"pointer","margin-left":"30px"}},[t._v($t("c2p8uo5"," 复制链接","lang"))])]),e("div",{staticClass:"content"},[e("p",[t._v($t("vc4ms8l","入驻协议内容修改后，提交后对线上客户生效。","lang"))]),e("el-form-item",{attrs:{label:$t("vp4v7b6","入驻协议内容","lang"),"label-width":"100px"}},[e("SpRichText",{model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1)],1),e("el-form-item",{staticStyle:{"text-align":"center","margin-top":"30px"},attrs:{"label-width":"0"}},[e("el-button",{attrs:{type:"primary"},on:{click:t.submitForm}},[t._v($t("cp35x4"," 保存 ","lang"))])],1)],1)],1)},[],!1,null,"5c9ef816",null).exports},data(){return{activeName:"class",tabList:[{name:$t("b517qd4","商家分类","lang"),activeName:"class"},{name:$t("blsc7b4","基础配置","lang"),activeName:"base"}]}}},p=(0,o.A)(d,function(){var t=this,e=t._self._c;return e("SpPage",{staticClass:"merchantsClassification"},[e("el-tabs",{attrs:{type:"card"},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},t._l(t.tabList,function(a,s){return e("el-tab-pane",{key:s,attrs:{label:a.name,name:a.activeName}},["class"==t.activeName?e("Classify"):t._e(),"base"==t.activeName?e("Base-cpn"):t._e()],1)}),1)],1)},[],!1,null,null,null).exports}}]);