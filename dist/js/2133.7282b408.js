"use strict";(self.webpackChunkecshopx_admin=self.webpackChunkecshopx_admin||[]).push([[2133],{32133:function(e,t,a){a.r(t),a.d(t,{default:function(){return o}});var l={name:"SettlementCycle",props:["value"],data(){const{cycle:e="",unit:t=""}=this.value;return{units:[{label:$t("hm11","天","lang"),value:"day"},{label:$t("go81","周","lang"),value:"week"},{label:$t("kco1","月","lang"),value:"month"}],cycle:e,unit:t}},computed:{cycleClass(){const{cycle:e}=this;return["cycle-input",{"is-error":!e}]}},watch:{value(e,t){const{cycle:a="",unit:l=""}=e;this.cycle=a,this.unit=l}},created(){},methods:{onChange(e){this.$emit("input",{cycle:this.cycle,unit:this.unit})}}},i=a(81656),n=(0,i.A)(l,function(){var e=this,t=e._self._c;return t("div",{staticClass:"comp-cycle"},[t("span",{staticClass:"label"},[e._v($t("lan1","每","lang"))]),t("el-input",{class:e.cycleClass,attrs:{type:"text",clearable:"",placeholder:$t("ue3nx08","请输入结算周期数","lang")},on:{change:e.onChange},model:{value:e.cycle,callback:function(t){e.cycle=t},expression:"cycle"}}),t("el-select",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},on:{change:e.onChange},model:{value:e.unit,callback:function(t){e.unit=t},expression:"unit"}},e._l(e.units,function(e){return t("el-option",{key:e.value,attrs:{size:"mini",label:e.label,value:e.value}})}),1)],1)},[],!1,null,"688972fe",null).exports,r=a(22541),c=a(86729),s={name:"",components:{SpSelectSupplier:c.default},data(){const e=this.$createElement;return{merchant_type:"supplier",form:{supplier_id:0,cycleData:{cycle:"",unit:""}},formList:[{label:$t("gidl234","结算周期","lang"),key:"cycleData",component:()=>e(n,{model:{value:this.form.cycleData,callback:e=>{this.$set(this.form,"cycleData",e)}}}),validator:(e,t,a)=>{const{cycle:l,unit:i}=this.form.cycleData;l&&i?a():a(new Error($t("8wc3fv8","结算周期不能为空","lang")))},tip:$t("757dukj","结算说明：结算周期的T+1天生成结算单","lang")}],formQuery:{supplier_name:"",distributor_id:"",merchant_id:"",supplier_id:""},setting:(0,r.createSetting)({actions:[{name:$t("ogvk2","设置","lang"),key:"config",type:"button",buttonType:"text",action:{handler:async([e])=>{this.addForm.id=e.id,this.addForm.distributor_id=e.distributor_id,this.addForm.cycleData={cycle:e.period[0],unit:e.period[1]},this.addForm.distributor_name=e.distributor_name,this.addFormList[0].isShow=!1,this.addDialog=!0}}}],columns:[{name:$t("vm0hbk5","供应商名称","lang"),key:"supplier_name"},{name:$t("gidl234","结算周期","lang"),key:"period",render:(e,{row:t})=>e("span",{},this.getCycle(t.period))}]}),addDialog:!1,addForm:{id:"",distributor_id:"",distributor_name:"",cycleData:{cycle:"",unit:""}},addFormList:[{label:$t("c4b9p3","供应商","lang"),key:"supplier_id",component:()=>e(c.default,{attrs:{clearable:!0,placeholder:$t("l72nr3","请选择","lang")},model:{value:this.addForm.supplier_id,callback:e=>{this.$set(this.addForm,"supplier_id",e)}}}),validator:(e,t,a)=>{const{id:l,supplier_id:i}=this.addForm;l||i?a():a(new Error($t("adohlc4","不能为空","lang")))},isShow:!0},{label:$t("gidl234","结算周期","lang"),key:"cycleData",component:()=>e(n,{model:{value:this.addForm.cycleData,callback:e=>{this.$set(this.addForm,"cycleData",e)}}}),validator:(e,t,a)=>{const{cycle:l,unit:i}=this.addForm.cycleData;l&&i?a():a(new Error($t("8wc3fv8","结算周期不能为空","lang")))}}]}},created(){},mounted(){this.fetch()},methods:{addItems(){this.addForm.id="",this.addForm.distributor_id="",this.addForm.cycleData={cycle:"",unit:""},this.addDialog=!0},async fetch(){const{period:e}=await this.$api.financial.getDefaultSetting({merchant_type:this.merchant_type});2==e.length&&(this.form.cycleData={cycle:e[0],unit:e[1]})},onSearch(){this.$refs.finder.refresh(!0)},beforeSearch(e){return{...e,...this.formQuery}},async onSaveConfig(){const{cycle:e,unit:t}=this.form.cycleData;await this.$api.financial.savePeriodSetting({period:[e,t],merchant_type:this.merchant_type}),this.$message.success($t("aghf564","保存成功","lang"))},async onAddSubmit(){const{id:e,supplier_id:t,cycleData:a}=this.addForm,{cycle:l,unit:i}=a;await this.$api.financial.savePeriodSetting({id:e,supplier_id:t,merchant_type:this.merchant_type,period:[l,i]}),this.$message.success(e?$t("aghf564","保存成功","lang"):$t("e7ygyc4","添加成功","lang")),this.addDialog=!1,this.$refs.finder.refresh(!0)},getCycle(e){const[t,a]=e;return`${t}${{day:$t("hm11","天","lang"),week:$t("go81","周","lang"),month:$t("kco1","月","lang")}[a]}`}}},o=(0,i.A)(s,function(){var e=this,t=e._self._c;return t("SpPage",[t("div",[t("el-tabs",{attrs:{type:"card"}},[t("el-tab-pane",{attrs:{label:$t("qp8b186","结算周期配置","lang")}},[t("SpForm",{attrs:{"form-list":e.formList},on:{onSubmit:e.onSaveConfig},model:{value:e.form,callback:function(t){e.form=t},expression:"form"}})],1),t("el-tab-pane",{attrs:{label:$t("s08l7s7","供应商结算周期","lang")}},[t("SpFilterForm",{attrs:{model:e.formQuery},on:{onSearch:e.onSearch,onReset:e.onSearch}},[t("SpFilterFormItem",{attrs:{prop:"supplier_id",label:$t("afppe54","供应商:","lang")}},[t("SpSelectSupplier",{attrs:{clearable:"",placeholder:$t("l72nr3","请选择","lang")},model:{value:e.formQuery.supplier_id,callback:function(t){e.$set(e.formQuery,"supplier_id",t)},expression:"formQuery.supplier_id"}})],1)],1),t("div",{staticClass:"action-container"},[t("el-button",{attrs:{type:"primary"},on:{click:e.addItems}},[e._v($t("jj2rp39"," 添加供应商配置 ","lang"))])],1),t("SpFinder",{ref:"finder",attrs:{"no-selection":"",setting:e.setting,hooks:{beforeSearch:e.beforeSearch},url:"/statement/period/supplier/setting"}})],1)],1),t("SpDialog",{ref:"addDialogRef",attrs:{title:`${this.addForm.id?$t("vlt1iw5","供应商编辑","lang"):$t("vhi6cp7","添加供应商配置","lang")}`,form:e.addForm,"form-list":e.addFormList},on:{onSubmit:e.onAddSubmit},model:{value:e.addDialog,callback:function(t){e.addDialog=t},expression:"addDialog"}})],1)])},[],!1,null,"0262720c",null).exports}}]);